wheatprojdoc060117.txt

06/01/17:
## talked to Vikas, to do:

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /home/baenziger/pterry
-bash: cd: /home/baenziger/pterry: No such file or directory

## ck Adam, get new HCC acct working
## unclear how Vikas works on this acct, Adam created pterry dir. (OK, Vikas, group works this way) under baenziger in both home & work directories (apparently they don't routinely do ???????). 
So, need **check** wi Vikas, how they work with their directories, and any 'common' dir. ?????????????????????????

## plans for using bedtools to achieve correct numbering for *two part* wheat chromosomes (16 Gb genome). I note the 'locations' were in columns, similar to data.frame structure. Perhaps relatively easy to import into R, manipulate there?

## Vikas to put following file into tusker/share. I can copy it from there.
## Check Adam, my globus not working ??????????????????

Sykes, et al., see discussion, p-356, 
## step 1: PPR.hmm on 
iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
-----------------------------------------------
Contains the protein sequence of all high-confidence (HC) gene models that have been positioned on the IWGSC sequence assembly, without splice variants. Only the representative gene model per locus is given.

06/05/17:
ssh -Y pterry@tusker.unl.edu
# Rrq096mN
cd /home/baenziger/pterry
cd /home/baenziger/shared/RefSeq_v1_Annotation/proteins/
ls -lh
[pterry@login.tusker proteins]$ pwd
/home/baenziger/shared/RefSeq_v1_Annotation/proteins

[pterry@login.tusker proteins]$ ls -lh
total 25M
-rw-r--r-- 1 vbelamkar2 baenziger 25M Apr 11 08:45 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
-rw-r--r-- 1 vbelamkar2 baenziger 118 Apr 11 08:45 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip.md5.txt
logout

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry
mkdir wheatproj
cd wheatproj
cd /work/baenziger/pterry/wheatproj

scp pterry@tusker.unl.edu:/home/baenziger/shared/RefSeq_v1_Annotation/proteins/iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip .
ls -lh

scp pterry@tusker.unl.edu:/home/baenziger/shared/RefSeq_v1_Annotation/proteins/iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip.md5.txt .
ls -lh
## Q: how do md5 ?????????????
md5sum <filetocheck> 
md5sum iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
3acdf6120fcff98d8e65500b24362fe7
cat iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip.md5.txt
The MD5 checksum value is: 3acdf6120fcff98d8e65500b24362fe7
## so checks out.
unzip iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip > iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
## looks like unzip just removes the 'zip' & leaves the '.fa' file, redirect does *not* work, it trying to replace the '.fa' file it just created.

unzip iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
ls -lh
less iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
>TraesCS1A01G000100.1
MRVIALSAGVTPSLRIGLPMCKCRSHGTFLLFGLQSSHLNICYYHQDLPRRPLCPGSRPG
FCSGRRALLLIGAWRSSRWPGVGRAL*
>TraesCS1A01G000200.1
MVNNLWPMEQCRQGKSAKRIRNFGKRICSEDWAQGSRPRTRRLSADCSCCSRGKSRSPRA
GQGTDQESPLRGLSPSMKQSTQNWYGQGESDYLIKTKHCDGPRGN*
## Q: '*' character ??????????????????????????????????????????????????

## OK, what need for input to hmmsearch ?????????????????
## what kind of file is Trinity.fasta.transdecoder.pep  ????????????????
## p-21, Hmmer manual, a 'fasta' file.
## so perhaps I have an appropriate input file.



## plan for using Hmmer for identifying PPR proteins in new wheat genome
## dnload PPR.hmm (done, from http://pfam.xfam.org/family/ppr#tabview=tab6)

## need couple species controls, check Sykes ref, possibly arabidopsis, rice ????? => **see** 1st few sentence 'Discussion' sectiom, rice, brachypodium, & sorghum

## read over Sykes paper again, get 'controls' used there ?????

06/04/17:
## Hmmer steps:
## Hmmer User's Guide, p-21-27, discussing 'hmmsearch' output

06/06/17: 
## line 8189, my **1st** hmmsearch in Bdac... file

ssh -Y pterry@crane.unl.edu 
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh
wc iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
  921676   921676 48634703 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
# grep -c "^>" longest_orfs.pep  ## 158367
grep -c "^>" iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa  ## 110790
## apparently on average, fasta seqs *ave* 7 lines ??????????????

## need scp PPR.hmm to crane

scp PPR.hmm pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
# hmmsearch NB-ARC.hmm Trinity.fasta.transdecoder.pep > hmmsrchshortpep.out
hmmsearch PPR.hmm iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa > PPR.out
## ran almost *instantly*
ls -lh
-rw-r--r-- 1 pterry amundsen   6704453 Jun  6 17:14 PPR.out
less PPR.out
wc PPR.out
 118172  689922 6704453 PPR.out

## now what to do with this output ????????
## initially, perhaps scp it to macbook, examine what have. Think need create a fasta file of top hits (how decide) ???????????
## Q: check Vikas AWK script ???????????????????????????????????????
## from /work/baenziger/pterry/wheatproj/PPR.out file
logout

cd /Users/bterry/macbook2017/vikas17/wheatproj
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/PPR.out .
ls -lh
## Hmmer User's Guide, p-21-27, discussing 'hmmsearch' output
## line 8203 (Bdac...)
## note: PPR.out has *no* 'description' colm entries, hmmsrchshortpep.out *does* ????????
## line 8208, ## 3rd colm, 'bias' ...
## line 8210, The next three colms are again an E-value, score, and bias, but only for the **single** best-scoring domain in the sequence, rather than the sum of all its identified domains.
## line 8213, ## So ***operationally***,
if both E-values are significant (<< 1), the sequence is likely to be homologous to your query.

06/12/17:
## Note: p-544, cheng ref., 0.1 for *full*, 100 for *domain* ??????
## Q: few comments:
## PPR.out, line 1540, 'inclusion threshold'
## p-9, sci. reports, RFL genes  >= 10 p-class ppr motifs, (note: sec 2, PPR.out, line 542, # domains < 10) So, should num. domains affect cutoff for hmmsearch hits ?????????????????
## p-533, cheng ref., PPR proteins, 2 to 30 tandem repeats ??????????????
## p-533, cheng ref., PPR.out, line 1562, criteria cutoff, 
(-E 0.1),
(-E 100)
## compare, hmmer doc, p-23, cutoff E-value <= 10.0, catches *all* 1595 lines sec 2, PPR.out 
## hmmer doc, p-24, sec 3, ...

## talked to Vikas, would like to take hits in PPR.out file using cheng, p-544 criterion of 'full' E-value <= 0.1. This line 1562 and above in sec 2.

06/13/17:
## So, to do, start  wi PPR.out file
i) remove sec 1 above sec 2
cd /Users/bterry/macbook2017/vikas17/wheatproj
head -n 1562 PPR.out | tail -n 1

ii) get sec 2 rows of PPR.out, lines 1562 & above
head -n 1562 PPR.out | tail -n 1546 | head -n 1
head -n 1562 PPR.out | tail -n 1546 > PPRsec2_1562.txt
## Left, remove line 1524, 'inclusion threshold' in new file
## try unix commands before doing wi BBedit, remaining, 1523 lines.
head -n 1523 PPRsec2_1562.txt > top.txt
tail -n 22 PPRsec2_1562.txt > bottom.txt

cat top.txt bottom.txt > tmp.txt
wc -l tmp.txt  ## expect 1545
    1545 tmp.txt

## examine tmp.txt in BBedit, if line above, below 'inclusion threshold' line ok, (looks good) then
mv tmp.txt PPRsec2_1562.txt  ## done, now 1545 in length
wc -l PPRsec2_1562.txt
    1545 PPRsec2_1562.txt  ## ok, have 9 colms

iii) cut colm 9, the 'sequence' colm.
#cut -f 9 PPRsec2_1562.txt | head -n 3
#cut -d ' ' -f 24 PPRsec2_1562.txt > PPRsec2_1562seqname.txt
## *not* working, varying number spaces in lines.
## so, try read into **R**, get 'sequence' colm that way ?????????

#xlsC_up_logdf <- read.delim("xlsC_up_logdf.txt", header=T, sep=" ", stringsAsFactors=FALSE)
## inside rStudio & R
setwd("~/macbook2017/vikas17/wheatproj")
#PPRsec2_1562 <- read.delim("PPRsec2_1562.txt", header=FALSE, sep=" ", stringsAsFactors=FALSE)
dim(PPRsec2_1562)  ## [1] 2290   27 ?????????????????????????????
head(PPRsec2_1562, n=3)
tail(PPRsec2_1562, n=3)
rm(PPRsec2_1562)
PPRsec2_1562 <- read.delim("PPRsec2_1562.txt", header=FALSE, stringsAsFactors=FALSE)
dim(PPRsec2_1562)  ## [1] 1545    1   ???????????????????????????????
head(PPRsec2_1562, n=3)
1    3.1e-147  471.5  44.9    3.7e-09   38.7   0.1   21.3 21  TraesCSU01G134400.1   
## so, right number rows, all in ***one*** colm ??????????????????
class(PPRsec2_1562)  ## [1] "data.frame"
## now what? Can I separate fields into df wi 9 fields ?????????????

#write.table(RefSeqID_seq, file="Trinity.fasta.transdecoder.pep.df.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=TRUE) 
write.table(PPRsec2_1562, file="Testwrite.txt", quote=FALSE, sep="\t", row.names=FALSE) 

## talked to Vikas about working with sec 2, hmmsearch output in PPRsec2_1562.txt.
cat PPRsec2_1562.txt|perl -pe 's/.+(Traes.+)/\1/'| head -n 3
TraesCSU01G134400.1   
TraesCS6B01G108900.1  
TraesCS6A01G081600.2 
## so, looks like successful peeling off colm 9.
cat PPRsec2_1562.txt|perl -pe 's/.+(Traes.+)/\1/' | > PPRsec2 _1562_Seqscolm.txt
## gives error ???????????????
cat PPRsec2_1562.txt|perl -pe 's/.+(Traes.+)/\1/'| head -n 1545 > PPRsec2_1562_Seqscolm.txt
## 1st & last rows look ok.
iv) sort | uniq | length, see if still have same number as in PPRsec2_1562.txt (i.e., are there any duplicates)? Name this file PPRseqnames.txt 

sort PPRsec2_1562_Seqscolm.txt |uniq | wc -l  ##     1545  as expected if each record in unique.

## next use Vikas getsubsetfatofa.awk (getseq.awk) pgm to subset the records selected by hmmsearch in iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa file to file PPR.out.

06/14/17:
## 1st need scp iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa file from crane to macbook.

scp ...
cd /Users/bterry/macbook2017/vikas17/wheatproj
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa .
-rw-r--r--   1 bterry  staff  48634703 Jun 14 10:27 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
ssh -Y pterry@crane.unl.edu 
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -al

## currently 644,
-rw-r--r--@ 1 bterry  staff   1.7K Jun 12 11:40 getseq.awk
## so not executable, Q: the '@' ?????????????????
#chmod u=rwx,g=rx,o=r myfile
chmod 755 getseq.awk
ls -lh
## Q: what wrong? Looks like at https://stackoverflow.com/questions/9991858/how-to-run-a-awk-file
## 1st line script needs to be right ?????????????????????

philip-terry-2:wheatproj bterry$ ./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa PPRsec2_1562_Seqscolm.txt | head -n 3
>TraesCS1A01G031600.1
MDCCCRACRTDLALAFFGRLLRTGLQAGQVVFNTLLKGLCHTKRADEALDVLLHRMPELG
CTPDVVAYNTVIHGFFREGQVGKACDMFHGMAQKGVMPNVVTYNSVIDGLCKARAMDKAE
## so worked.

## To try 
./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa PPRsec2_1562_Seqscolm.txt > PPRhmmsearchsubset.fa
wc -l PPRhmmsearchsubset.fa
   18284 PPRhmmsearchsubset.fa
grep -c "^>Tr" PPRhmmsearchsubset.fa   # 1545 as expect

python seqread.py first6ref.fta
python findcol3.py PPRsec2_1562.txt
## no output ???, perhaps try with make up some file data ??????????????
python findcol3.py
## failed on PPRsec2_1562.txt ????????????????????????????????????????

## OK, ready for next step, 

Vikas email, submit PPRhmmsearchsubset.fa to pfam at:
http://pfam.xfam.org/search#tabview=tab1
## problem, 500 or 5000 limit number sequences ??????????????????????????

06/15/17:
## so try say 1st 500 seqs. Q: how select 1st 500 'name' lines ????????????
grep "^>Tr" PPRhmmsearchsubset.fa > namelines.txt
wc -l namelines.txt  ##     1545 namelines.txt
## so 1st 500 seqs in PPRhmmsearchsubset.fa ends on line 5839
head -n 5839 PPRhmmsearchsubset.fa > PPRhmmsearchsubset1to500.fa
submit PPRhmmsearchsubset1to500.fa to pfam at:
http://pfam.xfam.org/search#tabview=tab1
## 2:16pm, approx wait time, 1hr 34 min.
## Output to browser screen, number of links ??????????
## email
# Your job id was: 0563853C-51FF-11E7-AAEB-FFCADBC3747A
# You can retrieve the **full** results by going to:
# http://www.ebi.ac.uk/Tools/hmmer/results/score/0563853C-51FF-11E7-AAEB-FFCADBC3747A
## complicated output, **HMMSCAN**
# If you have any comments or questions about the use of this service,
# please contact us at: hmmer-help@ebi.ac.uk

## check Vikas, what to do with this output?


## try put couple files in /work/baenziger/share
PPRhmmsearchsubset.fa
PPRhmmsearchsubset1to500.fa

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
ls -lh
cd ..
cd ..
cd shared
ls -lh
mkdir terry
cd terry
mkdir hmm
cd hmm
pwd
logout

cd /Users/bterry/macbook2017/vikas17/wheatproj

scp PPRhmmsearchsubset.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm
scp PPRhmmsearchsubset1to500.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## log back in, check /work/baenziger/shared/terry/hmm dir.
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/shared/terry/hmm
ls -al  ## sizes are same.

06/17/17:
Talked to vikas about:
## search refs for method to subset PLS, P subsets of PPRs ??????******??????
## try cheng paper, which others ???????????????????
## check where mentions particular genes having RF capability ??????????
## 1st 500 results from online hmmscan for PPRhmmsearchsubset1to500.fa.
## Idea: set up pipeline to get the output got in *email* for multiple species. Course, catenate results with more than 500 rows submitted to pfam.
## **pipeline**:
For each species:
i) hmmsearch the .fa file
# hmmsearch PPR.hmm iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa > PPR.out
## so for wheat, done, result PPR.out

ii) get colm 10 from hmmsearch output using vikas **one** line command

philip-terry-2:wheatproj bterry$ grep "Traes" PPR.out|tr -s " " "\t"|awk -F'\t' -v OFS='\t' '$2<0.1 {print $10}' > PPR.out.E0p1.txt
## 1545 records, colm 10.
## *same* as PPRsec2_1562_Seqscolm.txt, also 1545 records

## *testing* getting hmmsearch output into 'handleable' form.
grep "Traes" PPR.out|tr -s " " "\t"|awk -F'\t' -v OFS='\t' '$2<0.1 {print $2, $3, $4, $5, $6, $7, $8, $9, $10}' > test.txt
## looks like got colms 2 thru 10 sep'd wi '\t'

Test read.delim into R? Then try 'dim' number colms? Will I have to try remove removed 1st '\t' in Bbedit before read.delim? (done above)
testdf <- read.delim("test.txt", header=FALSE, stringsAsFactors=FALSE)
dim(testdf)  ##  [1] 1545    9  as expected.
head(testdf, n=3)   ## looks ok

06/18/17:

iii) getseq.AWK script to subset input .fa file
./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa PPRsec2_1562_Seqscolm.txt > PPRhmmsearchsubset.fa
wc -l PPRhmmsearchsubset.fa
   18284 PPRhmmsearchsubset.fa
grep -c "^>Tr" PPRhmmsearchsubset.fa   # 1545 as expect

## for wheat, proceed with use PPRsec2_1562_Seqscolm.txt rather than switching to PPR.out.E0p1.txt produced by Vikas. They the same. 

06/19/17:

iv) upload subset fasta to pfam online for hmmscan search.
## need do 4 times, including repeat of 1 to 500.

## so resubmit PPRhmmsearchsubset1to500.fa to hmmscan online pfam.
http://pfam.xfam.org/search#tabview=tab1
## cp/rename 1st, PPRhmmsearchsubset1to500.fa to PPRhmmsearchsubset1to500_2nd.fa
Your job is queued behind 5123 other searches. (approximate wait time: 2 hours and 51 minutes)
## **error** in receiving results, says on browser, no email message.
## so start another run, with PPRhmmsearchsubset1to500_3rd.fa, started 9:50am.
Your job is queued behind 9146 other searches. (approximate wait time: 5 hours and 5 minutes)
## done by 1 pm.
http://www.ebi.ac.uk/Tools/hmmer/results/AD5CAB18-54FE-11E7-859B-21AF53F04F9B/score
## email results only approx half that vikas recovered ???????????????????
## to send ***email*** to  hmmer-help@ebi.ac.uk
## my questions:

i) having trouble 'capturing' all of the output from an online pfam hmmscan result sent via email. the last line captured is:
>TraesCS1D01G198900.1 193 226 193 226 &n
So, wondering if I am not capturing all the output?

ii) looks like the results in the browser not formatted similarly. Is there some standard way I should be following in accessing the output results?

## prepare 501 to 1000 .fa file for submission to pfam online hmmscan run.
## namelines.txt, line in PPRhmmsearchsubset.fa
>TraesCS3A01G131000.1   501    1st line 5840
>TraesCS5B01G195700.1   1000   line after seq  11826
## 5987, for 'tail'
#head -n 5839 PPRhmmsearchsubset.fa > PPRhmmsearchsubset1to500.fa

head -n 11826 PPRhmmsearchsubset.fa | tail -n 5987 > PPRhmmsearchsubset501to1000.fa
## check, verify in PPRhmmsearchsubset.fa, looks ok, names and line numbers correlate in PPRhmmsearchsubset.fa & PPRhmmsearchsubset1to500.fa

06/21/17:
Vikas request **two** files copy to 'shared' dir, one, PPRhmmsearchsubset.fa, prevly there.
## 2nd
cd /Users/bterry/macbook2017/vikas17/wheatproj
scp hmmscanOP_1-500.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm
ls -al

## talked to vikas:
## to do: read the refs again, try figure out how get hmm specific for 'P' motif
## check 'sci reports'
## check 'Sykes'
## finish 'cheng'

## ready to submit to pfam hmmscan online, but 1st, wait for response to email, and read the refs again, try figure out what to do with hmmscan output ????????????????????????

06/24/17:
Talked to vikas today. Upshot: 
vikas ran MSA for PPRhmmsearchsubset.fa with clustal/omega, then phylogeny, which 'connected' with clustal/omega run.
To graph this, he used 'figtree' (to dnload, install).
## To do: I want to repeat this, learn myself.
## To do: re-read sykes ref, task want to accomplish for wheat proj.
## To do: read BMC genomics, 2014, 15 950.
## now protocol for what want do next:
--get 'cloned' RFSs (see sykes, p-2, sci reports, 1st full paragraph ?????????????
06/25/17:
In Sykes paper, p-354, section 'Phylogenetic Analysis of the RFL Cluster', refers to supplementary table S1, 143 rows, *multiple* species.

In sci. reports paper, page 2, 1st full paragraph, refers to CMS/Rf systems in supp. table S1 (*all* rice species).

06/26/17:
Talked to vikas:
To do: from srep35152-s1.pdf, table S1, take the 42 rows (see p-2, srep35152.pdf), the values in colm 3, 'NCBI reference', get the protein sequences from batch entrez search.
## 1st get colm 3 out of table S1. For now, use BBedit, but later like to put in unix command line with pipes ???????????????
## in BBedit, 3 steps
Find: \w+ \w+ \w+ (.+)
Replace: \1
## manually, write in 'group' for rows 19-2, for 41-42, remove rest 'species', then write in group 
Find: ^group (.+)
Replace: \1
## now, if manually removed line1, 3-7, 40-42 trailer parts from 'cultivar name', could then do cut of new colm2
## try cut
cut -d ' ' -f 2 srep35152-s1_tableS1_copy.txt | head -n 3  ## ok
cut -d ' ' -f 2 srep35152-s1_tableS1_copy.txt | head -n 42 > NCBIrefcolm.txt
## NCBIrefcolm.txt looks ok, 42 rows, has a blank 43 row ??????????????, so removed before proceed.

06/27/17:
## now for batch entrez search at NCBI, upload NCBIrefcolm.txt
## Note: some issues with 'batch entrex' output ?????????
## Q: AB179840 has 3 proteins, 2nd hypothetical tho matches dupl AB179840 , 1st matches on table S1, 3rd hypothetical, no aa seq given ??????????
## Q: note, batch conversion nucleotide to protein does not appear to match protein name from table S1 ???????
## Q: perhaps, manually try match each 'ncbi ref' with protein(s) coded for, select one matches table S1. What about 'ncbi ref' without protein name in table S1 ???????
## Q: or, to try find 'cloned' RF(L) proteins, look t p-2, sci peports, ref papers, try get 'a few' cloned genes ?????????????????????????

## talked to vikas, to manually examine table S1, 'sci reports' paper, each row in 'NCBI ref' colm. Sort of curate which select for 'restorer for CMS' genes to use in phylogeny with wheatproj PPR proteins (detd from PPR.hmm on wheatproj gene proteins. So, from NCBIrefcolm.txt file,

AB106867 /product="PPR protein"
AB110016 /product="Rf1"  (Q: ????????????????????????)

AB195686 /product="PPR protein"
AB470408 /product="pentatricopeptide repeat-containing protein"
         /function="fertility restorer"

AB470409 /product="pentatricopeptide repeat-containing protein"
AB470406 /product="pentatricopeptide repeat-containing protein"

AB470407 /product="pentatricopeptide repeat-containing protein"
DQ311053 /product="PPR protein"

DQ311054 /product="PPR protein"
DQ311052 /product="PPR protein"

AB179840 /product="restorer for CMS", /gene="Rf-1A", /protein_id="BAD20283.1"
AB179840 /product="hypothetical protein", /gene="Rf-1D", /protein_id="BAD20284.1"
AB179840 /gene="Rf-1B", /note="hypothetical protein", /pseudo

AB112811 /product="PPR protein", /function="fertility restoration of CMS", /gene="Rf-1C", /protein_id="BAD13711.1"

AB110443 /product="fertility restorer", /gene="Rf-1", /protein_id="BAD08214.1"
AB110443 /product="hypothetical protein", /gene="PPR794", /protein_id="BAD08211.1"

AB110443 /product="hypothetical protein", /gene="PPR683", /protein_id="BAD08212.1"
AB110443 /product="hypothetical protein", /gene="PPR762", /protein_id="BAD08213.1"

AB110444 /product="hypothetical protein", /protein_id="BAD08215.1"

AB110444 /product="hypothetical protein", /protein_id="BAD08216.1"
AB110444 /product="fertility restorer", /protein_id="BAD08217.1"

AB900791 /product="pentatricopeptide repeat-containing protein", /gene="PPR454", /protein_id="BAQ15368.1", /note="fertility restorer for Wild-abortive (WA) type
                     cytoplasmic male sterility (CMS)"
AB900792 /product="pentatricopeptide repeat-containing protein", /gene="PPR782a", /protein_id="BAQ15369.1", /note="fertility restorer for Wild-abortive (WA) type cytoplasmic male sterility (CMS)"

AB900793 /product="pentatricopeptide repeat-containing protein", /gene="PPR782b",  /protein_id="BAQ15370.1" /note="fertility restorer for Wild-abortive (WA) type cytoplasmic male sterility (CMS)"

AB900794 /product="pentatricopeptide repeat-containing protein", /gene="PPR458", /protein_id="BAQ15371.1", /note="fertility restorer for Wild-abortive (WA) type
                     cytoplasmic male sterility (CMS)"

Os10g0495400 uniprotKB, a seq., but Status Unreviewed
-Annotation score:no score -Protein predicted.

Os10g0495200 uniprotKB, a seq., but Status Unreviewed
-Annotation score:no score -Protein predicted.

Os10g0495100 uniprotKB not coming up, Oryzabase, Search Condition : Keyword(Os10g0495100), link to => big file for AP008216.2

KJ680250 /product="PPR protein PPR9-782-ZH", /gene="Rf4", /protein_id="AIC74552.1", /note="recessive fertility restorer allele for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680249 /product="PPR protein PPR9-782-M", /gene="Rf4", /protein_id="AIC74551.1", /note="fertility restorer allele for wild abortive
                     cytoplasmic male sterility (CMS-WA)"

KJ680248 /product="PPR protein PPR9-782-I", /gene="Rf4", /protein_id="AIC74550.1", /note="fertility restorer allele for wild abortive
                     cytoplasmic male sterility (CMS-WA)"
KJ680247 /product="truncated PPR protein PPR9-409-Z", /gene="Rf4", /protein_id="AIC74549.1", /note="recessive fertility restorer allele for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680253 /product="PPR protein PPR10-469-93", /gene="Rf4-like", /protein_id="AIC74555.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
KJ680252 /product="PPR protein PPR10-454-Z", /gene="Rf4-like", /protein_id="AIC74554.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680251 /product="PPR protein PPR10-454-M", /gene="Rf4-like", /protein_id="AIC74553.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680246 /product="PPR protein PPR8-780-M", /gene="Rf4-like", /protein_id="AIC74548.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
 
KJ680245 /product="PPR protein PPR7-458-ZH", /gene="Rf4-like", /protein_id="AIC74547.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
KJ680244 /product="PPR protein PPR7-458-Z", /gene="Rf4-like", /protein_id="AIC74546.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680243 /product="PPR protein PPR7-458-I", /gene="Rf4-like", /protein_id="AIC74545.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
KJ680242 /product="PPR protein PPR7-454-M", /gene="Rf4-like", /protein_id="AIC74544.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

AB179840 *DUPL* OF ABOVE. 

AK066315 Q: what to think ???????????????? 

06/30/17:
## so, 'FR' & lengths to select from 42 rows from table S1, 'sci reports'
AB470408 266/35 = 7.6
AB179840 790/35 = 22.57
AB112811 794/35 = 22.69
AB110443 791/35 = 22.6
AB110444 266/35 = 7.6
AB900791 455/35 = 13
AB900792 782/35 = 22.34
AB900793 782/35 = 22.34
AB900794 458/35 = 13.09
KJ680249 782/35 = 22.34
KJ680248 782/35 = 22.34

## talked to vikas, would like to next create a fasta file of these 11, append  to PPRhmmsearchsubset.fa (perhaps 1st, do gbLocks MSA for just the 11, see how well they align). 
http://molevol.cmima.csic.es/castresana/Gblocks_server.html
## see JMower course, plant systematics, lab 3, 02/05/16, sec II, 'Trimming alignments'.

07/01/17:
## so *updated* BdactyloidesthruGSEA081615.txt & wheatprojdoc060117.txt to github, planets repo.

## try append the 11 together 1st, then a reg expn to shorten the names on the name rows

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs

ls -lh
cat *seq.txt > FRknownseqs.fa
wc FRknownseqs.fa  ##      
117     180    8533 FRknownseqs.fa
head -n 4 FRknownseqs.fa
grep -c "^>" FRknownseqs.fa  ## 11  ????????????
grep "^>" FRknownseqs.fa > grepoutput  ## 11 rows as expect

## test reg expns in bbedit on grepoutput file.


1st:
(>)\w+\|(.+)
\1\2
>AB110443.1_prot_BAD08214.1_4 [gene=Rf-1] [prot ...

Then:
(>\w+).+
\1
## working with 'fresh' file, like p-28, bottom, haddock & dunn ?????????????????
## To do, same test for FRknownseqs_copy.fa
## looks like success, so rename FRknownseqs_shtname.fa
wc FRknownseqs_shtname.fa
     117     117    7164 FRknownseqs_shtname.fa
grep -c "^>" FRknownseqs_shtname.fa  ## 11 rows as expect


## perhaps try gblocks on FRknownseqs_shtname.fa, see if good alignment before proceed ????
## Note: ***purpose*** of Gblocks: Selection of conserved blocks from multiple alignments for their use in phylogenetic analysis, i.e., couple 'algorithms' to subset MSA to better matching parts of MSA for use in phylogenetic map prepn.

Gblocks did not work
Please check that the file format is correct
Generated by Gblocks Server
## WHAT TO THINK ??????????????????????????????????????????????
## Note in Angiosperm_...-muscle.fas, Gblocks worked ????????
## APPARENTLY GBLOCKS RETURNS ONLY PARTS OF INPUT THAT ALIGN WELL ???????????

## perhaps try FRknownseqs_shtname.fa with clustal/omega (ensembl).
## Q: should the two 7.6 and the two 13 length be retained ???????????? 
## Q: apparently '*', '-', & ':' missing from any column if one row has no aa ??????????
## Q: at least would get these symbols for most of length rest of the rows ?????
## Q: Q: should I try to trim some colms as Gblocks seems to do. Q: output file of Gblocks probably outputs these subsets ??????????????????????????????????

07/02/17:

## at least run clustal/omega *without* these 4 rows, so can see how well rest of rows align. Prepare FRknownseqs_shtname_7.fa from FRknownseqs_shtname.fa. Remove '408', '444', '791' & '794'.
## Getting '*', '-', & ':' symbols out to about 780 aa's.

STOPPED

## Q: test making a tree from this, practice ?????
## ok, *perhaps do*, include the two 13's since > 10, see if changes relationship of seven 22s run by themselves ??????????
## create FRknownseqs_shtname_9.fa from FRknownseqs_shtname.fa (remove '408' & '444')
## run clustal omega on FRknownseqs_shtname_9.fa
 ## phyl. for FRknownseqs_shtname_9.fa, relationships the 7 in FRknownseqs_shtname_7.fa *not* changed.

## so perhaps append the '9' (FRknownseqs_shtname_9.fa) to  PPRhmmsearchsubset.fa, & with with PPRhmmsearchsubset.fa subset by removing all seqs < 10*35 in length. Then perhaps test both ways, thinking Gblocks/JMower strategy for MSA 'trimming' of value ????

## 1st, MSA on FRknownseqs_shtname_9.fa appended to PPRhmmsearchsubset.fa

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
#cat *seq.txt > FRknownseqs.fa
cat PPRhmmsearchsubset.fa FRknownseqs_shtname_9.fa > PPRhmmsearchsubset_plus9.fa
grep -c "^>" PPRhmmsearchsubset_plus9.fa  ## 1554 as expect
## run PPRhmmsearchsubset_plus9.fa on clustal omega, the phylogeny, then figtree
## submitted, 12:16am, 07/03/17.
## apparently ran ~ 20 min.

07/03/17:
## now what, 'send to simple phylogeny' ??????? Try it, no dnside ???????
## **fails**, max 500 aligned seqs allowed.
## so what did Vikas do to get phylogeny on PPRhmmsearchsubset.fa previously ????????


## test 'awk' pgm wi FRknownseqs_shtname_9.fa 1st for counting seq lengths in fasta file.
awk '/^>/ {if (seqlen){print seqlen}; print ;seqlen=0;next; } { seqlen += length($0)}END{print seqlen}' FRknownseqs_shtname_9.fa
## worked!

## talked to Vikas, 
## 1st, went to email link to clustal MCA run for PPRhmmsearchsubset_plus9.fa. Q: now, from this results page, what did ???????????????
## Click on 'Phylogenetic Tree', scroll down a bit, see the '9' grouped together, and 14 closest relatives, all map to 'FR' part of radial tree layout in figtree right next to the 9 rice 'FR' +ve control proteins. Q: might these 14 cluster on new wheat genome as they reportedly do in rice? Is the new wheat seq allow to find their locations, see if they cluster?

07/04/17:
Vikas email, ideas, for going forward.
## from PPRhmmsearchsubset_plus9.fa phylogram, thru 'colors' in figtree, separate P & PLS proteins. 
## Q: any additional subsetting of the proteins from the branches near the leaves ???????????????
## Then, choose subsets of the 'wheat' proteins, like 'PLS', 'P', then hmmalign, hmmbuild, hmmsearch to refine subsets of PPRhmmsearchsubset.fa. Repeat MSA wi clustal, Gblocks, then phylogeny (Mega or what ???) 

07/05/17:
## talked to vikas,
## to do, 
## subset colored rows in file from figtree, PPRhmmsearchsubset_plus9_clustaltree_colored ('P' proteins).

## Note: PPRhmmsearchsubset_plus9_clustaltree_colored has NEXUS phylogenetic tree starting at line. So, just use 1st 1560 lines to get 'colored' rows.
cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy | head -n 1560 > PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560
## check number 'Treas' rows, in, '1560' (1545 as expected) in bbedit. Matches number in PPRhmmsearchsubset.fa.

## now reg expn to get 'colored' subset ('P') list. 

.+(Traes.+\d).+color.+  ## works bbedit, but lines not 'found' by this *remain*.
## so try,
cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 30
## works, replaces matching rows *but* leaves as was any line not matched, i.e., *still* 1560 lins long.
## check number 'color' rows, 820 + 9 as expect as 'AB', 'KJ' not included.

cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 1560 > PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl
## check number of 'Traes' in bbedit, 1545 as expect.

## next,
grep "^Traes" PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl |  head -n 30

## looks like working, so 

grep "^Traes" PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl > PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile
## 820 rows, matching what expect from number of 'color' rows in PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560

## check for duplicates
sort PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile |uniq | wc -l  ##          820  as expected if each record in unique.

07/06/17:
## now, subset PPRhmmsearchsubset.fa fasta file with the PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile listfile. 

## to do, use Vikas getsubsetfatofa.awk (getseq.awk) pgm to subset the records selected by figtree ('color' rows, possibly 'P' proteins) listfile in PPRhmmsearchsubset.fa. Output to PPRhmmsearchsubset_P_prots820.fa

## getseq.AWK script to subset input .fa file

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
./getseq.awk PPRhmmsearchsubset.fa PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile  > PPRhmmsearchsubset_P_prots820.fa
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

## talked to Vikas,

07/07/17:
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/shared/terry/hmm
ls -al  ## sizes are same.
module avail
## muscle/3.8   

07/08/17:
## next steps: starting with PPRhmmsearchsubset_P_prots820.fa
## muscle alignment, ON crane, CHECK if can put out stockholm format ???????????????????, doc, says not,  
## what crane dir to work in ??????
ssh -Y pterry@crane.unl.edu
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots820
cd refinPprots820
## scp PPRhmmsearchsubset_P_prots820.fa to crane, dir = refinPprots820
logout
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

STOPPED

## run muscle on PPRhmmsearchsubset_P_prots820.fa
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj/refinPprots820

## see line 109, srun muscle ...
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load muscle/3.8
cd /work/baenziger/pterry/wheatproj/refinPprots820
muscle -in PPRhmmsearchsubset_P_prots820.fa -out PPRhmmsearchsubset_P_prots820.fa.aln
## ~ 11:25pm => killed, ~ 12:25am, 07/09/17.

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored
PPRhmmsearchsubset_P_prots820 820 seqs, lengths min 151, max 1448, avg 603
00:00:03     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 1
00:00:03     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 2
00:00:30   437 MB(32%)  Iter   1  100.00%  Align node       
00:00:30   441 MB(32%)  Iter   1  100.00%  Root alignment
00:01:34   442 MB(32%)  Iter   2  100.00%  Refine tree   
00:01:34   442 MB(32%)  Iter   2  100.00%  Root alignment
00:01:34   442 MB(32%)  Iter   2  100.00%  Root alignment
00:33:02   442 MB(32%)  Iter   3  100.00%  Refine biparts
srun: Force Terminated job 7945126 85.58%  Refine bipartsfine biparts
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
srun: error: c2017: task 0: Killed 87.29%  Refine biparts
[pterry@login.crane refinPprots820]$ ls -lh
total 512K
-rw-r--r-- 1 pterry amundsen 511K Jul  8 22:08 PPRhmmsearchsubset_P_prots820.fa
[pterry@login.crane refinPprots820]$ 
## Q: EXACTLY WHY KILLED ?????????????????????????????????
## ANYWAY, CHECK ADAM ON MONDAY.
## MEAN TIME, TRY RUN AS SLURM JOB ??????????????????

07/09/17:
## most recent slurm file template: slurm_blastp_uniprotKB_C_UP.sh
## slurm_muscle_wheatproj_refin820.sh
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /home/baenziger/pterry
mkdir scripts
logout
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs

scp slurm_muscle_wheatproj_refin820.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/


ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin820.sh 7955004  16:18pm => ??:??am, 
squeue -u pterry  ## a PD
            JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
           7955004     batch TJob_mus   pterry PD       0:00      1 (Resources)

## Q: still pending at 1pm. How best to reduce resources requested to reduce 'PD' time ??????????????????
## stopped running before 10:22pm

[pterry@login.crane refinPprots820]$ squeue -u pterry
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
## Q: meaning of 'ST'  ???????????????????????

cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
-rw-r--r-- 1 pterry amundsen 602K Jul  9 21:28 job.7955004.err
-rw-r--r-- 1 pterry amundsen    0 Jul  9 19:43 job.7955004.out
-rw-r--r-- 1 pterry amundsen 511K Jul  8 22:08 PPRhmmsearchsubset_P_prots820.fa
-rw-r--r-- 1 pterry amundsen 2.5M Jul  9 21:28 PPRhmmsearchsubset_P_prots820.fa.aln

less job.7955004.err
## many invalid '*' lines.
head -n 12 job.7955004.err
## many of following line in '.err' file.
*** WARNING *** Invalid character '*' in FASTA sequence data, ignored


sacct -j  7955004 -o start,end
              Start                 End 
------------------- ------------------- 
2017-07-09T19:43:42 2017-07-09T21:28:09 
2017-07-09T19:43:42 2017-07-09T21:28:09 
## 21:28:09 - 19:43:42 ~= 1hr 44min run

wc -l job.7955004.err
1660 job.7955004.err
grep -c "***" job.7955004.err
1660    ## so not directly related to 820 input lines ??????????????
## look at last line of error file
tail -n 18 job.7955004.err
*** WARNING *** Invalid character '*' in FASTA sequence data, ignored

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored
PPRhmmsearchsubset_P_prots820 820 seqs, lengths min 151, max 1448, avg 603
00:00:06     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 1
00:00:06     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 2
00:01:02   437 MB(32%)  Iter   1  100.00%  Align node       
00:01:03   441 MB(32%)  Iter   1  100.00%  Root alignment
00:02:07   442 MB(32%)  Iter   2  100.00%  Refine tree   
00:02:07   442 MB(32%)  Iter   2  100.00%  Root alignment
00:02:07   442 MB(32%)  Iter   2  100.00%  Root alignment
00:33:17   442 MB(32%)  Iter   3  100.00%  Refine biparts
01:03:34   442 MB(32%)  Iter   4  100.00%  Refine biparts
01:34:27   442 MB(32%)  Iter   5  100.00%  Refine biparts
01:44:22   442 MB(32%)  Iter   6  100.00%  Refine biparts
01:44:22   442 MB(32%)  Iter   6  100.00%  Refine biparts
[pterry@login.crane refinPprots820]$ 
## ANYTHING TO GLEAN FROM THESE LINES AT END OF ERROR FILE ??????????

## Q: SHOULD I HAVE GOTTEN RID OF THE '*' IN INPUT FILE SEQS BEFORE RUN MUSCLE ???????????????????????
less PPRhmmsearchsubset_P_prots820.fa.aln  ## looks to be *in* MSA fasta format.
head -n 50 PPRhmmsearchsubset_P_prots820.fa.aln
head -n 60 PPRhmmsearchsubset_P_prots820.fa.aln | tail -n 7
## 1st fasta seq has 53 lines

## Q for *Vikas*: convert to stockholm format using Vikas script, OR web converter pgm???????????????????????????????????????????????? 
http://sequenceconversion.bugaco.com/converter/biology/sequences/

07/10/17:
## could scp Vikas fasta2stockholm.pl pgm to crane, make conversion *there* ??????

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp fasta2stockholm.pl pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
chmod 755 fasta2stockholm.pl
./fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
/usr/bin/env: perl -w: No such file or directory  ## ERROR
## Q: perhaps 1st line of '.pl'file needs to be different ?????????????????????????
fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
-bash: fasta2stockholm.pl: command not found  ## ERROR



ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
[pterry@login.crane refinPprots820]$ srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
srun: job 7957944 queued and waiting for resources
srun: job 7957944 has been allocated resources
[pterry@c3713.crane refinPprots820]$ module load perl/5.22
[pterry@c3713.crane refinPprots820]$ fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
bash: fasta2stockholm.pl: command not found
[pterry@c3713.crane refinPprots820]$ ./fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
/usr/bin/env: perl -w: No such file or directory
## Q: so how get run on crane ????????????????????????????????????????????????????

## scp over PPRhmmsearchsubset_P_prots820.fa.aln
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln .
ls -lh
head -n 5 PPRhmmsearchsubset_P_prots820.fa.aln
## Q: which converter, fasta to stockholm  ???????????????????

## try fasta2stockholm.pl on Macbook ?????
fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
-bash: fasta2stockholm.pl: command not found
chmod 755 fasta2stockholm.pl
./fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
more PPRhmmsearchsubset_P_prots820.fa.aln.slx
## so have 'stockholm MSA file
## examine a bit,
head -n 2 PPRhmmsearchsubset_P_prots820.fa.aln.slx
grep -c "Trae" PPRhmmsearchsubset_P_prots820.fa.aln.slx  ## 820, as expect.


## back on crane, *see* if can run the perl script, get '.slx' file there, won't have to scp the '.slx' over from macbook if works.

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx

-rw-r--r-- 1 pterry amundsen 2571524 Jul 10 22:42 PPRhmmsearchsubset_P_prots820.fa.aln.slx  ## same size as on Macbook

## now for *hmmbuild*

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots820

hmmbuild PPRhmmsearchsubset_P_prots820.fa.aln.hmm PPRhmmsearchsubset_P_prots820.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             PPRhmmsearchsubset_P_prots820.fa.aln.slx
# output HMM file:                  PPRhmmsearchsubset_P_prots820.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     PPRhmmsearchsubset_P_prots820.fa.aln   820  3114   727    19.20  0.590 

# CPU time: 3.50u 0.02s 00:00:03.52 Elapsed: 00:00:03.58
ls -al
exit
less PPRhmmsearchsubset_P_prots820.fa.aln.hmm
head -n 17 PPRhmmsearchsubset_P_prots820.fa.aln.hmm
HMMER3/f [3.1b2 | February 2015]
NAME  PPRhmmsearchsubset_P_prots820.fa.aln
LENG  727
ALPH  amino
RF    no
MM    no
CONS  yes
CS    no
MAP   yes
DATE  Mon Jul 10 23:32:32 2017
NSEQ  820
EFFN  19.196854
CKSUM 3787875152
STATS LOCAL MSV      -13.0024  0.69650
STATS LOCAL VITERBI  -14.3885  0.69650
STATS LOCAL FORWARD   -6.2752  0.69650
HMM          A        C        D        E        F        G        H        I        K        L        M        N        P        Q        R        S        T        V        W        Y   

wc PPRhmmsearchsubset_P_prots820.fa.aln.hmm
  2203  38656 339104 PPRhmmsearchsubset_P_prots820.fa.aln.hmm
tail -n 3 PPRhmmsearchsubset_P_prots820.fa.aln.hmm
          2.68100  4.42130  2.77999  2.72243  3.43843  2.42827  3.73790  3.28413  2.67511  2.65416  4.18353  2.92764  2.75690  3.17989  2.88499  2.37939  2.79409  2.98568  4.57761  3.62571
          2.21088  0.11609        *  4.16179  0.01570  0.00000        *
//


## realign using hmm model, hmmalign ?????, Vikas notes, is this a trimming fcn, --trim ????????????????  yes

07/11/17:
## perhaps make *slurm*, as 'timed out' with srun wi muscle above.
/Users/bterry/macbook2016/keenanres16/Bdac/pfam/uniprot

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp slurm_hmmalign_wheatproj_refin820.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refin820.sh 7976540  10:43am => ??:??am, 
squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
           7976540     batch TJob_hmm   pterry PD       0:00      1 (Priority)


cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
-rw-r--r-- 1 pterry amundsen    0 Jul 11 10:48 job.7976540.err
-rw-r--r-- 1 pterry amundsen    0 Jul 11 10:48 job.7976540.out
-rw-r--r-- 1 pterry amundsen 5.8M Jul 11 10:49 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln

sacct -j  7976540 -o start,end
              Start                 End 
------------------- ------------------- 
2017-07-11T10:48:43 2017-07-11T10:49:34 
2017-07-11T10:48:43 2017-07-11T10:49:34 
10:49:34 - 10:48:43 = < 1 min
## Q: is this quick ***ok*** ???????????????????????????????????????????????????????????????

less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
head -n 3 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
tail -n 3 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
grep -c "Trae" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln  ## 26240, so not telling anything ????????????????
wc -l PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
26290 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

## scp following script over to crane, chmod, see if will run

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp stockholm2fasta.pl pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
chmod 755 stockholm2fasta.pl
ls -al
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820
module load perl/5.22
perl stockholm2fasta.pl -c 999999 -g PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa

less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
grep -c ">Traes" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa  ## 820 as expect.
logout

## scp to macbook, examine in bbedit
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa .

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
## examine wi bbedit, or SEA VIEW ??????????????????????????
## 1620 lines in bbedit, not sure could 'trim manually in bbedit ????????????????????????????????????????????????????????????????????????

## Gblocks, try run, with PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
## Save resulting alignment as PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa

## run grep -c 
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
philip-terry-2:FRprotseqs bterry$ grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
grep: PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa: No such file or directory
## WHY THIS ERROR ???????????????????????????????????????????????????????
## copy PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa to test_Gblocks.fa
grep -c "^>Tr" test_Gblocks.fa  ## 820 as expect ???????????????????????

07/12/17:
## JMower, lab 3sec III does parsimony wi MEGA. But I want ML. So check subsequent labs if shows MEGA can receive 'trimmed' file for ML. Looks like lab 4 (871 course, does ML (2/12/2016) with PhyML & MEGA. I note several settings for PhyML & Mega are needed. Might **Vikas** have such for this task for PhyML ???????? Looks like can dnload 'binaries' for PhyML ????????????? BMC genomics paper, p-3, 'default' settings.
## sec II, Running ML using MEGA: what choices need to make for current task ??????
## copy PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa to 'documents dir. Changed extension to '.fas' (probably not necessary. Selected 'all.files'. Then this file name appeared in 'docs' dir. Try open, get **ERROR**, 'invalid data file format specified'.
## addl question, 'out group', 'rooting a tree' ??????????????????
## NOW WHAT ????????????????????????? Problem with PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa *NAME* ????????
## has 4920 lines.

07/13/17:
**TO DO**: TRY COPY TO NEW NAME, DELETE ORIGINAL, COPY BACK TO THIS NAME ?????????????????????
## NOW MEGA CAN 'SEE' THE FILE IN *DOCUMENTS* DIR.
***'test_Gblocks.fa'***  ## 4920 lines
cp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa test_cp_cmd.fa
cp: PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa: No such file or directory
## Q: '@' after file names in ls -al command ????????????????????
## Q: SO JUST TRY CHANGE NAME with 'Finder', not unix cmd line ????? 'PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa' to PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa.NAME.PROBLEM
THEN do 
cp test_Gblocks.fa PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
## then test cp new file to 
cp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa test_cp_cmd.fa
## if successful (worked ok), delete (done) test_cp_cmd.fa

...
## now a menu of choices: 
Model/Method: 8 choices, took default, 'Jones-Taylor-Thornton (JTT) model'
## started 11:23am => ~ 12:30pm, 07/14/17, (~25hrs), 'bootstrapping started'
## four days later, 07/17/17, bootstapping only at 17%. So stop job, remove MEGA6 from macbook, try install MEGA7 (GUI version), restart PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa ML phylogeny.


07/16/17:

ONGOING

## Try install (done), then run on 'macbook pro'.
## Folowing MEGA7-CC-QUICK-START-TUTORIAL.PDF file.

## need scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa from macbook 'documents' dir to crane, then scp this to 'pro' in 'documents' dir.

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al  ## check if there ????
## on 'pro' at 'documents' dir
cd Documents
-rw-r--r-- 1 pterry amundsen  259925 Jul 16 12:14 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa .
ls -al
## on 'pro', 
scp (from crane to 'pro', ...Gblocks.fa file, Documents dir.


## slide 8: launch MEGA-PROTO from 'Applications folder'.
## model/method: 16 options, took 'JTT'
## match rest settings as did on macbook
## save infer_ML_protein_PPR820.mao in default 'bterry' dir.
## Q: skipped slide 15, 'compute timetree (RelTime-ML) ?????????????????????????????????/?????????????????????????????????????????????
## slide 7: to run 'megacc'
megacc ...
## started on 'pro', 12:49pm => 6:13pm, **5 hr 26 min.**

Start time: 16-7-17 12:49:41
Executing analysis:

   94%  Optimizing final tree MEGA-CC has logged the following error:
  When         = 16-7-17 18:13:13
  Data file    = PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
  AnalysisFile = ./infer_ML_protein_PPR820.mao
  Parameter    = -o
  Parameter    = MLtree_PPR820.out
  Message      = Error: Access violation

  Please see the summary file for warnings/messages
  Please validate all your inputs and try again. If you think this is a
  bug, please report it at http://www.megasoftware.net
       100% Analysis Complete                                                               
An unhandled exception occurred at $0002F35E :
EInOutError :
  $0002F35E

EInOutError:
philip-terry:Documents bterry$


## Q: access violation for writing MLtree_PPR820.out, output file, can't find such a file on 'pro' ????????????
## Q: '100% Analysis Complete'
## Q: perhaps check vikas, jmower, bug report to MEGA, OR install, try GUI MEGA on Mac  ?????????????????????????????????

07/17/17:
## Installed mega7(gui) on macbook. Open, won't show PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa in its file display for '.fas' in 'Documents', and for 'all files', when try open, says 'invalid data file format specified'. though it is the output from Gblocks ?????????? This was input in mega7cc on 'pro' yesterday, but 'Error: Access violation' occurred then ?????????????

## talked to Vikas, ideas:
--upload to 'shared' dir, two files,
PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa, & PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs

scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## check if ok
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
ls -al
## notified vikas, email

--try install BioPerl.org/INSTALL.html to see if can get align_convert_fas_to_phy.pl to work.  (crane HAS)
--try stockholm2fasta.pl output in align_convert_fas_to_phy.pl since previously trimmed. (DONE below)
--try PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa in MEGA, i.e., skip Gblocks, already trimmed by hmmalign.
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

07/18/17:
## check if for two '.fa' files,
PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa, & PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa 
## can be subset to <= 10 char for '>' lines.
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa

test3_hmmaln.fa

## will this work ??????
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | head -n 3  ## worked
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+{9})/\1\2/' | head -n 3  ## failed ???
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+){9}/\1\2/' | head -n 3  ## worked
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+){9}/\1\2/' |wc -l  ## 6, ok

cat test4_hmmaln-Gblocks.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | head -n 8  # worked
cat test4_hmmaln-Gblocks.fa|perl -pe 's/(>).+(G.+){9}/\1\2/' | head -n 8 # wrkd
cat test4_hmmaln-Gblocks.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | wc -l  ## 24, ok
## NOTE: EACH SEQ 1 LINE FOR ...hmmaln.fa, BUT MULTIPLE LINES FOR hmmaln-Gblocks.fa  ?????????????????????????????????????????????????????????????

cat PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | wc -l  ## 1640

cat PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | head -n 1640 > PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln_10char.fa  ## has expected 1640 lines, 10 char names.
grep -c "^>" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln_10char.fa  ## 820, ok
grep "^>" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln_10char.fa | sort | uniq | wc -l  ## 768, **NOT UNIQ** ??????????????????????????????????????????
## NOTE: LOOKS LIKE CAN'T PROCEED THIS WAY ??????????????????????????????????
##CAN VIKAS PERHAPS PUT A LOOP INTO AWK (or just iterate integers to translate 'name' fields into >1, ... >820 ??????????????????????????


## while mega proceeding, try **PhyML**.
## look into PhyML, Q: could I use the online version ??????? 
## 1st, need 
*Building phylogeny tree
    Convert the hmm.aln.fas file into phylip format using the perl script
    
        align_convert_fas_to_phy.pl seq.fa.aln.hmmaln.fa

## Could just run this pgm on macbook on file PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
## better do on copy in case '.pl' pgm might change input pgm ???????
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
cp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks_copy.fa
## ERROR, 1ST FILE NAME, QQCH WRONG ?????????????????
## after fix above, copy works ok.

chmod 755 align_convert_fas_to_phy.pl
perl align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks_copy.fa
BEGIN failed--compilation aborted at align_convert_fas_to_phy.pl line 3.
## looks like 'Bio::AlignIO' needed ????????????????????????????????????????
## vikas, HOW TO GET ??????????????????

## Q: FOR VIKAS, fix Bio::AlignIO; ??????????????????????, since soln below to shorten name failed ??????????????????????????????????
## So, **Sat am**, email Vikas.

## for now try for PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks_copy.fa
i) convert fasta to phylip format with online converter 'http://sequenceconversion.bugaco.com/converter/biology/sequences/fasta_to_phylip.php'
## NOTE: **10** char limit, tried internet, no clear solns ??????????

## talked to adam, suggests try crane, bioperl installed there. Q: will this work for Gblocks with multiline seqs ???????????????? So to start:
--scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa to crane
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

--scp align_convert_fas_to_phy.pl to crane
scp align_convert_fas_to_phy.pl pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

--check permissions for the '.pl' file ## already 755

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820
module load bioperl
#perl stockholm2fasta.pl -c 999999 -g 

./align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
## -rw-r--r-- 1 pterry amundsen  911847 Jul 18 22:35 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy

## scp back to macbook, 
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  911847 Jul 18 23:22 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy

less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy
head -n 10 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy
## in bbedit, find 820 'Tra' lines as expect, 727 colms.

ii) then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.
## submitted, 11:59pm. Says, executing PhyML SMS. WAS THIS A GOOD CHOICE ???????
****************************************************************
## **1 day 12 hrs***
## potl FR section of phylogram, to test wi the '14', ck vikas, 'color' icon grayed out ???????????????????????


STOPPED

07/19/17:
## Checked at 9:45am,
ID: 1037530
Analysis name : p_prots820_fa_aln_hmmaln

Running

## to display in figtree

## Note: perhaps repeat, run Gblocks file thru align_convert_fas_to_phy.pl, then PhyML.
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820
module load bioperl

./align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
--------------------- WARNING ---------------------
MSG: Got a sequence without letters. Could not guess alphabet
---------------------------------------------------
## got 5 of these warnings ???????????????????????????
ls -al
-rw-r--r-- 1 pterry amundsen  340299 Jul 19 10:52 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy

## Q: did this work with the 5 warnings? Or perhaps in input file, these seqs 'empty' ???????????????????????
exit
less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  340299 Jul 19 11:02 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy
## check bbedit for 
PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa  ## for missing residues in any seqs. FOUND 5 names with no aa's in the seq. Should I remove them, run align...pl again, or just submit current .phy to PhyML ??????????????????
## initially try latter.
## bbedit of PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy, says finds 'Tr 820 times BUT can't find the 5 names of no aa seqs ?????????????????????????

## so submit to PhyML, PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy
## name it: P_prots820_fa_aln_hmmaln-Gblx, SMS, aLRT.
## started, 12:11pm
## status, running.

07/20/17:
**************************************************************************
## P_prots820_fa_aln_hmmaln-Gblx ran in ***12 hr 28 min***.
## display pprhmmsearchsubset_p_prots820_fa_aln_hmmaln_gblocks_phy_phyml_tree.txt
## in figtree (what format, newick ?????????????)
## note: 4 files in pprhmmsearchsubset_p_prots820_fa_aln_hmmaln_gblocks_phy_phyml dir.
## **DON'T** KNOW BUNCH THIS INFO ?????????????????????
## display in figtree, looks like could be a split FR & rest of P proteins.
##TO DO: might color (grayed out ??????) as Vikas, check of the 14 near seqs prev plot are in the 'FR' section.

## **results**: looks like a set of proteins separated from rest in both phylogram from Gblx & hmmaln. Yet to test with the 14 most closely related to the 9 rice RF's previously. Don't 'color' grayed out on figtree in my hands (ck vikas) ????????? Will ck Adam about PhyML on crane, give us opportunity do bootstrap.
*****************************************************************
## map the 14 on each phylogran, 3 groups, members same on each tree.
******************************************************************
## I note: organization/grouping of the 14 on these plots (1,4,9), and clustal/omega plot before the new wheat ony hmm prepared ***is different***.

## consider get PhyML on crane, in PhyMl_manual_012.pdf, sec 6.4, discusses parallel version of PhyML. Q: is SMS available on dnload version ?????????

## try mega7(gui) wi different input, see if can find file in 'Documents' dir.
## Installed mega7(gui) on macbook. Open, won't show PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa in its file display for '.fas' in 'Documents', and for 'all files', when try open, says 'invalid data file format specified'. though it is the output from Gblocks ?????????? This was input in mega7cc on 'pro' yesterday, but 'Error: Access violation' occurred then ?????????????
## try mega7(gui) on macbook with PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
## would not accept PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa in Documents dir earlier ('invalid data file format specified') ??????????????????????????
## BUT, ACCEPTING PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa *in* Documents dir.
## *no* bootstrap, other options were guesses, start, 7/19/17, 11:35pm => < 5:00am on 07/22/17, so < 53 hrs.

07/21/17:

Waiting MEGA(GUI) to finish ????????????????????????
## Newick_Export.nwk
## rename PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.mega7.nwk
## dir.:  /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/mega7

## checked, '1' powition relative to 2, 3 & 6, 7. In Gblocks, closer to 6. 7. But in two 'hmmaln's, closer to 2, 3, a DIFFERENCE ?????????????????????????????????????


## Talked to VIKAS
i) rerun realign step as per vikas 'Notes_Alignment_UsingHMMs.txt' thru PhyML step, , but with the 'seq.fa' file including the 820 seqs ***+*** the 9 from rice. So will need run 820 + 9 starting with muscle. Q: **how** do they organize in a phylogram with respect to the '14'. Note above, in the phylogram plot before create wheat protein hmm, the 14 **don't** group as they do in most recent two phylograms.
I note: Vikas a **preference** for the hmmaln.fa over the hmmaln-Gblocks.fa trimmed MSA when going for a phylogram.

ii) CYVERSE (Vikas, says has PhyML, MEGA)
pterry, ipWs14
## start at DE (discovery environment), LAUNCH
## sign in
## click apps button
## search: PhyML
## in here, need upload data before can proceed wi phyML run
## click data button, try upload input data to /iplant/home/pterry/analyses

07/22/17:

## OK, prepare input 'phy' data for PhyML on Cyverse. (820 + 9). To do, 

FRknownseqs_shtname_9.fa the '9' rice FR protein fasta file to cat to PPRhmmsearchsubset_P_prots820.fa before 'muscle'
## work in dir /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829
## so copy preceding two files into this dir.
## from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs, PPRhmmsearchsubset_P_prots820.fa
## from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs, 
FRknownseqs_shtname_9.fa
cat PPRhmmsearchsubset_P_prots820.fa FRknownseqs_shtname_9.fa > PPRhmmsearchsubset_P_prots820_plus9.fa
## bbedit, PPRhmmsearchsubset_P_prots820_plus9.fa  ## 829 '>' lines as expect.

STOPPED

07/23/17:
## Q: WHY WOULD NEED MUSCLE HERE, ONCE HAVE 'seq.fa', that is 'ready' for hmmalign step, following 'Notes_Alignment_UsingHMMs.txt' of Vikas.

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -al
mkdir refinPprots820plus9
pwd
cp refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmm refinPprots820plus9/
logout

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829
scp slurm_hmmalign_wheatproj_refin820plus9.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
scp PPRhmmsearchsubset_P_prots820plus9.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820plus9

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
ls -al ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_muscle_wheatproj_refin820.sh
ls -al
sbatch slurm_hmmalign_wheatproj_refin820plus9.sh 8084737  11:29am => ??:??am, 
squeue -u pterry  ## a PD
[pterry@login.crane scripts]$ squeue -u pterry
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
ls -lh
sacct -j  8084737 -o start,end
              Start                 End 
------------------- ------------------- 
2017-07-23T11:29:14 2017-07-23T11:30:09 
2017-07-23T11:29:14 2017-07-23T11:30:09 
## 11:30:09 - 11:29:14 = 55 sec.
less PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

cd /work/baenziger/pterry/wheatproj
cp refinPprots820/stockholm2fasta.pl refinPprots820plus9
cd refinPprots820plus9
ls -al
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
module load perl/5.22
perl stockholm2fasta.pl -c 999999 -g PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa
ls -al
less PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa
grep -c ">" PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa  ## 829 as expect.

STOPPED

## now fas to phy

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots820plus9
cd refinPprots820plus9
ls -al

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
module load bioperl

./align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
## -rw-r--r-- 1 pterry amundsen  921846 Jul 23 13:35 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy

## scp back to macbook, 
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820plus9/PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  921846 Jul 23 13:38 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy

less PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy
head -n 4 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy
 829 727
'TraesCS1A01G222900.1'  ---------- ---------- ---------- ---------- ---------- ---------- 
'TraesCS3D01G317800.1'  -------PQT PTVRRLPMAT TAAA-AAAAT ATASTRANSL SRIFSSSSPT VKPPKHNPNT 
## so phy header 829, 727 as expect

ii) then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.
## submitted, 11:59pm. Says, executing PhyML SMS. WAS THIS A GOOD CHOICE ???????
****************************************************************
## **1 day 12 hrs***
## potl FR section of phylogram, to test wi the '14', ck vikas, 'color' icon grayed out ???????????????????????

07/24/17:
## so updated BdactyloidesthruGSEA081615.txt wheat...060117.txt to github, planets repo.

07/29/17:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt
## the output from french site.
-rw-r--r--@  1 bterry  staff  45412 Jul 25 11:46 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt

## from cyverse site,
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/cyverse/PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy_phyml_cyverse_tree.txt
## the output from cyverse site.
-rw-r--r--@  1 bterry  staff  45412 Jul 30 00:19 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy_phyml_cyverse_tree.txt
## ***same*** number bytes in file from both phylogeny sites.

## might try dnload figtree, Q: subtle, were there couple sites,need choose correct one. But, find printout where dnloaded from previously, **same** URL. I note, figtree 1.4.3 previously installed on 'pro', 

07/30/17:
## try dnload, install figtree v1.4.3.dmg
## when try run, gives **error** as previously, figtree v1.4.3 quit unexpectedly, ...
so in morning, scp twp tree files to 'pro' (still running os 10.10 & figtree v1.4.3 successfully), view in figtree, then mark 'Trae' 1,2,3,6,7 & the 9 rice 'FRs', see how they compare. 

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml

scp pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## go check if looks ok in 'shared' dir ??
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
## ck if number bytes same as before scp
ls -al  ## ok, 
-rw-r--r-- 1 pterry amundsen   45412 Jul 30 10:31 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt

## Now, set up a dir on 'pro', scp thid file over, and run in figtree. 
## create macbook macbookpro2017/vikas17/pyML829 dirs
cd ~
mkdir macbookpro2017
cd macbookpro2017
mkdir vikas17
cd vikas17
mkdir pyML829
cd ~/macbookpro2017/vikas17/pyML829
scp pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt .
ls -lh

## now, on 'pro', load tree file, pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt, in figtree.
##, locate 'Trae' 1,2,3,6,7 on tree
## 1 by self, r1,r2,r3,r4,r6,r7,r8,r9 near 2 & 3, r5 near 6 & 7 (????). So, split of the 9 rice proteins into two groups of sizes 1 & 8. 

## For 829 PhyML phylogram, 820 wheat proteins grouping similarly to PhyML 820 phylogram. For 829 PhyML phylogram, nine rice proteins group into two groups, r5 groups with 'Trae' 6, 7, 8, 10. Other 8 rice proteins group with 2,3,4,5,9,11,12,13,14 Trae wheat proteins (9 group). THOUGH the rice proteins group by selves on the shorter branch beside the '9 group'. What to think?

## Q: don't see 'aLRT' on branches ??????????????????

## If believe rice proteins good FR proteins, then perhaps grab (how many) wheat proteins near the rice eight group?
## Probably in any case, look for more proven FR proteins from other species.
## Would help to understand more about these proteins, correlate domains with proteins displaying near the eight rice proteins.

08/02/17:
## talked to Vikas
## so, highlighted two branches as possible FR's, red (8 rice FRs colocate) blue, (1 rice FR co-locates). 
## figtree, **save as** 820plus9nexustree_colors on 'pro'. A nexus file wih the colored rows representing the possible FR's co-locating near the rice FR's, either the group of 8, or the group of 1.
## rename to:
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt
## REQUEST: this file to **'shared'** dir on crane.
scp ...to crane 'shared' from 'pro', done.
scp ... to dir on Macbook:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
ls -al  ## two files of interest look fine.

-rw-r--r-- 1 pterry amundsen   70689 Aug  2 22:05 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt
-rw-r--r-- 1 pterry amundsen   45412 Jul 30 10:31 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml

scp pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt .
ls -lh
-rw-r--r--@  1 bterry  staff  45412 Jul 25 11:46 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt
-rw-r--r--   1 bterry  staff  70689 Aug  2 22:39 pprhmmsearchsubse t_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt

## saved wheatprojdoc060117 to github.
## macbook froze, had to hit power button to recover. Afterward cursor seemed ok again, so tried to install figtree again, FAILED again. Note is error message mentions 'java' application. PERHAPS THIS WHERE COULD WORK. PERHAPS CALL **APPLECARE**. 1-800-275-2273. www.apple.com/support/macbook, july 05, 2015.


07/05/17:
phoned applecare, result: Demonstrated > java 1.6 installed. At URL,
https://java.com/en/download/help/version_manual.xml
...
The JRE and JDK are separate and can coexist on your system. Only **one** JRE can be installed on Mac. There can be multiple JDKs installed on a system, as many as you wish.

JRE Version Command Line on Mac

Type the following in a Terminal window:

philip-terry-2:planets bterry$ /Library/Internet\ Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -version
java version "1.8.0_144"
Java(TM) SE Runtime Environment (build 1.8.0_144-b01)
Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)
philip-terry-2:planets bterry$ 

## so, apparently evidence > ver 1.6 installed.

## **or** in the **java control panel**

Your system has the recommended version of Java.
Java 8  update 144

## or at URL:
https://support.apple.com/en-us/HT204036

Note: You can also download legacy Java SE 6 from Apple if you’re using an app that specifically requires this unsupported, out-of-date version.

Perhaps see if Vikas can get figtree to work on his mac sierra' If can then, perhaps I try load **legacy** ver of java, see if that allows figtree to  install. Q: apparently both versions cannot coexist ????????????????/

STOPPED

08/09/10:

## looking thru 2nd paragraph, p-2, srep35152.pdf ref., ref 8 there, looking for verified RF gene/protein for more detailed comparison to possible red or blue wheat proteins. 
## Q: trying get seq from ensembl ??????????????

08/10/17:

## talked to vikas,
## Rf-1, try get GFF file from ensembl plants, use fig 3 notation try get seq. for 'RF-1 RF protein.
## from ftp://ftp.ensemblgenomes.org/pub/plants/release-36/gff3/oryza_sativa/, see File: File:Oryza_sativa.IRGSP-1.0.36.chromosome.10.gff3.gz
	566 KB 	6/7/17
## TO DO: open, check for addresses like fig 3, sci reports ref.
## put in dir orysa_sativa+gff3
gunzip ...

## note: refs 26, 27 ???????????????????

08/11/17:
## copied to github, version this file copied to extl hdrive, 08/11/17

## Look in sci reports for a second method to find RF proteins (read fig 1 ???)

## Look in sci reports, fig 3, ensembl plants, are the 'Os_10_17173' refs into gff3 file ????????????????

08/13/17:
## TO DO, subset the red & blue rows separately. Refer to as nearricesubsetof8 (red) & nearricesubsetof1 (blue).
## see line 1633
## ref. see line 642 above ????????????????

## to do, (from 642 - 676 above)
## subset colored rows in file from figtree, 
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt ## ('P' proteins)

## Note: ## pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt has NEXUS phylogenetic tree starting at line 837. So, just use 1st 837 lines to get 'colored' rows.

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt | head -n 835 > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt

## check number 'Treas' rows, in, '835' (835 as expected) in bbedit. Matches number in PPRhmmsearchsubset.fa (??????????????????????????????????)
grep -c "Traes" pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt   # 820 as expect

## now reg expn to get 'colored' subset ('P') list. 

grep '.*Traes.*ff\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt | head -n 4  ## worked

grep '.*Traes.*ff\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt | wc
      22      22     899  ## correct for Traes 'blues'
## note, has *one* of 9 rice RFs nearby
grep '.*Traes.*ff\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue.txt

grep '.*Traes.*00\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt | wc
     122     122    5002

grep '.*Traes.*00\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red.txt

## now pull out of 'red' & 'blue' 'P' proteins the name will use to go back and get their aa seq.

.+(Traes.+\d).+color.+  ## works bbedit, but lines not 'found' by this *remain*.
## so try,

# cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 30

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue.txt|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 22

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue.txt|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 22 > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red.txt|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 122 > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt

08/14/17:

## check for duplicates [TO DO ????????]
sort PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile |uniq | wc -l  ##          820  as expected if each record in unique.

07/06/17:
## now, subset PPRhmmsearchsubset_P_prots820plus9.fa fasta file with the 
with 'red' (122 proteins) & 'blue' (22 proteins) from figtree color. 

## file to subset with 'blue' & 'red' proteins is 
PPRhmmsearchsubset_P_prots820plus9.fa

## need copy down from extl hdrive, done.

## to do, use Vikas getsubsetfatofa.awk (getseq.awk) pgm to subset the records selected by figtree ('color' rows, possibly 'PF' proteins) in 'blue' or 'red' listfiles in PPRhmmsearchsubset_P_prots820plus9.fa. Output to 
PPRhmmsearchsubset_P_prots820plus9_blue.fa or PPRhmmsearchsubset_P_prots820plus9_red.fa

STOPPED


## getseq.AWK script to subset input .fa file
## getseq.AWK script to subset input .fa file
## ref: line 1657 above

## cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
## ./getseq.awk PPRhmmsearchsubset.fa PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile  > PPRhmmsearchsubset_P_prots820.fa
## grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

cd /Users/bterry/macbookpro2017/vikas17/tmp081117reparemacbook

./getseq.awk PPRhmmsearchsubset_P_prots820plus9.fa pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt > PPRhmmsearchsubset_P_prots820plus9_blue.fa

# grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

grep -c "^>Tr" PPRhmmsearchsubset_P_prots820plus9_blue.fa   # 22 as expect

## now for the red

./getseq.awk PPRhmmsearchsubset_P_prots820plus9.fa pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt > PPRhmmsearchsubset_P_prots820plus9_red.fa

grep -c "^>Tr" PPRhmmsearchsubset_P_prots820plus9_red.fa   # 122 as expect

08/15/17:
## I ***note*** for pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt file, 
## 119 of 122 rows either chr 1,2,or 6. And 8 rice RF proteins near, **but** by themselves. Pattern ***similar*** rice p-4, sci. reports ref. paper.

## talked to Vikas,
## try a 2nd method for grouping (see Sci Reps paper, srep35152.pdf)
## **Note**: for red set, chr 1,2,6 have 119 of the 122 rows.

08/17/17:
orthofinder plan:
## prepare to run on crane ??????????
## get 9 rice RF genes in a fasta file.
FRknownseqs_shtname_9.fa
PPRhmmsearchsubset_P_prots820.fa
grep -c "^>" FRknownseqs_shtname_9.fa   # 9 as expect
grep -c "^>" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

## ref: https://github.com/davidemms/OrthoFinder
## Aside: try run these two files in orthoMCL online (Q: can't find online site ??????????, ck if vikas can find ??????????????????

08/18/17:
## scp the two orthofind input files to dir ???? on crane.
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry
mkdir ofinder  ## where plan to place orthofinder input files.
/work/baenziger/pterry/wheatproj/ofinder

## scp the two files 
cd /Users/bterry/macbookpro2017/vikas17/tmp081117reparemacbook

scp rice9.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder
scp wheat820P.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder

## Adam on crane
## installed OrthoFinder-1.1.8.tar.gz
## to test, Q: are dependencis needed here ??????????
module avail
   blast/2.4     ## Q: is this blast ok ????????????????????
   mcl/14.137

module spider orthofinder  

STOPPED

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/ofinder
ls -lh
cd ..
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj
module load blast/2.4   ## ## Q: is this blast ok ????????????????????
module load mcl/14.137
module load orthofinder/1.1
OrthoFinder-1.1.8/orthofinder -h ## OrthoFinder should print its 'help' text.
bash: OrthoFinder-1.1.8/orthofinder: No such file or directory
????????????????????????????????????????????????????????????????
orthofinder -h  ## outputs help info.
## example test
# OrthoFinder-1.1.8/orthofinder -f ExampleDataset
orthofinder -f ExampleDataset
...
IOError: [Errno 2] No such file or directory: '/lustre/work/baenziger/pterry/wheatproj/ExampleDataset/SimpleTest.phy'
???????????????????????????????????????????????????????????
## perhaps need ExampleDataset/SimpleTest.phy in dir wheatproj ???????

cd /work/baenziger/pterry/wheatproj
## orthofinder -f fasta_files_directory [-t number_of_threads]
orthofinder -f ofinder
[pterry@c0912.crane wheatproj]$ orthofinder -f ofinder
OrthoFinder version 1.1.8 Copyright (C) 2014 David Emms

    This program comes with ABSOLUTELY NO WARRANTY.
    This is free software, and you are welcome to redistribute it under certain conditions.
    For details please see the License.md that came with this software.

16 thread(s) for highly parallel tasks (BLAST searches etc.)
1 thread(s) for OrthoFinder algorithm

## what to think ???????????????
## if run **slurm** what parameters to choose ????????????????????
## match number tasks with number_of_threads
orthofinder -f ofinder [-t number_of_threads]

cd /Users/bterry/macbookpro2017/vikas17/tmp081117reparemacbook
scp slurm_ofinder_wheatproj_inp820and9.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
less slurm_ofinder_wheatproj_inp820and9.sh
## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh

08/19/17:
sbatch slurm_ofinder_wheatproj_inp820and9.sh 8443947  12:15am => ??:??am, 
squeue -u pterry  ## a PD

cd /work/baenziger/pterry/wheatproj
less job.8443839.out
Unrecognised argument: [-t

ERROR: An error occurred, please review previous error messages for more information.
job.8443791.out (END) 
## try [ -t 4], if still fails (does), skip specifying number of threads.
squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
           8443947     batch TJob_ofi   pterry  R       0:46      1 c3713
## ok, running

cd /work/baenziger/pterry/wheatproj
ls -al
less job.8443947.out
cat job.8443947.out
## looks like orthogroup output produced.

[pterry@login.crane Results_Aug19]$ ls -al
total 92
drwxr-xr-x 4 pterry amundsen  4096 Aug 19 00:57 .
drwxr-xr-x 4 pterry amundsen  4096 Aug 19 00:14 ..
-rw-r--r-- 1 pterry amundsen   932 Aug 19 00:57 Orthogroups.csv
-rw-r--r-- 1 pterry amundsen    43 Aug 19 00:57 Orthogroups.GeneCount.csv
-rw-r--r-- 1 pterry amundsen    44 Aug 19 00:57 Orthogroups_SpeciesOverlaps.csv
-rw-r--r-- 1 pterry amundsen 25932 Aug 19 00:57 Orthogroups.txt
-rw-r--r-- 1 pterry amundsen 25863 Aug 19 00:57 Orthogroups_UnassignedGenes.csv
drwxr-xr-x 4 pterry amundsen  4096 Aug 19 00:57 Orthologues_Aug19
-rw-r--r-- 1 pterry amundsen     0 Aug 19 00:57 SingleCopyOrthogroups.txt
-rw-r--r-- 1 pterry amundsen  1407 Aug 19 00:57 Statistics_Overall.csv
-rw-r--r-- 1 pterry amundsen  1773 Aug 19 00:57 Statistics_PerSpecies.csv
drwxr-xr-x 2 pterry amundsen  4096 Aug 19 00:57 WorkingDirectory
[pterry@login.crane Results_Aug19]$ 
## anything useful in  WorkingDirectory ?????????????????????
## so look inside Orthogroups.csv
less Orthogroups.csv
cat Orthogroups.csv
less Orthogroups_UnassignedGenes.csv
less Orthogroups.txt
less Statistics_Overall.csv
cat Statistics_Overall.csv
less Statistics_PerSpecies.csv
cat Statistics_PerSpecies.csv
less Orthogroups_SpeciesOverlaps.csv
        rice9   wheat820P
rice9   1       1
wheat820P       1       1
Orthogroups_SpeciesOverlaps.csv (END) 
## ok, want to see if 39 wheat proteins in Orthogroups.csv are a subset of 122 'red' proteins from ML phylogeny previously.
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder/Results_Aug19/Orthogroups.csv .

## to do: compare results of ML phylogeny estimate of RF proteins in 820 wheat P proteins (red, 122, blue, 22). Determine how many of Orthogroups.csv wheat proteins (39) (formatted as vectors in Ogroups_copy.csv) are in the red & blue P subsets.
## So, need files 
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt
R
## from Ogroups_copy.csv
wheat820P <- c(TraesCS1A01G054500.1, TraesCS1A01G054700.2, TraesCS1A01G067400.1, TraesCS1A01G067600.1, TraesCS1B01G071600.1, TraesCS1B01G072400.1, TraesCS1B01G072900.2, TraesCS1B01G074600.1, TraesCS1B01G075000.1, TraesCS1B01G085300.1, TraesCS1B01G085900.1, TraesCS1D01G056200.1, TraesCS1D01G058200.1, TraesCS1D01G068400.1, TraesCS1D01G068500.1, TraesCS1D01G068800.1, TraesCS1D01G068900.1, TraesCS5B01G250800.1, TraesCS6A01G014500.1, TraesCS6A01G014600.1, TraesCS6A01G014800.1, TraesCS6A01G014900.1, TraesCS6A01G015000.1, TraesCS6A01G083000.1, TraesCS6A01G311600.1, TraesCS6B01G021200.1, TraesCS6B01G021500.1, TraesCS6B01G021600.1, TraesCS6B01G045200.1, TraesCS6B01G114300.1, TraesCS6D01G017700.1, TraesCS6D01G017800.1, TraesCS6D01G047700.1, TraesCS6D01G076500.1, TraesCS6D01G290900.1, TraesCS7D01G487500.1, TraesCSU01G089700.1, TraesCSU01G089800.1, TraesCSU01G090200.1)
## How read in red, blue files ???????????

08/20/17:
## methods, 
i) https://stackoverflow.com/questions/3695677/how-to-find-common-elements-from-multiple-vectors
ii) p-222, v buffalo

## try read into R
setwd("~/macbookpro2017/vikas17/tmp081117reparemacbook/r_stuff")
 ## p-196, v buffalo
#testdf <- read.delim("test.txt", header=FALSE, stringsAsFactors=FALSE)
bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)  ##  [1] 22  1  as expected.
head(bluedf, n=3)   ## looks ok
class(bluedf)
reddf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("red"))
dim(reddf)  ##  [1] 22  1  as expected.
head(reddf, n=3)   ## looks ok
class(reddf)
#wheat820P <- c(TraesCS1A01G054500.1, TraesCS1A01G054700.2, TraesCS1A01G067400.1, TraesCS1A01G067600.1, TraesCS1B01G071600.1, TraesCS1B01G072400.1, TraesCS1B01G072900.2, TraesCS1B01G074600.1, TraesCS1B01G075000.1, TraesCS1B01G085300.1, TraesCS1B01G085900.1, TraesCS1D01G056200.1, TraesCS1D01G058200.1, TraesCS1D01G068400.1, TraesCS1D01G068500.1, TraesCS1D01G068800.1, TraesCS1D01G068900.1, TraesCS5B01G250800.1, TraesCS6A01G014500.1, TraesCS6A01G014600.1, TraesCS6A01G014800.1, TraesCS6A01G014900.1, TraesCS6A01G015000.1, TraesCS6A01G083000.1, TraesCS6A01G311600.1, TraesCS6B01G021200.1, TraesCS6B01G021500.1, TraesCS6B01G021600.1, TraesCS6B01G045200.1, TraesCS6B01G114300.1, TraesCS6D01G017700.1, TraesCS6D01G017800.1, TraesCS6D01G047700.1, TraesCS6D01G076500.1, TraesCS6D01G290900.1, TraesCS7D01G487500.1, TraesCSU01G089700.1, TraesCSU01G089800.1, TraesCSU01G090200.1)
## won't work for char data
sed 's/^/"/' testOgroups.txt
sed 's/^/"/' whtOgroup.txt | sed 's/$/", /' > whtOgroupsed.txt

## before do any more, try read whtOgroup.txt into R.
whtOgroupdf <- read.delim("whtOgroup.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOgroupdf)  ##  [1] 39  1  as expected.
head(whtOgroupdf, n=3)   ## looks ok
class(whtOgroupdf)
intersect(whtOgroupdf$whtOgrp, bluedf$blue)  ## 7 proteins
intersect(whtOgroupdf$whtOgrp, reddf$red)  ## 29 prots
## so, 39 - 36 = 3 prots not in common.
## now venn diagram or 'UpSetR', Gehlenborg ??????????

08/23/17:
*********************************************************************
Brought this file back from 'pro' today, so when decide, will backup to github.
**********************************************************************

Talked to vikas yesterday:
1) would like to create 1 file of 820+9. See what happens for following:
i) run online with orthoMCL
ii) run on orthofinder
## if result same as when ran separate files 820 & 9, then don't do (2) below.
2) run 820 wheat P seqs vs those for a rice genome P's (how get???). Include the '9' RF's from previous runs. See if find more orthogroups (only got 1 wi 820 & 9 ?????????

08/25/17:
talked to vikas.
## vikas request to 'shared' dir on crane, 
a) the 36 wheat proteins found as RF's in orthoFinder run on 820 & 9 files above.
b) previously did not have 829 file, only 820 & 9, so copy two input files for orthoFinderb to 'shared'.
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh  ## ck dir contents?
cd ofinder
## rice9.fa, wheat820P.fa
cd /work/baenziger/shared/terry/hmm
cp /work/baenziger/pterry/wheatproj/ofinder/*.fa .  ## ok, done


08/26/17:
## before do any more, try read whtOgroup.txt into R.
whtOgroupdf <- read.delim("whtOgroup.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOgroupdf)  ##  [1] 39  1  as expected.
head(whtOgroupdf, n=3)   ## looks ok
class(whtOgroupdf)

bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)  ##  [1] 22  1  as expected.
head(bluedf, n=3)   ## looks ok
class(bluedf)
reddf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("red"))
dim(reddf)  ##  [1] 22  1  as expected.
head(reddf, n=3)   ## looks ok
class(reddf)

Ofinder_blue <- intersect(whtOgroupdf$whtOgrp, bluedf$blue)  ## 7 proteins
Ofinder_red <- intersect(whtOgroupdf$whtOgrp, reddf$red)  ## 29 prots
## so, 39 - 36 = 3 prots not in common with RF phylogenetic ML analysis proteins.
write.table(Ofinder_blue, file="Ofinder_blue.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="blue")
write.table(Ofinder_red, file="Ofinder_red.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="red")

cat Ofinder_blue.txt Ofinder_red.txt > Ofinder_blueandred36.txt
## to copy to 'shared' on crane: Ofinder_blueandred36.txt

scp Ofinder_blueandred36.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm  ## ok, done

08/27/17:

1) would like to create 1 file of 820+9. See what happens for following:
i) run online with orthoMCL
ii) run on orthofinder

1st, cp rice9.fa & wheat820P.fa from /Users/bterry/macbook2017/vikas17frompro/tmp081117reparemacbook/
## to /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
cat rice9.fa wheat820P.fa > rice9wheat820P.fa
ls -al

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh  ## ck dir contents?
mkdir ofinder1
cd ofinder1

## scp rice9wheat820P.fa to ofinder1
scp rice9wheat820P.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder1
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/ofinder1
ls -lh  ## ck dir contents?
## now change slurm, scp over to crane
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
scp slurm_ofinder1_wheatproj_inp829.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/
## now run the slurm Job
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
#cd /work/baenziger/pterry/wheatproj
cd /home/baenziger/pterry/scripts

sbatch slurm_ofinder1_wheatproj_inp829.sh 8532901  1:08pm => ??:??am, 
squeue -u pterry  ## a PD

less job.8532901.err
Traceback (most recent call last):
  File "/util/opt/anaconda/4.3/envs/orthofinder-1.1.8/bin/orthofinder", line 1499, in <module>
    clustersFilename_pairs, statsFile, summaryText, orthogroupsResultsFilesString = DoOrthogroups(options, dirs, seqsInfo)    
  File "/util/opt/anaconda/4.3/envs/orthofinder-1.1.8/bin/orthofinder", line 1239, in DoOrthogroups
    summaryText, statsFile = Stats(ogs, speciesNamesDict, dirs.speciesToUse, dirs.resultsDir, iResultsVersion)
  File "/util/opt/anaconda/4.3/envs/orthofinder-1.1.8/bin/orthofinder", line 673, in Stats
    writer_sp.writerow(["Percentage of orthogroups containing species"] + [percentFormat % (100.*sum([iSp in og_sp for og_sp in speciesPresence])/len(properOGs)) for iSp in iSpecies])
ZeroDivisionError: float division by zero
job.8532901.err (END) 

## ***what to think*** ??????????????????????

less job.8532901.out
cat job.8532901.out
less Orthogroups.csv
        rice9wheat820P
Orthogroups.csv (END) 
## looks like ***no*** proteins reported in orthogroup ?????????????????

[pterry@login.crane Results_Aug27]$ cat Statistics_Overall.csv
Number of genes	829
Number of genes in orthogroups	0
Number of unassigned genes	829
Percentage of genes in orthogroups	0.0
Percentage of unassigned genes	100.0
Number of orthogroups	0
## NO genes in orthogroups
## So, have not proven that that using only **1** input .fa (rice9wheat820P.fa) file caused the failure to find any proteins in Orthogroups.csv output file. 

## for now, move on to try the **one** file (rice9wheat820P.fa) with orthoMCL online run. Tho I don't see a ratioale to do this, but if orthomcl only allows 1 file? Perhaps run a 2nd with ric9.fa & wheat820P.fa ???????
## dir is:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
## orthomcl: http://orthomcl.org/orthomcl/proteomeUpload.do
## submitted 9:30pm, 08/27/17.

08/28/17:
## result from orthomcl with one input file, /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/rice9wheat820P.fa
## results in /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/omclonline/orthomclResult-2V0ZL87G4ZTZ/orthologGroups file.

## talked to vikas, he went and found one of the rice 9 proteins (row) in this output file, 

AB110443	OG5_131220	osat|NP_001064958	0	-181	89	99

## noted OG5_131220 orthomcl_group same for all 9 rice RF proteins. Q: why only 828 records ???????????????????
## anyway, search in bbedit for OG5_131220 rows gives 144 rows, similar to number for 'blue' & 'red' results from phylogenetic ML analysis. 

## so, *to do*, compare this 144 with the 144 'blue' & 'red' phylogenetic ML analysis proteins. If roughly same set, then **two independent** ways to identify. Also, score what chromosomes these hits are on. Q: are they preponderantly on 1, 2, & 6 ??????????

08/29/17:

## so need:
--144 rows from orthoMCL
--red & blue protein lists from phylogenetic ML analysis

## for reference, place intersect.R in dir.:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff
## cp to this dir:
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt
## now, from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/orthomclResult-2V0ZL87G4ZTZ
## cp over orthologGroups to /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff
## now make copy of orthologGroups, then subset inside bbedit to oGroups144.txt


grep '.*OG5_131220.*$' oGroups144.txt > Test
## deleted oGroups144.txt, renamed test to oGroups144.txt.

## next, cut 1st colm from oGroups144.txt, then ready for r code for intersect test.
## from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff

cut -f 1  oGroups144.txt | head -n 3
cut -f 1  oGroups144.txt > oGroups144col1.txt  ## ok, 144 rows

## now for the intersect from R code
whtOMCLgroupdf <- read.delim("oGroups144col1.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOMCLgroupdf)
head(whtOMCLgroupdf, n=3)
class(whtOMCLgroupdf)

bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)
head(bluedf, n=3)

reddf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("red"))
dim(reddf)
head(reddf, n=3)

Ofinder_blue <- intersect(whtOMCLgroupdf$whtOgrp, bluedf$blue)
Ofinder_red <- intersect(whtOMCLgroupdf$whtOgrp, reddf$red)

## check
red_blue_overlap <- intersect(reddf$red, bluedf$blue)
length(red_blue_overlap)  ## 0 as expect

write.table(Ofinder_blue, file="OfinderMCL_blue.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="blue")
write.table(Ofinder_red, file="OfinderMCL_red.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="red")

## so, 10 of 22 'blue' phylogenic ML proteins match with OfinderMCL OG5_131220 orthomcl_group proteins, 122 of 122 'red' phylogenic ML proteins match with OfinderMCL OG5_131220 orthomcl_group proteins (135 OfinderMCL proteins). For the 'red', 122/820 and 122 (of 135)/820 orthoMCL match. Statistically, this degree of matching would not appear to be by chance. So if one can view othoMCL & phylogeny ML as independent methods, then the matching proteins related. 

## next step. Doc chromosomes for the 'red' 122?
## next step, perhaps do orthoMCL for the 820 wheat P proteins vs one of the rice protein genome proteins (1st do hmmPPR.hmm for the rice proteins to select P subset), or don't subset 1st, let orthoMCL find as many orthogroups as can? Guess just put all in one file? That is, try broaden search for RF proteins?

08/30/17:
## talked to vikas 
1) ## **to do** request put 147 wheat proteins on 'shared'. Q: how got 147? 122 (match 'red') + 10 (match 'blue'). Q: how get the additional 15? Perhaps the remaining 3 from orthoMCL, + ?? (perhaps remaining 12 nonmatching from 'blue' ?????????
  
## combine 135 proteins from oGroups144col1.txt (**remove** 9 rice rows. Last 12 needed are the 'blue' phylogenetic proteins not intersecting with oGroups144col1.txt proteins. 
## to get these, try setdiff(x,y) in R (order parameters matters) where x = blue file, y = intersect blue with oGroups144col1.txt output (10 rows)

08/31/17:
## will become setdiff12blue.R after run in rstudio.

setwd("~/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff")
whtOMCLgroupdf <- read.delim("oGroups144col1.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOMCLgroupdf)
head(whtOMCLgroupdf, n=3)
class(whtOMCLgroupdf)
bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)
head(bluedf, n=3)
Ofinder_blue <- intersect(whtOMCLgroupdf$whtOgrp, bluedf$blue)
length(Ofinder_blue)
class(Ofinder_blue)
## if vector (char vector), use as is ???????????????????????????????????????????????
class(bluedf$blue)
twelve <- setdiff(bluedf$blue, Ofinder_blue)
class(twelve)
length(twelve)  ## 12
write.table(twelve, file="twelve_nocolnam.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=FALSE)
write.table(whtOMCLgroupdf, file="oGroups144col1_nocolnam.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=FALSE)

## grep out 9 rice rows
grep '.*OG5_131220.*$' oGroups144.txt > Test
grep 'Tr' oGroups144col1_nocolnam.txt > oGroups144col1_nocolnam_norice9.txt

## then cat twelve_nocolnam.txt to oGroups144col1_nocolnam_norice9.txt giving oGroups135plus12blue_norice9.txt

cat oGroups144col1_nocolnam_norice9.txt twelve_nocolnam.txt > oGroups135plus12blue_norice9.txt

sort oGroups135plus12blue_norice9.txt |uniq | wc -l  ## 147


## next move oGroups135plus12blue_norice9.txt to 'shared' for vikas.
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff

scp oGroups135plus12blue_norice9.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## go check 'shared' dir
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
ls -lh  ## ck dir contents?

sort oGroups135plus12blue_norice9.txt > sort147.txt  ## counted 3 rows for each chromosome.	

## try update to github here.

STOPPED


2) ## vikas, GFF3, get start, end, (including introns ?????) introns, exons, 
3) ## display location all proteins (genes) all chromosomes same plot. (Q: how do ????
4) ## gene structure (vikas, online s/w) Q: think this more detailed than (3) above ?????
5) ## sequence logos (online)
6) expression data



## Q: any info on OG5_131220 orthomcl_group ?????????????????

## now venn diagram or 'UpSetR', Gehlenborg ??????????








 
 
 
 
 
## stockholm to fasta format, try internet page ????????????????
## DON'T HAVE VIKAS SCRIPT ????????????????????

## BUT, Vikas NOW trims manually ????????????????
## instead, try Gblocks ???????????????????????????????, MIGHT THERE BE A LIMIT IN FILE SIZE TO Gblocks ???????????????????????????????????

## build phylogeny (PhyML eventually ??), now, Mega (ML) ????????, what file format ????????????
## display in figtree or Mega ?????????????? 
 



## check out 'Download Alignment File' from clustal on PPRhmmsearchsubset_plus9.fa.
## clustalo-E20170703-061614-0438-15309988-oy.clustal_num
## Q: perhaps could run this file thru Gblocks to trim, then thru phylogram producing pgm like Mega, then display in Mega or figtree ???????????????


## Q: Exactly how did Vikas get to file: PPRhmmsearchsubset_plus9_clustaltree_colored ??????????????????????
## Q: what downloaded from clustal ??????????????????????, captured in BBedit ????????, then into figtree ?????????????????
## Q: perhaps 'screen captured' web display from 'Phylogenetic Tree' button, paste in BBedit, save, then load into figtree ????????????????

## Q: difference betw. PPRhmmsearchsubset_plus9_clustaltree_colored_nexus & PPRhmmsearchsubset_plus9_clustaltree & PPRhmmsearchsubset_plus9_clustaltree_colored ?????????????????????
                               


## ok, regarding the PPRhmmsearchsubset_plus9_clustaltree_colored (BBedit or grep command line ??????), 1st, separate  
'color' rows out. Take 1st 1558 lines, subtract 1st 4 = 1554 remaining (or 1st 13, don't need to subset PPRhmmsearchsubset.fa. Then, perhaps with bbedit or grep command line (???), 
find box: \]$
## save file as ...color  ## potl 'P' proteins 

find box not \]$
## save as non-color  ## potl 'PLS' proteins

## pare down to 



## Q: should PPRhmmsearchsubset.fa (1545 seqs) seqs be subset to those > some length, then append FRknownseqs_shtname_7.fa (or should include the '13s' also (i.e., > 10) ??????
## test 1-liner code at , https://stackoverflow.com/questions/23992646/sequence-length-of-fasta-file
## on the ...9.fa file.

## so, append to PPRhmmsearchsubset.fa,

Then do clustal/omega (ensembl) MSA, 'command A', save to txt file, they run thru phylogeny, finally display with figtree (Q: WHICH figtree pgm ????????), want see how compares to 'phylotree.txt.png' produced above. Looking for location the new Rf's in 3rd 'area' of that tree ????????

## so, create 11 fasta files, copy each to new file, shorten name line in each file, & reflect in name new file.


## may 1st add 3 from sykes (see below) ????? before ...
## create MSA wi hmmalign (stockholm format output)
## hmmbuild => hmm
## run on PPRhmmsearchsubset.fa, see if can pull out 'RF's' from this file.


## to check 3 on p-353, sykes
## following blasted vs ... ???????
## here, perhaps include in prepn of an hmm the following, but how  ???????????????????

i) brachypodium, gi|357139997 => ... gene prediction ???????????

ii) rice, gi|33859441

iii) maize, gi|662249846


## Q: how best get some 'RF's' from other species ??????????????


STOPPED



--take 1545 wheat PPRs (PPRhmmsearchsubset.fa) *plus* cloned RFLs
--muscle (MSA)
--BBedit, 'clean' data
--phylogeny
--plot phylogeny (figtree)



v) take output from email response (initially not from browser output ???), perhaps subset by colm 7, 'hmm name', but Q: about colm 6, 'hmm acc' ???????
## Q: how get all the email output (vikas did ?????*****?????). Q: can one get this output like email from the website ?????????
## Q: looks like at least one can dnload each of the results **separately** for each of the 500 names in the input to online hmmscan. Looks like **can't** get the form of the email output thru website? Q: currently if try 'print' the email output, it shorter than what vikas got ???????********???????????????

## At least concatenate output of multiple submissions to hnnscan, take the 'email' output.

 




iv) sort | uniq | length, see if still have same number as in PPRsec2_1562.txt (i.e., are there any duplicates)? Name this file PPRseqnames.txt 
TO CHECK that input fasta file, iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa, has these as its 'fasta names' ???????
v) apply Vikas getseq.awk to iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa & PPRseqnames.txt to get subset of fasta file from sec 2 of PPR.out. I note output from getseq.awk is a fasta fie.
## Note: if dataframe format will be needed, check my prev. method convert fasta to dataframe, then use 'merge', ref., p-224, vbuffalo book ????????????

## Q: try figure out what Vikas thinking with his blast & phylogeny analysis to 'identify gene models', that is, check ref articles how to find find RFL genes ??????????????????????

STOPPED

 if the full sequence E-value is significant but the single best domain E-value is not, the target sequence is **probably** a multidomain remote homolog; but be wary, and watch out for the case where it’s just a repetitive sequence.
## so Q:, PPR proteins repetitive domains, & two E-Values significantly diff. here, **not** in hmmsrchshortpep.out ****?????????????****
## line 8217, The two columns headed #doms are two different estimates of the number of distinct domains that the target sequence contains. ... These two numbers should be about the **same**.
## note, betw. hmmsrchshortpep.out & PPR.out, **order** magnitude diff. in the two numbers. Though they are about the same.

06/11/17:
## PPR.hmm, 'inclusion threshold' on line 1540. 
## Q: p-9, sci reports ref, PPR.out drops to <10 at line 542 ??? (Q: confusion, does the 10 domains mean RFLs with at least 10 domains in sec 2 should be retained ????????????)
## (Q: p-533, mentions PPR proteins 2 to 30 tandem repeats ??????????)
## inclusion threshold, line 1539 has only 2.2 & 1 for its two estimates of number of domains.
*******************************************
## Q: OK, so how to decide among these criteria ???????????????????
*********************************************

## **sec 3**, line 1598
## Q: how use sec 3 ???????????*************?????????????????????????
*********************************************************************
## Q: perhaps for PPR.out data, for now, don't use sec 3 ??????????????????????
**********************************************************************

## line 8221, The ! or ? symbol indicates whether this domain does or does not satisfy **both** per-sequence and per-domain inclusion thresholds.
## Q: is this good criterion for whatever use sec 3 for ??????????????????
## line 8227, If the independent E-value is significant (<< 1), that means that even this single domain by itself is such a strong hit that it suffices to identify the sequence as a **significant** homolog with respect to the size of the entire original database search. You can be confident that this is a homologous domain.
## Q: (<< 1), what value ?????????????????????
## line 8228, The next **four** columns give the endpoints of the reported local alignment with respect to both the query model (“hmm from” and “hmm to”) and the target sequence (“ali from” and “ali to”).
## think recall I used these endpoints for qqch ????????????????????????????
## Q: **no** vertical '|' in PPR.out, though in hmmsrchshortpep.out ??????????????????????????????????
## Q: where is line 385075, perhaps in Trinity.fasta.transdecoder.pep file ?????, YES
## line 8250, SO WHAT TO DO ?????????
## Should be able to take 'Sequence' colm from sec 2 of hmmsearch, do %in% to find the sec 2 hits from hmmsrchshortpep.out in Trinity.fasta.transdecoder.pep file, the rows want to build Stockholm MSA file with hmmalign.
## Q: or do I want to get just the 'domains' specified in the 3rd sec of hmmsrchshortpep.out for each of the 'hits' ??????????????
## Q: but PPR.out many more domains per hit ????????????***********??????????

08/08-09/17:
the plant journal (2016) 85, 532-47, file name = cheng...journal.pdf
## Q: p-544, ***HMMs*** ??????????????******?????????????????
## also Vikas refs Scientific Reports 6 35152 2016  ## *to see*
## unl classic libr not working ????????????????????????????????????????
## and Vikas BMC paper earlier ?????????  ## *to see*

## get all appropriate (above appropriate cutoff) PPR's from PPR.out. 

## Vikas rec. way using pfam to separate P & PLS subsets of PPR ??????
## then get RFL's, see new refs from Vikas ????????
## Sci Reports, 6:35152, 2016, p-6, fig 3, Q: non-RFL genes mixed in with RFL genes ????????????????????????????????????????????
## same ref, p-2, 4 methods **identify RFL proteins within P-class** ??????????

06/11/17:

STOPPED
## so need a plan to find RF/RFL (???) genes in wheatproj.
## could start with PPR.hmm from pfam since easy.
## so finish surveying hmmsearch criteria for output (i.e., in PPR.out file). ## Note criteria, p-544, cheng paper.


## line 8822, hmmalign the **1st** output from 1st hmmsearch 

## line 8848, (Q: note, looks like maybe there should *not* be 'redirection' command ">" when run hmmbuild command ?????????????, see p-20, output '.hmm' file name will be name given in hmmbuild command ?????????????

## line 8875, 2nd run of hmmsearch with 'refined' '.hmm'

## line 8937, blastp, Q: do I want to do vs uniprotKB ***??????????***
## line 9099, slurm blastp (FAILED)
## ran uniref90, WHAT VALUE ??????????????????, listed in recent trinotate paper ???????,
## line 9214, ran slurm blastp *uniprotKB* 
## line 9231, nearly same number hit as uniref90
## line 9237, names hits different
## line 9257, compare trinity DE'd wi blastp output from NB-ARC proteins.
## line 9356, ran 'comm' command
## to line 10056 (Q: later to review)

STOPPED



