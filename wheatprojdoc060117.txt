wheatprojdoc060117.txt

06/01/17:
## talked to Vikas, to do:

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /home/baenziger/pterry
-bash: cd: /home/baenziger/pterry: No such file or directory

## ck Adam, get new HCC acct working
## unclear how Vikas works on this acct, Adam created pterry dir. (OK, Vikas, group works this way) under baenziger in both home & work directories (apparently they don't routinely do ???????). 
So, need **check** wi Vikas, how they work with their directories, and any 'common' dir. ?????????????????????????

## plans for using bedtools to achieve correct numbering for *two part* wheat chromosomes (16 Gb genome). I note the 'locations' were in columns, similar to data.frame structure. Perhaps relatively easy to import into R, manipulate there?

## Vikas to put following file into tusker/share. I can copy it from there.
## Check Adam, my globus not working ??????????????????

Sykes, et al., see discussion, p-356, 
## step 1: PPR.hmm on 
iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
-----------------------------------------------
Contains the protein sequence of all high-confidence (HC) gene models that have been positioned on the IWGSC sequence assembly, without splice variants. Only the representative gene model per locus is given.

06/05/17:
ssh -Y pterry@tusker.unl.edu
# Rrq096mN
cd /home/baenziger/pterry
cd /home/baenziger/shared/RefSeq_v1_Annotation/proteins/
ls -lh
[pterry@login.tusker proteins]$ pwd
/home/baenziger/shared/RefSeq_v1_Annotation/proteins

[pterry@login.tusker proteins]$ ls -lh
total 25M
-rw-r--r-- 1 vbelamkar2 baenziger 25M Apr 11 08:45 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
-rw-r--r-- 1 vbelamkar2 baenziger 118 Apr 11 08:45 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip.md5.txt
logout

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry
mkdir wheatproj
cd wheatproj
cd /work/baenziger/pterry/wheatproj

scp pterry@tusker.unl.edu:/home/baenziger/shared/RefSeq_v1_Annotation/proteins/iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip .
ls -lh

scp pterry@tusker.unl.edu:/home/baenziger/shared/RefSeq_v1_Annotation/proteins/iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip.md5.txt .
ls -lh
## Q: how do md5 ?????????????
md5sum <filetocheck> 
md5sum iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
3acdf6120fcff98d8e65500b24362fe7
cat iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip.md5.txt
The MD5 checksum value is: 3acdf6120fcff98d8e65500b24362fe7
## so checks out.
unzip iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip > iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
## looks like unzip just removes the 'zip' & leaves the '.fa' file, redirect does *not* work, it trying to replace the '.fa' file it just created.

unzip iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
ls -lh
less iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
>TraesCS1A01G000100.1
MRVIALSAGVTPSLRIGLPMCKCRSHGTFLLFGLQSSHLNICYYHQDLPRRPLCPGSRPG
FCSGRRALLLIGAWRSSRWPGVGRAL*
>TraesCS1A01G000200.1
MVNNLWPMEQCRQGKSAKRIRNFGKRICSEDWAQGSRPRTRRLSADCSCCSRGKSRSPRA
GQGTDQESPLRGLSPSMKQSTQNWYGQGESDYLIKTKHCDGPRGN*
## Q: '*' character ??????????????????????????????????????????????????

## OK, what need for input to hmmsearch ?????????????????
## what kind of file is Trinity.fasta.transdecoder.pep  ????????????????
## p-21, Hmmer manual, a 'fasta' file.
## so perhaps I have an appropriate input file.



## plan for using Hmmer for identifying PPR proteins in new wheat genome
## dnload PPR.hmm (done, from http://pfam.xfam.org/family/ppr#tabview=tab6)

## need couple species controls, check Sykes ref, possibly arabidopsis, rice ????? => **see** 1st few sentence 'Discussion' sectiom, rice, brachypodium, & sorghum

## read over Sykes paper again, get 'controls' used there ?????

06/04/17:
## Hmmer steps:
## Hmmer User's Guide, p-21-27, discussing 'hmmsearch' output

06/06/17: 
## line 8189, my **1st** hmmsearch in Bdac... file

ssh -Y pterry@crane.unl.edu 
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh
wc iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
  921676   921676 48634703 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
# grep -c "^>" longest_orfs.pep  ## 158367
grep -c "^>" iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa  ## 110790
## apparently on average, fasta seqs *ave* 7 lines ??????????????

## need scp PPR.hmm to crane

scp PPR.hmm pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
# hmmsearch NB-ARC.hmm Trinity.fasta.transdecoder.pep > hmmsrchshortpep.out
hmmsearch PPR.hmm iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa > PPR.out
## ran almost *instantly*
ls -lh
-rw-r--r-- 1 pterry amundsen   6704453 Jun  6 17:14 PPR.out
less PPR.out
wc PPR.out
 118172  689922 6704453 PPR.out

## now what to do with this output ????????
## initially, perhaps scp it to macbook, examine what have. Think need create a fasta file of top hits (how decide) ???????????
## Q: check Vikas AWK script ???????????????????????????????????????
## from /work/baenziger/pterry/wheatproj/PPR.out file
logout

cd /Users/bterry/macbook2017/vikas17/wheatproj
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/PPR.out .
ls -lh
## Hmmer User's Guide, p-21-27, discussing 'hmmsearch' output
## line 8203 (Bdac...)
## note: PPR.out has *no* 'description' colm entries, hmmsrchshortpep.out *does* ????????
## line 8208, ## 3rd colm, 'bias' ...
## line 8210, The next three colms are again an E-value, score, and bias, but only for the **single** best-scoring domain in the sequence, rather than the sum of all its identified domains.
## line 8213, ## So ***operationally***,
if both E-values are significant (<< 1), the sequence is likely to be homologous to your query.

06/12/17:
## Note: p-544, cheng ref., 0.1 for *full*, 100 for *domain* ??????
## Q: few comments:
## PPR.out, line 1540, 'inclusion threshold'
## p-9, sci. reports, RFL genes  >= 10 p-class ppr motifs, (note: sec 2, PPR.out, line 542, # domains < 10) So, should num. domains affect cutoff for hmmsearch hits ?????????????????
## p-533, cheng ref., PPR proteins, 2 to 30 tandem repeats ??????????????
## p-533, cheng ref., PPR.out, line 1562, criteria cutoff, 
(-E 0.1),
(-E 100)
## compare, hmmer doc, p-23, cutoff E-value <= 10.0, catches *all* 1595 lines sec 2, PPR.out 
## hmmer doc, p-24, sec 3, ...

## talked to Vikas, would like to take hits in PPR.out file using cheng, p-544 criterion of 'full' E-value <= 0.1. This line 1562 and above in sec 2.

06/13/17:
## So, to do, start  wi PPR.out file
i) remove sec 1 above sec 2
cd /Users/bterry/macbook2017/vikas17/wheatproj
head -n 1562 PPR.out | tail -n 1

ii) get sec 2 rows of PPR.out, lines 1562 & above
head -n 1562 PPR.out | tail -n 1546 | head -n 1
head -n 1562 PPR.out | tail -n 1546 > PPRsec2_1562.txt
## Left, remove line 1524, 'inclusion threshold' in new file
## try unix commands before doing wi BBedit, remaining, 1523 lines.
head -n 1523 PPRsec2_1562.txt > top.txt
tail -n 22 PPRsec2_1562.txt > bottom.txt

cat top.txt bottom.txt > tmp.txt
wc -l tmp.txt  ## expect 1545
    1545 tmp.txt

## examine tmp.txt in BBedit, if line above, below 'inclusion threshold' line ok, (looks good) then
mv tmp.txt PPRsec2_1562.txt  ## done, now 1545 in length
wc -l PPRsec2_1562.txt
    1545 PPRsec2_1562.txt  ## ok, have 9 colms

iii) cut colm 9, the 'sequence' colm.
#cut -f 9 PPRsec2_1562.txt | head -n 3
#cut -d ' ' -f 24 PPRsec2_1562.txt > PPRsec2_1562seqname.txt
## *not* working, varying number spaces in lines.
## so, try read into **R**, get 'sequence' colm that way ?????????

#xlsC_up_logdf <- read.delim("xlsC_up_logdf.txt", header=T, sep=" ", stringsAsFactors=FALSE)
## inside rStudio & R
setwd("~/macbook2017/vikas17/wheatproj")
#PPRsec2_1562 <- read.delim("PPRsec2_1562.txt", header=FALSE, sep=" ", stringsAsFactors=FALSE)
dim(PPRsec2_1562)  ## [1] 2290   27 ?????????????????????????????
head(PPRsec2_1562, n=3)
tail(PPRsec2_1562, n=3)
rm(PPRsec2_1562)
PPRsec2_1562 <- read.delim("PPRsec2_1562.txt", header=FALSE, stringsAsFactors=FALSE)
dim(PPRsec2_1562)  ## [1] 1545    1   ???????????????????????????????
head(PPRsec2_1562, n=3)
1    3.1e-147  471.5  44.9    3.7e-09   38.7   0.1   21.3 21  TraesCSU01G134400.1   
## so, right number rows, all in ***one*** colm ??????????????????
class(PPRsec2_1562)  ## [1] "data.frame"
## now what? Can I separate fields into df wi 9 fields ?????????????

#write.table(RefSeqID_seq, file="Trinity.fasta.transdecoder.pep.df.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=TRUE) 
write.table(PPRsec2_1562, file="Testwrite.txt", quote=FALSE, sep="\t", row.names=FALSE) 

## talked to Vikas about working with sec 2, hmmsearch output in PPRsec2_1562.txt.
cat PPRsec2_1562.txt|perl -pe 's/.+(Traes.+)/\1/'| head -n 3
TraesCSU01G134400.1   
TraesCS6B01G108900.1  
TraesCS6A01G081600.2 
## so, looks like successful peeling off colm 9.
cat PPRsec2_1562.txt|perl -pe 's/.+(Traes.+)/\1/' | > PPRsec2 _1562_Seqscolm.txt
## gives error ???????????????
cat PPRsec2_1562.txt|perl -pe 's/.+(Traes.+)/\1/'| head -n 1545 > PPRsec2_1562_Seqscolm.txt
## 1st & last rows look ok.
iv) sort | uniq | length, see if still have same number as in PPRsec2_1562.txt (i.e., are there any duplicates)? Name this file PPRseqnames.txt 

sort PPRsec2_1562_Seqscolm.txt |uniq | wc -l  ##     1545  as expected if each record in unique.

## next use Vikas getsubsetfatofa.awk (getseq.awk) pgm to subset the records selected by hmmsearch in iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa file to file PPR.out.

06/14/17:
## 1st need scp iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa file from crane to macbook.

scp ...
cd /Users/bterry/macbook2017/vikas17/wheatproj
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa .
-rw-r--r--   1 bterry  staff  48634703 Jun 14 10:27 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
ssh -Y pterry@crane.unl.edu 
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -al

## currently 644,
-rw-r--r--@ 1 bterry  staff   1.7K Jun 12 11:40 getseq.awk
## so not executable, Q: the '@' ?????????????????
#chmod u=rwx,g=rx,o=r myfile
chmod 755 getseq.awk
ls -lh
## Q: what wrong? Looks like at https://stackoverflow.com/questions/9991858/how-to-run-a-awk-file
## 1st line script needs to be right ?????????????????????

philip-terry-2:wheatproj bterry$ ./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa PPRsec2_1562_Seqscolm.txt | head -n 3
>TraesCS1A01G031600.1
MDCCCRACRTDLALAFFGRLLRTGLQAGQVVFNTLLKGLCHTKRADEALDVLLHRMPELG
CTPDVVAYNTVIHGFFREGQVGKACDMFHGMAQKGVMPNVVTYNSVIDGLCKARAMDKAE
## so worked.

## To try 
./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa PPRsec2_1562_Seqscolm.txt > PPRhmmsearchsubset.fa
wc -l PPRhmmsearchsubset.fa
   18284 PPRhmmsearchsubset.fa
grep -c "^>Tr" PPRhmmsearchsubset.fa   # 1545 as expect

python seqread.py first6ref.fta
python findcol3.py PPRsec2_1562.txt
## no output ???, perhaps try with make up some file data ??????????????
python findcol3.py
## failed on PPRsec2_1562.txt ????????????????????????????????????????

## OK, ready for next step, 

Vikas email, submit PPRhmmsearchsubset.fa to pfam at:
http://pfam.xfam.org/search#tabview=tab1
## problem, 500 or 5000 limit number sequences ??????????????????????????

06/15/17:
## so try say 1st 500 seqs. Q: how select 1st 500 'name' lines ????????????
grep "^>Tr" PPRhmmsearchsubset.fa > namelines.txt
wc -l namelines.txt  ##     1545 namelines.txt
## so 1st 500 seqs in PPRhmmsearchsubset.fa ends on line 5839
head -n 5839 PPRhmmsearchsubset.fa > PPRhmmsearchsubset1to500.fa
submit PPRhmmsearchsubset1to500.fa to pfam at:
http://pfam.xfam.org/search#tabview=tab1
## 2:16pm, approx wait time, 1hr 34 min.
## Output to browser screen, number of links ??????????
## email
# Your job id was: 0563853C-51FF-11E7-AAEB-FFCADBC3747A
# You can retrieve the **full** results by going to:
# http://www.ebi.ac.uk/Tools/hmmer/results/score/0563853C-51FF-11E7-AAEB-FFCADBC3747A
## complicated output, **HMMSCAN**
# If you have any comments or questions about the use of this service,
# please contact us at: hmmer-help@ebi.ac.uk

## check Vikas, what to do with this output?


## try put couple files in /work/baenziger/share
PPRhmmsearchsubset.fa
PPRhmmsearchsubset1to500.fa

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
ls -lh
cd ..
cd ..
cd shared
ls -lh
mkdir terry
cd terry
mkdir hmm
cd hmm
pwd
logout

cd /Users/bterry/macbook2017/vikas17/wheatproj

scp PPRhmmsearchsubset.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm
scp PPRhmmsearchsubset1to500.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## log back in, check /work/baenziger/shared/terry/hmm dir.
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/shared/terry/hmm
ls -al  ## sizes are same.

06/17/17:
Talked to vikas about:
## search refs for method to subset PLS, P subsets of PPRs ??????******??????
## try cheng paper, which others ???????????????????
## check where mentions particular genes having RF capability ??????????
## 1st 500 results from online hmmscan for PPRhmmsearchsubset1to500.fa.
## Idea: set up pipeline to get the output got in *email* for multiple species. Course, catenate results with more than 500 rows submitted to pfam.
## **pipeline**:
For each species:
i) hmmsearch the .fa file
# hmmsearch PPR.hmm iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa > PPR.out
## so for wheat, done, result PPR.out

ii) get colm 10 from hmmsearch output using vikas **one** line command

philip-terry-2:wheatproj bterry$ grep "Traes" PPR.out|tr -s " " "\t"|awk -F'\t' -v OFS='\t' '$2<0.1 {print $10}' > PPR.out.E0p1.txt
## 1545 records, colm 10.
## *same* as PPRsec2_1562_Seqscolm.txt, also 1545 records

## *testing* getting hmmsearch output into 'handleable' form.
grep "Traes" PPR.out|tr -s " " "\t"|awk -F'\t' -v OFS='\t' '$2<0.1 {print $2, $3, $4, $5, $6, $7, $8, $9, $10}' > test.txt
## looks like got colms 2 thru 10 sep'd wi '\t'

Test read.delim into R? Then try 'dim' number colms? Will I have to try remove removed 1st '\t' in Bbedit before read.delim? (done above)
testdf <- read.delim("test.txt", header=FALSE, stringsAsFactors=FALSE)
dim(testdf)  ##  [1] 1545    9  as expected.
head(testdf, n=3)   ## looks ok

06/18/17:

iii) getseq.AWK script to subset input .fa file
./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa PPRsec2_1562_Seqscolm.txt > PPRhmmsearchsubset.fa
wc -l PPRhmmsearchsubset.fa
   18284 PPRhmmsearchsubset.fa
grep -c "^>Tr" PPRhmmsearchsubset.fa   # 1545 as expect

## for wheat, proceed with use PPRsec2_1562_Seqscolm.txt rather than switching to PPR.out.E0p1.txt produced by Vikas. They the same. 

06/19/17:

iv) upload subset fasta to pfam online for hmmscan search.
## need do 4 times, including repeat of 1 to 500.

## so resubmit PPRhmmsearchsubset1to500.fa to hmmscan online pfam.
http://pfam.xfam.org/search#tabview=tab1
## cp/rename 1st, PPRhmmsearchsubset1to500.fa to PPRhmmsearchsubset1to500_2nd.fa
Your job is queued behind 5123 other searches. (approximate wait time: 2 hours and 51 minutes)
## **error** in receiving results, says on browser, no email message.
## so start another run, with PPRhmmsearchsubset1to500_3rd.fa, started 9:50am.
Your job is queued behind 9146 other searches. (approximate wait time: 5 hours and 5 minutes)
## done by 1 pm.
http://www.ebi.ac.uk/Tools/hmmer/results/AD5CAB18-54FE-11E7-859B-21AF53F04F9B/score
## email results only approx half that vikas recovered ???????????????????
## to send ***email*** to  hmmer-help@ebi.ac.uk
## my questions:

i) having trouble 'capturing' all of the output from an online pfam hmmscan result sent via email. the last line captured is:
>TraesCS1D01G198900.1 193 226 193 226 &n
So, wondering if I am not capturing all the output?

ii) looks like the results in the browser not formatted similarly. Is there some standard way I should be following in accessing the output results?

## prepare 501 to 1000 .fa file for submission to pfam online hmmscan run.
## namelines.txt, line in PPRhmmsearchsubset.fa
>TraesCS3A01G131000.1   501    1st line 5840
>TraesCS5B01G195700.1   1000   line after seq  11826
## 5987, for 'tail'
#head -n 5839 PPRhmmsearchsubset.fa > PPRhmmsearchsubset1to500.fa

head -n 11826 PPRhmmsearchsubset.fa | tail -n 5987 > PPRhmmsearchsubset501to1000.fa
## check, verify in PPRhmmsearchsubset.fa, looks ok, names and line numbers correlate in PPRhmmsearchsubset.fa & PPRhmmsearchsubset1to500.fa

06/21/17:
Vikas request **two** files copy to 'shared' dir, one, PPRhmmsearchsubset.fa, prevly there.
## 2nd
cd /Users/bterry/macbook2017/vikas17/wheatproj
scp hmmscanOP_1-500.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm
ls -al

## talked to vikas:
## to do: read the refs again, try figure out how get hmm specific for 'P' motif
## check 'sci reports'
## check 'Sykes'
## finish 'cheng'

## ready to submit to pfam hmmscan online, but 1st, wait for response to email, and read the refs again, try figure out what to do with hmmscan output ????????????????????????

06/24/17:
Talked to vikas today. Upshot: 
vikas ran MSA for PPRhmmsearchsubset.fa with clustal/omega, then phylogeny, which 'connected' with clustal/omega run.
To graph this, he used 'figtree' (to dnload, install).
## To do: I want to repeat this, learn myself.
## To do: re-read sykes ref, task want to accomplish for wheat proj.
## To do: read BMC genomics, 2014, 15 950.
## now protocol for what want do next:
--get 'cloned' RFSs (see sykes, p-2, sci reports, 1st full paragraph ?????????????
06/25/17:
In Sykes paper, p-354, section 'Phylogenetic Analysis of the RFL Cluster', refers to supplementary table S1, 143 rows, *multiple* species.

In sci. reports paper, page 2, 1st full paragraph, refers to CMS/Rf systems in supp. table S1 (*all* rice species).

06/26/17:
Talked to vikas:
To do: from srep35152-s1.pdf, table S1, take the 42 rows (see p-2, srep35152.pdf), the values in colm 3, 'NCBI reference', get the protein sequences from batch entrez search.
## 1st get colm 3 out of table S1. For now, use BBedit, but later like to put in unix command line with pipes ???????????????
## in BBedit, 3 steps
Find: \w+ \w+ \w+ (.+)
Replace: \1
## manually, write in 'group' for rows 19-2, for 41-42, remove rest 'species', then write in group 
Find: ^group (.+)
Replace: \1
## now, if manually removed line1, 3-7, 40-42 trailer parts from 'cultivar name', could then do cut of new colm2
## try cut
cut -d ' ' -f 2 srep35152-s1_tableS1_copy.txt | head -n 3  ## ok
cut -d ' ' -f 2 srep35152-s1_tableS1_copy.txt | head -n 42 > NCBIrefcolm.txt
## NCBIrefcolm.txt looks ok, 42 rows, has a blank 43 row ??????????????, so removed before proceed.

06/27/17:
## now for batch entrez search at NCBI, upload NCBIrefcolm.txt
## Note: some issues with 'batch entrex' output ?????????
## Q: AB179840 has 3 proteins, 2nd hypothetical tho matches dupl AB179840 , 1st matches on table S1, 3rd hypothetical, no aa seq given ??????????
## Q: note, batch conversion nucleotide to protein does not appear to match protein name from table S1 ???????
## Q: perhaps, manually try match each 'ncbi ref' with protein(s) coded for, select one matches table S1. What about 'ncbi ref' without protein name in table S1 ???????
## Q: or, to try find 'cloned' RF(L) proteins, look t p-2, sci peports, ref papers, try get 'a few' cloned genes ?????????????????????????

## talked to vikas, to manually examine table S1, 'sci reports' paper, each row in 'NCBI ref' colm. Sort of curate which select for 'restorer for CMS' genes to use in phylogeny with wheatproj PPR proteins (detd from PPR.hmm on wheatproj gene proteins. So, from NCBIrefcolm.txt file,

AB106867 /product="PPR protein"
AB110016 /product="Rf1"  (Q: ????????????????????????)

AB195686 /product="PPR protein"
AB470408 /product="pentatricopeptide repeat-containing protein"
         /function="fertility restorer"

AB470409 /product="pentatricopeptide repeat-containing protein"
AB470406 /product="pentatricopeptide repeat-containing protein"

AB470407 /product="pentatricopeptide repeat-containing protein"
DQ311053 /product="PPR protein"

DQ311054 /product="PPR protein"
DQ311052 /product="PPR protein"

AB179840 /product="restorer for CMS", /gene="Rf-1A", /protein_id="BAD20283.1"
AB179840 /product="hypothetical protein", /gene="Rf-1D", /protein_id="BAD20284.1"
AB179840 /gene="Rf-1B", /note="hypothetical protein", /pseudo

AB112811 /product="PPR protein", /function="fertility restoration of CMS", /gene="Rf-1C", /protein_id="BAD13711.1"

AB110443 /product="fertility restorer", /gene="Rf-1", /protein_id="BAD08214.1"
AB110443 /product="hypothetical protein", /gene="PPR794", /protein_id="BAD08211.1"

AB110443 /product="hypothetical protein", /gene="PPR683", /protein_id="BAD08212.1"
AB110443 /product="hypothetical protein", /gene="PPR762", /protein_id="BAD08213.1"

AB110444 /product="hypothetical protein", /protein_id="BAD08215.1"

AB110444 /product="hypothetical protein", /protein_id="BAD08216.1"
AB110444 /product="fertility restorer", /protein_id="BAD08217.1"

AB900791 /product="pentatricopeptide repeat-containing protein", /gene="PPR454", /protein_id="BAQ15368.1", /note="fertility restorer for Wild-abortive (WA) type
                     cytoplasmic male sterility (CMS)"
AB900792 /product="pentatricopeptide repeat-containing protein", /gene="PPR782a", /protein_id="BAQ15369.1", /note="fertility restorer for Wild-abortive (WA) type cytoplasmic male sterility (CMS)"

AB900793 /product="pentatricopeptide repeat-containing protein", /gene="PPR782b",  /protein_id="BAQ15370.1" /note="fertility restorer for Wild-abortive (WA) type cytoplasmic male sterility (CMS)"

AB900794 /product="pentatricopeptide repeat-containing protein", /gene="PPR458", /protein_id="BAQ15371.1", /note="fertility restorer for Wild-abortive (WA) type
                     cytoplasmic male sterility (CMS)"

Os10g0495400 uniprotKB, a seq., but Status Unreviewed
-Annotation score:no score -Protein predicted.

Os10g0495200 uniprotKB, a seq., but Status Unreviewed
-Annotation score:no score -Protein predicted.

Os10g0495100 uniprotKB not coming up, Oryzabase, Search Condition : Keyword(Os10g0495100), link to => big file for AP008216.2

KJ680250 /product="PPR protein PPR9-782-ZH", /gene="Rf4", /protein_id="AIC74552.1", /note="recessive fertility restorer allele for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680249 /product="PPR protein PPR9-782-M", /gene="Rf4", /protein_id="AIC74551.1", /note="fertility restorer allele for wild abortive
                     cytoplasmic male sterility (CMS-WA)"

KJ680248 /product="PPR protein PPR9-782-I", /gene="Rf4", /protein_id="AIC74550.1", /note="fertility restorer allele for wild abortive
                     cytoplasmic male sterility (CMS-WA)"
KJ680247 /product="truncated PPR protein PPR9-409-Z", /gene="Rf4", /protein_id="AIC74549.1", /note="recessive fertility restorer allele for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680253 /product="PPR protein PPR10-469-93", /gene="Rf4-like", /protein_id="AIC74555.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
KJ680252 /product="PPR protein PPR10-454-Z", /gene="Rf4-like", /protein_id="AIC74554.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680251 /product="PPR protein PPR10-454-M", /gene="Rf4-like", /protein_id="AIC74553.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680246 /product="PPR protein PPR8-780-M", /gene="Rf4-like", /protein_id="AIC74548.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
 
KJ680245 /product="PPR protein PPR7-458-ZH", /gene="Rf4-like", /protein_id="AIC74547.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
KJ680244 /product="PPR protein PPR7-458-Z", /gene="Rf4-like", /protein_id="AIC74546.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

KJ680243 /product="PPR protein PPR7-458-I", /gene="Rf4-like", /protein_id="AIC74545.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"
KJ680242 /product="PPR protein PPR7-454-M", /gene="Rf4-like", /protein_id="AIC74544.1", /note="similar to the fertility restorer Rf4 for wild
                     abortive cytoplasmic male sterility (CMS-WA)"

AB179840 *DUPL* OF ABOVE. 

AK066315 Q: what to think ???????????????? 

06/30/17:
## so, 'FR' & lengths to select from 42 rows from table S1, 'sci reports'
AB470408 266/35 = 7.6
AB179840 790/35 = 22.57
AB112811 794/35 = 22.69
AB110443 791/35 = 22.6
AB110444 266/35 = 7.6
AB900791 455/35 = 13
AB900792 782/35 = 22.34
AB900793 782/35 = 22.34
AB900794 458/35 = 13.09
KJ680249 782/35 = 22.34
KJ680248 782/35 = 22.34

## talked to vikas, would like to next create a fasta file of these 11, append  to PPRhmmsearchsubset.fa (perhaps 1st, do gbLocks MSA for just the 11, see how well they align). 
http://molevol.cmima.csic.es/castresana/Gblocks_server.html
## see JMower course, plant systematics, lab 3, 02/05/16, sec II, 'Trimming alignments'.

07/01/17:
## so *updated* BdactyloidesthruGSEA081615.txt & wheatprojdoc060117.txt to github, planets repo.

## try append the 11 together 1st, then a reg expn to shorten the names on the name rows

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs

ls -lh
cat *seq.txt > FRknownseqs.fa
wc FRknownseqs.fa  ##      
117     180    8533 FRknownseqs.fa
head -n 4 FRknownseqs.fa
grep -c "^>" FRknownseqs.fa  ## 11  ????????????
grep "^>" FRknownseqs.fa > grepoutput  ## 11 rows as expect

## test reg expns in bbedit on grepoutput file.


1st:
(>)\w+\|(.+)
\1\2
>AB110443.1_prot_BAD08214.1_4 [gene=Rf-1] [prot ...

Then:
(>\w+).+
\1
## working with 'fresh' file, like p-28, bottom, haddock & dunn ?????????????????
## To do, same test for FRknownseqs_copy.fa
## looks like success, so rename FRknownseqs_shtname.fa
wc FRknownseqs_shtname.fa
     117     117    7164 FRknownseqs_shtname.fa
grep -c "^>" FRknownseqs_shtname.fa  ## 11 rows as expect


## perhaps try gblocks on FRknownseqs_shtname.fa, see if good alignment before proceed ????
## Note: ***purpose*** of Gblocks: Selection of conserved blocks from multiple alignments for their use in phylogenetic analysis, i.e., couple 'algorithms' to subset MSA to better matching parts of MSA for use in phylogenetic map prepn.

Gblocks did not work
Please check that the file format is correct
Generated by Gblocks Server
## WHAT TO THINK ??????????????????????????????????????????????
## Note in Angiosperm_...-muscle.fas, Gblocks worked ????????
## APPARENTLY GBLOCKS RETURNS ONLY PARTS OF INPUT THAT ALIGN WELL ???????????

## perhaps try FRknownseqs_shtname.fa with clustal/omega (ensembl).
## Q: should the two 7.6 and the two 13 length be retained ???????????? 
## Q: apparently '*', '-', & ':' missing from any column if one row has no aa ??????????
## Q: at least would get these symbols for most of length rest of the rows ?????
## Q: Q: should I try to trim some colms as Gblocks seems to do. Q: output file of Gblocks probably outputs these subsets ??????????????????????????????????

07/02/17:

## at least run clustal/omega *without* these 4 rows, so can see how well rest of rows align. Prepare FRknownseqs_shtname_7.fa from FRknownseqs_shtname.fa. Remove '408', '444', '791' & '794'.
## Getting '*', '-', & ':' symbols out to about 780 aa's.

STOPPED

## Q: test making a tree from this, practice ?????
## ok, *perhaps do*, include the two 13's since > 10, see if changes relationship of seven 22s run by themselves ??????????
## create FRknownseqs_shtname_9.fa from FRknownseqs_shtname.fa (remove '408' & '444')
## run clustal omega on FRknownseqs_shtname_9.fa
 ## phyl. for FRknownseqs_shtname_9.fa, relationships the 7 in FRknownseqs_shtname_7.fa *not* changed.

## so perhaps append the '9' (FRknownseqs_shtname_9.fa) to  PPRhmmsearchsubset.fa, & with with PPRhmmsearchsubset.fa subset by removing all seqs < 10*35 in length. Then perhaps test both ways, thinking Gblocks/JMower strategy for MSA 'trimming' of value ????

## 1st, MSA on FRknownseqs_shtname_9.fa appended to PPRhmmsearchsubset.fa

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
#cat *seq.txt > FRknownseqs.fa
cat PPRhmmsearchsubset.fa FRknownseqs_shtname_9.fa > PPRhmmsearchsubset_plus9.fa
grep -c "^>" PPRhmmsearchsubset_plus9.fa  ## 1554 as expect
## run PPRhmmsearchsubset_plus9.fa on clustal omega, the phylogeny, then figtree
## submitted, 12:16am, 07/03/17.
## apparently ran ~ 20 min.

07/03/17:
## now what, 'send to simple phylogeny' ??????? Try it, no dnside ???????
## **fails**, max 500 aligned seqs allowed.
## so what did Vikas do to get phylogeny on PPRhmmsearchsubset.fa previously ????????


## test 'awk' pgm wi FRknownseqs_shtname_9.fa 1st for counting seq lengths in fasta file.
awk '/^>/ {if (seqlen){print seqlen}; print ;seqlen=0;next; } { seqlen += length($0)}END{print seqlen}' FRknownseqs_shtname_9.fa
## worked!

## talked to Vikas, 
## 1st, went to email link to clustal MCA run for PPRhmmsearchsubset_plus9.fa. Q: now, from this results page, what did ???????????????
## Click on 'Phylogenetic Tree', scroll down a bit, see the '9' grouped together, and 14 closest relatives, all map to 'FR' part of radial tree layout in figtree right next to the 9 rice 'FR' +ve control proteins. Q: might these 14 cluster on new wheat genome as they reportedly do in rice? Is the new wheat seq allow to find their locations, see if they cluster?

07/04/17:
Vikas email, ideas, for going forward.
## from PPRhmmsearchsubset_plus9.fa phylogram, thru 'colors' in figtree, separate P & PLS proteins. 
## Q: any additional subsetting of the proteins from the branches near the leaves ???????????????
## Then, choose subsets of the 'wheat' proteins, like 'PLS', 'P', then hmmalign, hmmbuild, hmmsearch to refine subsets of PPRhmmsearchsubset.fa. Repeat MSA wi clustal, Gblocks, then phylogeny (Mega or what ???) 

07/05/17:
## talked to vikas,
## to do, 
## Note: PPRhmmsearchsubset_plus9_clustaltree_colored has NEXUS phylogenetic tree starting at line. So, just use 1st 1560 lines to get 'colored' rows.
cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy | head -n 1560 > PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560
## check number 'Treas' rows, in, '1560' (1545 as expected) in bbedit. Matches number in PPRhmmsearchsubset.fa.

## now reg expn to get 'colored' subset ('P') list. 

.+(Traes.+\d).+color.+  ## works bbedit, but lines not 'found' by this *remain*.
## so try,
cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 30
## works, replaces matching rows *but* leaves as was any line not matched, i.e., *still* 1560 lins long.
## check number 'color' rows, 820 + 9 as expect as 'AB', 'KJ' not included.

cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 1560 > PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl
## check number of 'Traes' in bbedit, 1545 as expect.

## next,
grep "^Traes" PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl |  head -n 30

## looks like working, so 

grep "^Traes" PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl > PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile
## 820 rows, matching what expect from number of 'color' rows in PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560

## check for duplicates
sort PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile |uniq | wc -l  ##          820  as expected if each record in unique.

07/06/17:
## now, subset PPRhmmsearchsubset.fa fasta file with the PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile listfile. 

## to do, use Vikas getsubsetfatofa.awk (getseq.awk) pgm to subset the records selected by figtree ('color' rows, possibly 'P' proteins) listfile in PPRhmmsearchsubset.fa. Output to PPRhmmsearchsubset_P_prots820.fa

## getseq.AWK script to subset input .fa file

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
./getseq.awk PPRhmmsearchsubset.fa PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile  > PPRhmmsearchsubset_P_prots820.fa
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

## talked to Vikas,

07/07/17:
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/shared/terry/hmm
ls -al  ## sizes are same.
module avail
## muscle/3.8   

07/08/17:
## next steps: starting with PPRhmmsearchsubset_P_prots820.fa
## muscle alignment, ON crane, CHECK if can put out stockholm format ???????????????????, doc, says not,  
## what crane dir to work in ??????
ssh -Y pterry@crane.unl.edu
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots820
cd refinPprots820
## scp PPRhmmsearchsubset_P_prots820.fa to crane, dir = refinPprots820
logout
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

STOPPED

## run muscle on PPRhmmsearchsubset_P_prots820.fa
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj/refinPprots820

## see line 109, srun muscle ...
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load muscle/3.8
cd /work/baenziger/pterry/wheatproj/refinPprots820
muscle -in PPRhmmsearchsubset_P_prots820.fa -out PPRhmmsearchsubset_P_prots820.fa.aln
## ~ 11:25pm => killed, ~ 12:25am, 07/09/17.

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored
PPRhmmsearchsubset_P_prots820 820 seqs, lengths min 151, max 1448, avg 603
00:00:03     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 1
00:00:03     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 2
00:00:30   437 MB(32%)  Iter   1  100.00%  Align node       
00:00:30   441 MB(32%)  Iter   1  100.00%  Root alignment
00:01:34   442 MB(32%)  Iter   2  100.00%  Refine tree   
00:01:34   442 MB(32%)  Iter   2  100.00%  Root alignment
00:01:34   442 MB(32%)  Iter   2  100.00%  Root alignment
00:33:02   442 MB(32%)  Iter   3  100.00%  Refine biparts
srun: Force Terminated job 7945126 85.58%  Refine bipartsfine biparts
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
srun: error: c2017: task 0: Killed 87.29%  Refine biparts
[pterry@login.crane refinPprots820]$ ls -lh
total 512K
-rw-r--r-- 1 pterry amundsen 511K Jul  8 22:08 PPRhmmsearchsubset_P_prots820.fa
[pterry@login.crane refinPprots820]$ 
## Q: EXACTLY WHY KILLED ?????????????????????????????????
## ANYWAY, CHECK ADAM ON MONDAY.
## MEAN TIME, TRY RUN AS SLURM JOB ??????????????????

07/09/17:
## most recent slurm file template: slurm_blastp_uniprotKB_C_UP.sh
## slurm_muscle_wheatproj_refin820.sh
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /home/baenziger/pterry
mkdir scripts
logout
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs

scp slurm_muscle_wheatproj_refin820.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/


ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin820.sh 7955004  16:18pm => ??:??am, 
squeue -u pterry  ## a PD
            JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
           7955004     batch TJob_mus   pterry PD       0:00      1 (Resources)

## Q: still pending at 1pm. How best to reduce resources requested to reduce 'PD' time ??????????????????
## stopped running before 10:22pm

[pterry@login.crane refinPprots820]$ squeue -u pterry
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
## Q: meaning of 'ST'  ???????????????????????

cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
-rw-r--r-- 1 pterry amundsen 602K Jul  9 21:28 job.7955004.err
-rw-r--r-- 1 pterry amundsen    0 Jul  9 19:43 job.7955004.out
-rw-r--r-- 1 pterry amundsen 511K Jul  8 22:08 PPRhmmsearchsubset_P_prots820.fa
-rw-r--r-- 1 pterry amundsen 2.5M Jul  9 21:28 PPRhmmsearchsubset_P_prots820.fa.aln

less job.7955004.err
## many invalid '*' lines.
head -n 12 job.7955004.err
## many of following line in '.err' file.
*** WARNING *** Invalid character '*' in FASTA sequence data, ignored


sacct -j  7955004 -o start,end
              Start                 End 
------------------- ------------------- 
2017-07-09T19:43:42 2017-07-09T21:28:09 
2017-07-09T19:43:42 2017-07-09T21:28:09 
## 21:28:09 - 19:43:42 ~= 1hr 44min run

wc -l job.7955004.err
1660 job.7955004.err
grep -c "***" job.7955004.err
1660    ## so not directly related to 820 input lines ??????????????
## look at last line of error file
tail -n 18 job.7955004.err
*** WARNING *** Invalid character '*' in FASTA sequence data, ignored

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored

*** WARNING *** Invalid character '*' in FASTA sequence data, ignored
PPRhmmsearchsubset_P_prots820 820 seqs, lengths min 151, max 1448, avg 603
00:00:06     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 1
00:00:06     25 MB(2%)  Iter   1  100.00%  K-mer dist pass 2
00:01:02   437 MB(32%)  Iter   1  100.00%  Align node       
00:01:03   441 MB(32%)  Iter   1  100.00%  Root alignment
00:02:07   442 MB(32%)  Iter   2  100.00%  Refine tree   
00:02:07   442 MB(32%)  Iter   2  100.00%  Root alignment
00:02:07   442 MB(32%)  Iter   2  100.00%  Root alignment
00:33:17   442 MB(32%)  Iter   3  100.00%  Refine biparts
01:03:34   442 MB(32%)  Iter   4  100.00%  Refine biparts
01:34:27   442 MB(32%)  Iter   5  100.00%  Refine biparts
01:44:22   442 MB(32%)  Iter   6  100.00%  Refine biparts
01:44:22   442 MB(32%)  Iter   6  100.00%  Refine biparts
[pterry@login.crane refinPprots820]$ 
## ANYTHING TO GLEAN FROM THESE LINES AT END OF ERROR FILE ??????????

## Q: SHOULD I HAVE GOTTEN RID OF THE '*' IN INPUT FILE SEQS BEFORE RUN MUSCLE ???????????????????????
less PPRhmmsearchsubset_P_prots820.fa.aln  ## looks to be *in* MSA fasta format.
head -n 50 PPRhmmsearchsubset_P_prots820.fa.aln
head -n 60 PPRhmmsearchsubset_P_prots820.fa.aln | tail -n 7
## 1st fasta seq has 53 lines

## Q for *Vikas*: convert to stockholm format using Vikas script, OR web converter pgm???????????????????????????????????????????????? 
http://sequenceconversion.bugaco.com/converter/biology/sequences/

07/10/17:
## could scp Vikas fasta2stockholm.pl pgm to crane, make conversion *there* ??????

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp fasta2stockholm.pl pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
chmod 755 fasta2stockholm.pl
./fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
/usr/bin/env: perl -w: No such file or directory  ## ERROR
## Q: perhaps 1st line of '.pl'file needs to be different ?????????????????????????
fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
-bash: fasta2stockholm.pl: command not found  ## ERROR



ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
[pterry@login.crane refinPprots820]$ srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
srun: job 7957944 queued and waiting for resources
srun: job 7957944 has been allocated resources
[pterry@c3713.crane refinPprots820]$ module load perl/5.22
[pterry@c3713.crane refinPprots820]$ fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
bash: fasta2stockholm.pl: command not found
[pterry@c3713.crane refinPprots820]$ ./fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
/usr/bin/env: perl -w: No such file or directory
## Q: so how get run on crane ????????????????????????????????????????????????????

## scp over PPRhmmsearchsubset_P_prots820.fa.aln
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln .
ls -lh
head -n 5 PPRhmmsearchsubset_P_prots820.fa.aln
## Q: which converter, fasta to stockholm  ???????????????????

## try fasta2stockholm.pl on Macbook ?????
fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
-bash: fasta2stockholm.pl: command not found
chmod 755 fasta2stockholm.pl
./fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx
more PPRhmmsearchsubset_P_prots820.fa.aln.slx
## so have 'stockholm MSA file
## examine a bit,
head -n 2 PPRhmmsearchsubset_P_prots820.fa.aln.slx
grep -c "Trae" PPRhmmsearchsubset_P_prots820.fa.aln.slx  ## 820, as expect.


## back on crane, *see* if can run the perl script, get '.slx' file there, won't have to scp the '.slx' over from macbook if works.

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl PPRhmmsearchsubset_P_prots820.fa.aln > PPRhmmsearchsubset_P_prots820.fa.aln.slx

-rw-r--r-- 1 pterry amundsen 2571524 Jul 10 22:42 PPRhmmsearchsubset_P_prots820.fa.aln.slx  ## same size as on Macbook

## now for *hmmbuild*

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots820

hmmbuild PPRhmmsearchsubset_P_prots820.fa.aln.hmm PPRhmmsearchsubset_P_prots820.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             PPRhmmsearchsubset_P_prots820.fa.aln.slx
# output HMM file:                  PPRhmmsearchsubset_P_prots820.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     PPRhmmsearchsubset_P_prots820.fa.aln   820  3114   727    19.20  0.590 

# CPU time: 3.50u 0.02s 00:00:03.52 Elapsed: 00:00:03.58
ls -al
exit
less PPRhmmsearchsubset_P_prots820.fa.aln.hmm
head -n 17 PPRhmmsearchsubset_P_prots820.fa.aln.hmm
HMMER3/f [3.1b2 | February 2015]
NAME  PPRhmmsearchsubset_P_prots820.fa.aln
LENG  727
ALPH  amino
RF    no
MM    no
CONS  yes
CS    no
MAP   yes
DATE  Mon Jul 10 23:32:32 2017
NSEQ  820
EFFN  19.196854
CKSUM 3787875152
STATS LOCAL MSV      -13.0024  0.69650
STATS LOCAL VITERBI  -14.3885  0.69650
STATS LOCAL FORWARD   -6.2752  0.69650
HMM          A        C        D        E        F        G        H        I        K        L        M        N        P        Q        R        S        T        V        W        Y   

wc PPRhmmsearchsubset_P_prots820.fa.aln.hmm
  2203  38656 339104 PPRhmmsearchsubset_P_prots820.fa.aln.hmm
tail -n 3 PPRhmmsearchsubset_P_prots820.fa.aln.hmm
          2.68100  4.42130  2.77999  2.72243  3.43843  2.42827  3.73790  3.28413  2.67511  2.65416  4.18353  2.92764  2.75690  3.17989  2.88499  2.37939  2.79409  2.98568  4.57761  3.62571
          2.21088  0.11609        *  4.16179  0.01570  0.00000        *
//


## realign using hmm model, hmmalign ?????, Vikas notes, is this a trimming fcn, --trim ????????????????  yes

07/11/17:
## perhaps make *slurm*, as 'timed out' with srun wi muscle above.
/Users/bterry/macbook2016/keenanres16/Bdac/pfam/uniprot

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp slurm_hmmalign_wheatproj_refin820.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refin820.sh 7976540  10:43am => ??:??am, 
squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
           7976540     batch TJob_hmm   pterry PD       0:00      1 (Priority)


cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
-rw-r--r-- 1 pterry amundsen    0 Jul 11 10:48 job.7976540.err
-rw-r--r-- 1 pterry amundsen    0 Jul 11 10:48 job.7976540.out
-rw-r--r-- 1 pterry amundsen 5.8M Jul 11 10:49 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln

sacct -j  7976540 -o start,end
              Start                 End 
------------------- ------------------- 
2017-07-11T10:48:43 2017-07-11T10:49:34 
2017-07-11T10:48:43 2017-07-11T10:49:34 
10:49:34 - 10:48:43 = < 1 min
## Q: is this quick ***ok*** ???????????????????????????????????????????????????????????????

less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
head -n 3 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
tail -n 3 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
grep -c "Trae" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln  ## 26240, so not telling anything ????????????????
wc -l PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln
26290 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

## scp following script over to crane, chmod, see if will run

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp stockholm2fasta.pl pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
chmod 755 stockholm2fasta.pl
ls -al
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820
module load perl/5.22
perl stockholm2fasta.pl -c 999999 -g PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa

less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
grep -c ">Traes" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa  ## 820 as expect.
logout

## scp to macbook, examine in bbedit
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa .

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
## examine wi bbedit, or SEA VIEW ??????????????????????????
## 1620 lines in bbedit, not sure could 'trim manually in bbedit ????????????????????????????????????????????????????????????????????????

## Gblocks, try run, with PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
## Save resulting alignment as PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa

## run grep -c 
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
philip-terry-2:FRprotseqs bterry$ grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
grep: PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa: No such file or directory
## WHY THIS ERROR ???????????????????????????????????????????????????????
## copy PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa to test_Gblocks.fa
grep -c "^>Tr" test_Gblocks.fa  ## 820 as expect ???????????????????????

07/12/17:
## JMower, lab 3sec III does parsimony wi MEGA. But I want ML. So check subsequent labs if shows MEGA can receive 'trimmed' file for ML. Looks like lab 4 (871 course, does ML (2/12/2016) with PhyML & MEGA. I note several settings for PhyML & Mega are needed. Might **Vikas** have such for this task for PhyML ???????? Looks like can dnload 'binaries' for PhyML ????????????? BMC genomics paper, p-3, 'default' settings.
## sec II, Running ML using MEGA: what choices need to make for current task ??????
## copy PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa to 'documents dir. Changed extension to '.fas' (probably not necessary. Selected 'all.files'. Then this file name appeared in 'docs' dir. Try open, get **ERROR**, 'invalid data file format specified'.
## addl question, 'out group', 'rooting a tree' ??????????????????
## NOW WHAT ????????????????????????? Problem with PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa *NAME* ????????
## has 4920 lines.

07/13/17:
**TO DO**: TRY COPY TO NEW NAME, DELETE ORIGINAL, COPY BACK TO THIS NAME ?????????????????????
## NOW MEGA CAN 'SEE' THE FILE IN *DOCUMENTS* DIR.
***'test_Gblocks.fa'***  ## 4920 lines
cp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa test_cp_cmd.fa
cp: PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa: No such file or directory
## Q: '@' after file names in ls -al command ????????????????????
## Q: SO JUST TRY CHANGE NAME with 'Finder', not unix cmd line ????? 'PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa' to PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa.NAME.PROBLEM
THEN do 
cp test_Gblocks.fa PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
## then test cp new file to 
cp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa test_cp_cmd.fa
## if successful (worked ok), delete (done) test_cp_cmd.fa

...
## now a menu of choices: 
Model/Method: 8 choices, took default, 'Jones-Taylor-Thornton (JTT) model'
## started 11:23am => ~ 12:30pm, 07/14/17, (~25hrs), 'bootstrapping started'
## four days later, 07/17/17, bootstapping only at 17%. So stop job, remove MEGA6 from macbook, try install MEGA7 (GUI version), restart PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa ML phylogeny.


07/16/17:

ONGOING

## Try install (done), then run on 'macbook pro'.
## Folowing MEGA7-CC-QUICK-START-TUTORIAL.PDF file.

## need scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa from macbook 'documents' dir to crane, then scp this to 'pro' in 'documents' dir.

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al  ## check if there ????
## on 'pro' at 'documents' dir
cd Documents
-rw-r--r-- 1 pterry amundsen  259925 Jul 16 12:14 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa .
ls -al
## on 'pro', 
scp (from crane to 'pro', ...Gblocks.fa file, Documents dir.


## slide 8: launch MEGA-PROTO from 'Applications folder'.
## model/method: 16 options, took 'JTT'
## match rest settings as did on macbook
## save infer_ML_protein_PPR820.mao in default 'bterry' dir.
## Q: skipped slide 15, 'compute timetree (RelTime-ML) ?????????????????????????????????/?????????????????????????????????????????????
## slide 7: to run 'megacc'
megacc ...
## started on 'pro', 12:49pm => 6:13pm, **5 hr 26 min.**

Start time: 16-7-17 12:49:41
Executing analysis:

   94%  Optimizing final tree MEGA-CC has logged the following error:
  When         = 16-7-17 18:13:13
  Data file    = PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
  AnalysisFile = ./infer_ML_protein_PPR820.mao
  Parameter    = -o
  Parameter    = MLtree_PPR820.out
  Message      = Error: Access violation

  Please see the summary file for warnings/messages
  Please validate all your inputs and try again. If you think this is a
  bug, please report it at http://www.megasoftware.net
       100% Analysis Complete                                                               
An unhandled exception occurred at $0002F35E :
EInOutError :
  $0002F35E

EInOutError:
philip-terry:Documents bterry$


## Q: access violation for writing MLtree_PPR820.out, output file, can't find such a file on 'pro' ????????????
## Q: '100% Analysis Complete'
## Q: perhaps check vikas, jmower, bug report to MEGA, OR install, try GUI MEGA on Mac  ?????????????????????????????????

07/17/17:
## Installed mega7(gui) on macbook. Open, won't show PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa in its file display for '.fas' in 'Documents', and for 'all files', when try open, says 'invalid data file format specified'. though it is the output from Gblocks ?????????? This was input in mega7cc on 'pro' yesterday, but 'Error: Access violation' occurred then ?????????????

## talked to Vikas, ideas:
--upload to 'shared' dir, two files,
PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa, & PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs

scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## check if ok
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
ls -al
## notified vikas, email

--try install BioPerl.org/INSTALL.html to see if can get align_convert_fas_to_phy.pl to work.  (crane HAS)
--try stockholm2fasta.pl output in align_convert_fas_to_phy.pl since previously trimmed. (DONE below)
--try PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa in MEGA, i.e., skip Gblocks, already trimmed by hmmalign.
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

07/18/17:
## check if for two '.fa' files,
PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa, & PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa 
## can be subset to <= 10 char for '>' lines.
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa

test3_hmmaln.fa

## will this work ??????
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | head -n 3  ## worked
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+{9})/\1\2/' | head -n 3  ## failed ???
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+){9}/\1\2/' | head -n 3  ## worked
cat test3_hmmaln.fa|perl -pe 's/(>).+(G.+){9}/\1\2/' |wc -l  ## 6, ok

cat test4_hmmaln-Gblocks.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | head -n 8  # worked
cat test4_hmmaln-Gblocks.fa|perl -pe 's/(>).+(G.+){9}/\1\2/' | head -n 8 # wrkd
cat test4_hmmaln-Gblocks.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | wc -l  ## 24, ok
## NOTE: EACH SEQ 1 LINE FOR ...hmmaln.fa, BUT MULTIPLE LINES FOR hmmaln-Gblocks.fa  ?????????????????????????????????????????????????????????????

cat PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | wc -l  ## 1640

cat PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa|perl -pe 's/(>).+(G.+$)/\1\2/' | head -n 1640 > PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln_10char.fa  ## has expected 1640 lines, 10 char names.
grep -c "^>" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln_10char.fa  ## 820, ok
grep "^>" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln_10char.fa | sort | uniq | wc -l  ## 768, **NOT UNIQ** ??????????????????????????????????????????
## NOTE: LOOKS LIKE CAN'T PROCEED THIS WAY ??????????????????????????????????
##CAN VIKAS PERHAPS PUT A LOOP INTO AWK (or just iterate integers to translate 'name' fields into >1, ... >820 ??????????????????????????


## while mega proceeding, try **PhyML**.
## look into PhyML, Q: could I use the online version ??????? 
## 1st, need 
*Building phylogeny tree
    Convert the hmm.aln.fas file into phylip format using the perl script
    
        align_convert_fas_to_phy.pl seq.fa.aln.hmmaln.fa

## Could just run this pgm on macbook on file PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
## better do on copy in case '.pl' pgm might change input pgm ???????
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
cp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks_copy.fa
## ERROR, 1ST FILE NAME, QQCH WRONG ?????????????????
## after fix above, copy works ok.

chmod 755 align_convert_fas_to_phy.pl
perl align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks_copy.fa
BEGIN failed--compilation aborted at align_convert_fas_to_phy.pl line 3.
## looks like 'Bio::AlignIO' needed ????????????????????????????????????????
## vikas, HOW TO GET ??????????????????

## Q: FOR VIKAS, fix Bio::AlignIO; ??????????????????????, since soln below to shorten name failed ??????????????????????????????????
## So, **Sat am**, email Vikas.

## for now try for PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks_copy.fa
i) convert fasta to phylip format with online converter 'http://sequenceconversion.bugaco.com/converter/biology/sequences/fasta_to_phylip.php'
## NOTE: **10** char limit, tried internet, no clear solns ??????????

## talked to adam, suggests try crane, bioperl installed there. Q: will this work for Gblocks with multiline seqs ???????????????? So to start:
--scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa to crane
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

--scp align_convert_fas_to_phy.pl to crane
scp align_convert_fas_to_phy.pl pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

--check permissions for the '.pl' file ## already 755

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820
module load bioperl
#perl stockholm2fasta.pl -c 999999 -g 

./align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
## -rw-r--r-- 1 pterry amundsen  911847 Jul 18 22:35 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy

## scp back to macbook, 
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  911847 Jul 18 23:22 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy

less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy
head -n 10 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.phy
## in bbedit, find 820 'Tra' lines as expect, 727 colms.

ii) then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.
## submitted, 11:59pm. Says, executing PhyML SMS. WAS THIS A GOOD CHOICE ???????
****************************************************************
## **1 day 12 hrs***
## potl FR section of phylogram, to test wi the '14', ck vikas, 'color' icon grayed out ???????????????????????


STOPPED

07/19/17:
## Checked at 9:45am,
ID: 1037530
Analysis name : p_prots820_fa_aln_hmmaln

Running

## to display in figtree

## Note: perhaps repeat, run Gblocks file thru align_convert_fas_to_phy.pl, then PhyML.
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820
module load bioperl

./align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa
--------------------- WARNING ---------------------
MSG: Got a sequence without letters. Could not guess alphabet
---------------------------------------------------
## got 5 of these warnings ???????????????????????????
ls -al
-rw-r--r-- 1 pterry amundsen  340299 Jul 19 10:52 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy

## Q: did this work with the 5 warnings? Or perhaps in input file, these seqs 'empty' ???????????????????????
exit
less PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  340299 Jul 19 11:02 PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy
## check bbedit for 
PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa  ## for missing residues in any seqs. FOUND 5 names with no aa's in the seq. Should I remove them, run align...pl again, or just submit current .phy to PhyML ??????????????????
## initially try latter.
## bbedit of PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy, says finds 'Tr 820 times BUT can't find the 5 names of no aa seqs ?????????????????????????

## so submit to PhyML, PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.phy
## name it: P_prots820_fa_aln_hmmaln-Gblx, SMS, aLRT.
## started, 12:11pm
## status, running.

07/20/17:
**************************************************************************
## P_prots820_fa_aln_hmmaln-Gblx ran in ***12 hr 28 min***.
## display pprhmmsearchsubset_p_prots820_fa_aln_hmmaln_gblocks_phy_phyml_tree.txt
## in figtree (what format, newick ?????????????)
## note: 4 files in pprhmmsearchsubset_p_prots820_fa_aln_hmmaln_gblocks_phy_phyml dir.
## **DON'T** KNOW BUNCH THIS INFO ?????????????????????
## display in figtree, looks like could be a split FR & rest of P proteins.
##TO DO: might color (grayed out ??????) as Vikas, check of the 14 near seqs prev plot are in the 'FR' section.

## **results**: looks like a set of proteins separated from rest in both phylogram from Gblx & hmmaln. Yet to test with the 14 most closely related to the 9 rice RF's previously. Don't 'color' grayed out on figtree in my hands (ck vikas) ????????? Will ck Adam about PhyML on crane, give us opportunity do bootstrap.
*****************************************************************
## map the 14 on each phylogran, 3 groups, members same on each tree.
******************************************************************
## I note: organization/grouping of the 14 on these plots (1,4,9), and clustal/omega plot before the new wheat ony hmm prepared ***is different***.

## consider get PhyML on crane, in PhyMl_manual_012.pdf, sec 6.4, discusses parallel version of PhyML. Q: is SMS available on dnload version ?????????

## try mega7(gui) wi different input, see if can find file in 'Documents' dir.
## Installed mega7(gui) on macbook. Open, won't show PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa in its file display for '.fas' in 'Documents', and for 'all files', when try open, says 'invalid data file format specified'. though it is the output from Gblocks ?????????? This was input in mega7cc on 'pro' yesterday, but 'Error: Access violation' occurred then ?????????????
## try mega7(gui) on macbook with PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa
## would not accept PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln-Gblocks.fa in Documents dir earlier ('invalid data file format specified') ??????????????????????????
## BUT, ACCEPTING PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa *in* Documents dir.
## *no* bootstrap, other options were guesses, start, 7/19/17, 11:35pm => < 5:00am on 07/22/17, so < 53 hrs.

07/21/17:

Waiting MEGA(GUI) to finish ????????????????????????
## Newick_Export.nwk
## rename PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.mega7.nwk
## dir.:  /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/mega7

## checked, '1' powition relative to 2, 3 & 6, 7. In Gblocks, closer to 6. 7. But in two 'hmmaln's, closer to 2, 3, a DIFFERENCE ?????????????????????????????????????


## Talked to VIKAS
i) rerun realign step as per vikas 'Notes_Alignment_UsingHMMs.txt' thru PhyML step, , but with the 'seq.fa' file including the 820 seqs ***+*** the 9 from rice. So will need run 820 + 9 starting with muscle. Q: **how** do they organize in a phylogram with respect to the '14'. Note above, in the phylogram plot before create wheat protein hmm, the 14 **don't** group as they do in most recent two phylograms.
I note: Vikas a **preference** for the hmmaln.fa over the hmmaln-Gblocks.fa trimmed MSA when going for a phylogram.

ii) CYVERSE (Vikas, says has PhyML, MEGA)
pterry, ipWs14
## start at DE (discovery environment), LAUNCH
## sign in
## click apps button
## search: PhyML
## in here, need upload data before can proceed wi phyML run
## click data button, try upload input data to /iplant/home/pterry/analyses

07/22/17:

## OK, prepare input 'phy' data for PhyML on Cyverse. (820 + 9). To do, 

FRknownseqs_shtname_9.fa the '9' rice FR protein fasta file to cat to PPRhmmsearchsubset_P_prots820.fa before 'muscle'
## work in dir /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829
## so copy preceding two files into this dir.
## from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs, PPRhmmsearchsubset_P_prots820.fa
## from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs, 
FRknownseqs_shtname_9.fa
cat PPRhmmsearchsubset_P_prots820.fa FRknownseqs_shtname_9.fa > PPRhmmsearchsubset_P_prots820_plus9.fa
## bbedit, PPRhmmsearchsubset_P_prots820_plus9.fa  ## 829 '>' lines as expect.

STOPPED

07/23/17:
## Q: WHY WOULD NEED MUSCLE HERE, ONCE HAVE 'seq.fa', that is 'ready' for hmmalign step, following 'Notes_Alignment_UsingHMMs.txt' of Vikas.

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -al
mkdir refinPprots820plus9
pwd
cp refinPprots820/PPRhmmsearchsubset_P_prots820.fa.aln.hmm refinPprots820plus9/
logout

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829
scp slurm_hmmalign_wheatproj_refin820plus9.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
scp PPRhmmsearchsubset_P_prots820plus9.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820plus9

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
ls -al ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_muscle_wheatproj_refin820.sh
ls -al
sbatch slurm_hmmalign_wheatproj_refin820plus9.sh 8084737  11:29am => ??:??am, 
squeue -u pterry  ## a PD
[pterry@login.crane scripts]$ squeue -u pterry
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
ls -lh
sacct -j  8084737 -o start,end
              Start                 End 
------------------- ------------------- 
2017-07-23T11:29:14 2017-07-23T11:30:09 
2017-07-23T11:29:14 2017-07-23T11:30:09 
## 11:30:09 - 11:29:14 = 55 sec.
less PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

cd /work/baenziger/pterry/wheatproj
cp refinPprots820/stockholm2fasta.pl refinPprots820plus9
cd refinPprots820plus9
ls -al
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
module load perl/5.22
perl stockholm2fasta.pl -c 999999 -g PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa
ls -al
less PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa
grep -c ">" PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa  ## 829 as expect.

STOPPED

## now fas to phy

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots820plus9
cd refinPprots820plus9
ls -al

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots820plus9
module load bioperl

./align_convert_fas_to_phy.pl PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
## -rw-r--r-- 1 pterry amundsen  921846 Jul 23 13:35 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy

## scp back to macbook, 
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots820plus9/PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  921846 Jul 23 13:38 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy

less PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy
head -n 4 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy
 829 727
'TraesCS1A01G222900.1'  ---------- ---------- ---------- ---------- ---------- ---------- 
'TraesCS3D01G317800.1'  -------PQT PTVRRLPMAT TAAA-AAAAT ATASTRANSL SRIFSSSSPT VKPPKHNPNT 
## so phy header 829, 727 as expect

ii) then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.
## submitted, 11:59pm. Says, executing PhyML SMS. WAS THIS A GOOD CHOICE ???????
****************************************************************
## **1 day 12 hrs***
## potl FR section of phylogram, to test wi the '14', ck vikas, 'color' icon grayed out ???????????????????????

07/24/17:
## so updated BdactyloidesthruGSEA081615.txt wheat...060117.txt to github, planets repo.

07/29/17:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt
## the output from french site.
-rw-r--r--@  1 bterry  staff  45412 Jul 25 11:46 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt

## from cyverse site,
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/cyverse/PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy_phyml_cyverse_tree.txt
## the output from cyverse site.
-rw-r--r--@  1 bterry  staff  45412 Jul 30 00:19 PPRhmmsearchsubset_P_prots820plus9.fa.aln.hmmaln.phy_phyml_cyverse_tree.txt
## ***same*** number bytes in file from both phylogeny sites.

## might try dnload figtree, Q: subtle, were there couple sites,need choose correct one. But, find printout where dnloaded from previously, **same** URL. I note, figtree 1.4.3 previously installed on 'pro', 

07/30/17:
## try dnload, install figtree v1.4.3.dmg
## when try run, gives **error** as previously, figtree v1.4.3 quit unexpectedly, ...
so in morning, scp twp tree files to 'pro' (still running os 10.10 & figtree v1.4.3 successfully), view in figtree, then mark 'Trae' 1,2,3,6,7 & the 9 rice 'FRs', see how they compare. 

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml

scp pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## go check if looks ok in 'shared' dir ??
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
## ck if number bytes same as before scp
ls -al  ## ok, 
-rw-r--r-- 1 pterry amundsen   45412 Jul 30 10:31 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt

## Now, set up a dir on 'pro', scp thid file over, and run in figtree. 
## create macbook macbookpro2017/vikas17/pyML829 dirs
cd ~
mkdir macbookpro2017
cd macbookpro2017
mkdir vikas17
cd vikas17
mkdir pyML829
cd ~/macbookpro2017/vikas17/pyML829
scp pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt .
ls -lh

## now, on 'pro', load tree file, pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt, in figtree.
##, locate 'Trae' 1,2,3,6,7 on tree
## 1 by self, r1,r2,r3,r4,r6,r7,r8,r9 near 2 & 3, r5 near 6 & 7 (????). So, split of the 9 rice proteins into two groups of sizes 1 & 8. 

## For 829 PhyML phylogram, 820 wheat proteins grouping similarly to PhyML 820 phylogram. For 829 PhyML phylogram, nine rice proteins group into two groups, r5 groups with 'Trae' 6, 7, 8, 10. Other 8 rice proteins group with 2,3,4,5,9,11,12,13,14 Trae wheat proteins (9 group). THOUGH the rice proteins group by selves on the shorter branch beside the '9 group'. What to think?

## Q: don't see 'aLRT' on branches ??????????????????

## If believe rice proteins good FR proteins, then perhaps grab (how many) wheat proteins near the rice eight group?
## Probably in any case, look for more proven FR proteins from other species.
## Would help to understand more about these proteins, correlate domains with proteins displaying near the eight rice proteins.

08/02/17:
## talked to Vikas
## so, highlighted two branches as possible FR's, red (8 rice FRs colocate) blue, (1 rice FR co-locates). 
## figtree, **save as** 820plus9nexustree_colors on 'pro'. A nexus file wih the colored rows representing the possible FR's co-locating near the rice FR's, either the group of 8, or the group of 1.
## rename to:
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt
## REQUEST: this file to **'shared'** dir on crane.
scp ...to crane 'shared' from 'pro', done.
scp ... to dir on Macbook:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
ls -al  ## two files of interest look fine.

-rw-r--r-- 1 pterry amundsen   70689 Aug  2 22:05 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt
-rw-r--r-- 1 pterry amundsen   45412 Jul 30 10:31 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml

scp pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt .
ls -lh
-rw-r--r--@  1 bterry  staff  45412 Jul 25 11:46 pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree.txt
-rw-r--r--   1 bterry  staff  70689 Aug  2 22:39 pprhmmsearchsubse t_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt

## saved wheatprojdoc060117 to github.
## macbook froze, had to hit power button to recover. Afterward cursor seemed ok again, so tried to install figtree again, FAILED again. Note is error message mentions 'java' application. PERHAPS THIS WHERE COULD WORK. PERHAPS CALL **APPLECARE**. 1-800-275-2273. www.apple.com/support/macbook, july 05, 2015.


07/05/17:
phoned applecare, result: Demonstrated > java 1.6 installed. At URL,
https://java.com/en/download/help/version_manual.xml
...
The JRE and JDK are separate and can coexist on your system. Only **one** JRE can be installed on Mac. There can be multiple JDKs installed on a system, as many as you wish.

JRE Version Command Line on Mac

Type the following in a Terminal window:

philip-terry-2:planets bterry$ /Library/Internet\ Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -version
java version "1.8.0_144"
Java(TM) SE Runtime Environment (build 1.8.0_144-b01)
Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)
philip-terry-2:planets bterry$ 

## so, apparently evidence > ver 1.6 installed.

## **or** in the **java control panel**

Your system has the recommended version of Java.
Java 8  update 144

## or at URL:
https://support.apple.com/en-us/HT204036

Note: You can also download legacy Java SE 6 from Apple if you’re using an app that specifically requires this unsupported, out-of-date version.

Perhaps see if Vikas can get figtree to work on his mac sierra' If can then, perhaps I try load **legacy** ver of java, see if that allows figtree to  install. Q: apparently both versions cannot coexist ????????????????/

STOPPED

08/09/10:

## looking thru 2nd paragraph, p-2, srep35152.pdf ref., ref 8 there, looking for verified RF gene/protein for more detailed comparison to possible red or blue wheat proteins. 
## Q: trying get seq from ensembl ??????????????

08/10/17:

## talked to vikas,
## Rf-1, try get GFF file from ensembl plants, use fig 3 notation try get seq. for 'RF-1 RF protein.
## from ftp://ftp.ensemblgenomes.org/pub/plants/release-36/gff3/oryza_sativa/, see File: File:Oryza_sativa.IRGSP-1.0.36.chromosome.10.gff3.gz
	566 KB 	6/7/17
## TO DO: open, check for addresses like fig 3, sci reports ref.
## put in dir orysa_sativa+gff3
gunzip ...

## note: refs 26, 27 ???????????????????

08/11/17:
## copied to github, version this file copied to extl hdrive, 08/11/17

## Look in sci reports for a second method to find RF proteins (read fig 1 ???)

## Look in sci reports, fig 3, ensembl plants, are the 'Os_10_17173' refs into gff3 file ????????????????

08/13/17:
## TO DO, subset the red & blue rows separately. Refer to as nearricesubsetof8 (red) & nearricesubsetof1 (blue).
## see line 1633
## ref. see line 642 above ????????????????

## to do, (from 642 - 676 above)
## subset colored rows in file from figtree, 
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt ## ('P' proteins)

## Note: ## pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt has NEXUS phylogenetic tree starting at line 837. So, just use 1st 837 lines to get 'colored' rows.

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt | head -n 835 > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt

## check number 'Treas' rows, in, '835' (835 as expected) in bbedit. Matches number in PPRhmmsearchsubset.fa (??????????????????????????????????)
grep -c "Traes" pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt   # 820 as expect

## now reg expn to get 'colored' subset ('P') list. 

grep '.*Traes.*ff\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt | head -n 4  ## worked

grep '.*Traes.*ff\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt | wc
      22      22     899  ## correct for Traes 'blues'
## note, has *one* of 9 rice RFs nearby
grep '.*Traes.*ff\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue.txt

grep '.*Traes.*00\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt | wc
     122     122    5002

grep '.*Traes.*00\]$' pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835.txt > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red.txt

## now pull out of 'red' & 'blue' 'P' proteins the name will use to go back and get their aa seq.

.+(Traes.+\d).+color.+  ## works bbedit, but lines not 'found' by this *remain*.
## so try,

# cat PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 30

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue.txt|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 22

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue.txt|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 22 > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt

cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red.txt|perl -pe 's/.+(Traes.+\d).+color.+/\1/' | head -n 122 > pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt

08/14/17:

## check for duplicates [TO DO ????????]
sort PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile |uniq | wc -l  ##          820  as expected if each record in unique.

07/06/17:
## now, subset PPRhmmsearchsubset_P_prots820plus9.fa fasta file with the 
with 'red' (122 proteins) & 'blue' (22 proteins) from figtree color. 

## file to subset with 'blue' & 'red' proteins is 
PPRhmmsearchsubset_P_prots820plus9.fa

## need copy down from extl hdrive, done.

## to do, use Vikas getsubsetfatofa.awk (getseq.awk) pgm to subset the records selected by figtree ('color' rows, possibly 'PF' proteins) in 'blue' or 'red' listfiles in PPRhmmsearchsubset_P_prots820plus9.fa. Output to 
PPRhmmsearchsubset_P_prots820plus9_blue.fa or PPRhmmsearchsubset_P_prots820plus9_red.fa

STOPPED


## getseq.AWK script to subset input .fa file
## getseq.AWK script to subset input .fa file
## ref: line 1657 above

## cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs
## ./getseq.awk PPRhmmsearchsubset.fa PPRhmmsearchsubset_plus9_clustaltree_colored_copy_1560_aftperl_listfile  > PPRhmmsearchsubset_P_prots820.fa
## grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

cd /Users/bterry/macbookpro2017/vikas17/tmp081117reparemacbook

./getseq.awk PPRhmmsearchsubset_P_prots820plus9.fa pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt > PPRhmmsearchsubset_P_prots820plus9_blue.fa

# grep -c "^>Tr" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

grep -c "^>Tr" PPRhmmsearchsubset_P_prots820plus9_blue.fa   # 22 as expect

## now for the red

./getseq.awk PPRhmmsearchsubset_P_prots820plus9.fa pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt > PPRhmmsearchsubset_P_prots820plus9_red.fa

grep -c "^>Tr" PPRhmmsearchsubset_P_prots820plus9_red.fa   # 122 as expect

08/15/17:
## I ***note*** for pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt file, 
## 119 of 122 rows either chr 1,2,or 6. And 8 rice RF proteins near, **but** by themselves. Pattern ***similar*** rice p-4, sci. reports ref. paper.

## talked to Vikas,
## try a 2nd method for grouping (see Sci Reps paper, srep35152.pdf)
## **Note**: for red set, chr 1,2,6 have 119 of the 122 rows.

08/17/17:
orthofinder plan:
## prepare to run on crane ??????????
## get 9 rice RF genes in a fasta file.
FRknownseqs_shtname_9.fa
PPRhmmsearchsubset_P_prots820.fa
grep -c "^>" FRknownseqs_shtname_9.fa   # 9 as expect
grep -c "^>" PPRhmmsearchsubset_P_prots820.fa   # 820 as expect

## ref: https://github.com/davidemms/OrthoFinder
## Aside: try run these two files in orthoMCL online (Q: can't find online site ??????????, ck if vikas can find ??????????????????

08/18/17:
## scp the two orthofind input files to dir ???? on crane.
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry
mkdir ofinder  ## where plan to place orthofinder input files.
/work/baenziger/pterry/wheatproj/ofinder

## scp the two files 
cd /Users/bterry/macbookpro2017/vikas17/tmp081117reparemacbook

scp rice9.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder
scp wheat820P.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder

## Adam on crane
## installed OrthoFinder-1.1.8.tar.gz
## to test, Q: are dependencis needed here ??????????
module avail
   blast/2.4     ## Q: is this blast ok ????????????????????
   mcl/14.137

module spider orthofinder  

STOPPED

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/ofinder
ls -lh
cd ..
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj
module load blast/2.4   ## ## Q: is this blast ok ????????????????????
module load mcl/14.137
module load orthofinder/1.1
OrthoFinder-1.1.8/orthofinder -h ## OrthoFinder should print its 'help' text.
bash: OrthoFinder-1.1.8/orthofinder: No such file or directory
????????????????????????????????????????????????????????????????
orthofinder -h  ## outputs help info.
## example test
# OrthoFinder-1.1.8/orthofinder -f ExampleDataset
orthofinder -f ExampleDataset
...
IOError: [Errno 2] No such file or directory: '/lustre/work/baenziger/pterry/wheatproj/ExampleDataset/SimpleTest.phy'
???????????????????????????????????????????????????????????
## perhaps need ExampleDataset/SimpleTest.phy in dir wheatproj ???????

cd /work/baenziger/pterry/wheatproj
## orthofinder -f fasta_files_directory [-t number_of_threads]
orthofinder -f ofinder
[pterry@c0912.crane wheatproj]$ orthofinder -f ofinder
OrthoFinder version 1.1.8 Copyright (C) 2014 David Emms

    This program comes with ABSOLUTELY NO WARRANTY.
    This is free software, and you are welcome to redistribute it under certain conditions.
    For details please see the License.md that came with this software.

16 thread(s) for highly parallel tasks (BLAST searches etc.)
1 thread(s) for OrthoFinder algorithm

## what to think ???????????????
## if run **slurm** what parameters to choose ????????????????????
## match number tasks with number_of_threads
orthofinder -f ofinder [-t number_of_threads]

cd /Users/bterry/macbookpro2017/vikas17/tmp081117reparemacbook
scp slurm_ofinder_wheatproj_inp820and9.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
less slurm_ofinder_wheatproj_inp820and9.sh
## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh

08/19/17:
sbatch slurm_ofinder_wheatproj_inp820and9.sh 8443947  12:15am => ??:??am, 
squeue -u pterry  ## a PD

cd /work/baenziger/pterry/wheatproj
less job.8443839.out
Unrecognised argument: [-t

ERROR: An error occurred, please review previous error messages for more information.
job.8443791.out (END) 
## try [ -t 4], if still fails (does), skip specifying number of threads.
squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
           8443947     batch TJob_ofi   pterry  R       0:46      1 c3713
## ok, running

cd /work/baenziger/pterry/wheatproj
ls -al
less job.8443947.out
cat job.8443947.out
## looks like orthogroup output produced.

[pterry@login.crane Results_Aug19]$ ls -al
total 92
drwxr-xr-x 4 pterry amundsen  4096 Aug 19 00:57 .
drwxr-xr-x 4 pterry amundsen  4096 Aug 19 00:14 ..
-rw-r--r-- 1 pterry amundsen   932 Aug 19 00:57 Orthogroups.csv
-rw-r--r-- 1 pterry amundsen    43 Aug 19 00:57 Orthogroups.GeneCount.csv
-rw-r--r-- 1 pterry amundsen    44 Aug 19 00:57 Orthogroups_SpeciesOverlaps.csv
-rw-r--r-- 1 pterry amundsen 25932 Aug 19 00:57 Orthogroups.txt
-rw-r--r-- 1 pterry amundsen 25863 Aug 19 00:57 Orthogroups_UnassignedGenes.csv
drwxr-xr-x 4 pterry amundsen  4096 Aug 19 00:57 Orthologues_Aug19
-rw-r--r-- 1 pterry amundsen     0 Aug 19 00:57 SingleCopyOrthogroups.txt
-rw-r--r-- 1 pterry amundsen  1407 Aug 19 00:57 Statistics_Overall.csv
-rw-r--r-- 1 pterry amundsen  1773 Aug 19 00:57 Statistics_PerSpecies.csv
drwxr-xr-x 2 pterry amundsen  4096 Aug 19 00:57 WorkingDirectory
[pterry@login.crane Results_Aug19]$ 
## anything useful in  WorkingDirectory ?????????????????????
## so look inside Orthogroups.csv
less Orthogroups.csv
cat Orthogroups.csv
less Orthogroups_UnassignedGenes.csv
less Orthogroups.txt
less Statistics_Overall.csv
cat Statistics_Overall.csv
less Statistics_PerSpecies.csv
cat Statistics_PerSpecies.csv
less Orthogroups_SpeciesOverlaps.csv
        rice9   wheat820P
rice9   1       1
wheat820P       1       1
Orthogroups_SpeciesOverlaps.csv (END) 
## ok, want to see if 39 wheat proteins in Orthogroups.csv are a subset of 122 'red' proteins from ML phylogeny previously.
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder/Results_Aug19/Orthogroups.csv .

## to do: compare results of ML phylogeny estimate of RF proteins in 820 wheat P proteins (red, 122, blue, 22). Determine how many of Orthogroups.csv wheat proteins (39) (formatted as vectors in Ogroups_copy.csv) are in the red & blue P subsets.
## So, need files 
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt
R
## from Ogroups_copy.csv
wheat820P <- c(TraesCS1A01G054500.1, TraesCS1A01G054700.2, TraesCS1A01G067400.1, TraesCS1A01G067600.1, TraesCS1B01G071600.1, TraesCS1B01G072400.1, TraesCS1B01G072900.2, TraesCS1B01G074600.1, TraesCS1B01G075000.1, TraesCS1B01G085300.1, TraesCS1B01G085900.1, TraesCS1D01G056200.1, TraesCS1D01G058200.1, TraesCS1D01G068400.1, TraesCS1D01G068500.1, TraesCS1D01G068800.1, TraesCS1D01G068900.1, TraesCS5B01G250800.1, TraesCS6A01G014500.1, TraesCS6A01G014600.1, TraesCS6A01G014800.1, TraesCS6A01G014900.1, TraesCS6A01G015000.1, TraesCS6A01G083000.1, TraesCS6A01G311600.1, TraesCS6B01G021200.1, TraesCS6B01G021500.1, TraesCS6B01G021600.1, TraesCS6B01G045200.1, TraesCS6B01G114300.1, TraesCS6D01G017700.1, TraesCS6D01G017800.1, TraesCS6D01G047700.1, TraesCS6D01G076500.1, TraesCS6D01G290900.1, TraesCS7D01G487500.1, TraesCSU01G089700.1, TraesCSU01G089800.1, TraesCSU01G090200.1)
## How read in red, blue files ???????????

08/20/17:
## methods, 
i) https://stackoverflow.com/questions/3695677/how-to-find-common-elements-from-multiple-vectors
ii) p-222, v buffalo

## try read into R
setwd("~/macbookpro2017/vikas17/tmp081117reparemacbook/r_stuff")
 ## p-196, v buffalo
#testdf <- read.delim("test.txt", header=FALSE, stringsAsFactors=FALSE)
bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)  ##  [1] 22  1  as expected.
head(bluedf, n=3)   ## looks ok
class(bluedf)
reddf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("red"))
dim(reddf)  ##  [1] 22  1  as expected.
head(reddf, n=3)   ## looks ok
class(reddf)
#wheat820P <- c(TraesCS1A01G054500.1, TraesCS1A01G054700.2, TraesCS1A01G067400.1, TraesCS1A01G067600.1, TraesCS1B01G071600.1, TraesCS1B01G072400.1, TraesCS1B01G072900.2, TraesCS1B01G074600.1, TraesCS1B01G075000.1, TraesCS1B01G085300.1, TraesCS1B01G085900.1, TraesCS1D01G056200.1, TraesCS1D01G058200.1, TraesCS1D01G068400.1, TraesCS1D01G068500.1, TraesCS1D01G068800.1, TraesCS1D01G068900.1, TraesCS5B01G250800.1, TraesCS6A01G014500.1, TraesCS6A01G014600.1, TraesCS6A01G014800.1, TraesCS6A01G014900.1, TraesCS6A01G015000.1, TraesCS6A01G083000.1, TraesCS6A01G311600.1, TraesCS6B01G021200.1, TraesCS6B01G021500.1, TraesCS6B01G021600.1, TraesCS6B01G045200.1, TraesCS6B01G114300.1, TraesCS6D01G017700.1, TraesCS6D01G017800.1, TraesCS6D01G047700.1, TraesCS6D01G076500.1, TraesCS6D01G290900.1, TraesCS7D01G487500.1, TraesCSU01G089700.1, TraesCSU01G089800.1, TraesCSU01G090200.1)
## won't work for char data
sed 's/^/"/' testOgroups.txt
sed 's/^/"/' whtOgroup.txt | sed 's/$/", /' > whtOgroupsed.txt

## before do any more, try read whtOgroup.txt into R.
whtOgroupdf <- read.delim("whtOgroup.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOgroupdf)  ##  [1] 39  1  as expected.
head(whtOgroupdf, n=3)   ## looks ok
class(whtOgroupdf)
intersect(whtOgroupdf$whtOgrp, bluedf$blue)  ## 7 proteins
intersect(whtOgroupdf$whtOgrp, reddf$red)  ## 29 prots
## so, 39 - 36 = 3 prots not in common.
## now venn diagram or 'UpSetR', Gehlenborg ??????????

08/23/17:
*********************************************************************
Brought this file back from 'pro' today, so when decide, will backup to github.
**********************************************************************

Talked to vikas yesterday:
1) would like to create 1 file of 820+9. See what happens for following:
i) run online with orthoMCL
ii) run on orthofinder
## if result same as when ran separate files 820 & 9, then don't do (2) below.
2) run 820 wheat P seqs vs those for a rice genome P's (how get???). Include the '9' RF's from previous runs. See if find more orthogroups (only got 1 wi 820 & 9 ?????????

08/25/17:
talked to vikas.
## vikas request to 'shared' dir on crane, 
a) the 36 wheat proteins found as RF's in orthoFinder run on 820 & 9 files above.
b) previously did not have 829 file, only 820 & 9, so copy two input files for orthoFinderb to 'shared'.
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh  ## ck dir contents?
cd ofinder
## rice9.fa, wheat820P.fa
cd /work/baenziger/shared/terry/hmm
cp /work/baenziger/pterry/wheatproj/ofinder/*.fa .  ## ok, done


08/26/17:
## before do any more, try read whtOgroup.txt into R.
whtOgroupdf <- read.delim("whtOgroup.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOgroupdf)  ##  [1] 39  1  as expected.
head(whtOgroupdf, n=3)   ## looks ok
class(whtOgroupdf)

bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)  ##  [1] 22  1  as expected.
head(bluedf, n=3)   ## looks ok
class(bluedf)
reddf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("red"))
dim(reddf)  ##  [1] 22  1  as expected.
head(reddf, n=3)   ## looks ok
class(reddf)

Ofinder_blue <- intersect(whtOgroupdf$whtOgrp, bluedf$blue)  ## 7 proteins
Ofinder_red <- intersect(whtOgroupdf$whtOgrp, reddf$red)  ## 29 prots
## so, 39 - 36 = 3 prots not in common with RF phylogenetic ML analysis proteins.
write.table(Ofinder_blue, file="Ofinder_blue.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="blue")
write.table(Ofinder_red, file="Ofinder_red.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="red")

cat Ofinder_blue.txt Ofinder_red.txt > Ofinder_blueandred36.txt
## to copy to 'shared' on crane: Ofinder_blueandred36.txt

scp Ofinder_blueandred36.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm  ## ok, done

08/27/17:

1) would like to create 1 file of 820+9. See what happens for following:
i) run online with orthoMCL
ii) run on orthofinder

1st, cp rice9.fa & wheat820P.fa from /Users/bterry/macbook2017/vikas17frompro/tmp081117reparemacbook/
## to /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
cat rice9.fa wheat820P.fa > rice9wheat820P.fa
ls -al

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
ls -lh  ## ck dir contents?
mkdir ofinder1
cd ofinder1

## scp rice9wheat820P.fa to ofinder1
scp rice9wheat820P.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/ofinder1
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/ofinder1
ls -lh  ## ck dir contents?
## now change slurm, scp over to crane
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
scp slurm_ofinder1_wheatproj_inp829.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/
## now run the slurm Job
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
#cd /work/baenziger/pterry/wheatproj
cd /home/baenziger/pterry/scripts

sbatch slurm_ofinder1_wheatproj_inp829.sh 8532901  1:08pm => ??:??am, 
squeue -u pterry  ## a PD

less job.8532901.err
Traceback (most recent call last):
  File "/util/opt/anaconda/4.3/envs/orthofinder-1.1.8/bin/orthofinder", line 1499, in <module>
    clustersFilename_pairs, statsFile, summaryText, orthogroupsResultsFilesString = DoOrthogroups(options, dirs, seqsInfo)    
  File "/util/opt/anaconda/4.3/envs/orthofinder-1.1.8/bin/orthofinder", line 1239, in DoOrthogroups
    summaryText, statsFile = Stats(ogs, speciesNamesDict, dirs.speciesToUse, dirs.resultsDir, iResultsVersion)
  File "/util/opt/anaconda/4.3/envs/orthofinder-1.1.8/bin/orthofinder", line 673, in Stats
    writer_sp.writerow(["Percentage of orthogroups containing species"] + [percentFormat % (100.*sum([iSp in og_sp for og_sp in speciesPresence])/len(properOGs)) for iSp in iSpecies])
ZeroDivisionError: float division by zero
job.8532901.err (END) 

## ***what to think*** ??????????????????????

less job.8532901.out
cat job.8532901.out
less Orthogroups.csv
        rice9wheat820P
Orthogroups.csv (END) 
## looks like ***no*** proteins reported in orthogroup ?????????????????

[pterry@login.crane Results_Aug27]$ cat Statistics_Overall.csv
Number of genes	829
Number of genes in orthogroups	0
Number of unassigned genes	829
Percentage of genes in orthogroups	0.0
Percentage of unassigned genes	100.0
Number of orthogroups	0
## NO genes in orthogroups
## So, have not proven that that using only **1** input .fa (rice9wheat820P.fa) file caused the failure to find any proteins in Orthogroups.csv output file. 

## for now, move on to try the **one** file (rice9wheat820P.fa) with orthoMCL online run. Tho I don't see a ratioale to do this, but if orthomcl only allows 1 file? Perhaps run a 2nd with rice9.fa & wheat820P.fa ???????
## dir is:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp
## orthomcl: http://orthomcl.org/orthomcl/proteomeUpload.do
## submitted 9:30pm, 08/27/17.

08/28/17:
## result from orthomcl with one input file, /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/rice9wheat820P.fa
## results in /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/omclonline/orthomclResult-2V0ZL87G4ZTZ/orthologGroups file.

## talked to vikas, he went and found one of the rice 9 proteins (row) in this output file, 

AB110443	OG5_131220	osat|NP_001064958	0	-181	89	99

## noted OG5_131220 orthomcl_group same for all 9 rice RF proteins. Q: why only 828 records ???????????????????
## anyway, search in bbedit for OG5_131220 rows gives 144 rows, similar to number for 'blue' & 'red' results from phylogenetic ML analysis. 

## so, *to do*, compare this 144 with the 144 'blue' & 'red' phylogenetic ML analysis proteins. If roughly same set, then **two independent** ways to identify. Also, score what chromosomes these hits are on. Q: are they preponderantly on 1, 2, & 6 ??????????

08/29/17:

## so need:
--144 rows from orthoMCL
--red & blue protein lists from phylogenetic ML analysis

## for reference, place intersect.R in dir.:
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff
## cp to this dir:
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt
## now, from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/orthomclResult-2V0ZL87G4ZTZ
## cp over orthologGroups to /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff
## now make copy of orthologGroups, then subset inside bbedit to oGroups144.txt


grep '.*OG5_131220.*$' oGroups144.txt > Test
## deleted oGroups144.txt, renamed test to oGroups144.txt.
## oGroups144.txt has 135 non rice9 RFs, 122 match red, 10 match blue, apparently 3 non matchers.

## next, cut 1st colm from oGroups144.txt, then ready for r code for intersect test.
## from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff

cut -f 1  oGroups144.txt | head -n 3
cut -f 1  oGroups144.txt > oGroups144col1.txt  ## ok, 144 rows

## now for the intersect from R code
whtOMCLgroupdf <- read.delim("oGroups144col1.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOMCLgroupdf)
head(whtOMCLgroupdf, n=3)
class(whtOMCLgroupdf)

bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)
head(bluedf, n=3)

reddf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("red"))
dim(reddf)
head(reddf, n=3)

Ofinder_blue <- intersect(whtOMCLgroupdf$whtOgrp, bluedf$blue)
Ofinder_red <- intersect(whtOMCLgroupdf$whtOgrp, reddf$red)

## check
red_blue_overlap <- intersect(reddf$red, bluedf$blue)
length(red_blue_overlap)  ## 0 as expect

write.table(Ofinder_blue, file="OfinderMCL_blue.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="blue")
write.table(Ofinder_red, file="OfinderMCL_red.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names="red")

## so, 10 of 22 'blue' phylogenic ML proteins match with OfinderMCL OG5_131220 orthomcl_group proteins, 122 of 122 'red' phylogenic ML proteins match with OfinderMCL OG5_131220 orthomcl_group proteins (135 OfinderMCL proteins). For the 'red', 122/820 and 122 (of 135)/820 orthoMCL match. Statistically, this degree of matching would not appear to be by chance. So if one can view othoMCL & phylogeny ML as independent methods, then the matching proteins related. 

## next step. Doc chromosomes for the 'red' 122?
## next step, perhaps do orthoMCL for the 820 wheat P proteins vs one of the rice protein genome proteins (1st do hmmPPR.hmm for the rice proteins to select P subset), or don't subset 1st, let orthoMCL find as many orthogroups as can? Guess just put all in one file? That is, try broaden search for RF proteins?

08/30/17:
## talked to vikas 
1) ## **to do** request put 147 wheat proteins on 'shared'. Q: how got 147? 122 (match 'red') + 10 (match 'blue'). Q: how get the additional 15? Perhaps the remaining 3 from orthoMCL, + ?? (perhaps remaining 12 nonmatching from 'blue' ?????????
  
## combine 135 proteins from oGroups144col1.txt (**remove** 9 rice rows. Last 12 needed are the 'blue' phylogenetic proteins not intersecting with oGroups144col1.txt proteins. 
## to get these, try setdiff(x,y) in R (order parameters matters) where x = blue file, y = intersect blue with oGroups144col1.txt output (10 rows)

08/31/17:
## will become setdiff12blue.R after run in rstudio.

setwd("~/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff")
whtOMCLgroupdf <- read.delim("oGroups144col1.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOMCLgroupdf)
head(whtOMCLgroupdf, n=3)
class(whtOMCLgroupdf)
bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)
head(bluedf, n=3)
Ofinder_blue <- intersect(whtOMCLgroupdf$whtOgrp, bluedf$blue)
length(Ofinder_blue)
class(Ofinder_blue)
## if vector (char vector), use as is ???????????????????????????????????????????????
class(bluedf$blue)
twelve <- setdiff(bluedf$blue, Ofinder_blue)
class(twelve)
length(twelve)  ## 12
write.table(twelve, file="twelve_nocolnam.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=FALSE)
write.table(whtOMCLgroupdf, file="oGroups144col1_nocolnam.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=FALSE)

## grep out 9 rice rows
grep '.*OG5_131220.*$' oGroups144.txt > Test
grep 'Tr' oGroups144col1_nocolnam.txt > oGroups144col1_nocolnam_norice9.txt

## then cat twelve_nocolnam.txt to oGroups144col1_nocolnam_norice9.txt giving oGroups135plus12blue_norice9.txt

cat oGroups144col1_nocolnam_norice9.txt twelve_nocolnam.txt > oGroups135plus12blue_norice9.txt

sort oGroups135plus12blue_norice9.txt |uniq | wc -l  ## 147


## next move oGroups135plus12blue_norice9.txt to 'shared' for vikas.
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff

scp oGroups135plus12blue_norice9.txt pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm

## go check 'shared' dir
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
ls -lh  ## ck dir contents?

sort oGroups135plus12blue_norice9.txt > sort147.txt  ## counted 3 rows for each chromosome.	

# slip a save to ***github*** in here
cd ~/planets
git status
git add wheatprojdoc060117.txt
git commit -m "update 08/31/17 wheatprojdoc060117.txt"
git status
git push origin master
# git remote -v

09/01/17:
## spoke wi vikas
I have downloaded the gff3 file and it is available here: /work/baenziger/shared with Filename: iwgsc_refseqv1.0_HighConf_2017Mar13.gff3.zip.

I have also downloaded an annotation file available for the reference genome (iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB.zip).

## Q: what get from each ??????????????????????

09/02/17:
## initially, det. how use the gff3 file. Perhaps scp over to mbook.

/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/wheatgff3

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/hmm
cd /work/baenziger/shared

cd /work/baenziger/shared/terry/hmm
cp /work/baenziger/shared/iwgsc_refseqv1.0_HighConf_2017Mar13.gff3.zip .
cp /work/baenziger/shared/iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB.zip .
## scp gff3 to /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/wheatgff3

scp pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm/iwgsc_refseqv1.0_HighConf_2017Mar13.gff3.zip .
ls -lh
unzip iwgsc_refseqv1.0_HighConf_2017Mar13.gff3.zip
ls -al
less iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
head -n 3 iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
## looks like 9 fields, perhaps look for 'Traes...' rows in 147, 'gene' rows for these names ??????????????
wc -l iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
 1743281 iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
sort oGroups135plus12blue_norice9.txt |uniq > testsort147.txt
less iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
## 1st protein name: TraesCS1A01G031600
grep -c "TraesCS1A01G031600" iwgsc_refseqv1.0_HighConf_2017Mar13.gff3  ## 4 rows
grep "TraesCS1A01G031600" iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
## try grep just 'gene' line ??????
grep '.*gene.*TraesCS1A01G031600.*$' iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
## worked, got just the gene line.
## next, perhaps can create a shell script with such a command for each of 147 rows in sort147.txt ?????????????????

09/03/17:
## **annotation** file for the reference genome
scp pterry@crane.unl.edu:/work/baenziger/shared/terry/hmm/iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB.zip .
ls -lh
unzip iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB.zip
ls -al
less iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB

head -n 2 iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB

pcp256668pcs:wheatgff3 bterry$ head -n 2 
iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB

Gene-ID	is_repr	AHRD-Quality-Code	Blast-Hit-Accession	Human-Readable-Description	Pfam-IDs-(Description)	Interpro-IDs-(Description)	GO-IDs-(Description)-via-Interpro	Gene-or-TE-TE?-U (via-function)	Pfam-IDs	Interpro-IDs	GO-IDs-via-Interpro
TraesCS1A01G000100.1	1	-**	sp|P0AGJ7|TRML_ECOLI	tRNA (cytidine(34)-2'-O)-methyltransferase				G			
pcp256668pcs:wheatgff3 bterry$
## A Q: ***possible*** search annotation file for all PPR proteins, compare to the 147 'RF' proteins ??????????????????????????????????????

## continue planning to analyze gff3 file:
## attempt to subset 'gene' gff3 rows of iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
grep '.*gene.*$' iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 | wc -l  ##   110790
## think could handle with R ??????????
grep '.*gene.*$' iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 > gff3_genes.txt
wc -l gff3_genes.txt
  110790 gff3_genes.txt
cut -f 1,3,4,5 gff3_genes.txt > gff3_genes_col1345.txt
head -n 3 gff3_genes_col1345.txt
cut -f 9 gff3_genes.txt > gff3_genes_col9.txt
head -n 3 gff3_genes_col9.txt  ## looks like 'Trae' numbers 'incrementing' ????
cat gff3_genes_col9.txt|perl -pe 's/^ID=(Tr.+);.+/\1/' | wc -l  ##   110790 as expect.
cat gff3_genes_col9.txt|perl -pe 's/^ID=(Tr.+);.+/\1/' | head -n 110790 > gff3_genes_col9names.txt
wc -l gff3_genes_col9names.txt
  110790 gff3_genes_col9names.txt  ## a expect
## to check fidelity,
head -n 3 gff3_genes_col9.txt
head -n 3 gff3_genes_col9names.txt
tail -n 3 gff3_genes_col9.txt
tail -n 3 gff3_genes_col9names.txt
## so lengths same, and head, tail same, so can proceed
sort gff3_genes_col9names.txt |uniq | wc -l   ## 110790 as expect
head -n 3 gff3_genes.txt
head -n 3 gff3_genes_col9names.txt
tail -n 3 gff3_genes.txt
tail -n 3 gff3_genes_col9names.txt
wc -l gff3_genes.txt  ##   110790 gff3_genes.txt
wc -l gff3_genes_col9names.txt  ##   110790 gff3_genes_col9names.txt
## now, paste back together colms 1,3,4,5 with colm9.
paste gff3_genes_col1345.txt gff3_genes_col9names.txt > gff3_1345_9names.txt
head -n 3 gff3_1345_9names.txt
tail -n 3 gff3_1345_9names.txt
## preceding checks look ok.

2) ## vikas, ***above***, got GFF3, get start, end, (including introns ?????) introns, exons, 
## Note: word 'intron' ***not*** in GFF3 file (checked with 'less' command) ??????????


STOPPED

3) ## display location all proteins (genes) all chromosomes same plot. (Q: how do ????, vikas had example ????????????????
4) ## in 'annotation' file, perhaps try 
--select rows matching 'gene' names in gff3 (approx 110k rows), then look for 'ppr' in human readable description column?
--select 147 rows tentative 'RF' proteins, see what their human readable description column says?

09/04/17:

## sent vikas email stating gff3 issue, possible solns, request any suggestion ???

less iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
wc -l iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
 1743281 iwgsc_refseqv1.0_HighConf_2017Mar13.gff3  ## note 110790 'genes' rows

09/05/17:
talked to vikas:

i. subset gff3_1345_9names.txt wi grep -x -f, pattern file will be sort147.txt file after remove ".digit' from rhs each row.
## to display locations on chromosomes, check into ggplot2 'facets' ?????????
## Q: can **IGV** browser be used to display ?????? Perhaps if in gff3 format ????????
## Q: perhaps need subset ***the original gff3*** file wi the 147 RF names to display in GSDS or IGV or UCSC (checked ucsc site, currently **not** handle gff3 format)????????????
## try grep -x -f on (Q: with the name multiple times in some rows, to **test** if might be a problem ????????
## looks like practice wi top few lines of the gff3 file wi lines wi multiple names in.


ii. annotation file protein names have ".digit' at end of its names, which start off the rows. Apparently tab separated colms. Try just one name to start, may be multiple rows with each protein name ????????? Perhaps reduce number rows before subset with the 147 'RF' protein file. determine how many row, perhaps play around with 'cut' and 1st few rows of annotation file to determine  ???????

wc -l iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB
  107502 iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB

iii. plot gene structures from gff3 (vikas has link for this, http://gsds.cbi.pku.edu.cn/)

09/06/17:
## one add'l **idea**: phylogeny on just the 147, GSDS site can then display (me: unclear ??????)

## working on (i) from previous day
## 1st, remove '.digit' from rhs sort147.txt, before try subset original gff3 file with it (i.e., using grep -x -f)

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff

cat sort147.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | wc -l  ## 147, ok
cat sort147.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 3
TraesCS1A01G031600  ## looks good
cat sort147.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 147 > sort147_nodotnum.txt

## now ready try grep -x -f pat.txt sample.txt
## 1st, try on '31600' lines of iwgsc_refseqv1.0_HighConf_2017Mar13.gff3

grep -x -f sort147_nodotnum.txt samp31600_8rows.gff3 | wc -l   ## 0
grep -f sort147_nodotnum.txt samp31600_8rows.gff3 | wc -l    ## 8, so not specific ???
grep -f sort147_nodotnum.txt samp31600_8rows.gff3
## perhaps check if just 'TraesCS1A01G031600' can successfully match in samp31600_8rows.gff3

grep '.*TraesCS1A01G031600.*' samp31600_8rows.gff3 | wc -l  ## worked!
## but, -f option not working, what to try ????????????????
## python list & for loop ??????????????????????
name in 
09/07/17:
## 1st try code from Zeynep
bash Philip.bash sort147_nodotnum.txt
bash: Philip.bash: No such file or directory  ## what wrong  ?????
## perhaps try
bash Philip.sh sort147_nodotnum.txt  ## this ran
## ok, try modify Philip.sh to Philip_no_else.sh
bash Philip_no_else.sh sort147_nodotnum.txt
## ok, try modify Philip_no_else.sh to Philip_no_echo.sh
bash Philip_no_echo.sh sort147_nodotnum.txt
## ok, looks like worked on this test sample gff3 file.
## now try to save output to a file
bash Philip_no_echo.sh sort147_nodotnum.txt > testbashtofile.gff3
## looks like worked. Now try on actual gff3 file, iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
## Philip_realgff3.sh
bash Philip_realgff3.sh sort147_nodotnum.txt > realbashtofile.gff3
## ran in less than 20 min, 789 rows, Q: should I delete last 3 pattern outputs since no chromosome specified before pass to GSDS display  (or IGV) ?????

09/08/17:
## submit realbashtofile.gff3 to http://gsds.cbi.pku.edu.cn, request png output
## Q: what looking at ????????
## different number of 'names' left side of png display ??????????
## Q: other possible displays from GSDS (phylogenetic tree) ??????????????
## Q: if want qqch like Vikas had with gene locations on chromosome, not getting it here ????????
## Q: to get such a display, perhaps check the faceting with ggplot2 using my 5 colm df for 'gene' rows for the 147  ??????
## Q: or IGV ????????????????

## talked to vikas
i. plot chr(y axis) vs start position (x axis). Could subset 5 colm from gff3 (already gff3 subset to 'genes' rows) with 147 RF names, then take appropriate colms from gff3_1345_9names.txt, 1st & 2nd, to plot with ggplot2 script from vikas.
ii. subset the annotation file for the 147 RF proteins/genes. See what the descriptions say.

09/09/17: to subset 
## so try to do (i) 1st. Working with GenomeWidePlot.R from vikas, but 1st need file with 

wc -l gff3_1345_9names.txt
  110790 gff3_1345_9names.txt
## try modify Philip_realgff3.sh, use to subset gff3_1345_9names.txt wi the 147 RF genes from sort147_nodotnum.txt.
## rename, modify this '.sh' file in Philip_5colmgff3.sh
bash Philip_5colmgff3.sh sort147_nodotnum.txt > gff3_1345_9names_147.txt  ## ok
## Note, last 3 rows have no chromosome number, but a start number ??????????????????????????????????
## cut colms 1 & 3 for input to GenomeWidePlot.R.

cut -f 1,3 gff3_1345_9names_147.txt > gff3_cols13_147.txt
head -n 3 gff3_cols13_147.txt

## then remove last 3 rows, no chr number ???????????????????????
gff3_cols13_144.txt
## finally, remove 1st 3 char each row in gff3_cols13_144.txt with 

cat gff3_cols13_144.txt|perl -pe 's/chr(.+)/\1/' | head -n 3  ## ok
cat gff3_cols13_144.txt|perl -pe 's/chr(.+)/\1/' | head -n 144 > gff3_cols13_144nochr.txt

## now try modify GenomeWidePlot.R to use here ??????
## to GenomeWidePlot_pmt.R
## note 3 rows chr 5, 3 rows chr 7. Keep ????????????????????????????????
## GenomeWidePlot_pmt.R  ## result: basically for the chroms with the most putative Rf genes, #'s 1, 2, 6, the genes are clustered!
## What was vikas suggesting for the change to 'geom_point' in the ggplot code ???????
## A change which would be nice is the number of genes on the plot to indicate the clustering ???????????????
## so perhaps vikas thinking of cluster bars & I would add the number in the cluster ??????????

09/10/17:
## use vikas email to summarize result of GenomeWidePlot_pmt.R run on gff3_cols13_144nochr.txt.

Would say, basically for the chroms with the most putative Rf genes, #'s 1, 2, 6, the genes are clustered! 

***NOTE:*** CLUSTERS NEAR SAME LOCATION FOR EACH NUMBERED CHROMOSOME FOR A, B, & D CHROMOSOME DUPLICATIONS!

chrom   # prots      # prots
        on chrom     in cluster
1A       23            22
1B       28            26
1D       30            29
2A       8              7
2B       6              4
2D       8              7
5A       1
5B       2
5D       1
6A       11             7(?)
6B       12             5,4(?)
6D       11             8
7B       1
7D       2

## now for (ii) above, the annotation file

wc -l iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB
  107502 iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB

## try modify Philip_realgff3.sh, use to subset iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB wi the 147 RF genes from sort147_nodotnum.txt.
## rename, modify this '.sh' file in Philip_realannotation.sh
bash Philip_realannotation.sh sort147_nodotnum.txt > wheatannotationvs147.txt  ## ok
wc -l wheatannotationvs147.txt
     147 wheatannotationvs147.txt
## all 147 rows are PPR 'human-readable description' colm.
## To do: read into R so can more easily 'see' the colms.

cut -f 5 wheatannotationvs147.txt | head -n 147 > colm5.txt
## looks like colm 5 is 'Human-Readable_Description' colm. All rows have 'Pentatricopeptide repeat-containing protein' in colm 5
## colm 6, Pfam-IDs-(Description), Q: what to think ?????????????????????
## colm ?,Interpro-IDs-(Description). Q: Q: what to think ?????????????????????
## colm 9, (via-function), all 'G's, ????????????????????//
## colm 10, Pfam-IDs
## colm 11, Interpro-IDS
## colm 12, GO-IDs_via-Interpro

## so annotation file result: almost all colm 5 'Human-Readable_Description' are 'Pentatricopeptide repeat-containing protein'.
## test
cut -f 5 iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB > allcolm5_annotation.txt
## can see much annotation, not PPR
## perhaps search on colm 5 for 'Pentatricopeptide', get a sense if many more than 147 in allcolm5_annotation.txt ??????
grep -c "Pentatricopeptide" allcolm5_annotation.txt  ## 1602
grep "Pentatricopeptide" allcolm5_annotation.txt > colm5Pentatricopeptide.txt
## basically 1602 rows of 'Pentatricopeptide repeat-containing protein' in iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB
## ~ 1.5% of the rows, WHAT TO THINK ???????????????????????????????

09/11/17:
## talked to vikas
09/12/17:
i. run GenomeWidePlot_pmt.R again, this time with 
#geom_jitter(alpha=I(0.1)) +
## test different settings starting with '0.1'
## done, helps, may want try later, perhaps not helping current goal enough ??????
## also, modify 
 geom_point(colour="red", size=2) +
## try values of 0.5, 1.0, 1.5
## tried 0.5, helps, still can see points, but can close by points also. Note, 2A chrom, should be 7 points, still only see 4. 1D, should see 29, only seeing 22
## Q: why vikas comment out ????????????????????????????????/

ii. det. size of clusters for chrom's !A, 1B, 1D, 2A, 2B, 2D, 6A, 6B, 6D, for now just use start positions. To do, for example for 1A, read gff3_cols13_144nochr.txt file into R, grep '1A' in colm 1, the 23 rows, sort by colm 2, small to large, then head 22, removes location outlier. Then, 

## do in R if reg expn will work, else, try unix command line ????????????????
df_col13_144nochr <- read.delim("gff3_cols13_144nochr.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("chrom", "start"))
dim(df_col13_144nochr)
head(df_col13_144nochr, n=3)
df_1A <- df_col13_144nochr[grep("^1A", col13_144nochr_df$chrom), ]
dim df_1A  ## will be used vikas plot for 22, TO DO, so delete row 23 before plot 
## sort df_1A with the 22 before vikas plot (tho presumably don't need)
## need min, max for row 1 & 2 of df_minmaxchr1.

chrom <- vector(mode="character", length=6)
start <- vector(mode="numeric", length=6)

09/14/17:
df_minmaxchr1 <- data.frame(chrom, start)
df_minmaxchr1[1,1] <- "1A"
df_minmaxchr1[2,1] <- "1A"
df_minmaxchr1[3,1] <- "1B"
df_minmaxchr1[4,1] <- "1B"
df_minmaxchr1[5,1] <- "1D"
df_minmaxchr1[6,1] <- "1D"
head(df_minmaxchr1)

from https://stackoverflow.com/questions/1296646/how-to-sort-a-dataframe-by-columns
## dd[order(-dd$z, dd$b),]
df_1A <- df_1A[order(df_1A$start), ]
tail(df_1A, n=3)  ## check that last row is the outlier value ?????
## need remove row 23 1st
dim(df_1A)  ## expect 22 2 ?????????????
df_1A <- df_1A[-c(23), ]
dim(df_1A)  ## expect 22 2 ?????????????

df_minmaxchr1[1,2] <- min(df_1A$start, na.rm=T)
df_minmaxchr1[2,2] <- max(df_1A$start, na.rm=T)
head(df_minmaxchr1)

09/13/17:
## TO finish last 4 rows of df_minmaxchr1
## WILL need df_1B & df_1D.

df_1B <- df_col13_144nochr[grep("^1B", df_col13_144nochr$chrom), ]
dim(df_1B)  ## will be used vikas plot for 26, TO DO, so delete 2 rows before plot 
df_1B <- df_1B[order(df_1B$start), ]
tail(df_1B, n=3)  ## check that last 2 rows are the outlier values ?????

## need remove last 2 rows 1st
df_1B <- df_1B[-c(27, 28), ]
dim(df_1A)  ## expect 26 2 ?????????????

df_minmaxchr1[3,2] <- min(df_1B$start, na.rm=T)
df_minmaxchr1[4,2] <- max(df_1B$start, na.rm=T)
head(df_minmaxchr1)

## now for df_1D

df_1D <- df_col13_144nochr[grep("^1D", df_col13_144nochr$chrom), ]
dim(df_1D)  ## will be used vikas plot for 29, TO DO, so delete 1 row before plot 

df_1D <- df_1D[order(df_1D$start), ]
tail(df_1D, n=3)  ## check that last row is the outlier value ?????

## need remove last row 1st
df_1D <- df_1D[-c(30), ]
dim(df_1D)  ## expect 29 2 ?????????????

df_minmaxchr1[5,2] <- min(df_1D$start, na.rm=T)
df_minmaxchr1[6,2] <- max(df_1D$start, na.rm=T)
head(df_minmaxchr1)

## TO calc **'range'** of '1A' cluster, & of '1B' & '1D'. 
>range(y,na.rm=TRUE)

[1] -4 43

[1] 47

## define dataframe

chr_ran <- vector(mode="character", length=3)
str_ran <- vector(mode="numeric", length=3)
df_rangchr1 <- data.frame(chr_ran, str_ran)
df_rangchr1[1,1] <- "1A"
df_rangchr1[2,1] <- "1B"
df_rangchr1[3,1] <- "1D"

rang <- range(df_1A$start,na.rm=TRUE)
class(rang)
rang
df_rangchr1[1,2] <- diff(rang)

rang <- range(df_1B$start,na.rm=TRUE)
df_rangchr1[2,2] <- diff(rang)

rang <- range(df_1D$start,na.rm=TRUE)
df_rangchr1[3,2] <- diff(rang)
head(df_rangchr1)

## TO DO: now for some plotting

## will need to convert df_minmaxchr1 to terminology in GenomeWidePlot.R (the 'data' df there) before proceed with that plot.

## for example, 'data' df, colms 'chrom' & 'pos'
data <- df_minmaxchr1
head(data)
colnames(data)[2] <- "pos"
head(data)

## following from GenomeWidePlot_pmt.R
##********************
#Converting BP scale from bp to Mb
data$Mb=data$pos*0.000001
head(data)

library(RColorBrewer)
library(ggplot2)
library(reshape)  ## h wickham ???????????????

#Plot
ggplot(data, aes(x=Mb, y=chrom)) + theme_classic() +
  geom_point(colour="red", size=0.5) +
  #scale_x_continuous(breaks = seq(0, 60, 10)) +
  theme(axis.text.x = element_text(colour = 'black', face="bold", size = 20, vjust=0.5)) +
  theme(axis.text.y = element_text(colour = 'black', face="bold", size = 20)) +
  theme(axis.title.x = element_text(colour = 'black', face="bold", size = 25, vjust=-0.2)) +
  theme(axis.title.y = element_text(colour = 'black', face="bold", size = 25, angle=90)) +
  xlab("Length of chromosome (Mb)") +
  ylab("Chromosome") +
  geom_jitter(alpha=I(0.1)) +
  theme(plot.background=element_blank(),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),
        panel.border=element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  scale_x_continuous(expand = c(0,0)) + scale_y_discrete(expand = c(0,0))

##*********************************************

## Yet to plot, df_1A, df_1B, df_1D
head(df_1A)
dim(df_1A)
tail(df_1A)

## for example, 'data' df, colms 'chrom' & 'pos'
data <- df_1A
head(data)
colnames(data)[2] <- "pos"
head(data)

## following from GenomeWidePlot_pmt.R
##********************
#Converting BP scale from bp to Mb
data$Mb=data$pos*0.000001
head(data)

#Plot
ggplot(data, aes(x=Mb, y=chrom)) + theme_classic() +
  geom_point(colour="red", size=0.5) +
  #scale_x_continuous(breaks = seq(0, 60, 10)) +
  theme(axis.text.x = element_text(colour = 'black', face="bold", size = 20, vjust=0.5)) +
  theme(axis.text.y = element_text(colour = 'black', face="bold", size = 20)) +
  theme(axis.title.x = element_text(colour = 'black', face="bold", size = 25, vjust=-0.2)) +
  theme(axis.title.y = element_text(colour = 'black', face="bold", size = 25, angle=90)) +
  xlab("Length of chromosome (Mb)") +
  ylab("Chromosome") +
  geom_jitter(alpha=I(0.1)) +
  theme(plot.background=element_blank(),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),
        panel.border=element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  scale_x_continuous(expand = c(0,0)) + scale_y_discrete(expand = c(0,0))

##*********************************************

## plotting with geom_point = 2 gave expected 22 points. Plotting with geom_point = 0.5 gave 26 points != 22 ??????????????????????????????
## note: clustering in 3 locations, **not** uniformly distributed across the 43 Mb for df_1A.

in df_1A, 1st 2, next 9, next 7 & last 4 in the total of 22. 

#rang <- range(df_1A$start,na.rm=TRUE)
#rang1 <- range(df_1A[1:2, ], na.rm=TRUE)  ## fails
rang1minmax <- range(df_1A$start[1:2], na.rm=TRUE)  ## works
head(rang1minmax)
rang1 <- diff(rang1minmax)
rang1  ## [1] 6964

rang2minmax <- range(df_1A$start[3:11], na.rm=TRUE)  ## works
head(rang2minmax)
rang2 <- diff(rang2minmax)
rang2  ## [1] 1,337,765

rang3minmax <- range(df_1A$start[12:18], na.rm=TRUE)  ## works
head(rang3minmax)
rang3 <- diff(rang3minmax)
rang3  ## [1] 363,314

rang4minmax <- range(df_1A$start[19:22], na.rm=TRUE)  ## works
head(rang4minmax)
rang4 <- diff(rang4minmax)
rang4  ## [1] 240,790

## to do, plot the 4 groups in 1A

09/16/17:
________________________________________________________________________________________
## ***an aside*** for a moment, try get python to do what did with shell script above, do in dir. /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/wheatgff3/python

bash Philip_no_echo.sh sort147_nodotnum.txt > testbashtofile_pydir.gff3
## ok, same output as testbashtofile.gff3 on 09/07/17 above.
## now try repeat with python, initially with 'print' statement.
python3 adam2.py
   File "adam2.py", line 13, in <module>
    if name in line2.split('\t')[8]:
IndexError: list index out of range
## don't see what wrong ?????????????????????????
## anyway, replace line 13 by
##      if name in line2:
## result: found the 4 31600 lines, but ***not*** the 31700 lines. The shell script on these two input files found the 8 lines expected ???????????????????????????
## end ***aside*** for now.
_______________________________________________________________________________________

## TO DO: perhaps plot the 4 sets of ranges, one at a time, in df_1A, may have some genes clustered **within** the groups.
df_1Agrp1 <- df_1A[1:2, ]
dim(df_1Agrp1)  ## [1] 2 2
head(df_1Agrp1)  ## looks ok.

## for example, 'data' df, colms 'chrom' & 'pos'
data <- df_1Agrp1
head(data)
colnames(data)[2] <- "pos"
head(data)

## following from GenomeWidePlot_pmt.R
##********************
#Converting BP scale from bp to Mb
data$Mb=data$pos*0.000001
head(data)

#Plot
ggplot(data, aes(x=Mb, y=chrom)) + theme_classic() +
  geom_point(colour="red", size=2) +
  #scale_x_continuous(breaks = seq(0, 60, 10)) +
  theme(axis.text.x = element_text(colour = 'black', face="bold", size = 20, vjust=0.5)) +
  theme(axis.text.y = element_text(colour = 'black', face="bold", size = 20)) +
  theme(axis.title.x = element_text(colour = 'black', face="bold", size = 25, vjust=-0.2)) +
  theme(axis.title.y = element_text(colour = 'black', face="bold", size = 25, angle=90)) +
  xlab("Length of chromosome (Mb)") +
  ylab("Chromosome") +
  geom_jitter(alpha=I(0.1)) +
  theme(plot.background=element_blank(),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),
        panel.border=element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  scale_x_continuous(expand = c(0,0)) + scale_y_discrete(expand = c(0,0))

STOPPED

df_1Agrp2 <- df_1A[3:11, ]
dim(df_1Agrp2)  ## ## [1] 9 2
head(df_1Agrp2)  ## looks ok.

## for example, 'data' df, colms 'chrom' & 'pos'
data <- df_1Agrp2
head(data)
colnames(data)[2] <- "pos"
head(data)

#Converting BP scale from bp to Mb
data$Mb=data$pos*0.000001
head(data)

#Plot
ggplot(data, aes(x=Mb, y=chrom)) + theme_classic() +
  geom_point(colour="red", size=2) +
  #scale_x_continuous(breaks = seq(0, 60, 10)) +
  theme(axis.text.x = element_text(colour = 'black', face="bold", size = 20, vjust=0.5)) +
  theme(axis.text.y = element_text(colour = 'black', face="bold", size = 20)) +
  theme(axis.title.x = element_text(colour = 'black', face="bold", size = 25, vjust=-0.2)) +
  theme(axis.title.y = element_text(colour = 'black', face="bold", size = 25, angle=90)) +
  xlab("Length of chromosome (Mb)") +
  ylab("Chromosome") +
  geom_jitter(alpha=I(0.1)) +

theme(plot.background=element_blank(),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),
        panel.border=element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  scale_x_continuous(expand = c(0,0)) + scale_y_discrete(expand = c(0,0))

 
df_1Agrp3 <- df_1A[12:18, ]
dim(df_1Agrp3)  ## [1] 7 2
head(df_1Agrp3)  ## looks ok.

## for example, 'data' df, colms 'chrom' & 'pos'
data <- df_1Agrp3
head(data)
colnames(data)[2] <- "pos"
head(data)

#Converting BP scale from bp to Mb
data$Mb=data$pos*0.000001
head(data)

#Plot
ggplot(data, aes(x=Mb, y=chrom)) + theme_classic() +
  geom_point(colour="red", size=2) +
  #scale_x_continuous(breaks = seq(0, 60, 10)) +
  theme(axis.text.x = element_text(colour = 'black', face="bold", size = 20, vjust=0.5)) +
  theme(axis.text.y = element_text(colour = 'black', face="bold", size = 20)) +
  theme(axis.title.x = element_text(colour = 'black', face="bold", size = 25, vjust=-0.2)) +
  theme(axis.title.y = element_text(colour = 'black', face="bold", size = 25, angle=90)) +
  xlab("Length of chromosome (Mb)") +
  ylab("Chromosome") +
  geom_jitter(alpha=I(0.1)) +
  theme(plot.background=element_blank(),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),
        panel.border=element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  scale_x_continuous(expand = c(0,0)) + scale_y_discrete(expand = c(0,0))

df_1Agrp4 <- df_1A[19:22, ]
dim(df_1Agrp4)  ## [1] 7 2
head(df_1Agrp4)  ## looks ok.

## for example, 'data' df, colms 'chrom' & 'pos'
data <- df_1Agrp4
head(data)
colnames(data)[2] <- "pos"
head(data)

#Converting BP scale from bp to Mb
data$Mb=data$pos*0.000001
head(data)

#Plot
ggplot(data, aes(x=Mb, y=chrom)) + theme_classic() +
  geom_point(colour="red", size=2) +
  #scale_x_continuous(breaks = seq(0, 60, 10)) +
  theme(axis.text.x = element_text(colour = 'black', face="bold", size = 20, vjust=0.5)) +
  theme(axis.text.y = element_text(colour = 'black', face="bold", size = 20)) +
  theme(axis.title.x = element_text(colour = 'black', face="bold", size = 25, vjust=-0.2)) +
  theme(axis.title.y = element_text(colour = 'black', face="bold", size = 25, angle=90)) +
  xlab("Length of chromosome (Mb)") +
  ylab("Chromosome") +
  geom_jitter(alpha=I(0.1)) +
  theme(plot.background=element_blank(),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),
        panel.border=element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  scale_x_continuous(expand = c(0,0)) + scale_y_discrete(expand = c(0,0))

09/17/17:

## To finish displaying for 1B (26 genes), & 1D (29 genes), the 'cluster' portion of the genes, compare distribution to 1A chromosome (22 genes).

## for df_1B (26 genes)
head(df_1B)
dim(df_1B)  ## [1] 26  2
tail(df_1B)
data <- df_1B
head(data)
colnames(data)[2] <- "pos"
head(data)
data$Mb=data$pos*0.000001
head(data)

ggplot(data, aes(x=Mb, y=chrom)) + theme_classic() +
  geom_point(colour="red", size=2) +
  #scale_x_continuous(breaks = seq(0, 60, 10)) +
  theme(axis.text.x = element_text(colour = 'black', face="bold", size = 20, vjust=0.5)) +
  theme(axis.text.y = element_text(colour = 'black', face="bold", size = 20)) +
  theme(axis.title.x = element_text(colour = 'black', face="bold", size = 25, vjust=-0.2)) +
  theme(axis.title.y = element_text(colour = 'black', face="bold", size = 25, angle=90)) +
  xlab("Length of chromosome (Mb)") +
  ylab("Chromosome") +
  geom_jitter(alpha=I(0.1)) +
  theme(plot.background=element_blank(),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),
        panel.border=element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  scale_x_continuous(expand = c(0,0)) + scale_y_discrete(expand = c(0,0))

## now calc ranges of the 4 groups of genes in df_1B seen in plot.

rang1_1Bminmax <- range(df_1B$start[1:8], na.rm=TRUE)  ## works
head(rang1_1Bminmax)
rang1_1B <- rang1_1Bminmax
rang1_1B
rang1_1B <- diff(rang1_1Bminmax)
rang1_1B  ## [1] 1179582  ## so 1179 Kb, pretty wide compared to fig 3, sci reports ??

rang2_1Bminmax <- range(df_1B$start[9:19], na.rm=TRUE)  ## works
head(rang2_1Bminmax)
rang2_1B <- diff(rang2_1Bminmax)
rang2_1B  ## [1] 1835062

rang3_1Bminmax <- range(df_1B$start[20:24], na.rm=TRUE)  ## works
head(rang3_1Bminmax)
rang3_1B <- diff(rang3_1Bminmax)
rang3_1B  ## [1] 1142607

rang4_1Bminmax <- range(df_1B$start[25:26], na.rm=TRUE)  ## works
head(rang4_1Bminmax)
rang4_1B <- diff(rang4_1Bminmax)
rang4_1B  ## [1] 94820

09/18/17:
## Talked to vikas, to do's:
i. count of different wheat RF's on different chromosomes (vikas has script)
ii. relation RF's of different chromosomes. Use phylogeny. May already have this data? Recall the 'blue' & 'red' subsets of phylogeny tree. Should be able to find those subsets, just go in, at 'leaves', see which protein/gene names are on leaves on same nodes.
iii. multiple chromosome displays (send links to vikas)
--https://biodatamining.biomedcentral.com/articles/10.1186/1756-0381-6-18 (Phenogram)
--https://stackoverflow.com/questions/33727432/how-to-plot-positions-along-a-chromosome-graphic (ggplot)
iv. send vikas input file for overhead plot of location of genes on chromosome (yet to find) 
v. tandem gene duplication distance (see soybean paper)
vi. PAG, jan 13-17, 2018 (possible abstract of work with new wheat genome)

## finish (iv) done.

## next, read (iii), look for file, how display to do (ii).

##**saved** wheatprojdoc060117.txt to github.

09/19/17:
___________________________________________________________________________
## resume bit about python from 09/16/17 above
head -n 10 sort147_nodotnum.txt > 10sort147_nodotnum10.txt  ## done
## working with pythonsubset.py
## following fails, 
  if line1 == 'TraesCS1A01G054800':  ## not working, does not break, check csce155t info on index for for loop ?????
      break
## next, try, no match line 17 for 2nd pattern '31700' ????????????????????/
philip-terry-2:python bterry$ python3 pythonsubset.py
TraesCS1A01G031600
chr1A   IWGSC_March2017 gene    14577948        14579936        49      +       .       ID=TraesCS1A01G031600;primconf=HC

chr1A   IWGSC_March2017 mRNA    14577948        14579936        49      +       .       ID=TraesCS1A01G031600.1;Parent=TraesCS1A01G031600;primconf=HC;secconf=HC1

chr1A   IWGSC_March2017 exon    14577948        14579936        .       +       .       Parent=TraesCS1A01G031600.1

chr1A   IWGSC_March2017 CDS     14577948        14579936        .       +       0       Parent=TraesCS1A01G031600.1

TraesCS1A01G031700
TraesCS1A01G054500
TraesCS1A01G054700
TraesCS1A01G054800
TraesCS1A01G055500
TraesCS1A01G055600
TraesCS1A01G055800
TraesCS1A01G056000
TraesCS1A01G057300
philip-terry-2:python bterry$ 

## send Juan 4 files
i. pythonsubset.py
ii. samp31600_8rows.gff3
iii. sort147_nodotnum10.txt
iv. output when run, 2nd pattern, ...31700 not found in gff3 file?
_______________________________________________________________________________

09/20/17:
 
## ok, printed blue & red from figtree on 'pro'. **Yet** to do, compare the relationships in figtree display say for chrom 1, for A, B, & D with locations on these chromosomes. Note, few relations betw proteins on different numbered chroms in phylogeny diagram.  To relate locations on chrom vs phylogeny relations, ***need*** go back from gff3_cols13_144nochr.txt to step before removed gene/protein name ????????????????????

09/22/17:
## talked to vikas
i. prepare homeologous proteins/genes table. columns: protein gene names. Q: exactly how define 'homeologous' in phylogram? Looks like lot of 'three' leaves, perhaps use this? Perhaps group the rows by chromosome number, i.e., 1, 2, 6? But perhaps, would like to show additional nearby relationships ???????????????
Q: where aLRT values sort of overlapping, clarify exactly how to interpret, value & what near to ???????????
Q: perhaps could increase 'three leaves' some depending on associated aLRT values ??????
Q: or from circular display, perhaps get relation larger than say 'three size groups', then in table, group rows accordingly ???????????????
Q: perhaps start with vikas script GenomeWidePlot_pmt.R. Plot a few 'threes' or bit larger group, see if can find some patterns between phyml relationships of proteins & seq of genes along for example, chroms 1A, 1B, & 1D ??????
Q: **phenoGram**, perhaps submit subsets of genes (on say just chroms 1A, 1B, 1D) would like to compare to phenoGram, view positions on chromosomes. 
ii. count genes per chromosome, vikas had script.
iii. To Finish: analyzing blue & red parts of phyml phylogram from figtree run on 'pro'.
*////////////////////////////////////////////////////////////////////////////////
***iv.*** Work flow steps, start to end, try '.Rmd'
***v.*** RNAseq from new db, (Q: not yet done ?????)
-- wheatExp, contact info ?????????? https://wheat.pw.usda.gov/WheatExp/
-- expVIP  http://www.wheat-expression.com/#
vi. MEME (input fasta file) http://meme-suite.org/tools/meme
vii. 144 proteins REDO: PHYLOGENY through hmm ( see vikas 'Notes_Alignment_UsingHMMs.txt
///////////////////////////////////////////////////////////////////////////////////*

09/24/17: 
## working on (i) above, after find file gff3_cols13_144nochr.txt (input for GenomeWidePlot_pmt.R), need relate this back to file still has related protein/gene names ????? Came from gff3_cols13_144.txt (from gff3_cols13_147.txt). Of course, will test **phenoGram** also. Check precursor file, gff3_1345_9names_147.txt.

09/26/17:
## from blue & red RF-like proteins, select from red 12 from 1A, 1B, 1D, see if located closer together compared to 3 from 1A, 1B, 1D from blue. See if the 3 from blue located away from the 12 from red ??????????

09/27/17:
Talked to vikas, emphasize (iv), (v) above. And qqch about producing phylogeny of just the 147 RF-like proteins ??????????????????????????

gff3_1345_9names_147.txt -> gff3_1345_9names_15.txt (done)
gff3_1345_9names_15.txt -> gff3_1345_9names_12.txt (done)

## from 09/17/17 above
## cut colms 1 & 3 for input to GenomeWidePlot.R.

cut -f 1,3 gff3_1345_9names_15.txt > gff3_cols13_15.txt
head -n 3 gff3_cols13_15.txt

cut -f 1,3 gff3_1345_9names_12.txt > gff3_cols13_12.txt
head -n 3 gff3_cols13_12.txt

## finally, remove 1st 3 char each row in gff3_cols13_15.txt, gff3_cols13_12.txt with 

cat gff3_cols13_15.txt|perl -pe 's/chr(.+)/\1/' | head -n 3  ## ok
cat gff3_cols13_15.txt|perl -pe 's/chr(.+)/\1/' | head -n 15 > gff3_cols13_15nochr.txt

cat gff3_cols13_12.txt|perl -pe 's/chr(.+)/\1/' | head -n 3  ## ok
cat gff3_cols13_12.txt|perl -pe 's/chr(.+)/\1/' | head -n 12 > gff3_cols13_12nochr.txt

## now try modify GenomeWidePlot.R to use here ??????
## looks like can just copy GenomeWidePlot_pmt.R to GenomeWidePlot_15pmt.R, modify


09/28/17:
## ready to run GenomeWidePlot_12pmt.R in RStudio
## did, not getting nice plot, but showing that the proteins in 1A, 1B, & 1D are within chrom, clustered, thus phylogram relationships correlate with close distance relationship on chromosomes.
## the range for the proteins are:
1A 61742
1B 356307
1D 152289
## comparing to fig 3, sci reports, within scale there of 100k to 500k. Significance ??????????
## perhaps phenogram plot can do better ????????????????????



10/17/17:
working with wheatflowdocnotes.txt, ppointtmp.txt, and then wheatflowdocnotestoc4_from_ppointtmp.Rmd

10/26/17:
## from 09/22/17 above, task number **vii**, **redo** phylogeny thru hmm for .../r_stuff/oGroups144.txt, but for subset 122 (match red) plus 10 (match blue) for hmm part. Note: previously decided to include 12 additional blue rows not matching orthoMCL. Finally, add back rice9 at hmmalign step, run phyML online (French), finally display in figtree, locate what rice 9 seqs near. So for muscle step, start with 122 + 10 + 12 + 9 = 153 rows.
## Note: orthoMCL result has 135 rows of wheat proteins in orthoGroup 'OG5_131220' which also contained the rice 9 RF proteins (total 144). So, 3 rows not match in blue, red groups from phylogram. For now, don't include these 3 in 'redo' phylogeny (following 'Notes_Alignment_UsingHMMs.txt' from vikas)

## ref. 07/22/17
i) rerun realign step as per vikas 'Notes_Alignment_UsingHMMs.txt' thru PhyML step, , but with the 'seq.fa' file including the 153 seqs referenced above. So will need run 144 + 9 starting with muscle. 
I note: Vikas a **preference** for the hmmaln.fa over the hmmaln-Gblocks.fa trimmed MSA when going for a phylogram.

## example
line 1346
FRknownseqs_shtname_9.fa the '9' rice FR protein fasta file to cat to PPRhmmsearchsubset_P_prots820.fa before 'muscle'

## to do, prepare .fa input file for the 153 proteins mentioned above.

## in /Users/bterry/macbook2017/vikas17frompro/tmp081117reparemacbook dir, found
PPRhmmsearchsubset_P_prots820plus9_blue.fa
## 22 seqs

## & PPRhmmsearchsubset_P_prots820plus9_red.fa
## 122 seqs

## & rice9.fa
## 9 seqs
## also FRprotseqs dir has FRknownseqs-shtname_9.fa

## to cat these 3 files (22, 122, 9 - 153), will be input for muscle pgm

10/27/17:
## ref 07/22/17: to cat ...
## dir for the files: .../FRprotseqs/phyml/pyML153
## copy the three files to cat to pyML153
PPRhmmsearchsubset_P_prots820plus9_blue.fa
PPRhmmsearchsubset_P_prots820plus9_red.fa
rice9.fa

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153
cat PPRhmmsearchsubset_P_prots820plus9_blue.fa PPRhmmsearchsubset_P_prots820plus9_red.fa > 22plus122.fa
bbedit, 22plus122.fa  ## 144 '>' lines as expect.
cat 22plus122.fa rice9.fa > 22plus122plus9.fa
bbedit, 22plus122plus9.fa  ## 153 '>' lines as expect.

## need new dir on crane to do next three steps, muscle, fasta2stockholm.pl, & hmmbuild.

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots153
cd refinPprots153
## scp PPRhmmsearchsubset_P_prots820.fa to crane, dir = refinPprots820
logout
## now for slurm_muscle_wheatproj_refin153.sh
## edit, then scp
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153
scp 22plus122plus9.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots153

scp slurm_muscle_wheatproj_refin153.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots153
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin153.sh 10392665  11:56pm => ??:??am, 
squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          10392665     batch TJob_mus   pterry  R       0:17      1 c3709
cd /work/baenziger/pterry/wheatproj/refinPprots153
ls -lh

less job.10392665.err
## many invalid '*' lines.
sacct -j  10392665 -o start,end
              Start                 End 
------------------- ------------------- 
2017-10-27T23:57:08 2017-10-27T23:57:42 
2017-10-27T23:57:08 2017-10-27T23:57:42 
## so 34 seconds run

less 22plus122plus9.fa.aln  ## looks to be *in* MSA fasta format.
head -n 50 22plus122plus9.fa.aln
# head -n 60 PPRhmmsearchsubset_P_prots820.fa.aln | tail -n 7

## next, fasta2stockholm.pl conversion

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
cd ..
cd refinPprots153
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1231 Oct 28 00:33 fasta2stockholm.pl

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots153
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl 22plus122plus9.fa.aln > 22plus122plus9.fa.aln.slx
ls -al
-rw-r--r-- 1 pterry amundsen 149389 Oct 28 00:39 22plus122plus9.fa.aln.slx

10/28/17:
## to check top stockholm file
less 22plus122plus9.fa.aln.slx


## now for *hmmbuild*
## see 07/10/17 above.

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots153
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots153

hmmbuild 22plus122plus9.fa.aln.hmm 22plus122plus9.fa.aln.slx
# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     22plus122plus9.fa.aln   153   955   778     2.53  0.590 

## Q: This line some signif. differences from run on 07/10/17. What to think?

exit
less 22plus122plus9.fa.aln.hmm
head -n 17 22plus122plus9.fa.aln.hmm
wc -l 22plus122plus9.fa.aln.hmm
 2356 22plus122plus9.fa.aln.hmm
tail -n 3 22plus122plus9.fa.aln.hmm

## realign using hmm model, hmmalign ?????, Vikas notes, is this a trimming fcn, --trim ????????????????  yes
## slurm file prepared

scp slurm_hmmalign_wheatproj_refin153.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots153
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_refin153.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refin153.sh 10403500  11:29am => ??:??am, 
squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          10403500     batch TJob_hmm   pterry  R       0:04      1 c3618

cd /work/baenziger/pterry/wheatproj/refinPprots153
ls -lh

-rw-r--r-- 1 pterry amundsen    0 Oct 28 11:30 job.10403500.err
-rw-r--r-- 1 pterry amundsen    0 Oct 28 11:30 job.10403500.out
-rw-r--r-- 1 pterry amundsen 298K Oct 28 11:30 22plus122plus9.fa.aln.hmmaln

sacct -j  10403500 -o start,end
              Start                 End 
------------------- ------------------- 
2017-10-28T11:30:04 2017-10-28T11:30:18 
2017-10-28T11:30:04 2017-10-28T11:30:18 
## 14 sec

less 22plus122plus9.fa.aln.hmmaln
head -n 3 22plus122plus9.fa.aln.hmmaln
tail -n 3 22plus122plus9.fa.aln.hmmaln
#grep -c "Trae" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln  ## 26240, so not telling anything ????????????????
wc -l 22plus122plus9.fa.aln.hmmaln
 1547 22plus122plus9.fa.aln.hmmaln

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

cd ..
cd refinPprots153
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1398 Oct 28 16:22 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots153
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g 22plus122plus9.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > 22plus122plus9.fa.aln.hmmaln.fa

ls -al
less 22plus122plus9.fa.aln.hmmaln.fa

grep -c ">Traes" 22plus122plus9.fa.aln.hmmaln.fa  ## 144 as expect, as rice9 not counted
exit
logout

## scp to macbook, examine both 'hmmaln' (22plus122plus9.fa.aln.hmmaln) & hmmaln.fa (22plus122plus9.fa.aln.hmmaln.fa) in bbedit.

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots153/22plus122plus9.fa.aln.hmmaln .

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots153/22plus122plus9.fa.aln.hmmaln.fa .

ls -al

## unclear which format should manually look at to see if additional trimming needed, Stockholm or fasta ??????????????????????????????????
*******************************************************************************
## examine wi bbedit, or SEA VIEW ??????????????????????????
## ***need*** to learn more about format of stockholm MSA file ??????????????????????????? 
22plus122plus9.fa.aln.hmmaln.fa has 306 lines as expect (2*153).
## don't know that know ***how*** to determine if 'trimming is needed' ???????????????????
## even if SEA VIEW, how decide if trimming needed ?????????????????????????????
*********************************************************************************

## now fas to phy

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots153
cd refinPprots153
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots153
module load bioperl

./align_convert_fas_to_phy.pl 22plus122plus9.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r-- 1 pterry amundsen 178714 Oct 29 13:15 22plus122plus9.fa.aln.hmmaln.phy
exit

## scp back to macbook, 
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots153/22plus122plus9.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  178714 Oct 29 13:38 22plus122plus9.fa.aln.hmmaln.phy

less 22plus122plus9.fa.aln.hmmaln.phy
head -n 4 22plus122plus9.fa.aln.hmmaln.phy
 153 778
'TraesCS1B01G074600.1'  -SPPSRSWSP EGAFAAATAR LSTGTLSPEE AHHLFDELLR QATPVPSRSL NGFLATLSRD

## so phy header 153, 727, expect the 153

STOPPED

ii) then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153
/22plus122plus9.fa.aln.hmmaln.phy

The alignment file "22plus122plus9.fa.aln.hmmaln.phy" was uploaded, it contains 153 taxons of 778 characters.

Your job was submitted. (10/29/17, 1:58PM)
****************************************************************

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20171029-195838_Rr84/cmd.txt

10/31/17:
## **Viewed** result of online phyML at http://www.atgc-montpellier.fr/presto/index.php?tree=20171029-195838_Rr84/22plus122plus9_fa_aln_hmmaln_phy_phyml_tree.txt

## Some **comments**:

## **trimming**: 
hmmalign --trim ...
#=GR 
gblocks
might all he '*'s affect choices on trimming
BIOS 942, proj2, multidomain to one domain ????????????
BIOS 942, proj2, ... structure/fcn relationships ... ??????

## **discrepancy**, here in 153, rice9 all together, previous 820plus9, 5th rice seq. by self, 'blue' seqs selected.
## To do, redisplay 820plus9 in figtree, check if 5th rice seq. really 'out by self' ????
## 

## to view /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153/22plus122plus9_fa_aln_hmmaln_phy_phyml/22plus122plus9_fa_aln_hmmaln_phy_phyml_tree.txt in figtree


## github saved

11/01/17:
## talked to vikas, went over what need to do to publish
## 5 figures
fig1: 1545, sec 2.1.2, but get location of rice 9 on plot
fig2: 820plus9, locate the rice9 in image in file: ./hmmpipeline/FRprotseqs/phyml/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt
fig3: ve nn diagram
fig4: 156 phylogeny, venn diagram with 4 colors
fig4b: ????
fig5: genome wide distn, phenogram ??
fig6: intron/exon => gff3 ???????????

## additional to dos:
--sec 2.1.2, for 1545 wheat seqs plus 9, check figtree plot of this, locate where rice 9 plot ?? .../FRprotseqs/PPRhmmsearchsubset_plus9_clustaltree_colored
 (DO ***THURS***, IF PROBLEM, CHECK WITH VIKAS) 
***ALL RICE9 IN*** RED SECTION, SEC 2.1.2 
Q: not finding plot **1545** with **both** blue & red colors, but appears to be same plot as FRprotseqs/PPRhmmsearchsubset_plus9_clustaltree_colored, so location rice9 would be same.
--also for image in sec 2.2 (tho think same 1545 as previous line), locate rice 9 ??
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors_scrnshot.png
Has 1545, two colors, TO FIND, WHERE FILE WHICH CAN LOAD INTO FIGTREE, GET THIS IMAGE ????
--on 'pro', pyML829/pph...820plus9...nexus_2colors.txt, => AB900794  ***single*** rice9 off by self, in 22 blue.

--TO DO:  http://pfam.xfam.org/search#tabview=tab1
Q: vikas said we did, I not remembering ???????????????????

--'Notes' steps on '156' seqs n, (add 3 non intersecting from orthoMCL)
***THURS***: TRY plot 153 in figtree, ***colorize*** 
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153/22plus122plus9_fa_aln_hmmaln_phy_phyml/22plus122plus9_fa_aln_hmmaln_phy_phyml_tree.txt in figtree on 'pro'.


Q: relative to 122, 10, 12, identify relative position to rice9.
PRACTICE WITH VIKAS ??????????????????????

--location plots (yet to put in Rmd, vikas likes 'phenogram' he did

11/03/17:
## talked to vikas, few notes:
--three wheat seqs to exclude from planned above 156 'Notes' steps (...99600, ...10800, ...196200). BUT DOC IN FIG LEGEND LATER). So call it, 156-3 'Notes' run.
--made some comments on how use figtree. 
root tree, midpoint
Node labels, aLRT, sig digits = 2
## note, vikas colored 153 tree tree, the rice9 seqs in figtree 'orange', saved file.

11/06/17:
After looking thru items on 11/01 & 11/03, prioritize **while in TX** 
--Rmd doc, fill out, etc.
--run 156_3 thru vikas 'Notes' steps
Others involving figtree, etc., do in do when back in Lincoln.

## To run 'Notes' steps on 156_3 set of sequences

## 1st, find the 3 seqs in oGroups144col1.txt which don't intersect with blue or red sets. Colorize consistent over images.

from ##08/31/17:


setwd("~/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff")
whtOMCLgroupdf <- read.delim("oGroups144col1.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("whtOgrp"))
dim(whtOMCLgroupdf)
head(whtOMCLgroupdf, n=3)
class(whtOMCLgroupdf)
bluedf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("blue"))
dim(bluedf)
head(bluedf, n=3)

reddf <- read.delim("pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("red"))
dim(reddf)
head(reddf, n=3)

intermed <- setdiff(whtOMCLgroupdf$whtOgrp, reddf$red)
head(intermed, n=3)
length(intermed)  ## 22, as expect

out3 <- setdiff(intermed, bluedf$blue)
class(out3)
length(out3)  ## 12 as expect, 9(rice) + 3(ones in orthroMCL not in blue or red pyML of 820 possible 'P' proteins.  
head(out3, n=3)
out3
 [1] "TraesCS6A01G014500.1" "TraesCS6A01G014900.1" "TraesCS6B01G114300.1" "AB110443"            
## so the 3 wheat names are the orthoMCL seqs **not** in 'red' or 'blue' sets.
 ## note: longest of these only ~ 400 aa's.

## 1st, prepare the 156_3 seqs

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML156_3

## prepare 135xtra3.fa from PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln.fa in dir /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs using bbedit

cp -rw-r--r--   1 bterry  staff   84500 Oct 27 14:38 22plus122.fa
from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153

## cat to get the 156 seqs

cat 22plus122plus9.fa 135xtra3.fa > 22plus122plus9plus3.fa
bbedit 22plus122plus9plus3.fa

## finally, remove the 3 outlier seqs seen in figtree display of the 153 seqs
-rw-r--r--@  1 bterry  staff  8244 Oct 29 21:02 22plus122plus9_fa_aln_hmmaln_phy_phyml_tree.txt
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML153/22plus122plus9_fa_aln_hmmaln_phy_phyml/22plus122plus9_fa_aln_hmmaln_phy_phyml_tree.txt

## They are:
TraesCS1D01G199600.1   ## length > 600
TraesCS1B01G210800.1  ## length > 600
TraesCS1A01G196200.1  ## length > 600 aa's
## note, ***all*** from 'blue' set of 22 (TO check, in 12 blue seqs *not* in orthoMCL)

## so, 
cp 22plus122plus9plus3.fa > 156_3.fa
## use bbedit to delete these 3
## confirmed new length = 153

## ref: 10/26/17 (line 2981)

## need new dir on crane to do next three steps, muscle, fasta2stockholm.pl, & hmmbuild.

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML156_3

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots156_3
cd refinPprots156_3
## scp PPRhmmsearchsubset_P_prots820.fa to crane, dir = refinPprots156_3
logout
## now for slurm_muscle_wheatproj_refin153.sh
## edit, then scp
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML156_3
scp 156_3.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots156_3
## cp slurm_muscle_wheatproj_refin153.sh to slurm_muscle_wheatproj_refin156_3.sh, edit

scp slurm_muscle_wheatproj_refin156_3.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots156_3
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin156_3.sh 10467000  7:51pm => ??:??am, 
squeue -u pterry  ## a R
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
             
cd /work/baenziger/pterry/wheatproj/refinPprots156_3
ls -lh

less job.10467000.err
## many invalid '*' lines.
sacct -j  10467000 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-06T19:51:38 2017-11-06T19:52:11 
2017-11-06T19:51:38 2017-11-06T19:52:11 
19:52:11 - 19:51:38 = 33 sec

less 156_3.fa.aln  ## looks to be *in* MSA fasta format.
head -n 50 156_3.fa.aln
# head -n 60 PPRhmmsearchsubset_P_prots820.fa.aln | tail -n 7

## next, fasta2stockholm.pl conversion (line 3826)

11/07/17:
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -lh
cd ..
cd refinPprots156_3
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1231 Oct 28 00:33 fasta2stockholm.pl

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots156_3
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl 156_3.fa.aln > 156_3.fa.aln.slx
ls -al
-rw-r--r-- 1 pterry amundsen 150001 Nov  7 08:05 156_3.fa.aln.slx

## to check top stockholm file
less 156_3.fa.aln.slx

## now for *hmmbuild*
## see 10/28/17 above.

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots156_3
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots156_3

hmmbuild 156_3.fa.aln.hmm 156_3.fa.aln.slx
# input alignment file:             156_3.fa.aln.slx
# output HMM file:                  156_3.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     156_3.fa.aln           153   959   788     2.34  0.590 

# CPU time: 2.52u 0.01s 00:00:02.52 Elapsed: 00:00:02.54
exit
less 156_3.fa.aln.hmm
#head -n 17 156_3.fa.aln.hmm
wc -l 156_3.fa.aln.hmm
 2386 156_3.fa.aln.hmm
tail -n 3 156_3.fa.aln.hmm

## realign using hmm model, hmmalign 

## slurm file prepared

scp slurm_hmmalign_wheatproj_refin156_3.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots156_3
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_refin156_3.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refin156_3.sh 10469154  8:44am => ??:??am, 
squeue -u pterry  ## a ST
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

cd /work/baenziger/pterry/wheatproj/refinPprots156_3
ls -lh

-rw-r--r-- 1 pterry amundsen    0 Nov  7 08:44 job.10469154.err
-rw-r--r-- 1 pterry amundsen    0 Nov  7 08:44 job.10469154.out
-rw-r--r-- 1 pterry amundsen 299K Nov  7 08:44 156_3.fa.aln.hmmaln

sacct -j  10469154 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-07T08:44:27 2017-11-07T08:44:42 
2017-11-07T08:44:27 2017-11-07T08:44:42 
08:44:42 - 08:44:27 = 15 sec

less 156_3.fa.aln.hmmaln
#head -n 3 22plus122plus9.fa.aln.hmmaln
tail -n 3 156_3.fa.aln.hmmaln
#grep -c "Trae" PPRhmmsearchsubset_P_prots820.fa.aln.hmmaln  ## 26240, so not telling anything ????????????????
wc -l 156_3.fa.aln.hmmaln
1547 156_3.fa.aln.hmmaln  ## same as 153

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

cd ..
cd refinPprots156_3
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1398 Oct 28 16:22 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots156_3
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g 156_3.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > 156_3.fa.aln.hmmaln.fa

ls -al
less 156_3.fa.aln.hmmaln.fa

grep -c ">Traes" 156_3.fa.aln.hmmaln.fa  ## 144 as expect, as rice9 not counted
exit
logout

## now fas to phy

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots156_3
cd refinPprots156_3
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots156_3
module load bioperl

./align_convert_fas_to_phy.pl 156_3.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r-- 1 pterry amundsen 184070 Nov  7 10:00 156_3.fa.aln.hmmaln.phy
exit

## scp back to macbook, 
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML156_3
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots156_3/156_3.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  184070 Nov  7 10:03 156_3.fa.aln.hmmaln.phy

less 156_3.fa.aln.hmmaln.phy
head -n 4 156_3.fa.aln.hmmaln.phy

 153 788
'TraesCS1D01G057800.1'  --STSTPTLR PSRSWSPHAA FAAATERVRA GTLSPEDAHH LFDELLRQAT PVPSRSLDGF 

## so phy header 153, 788, expect the 153

Then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML156_3
/156_3.fa.aln.hmmaln.phy

Data type: aa's

Submitted 10:14am, name: 156_3

The alignment file "156_3.fa.aln.hmmaln.phy" was uploaded, it contains 153 taxons of 788 characters.

Your job was submitted.

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20171107-171418_Md38/cmd.txt

github saved

## ok, for 156_3, try color by prev red122, blue10, blue12 ???????? Perhaps by colocation on a chromosome

11/08/17:

## working with figtree on 'pro'
'checks', LHS include 'Tip labels' (sig digits =2), 'Node labels', (display aLRT, sig. digits =2, ), 'Scale bar', (????)
## working on 156_3.fa.aln.hmmaln.phy_phyml_tree.txt, 
## Q: labeling like did with mega ?????????????/
## Q: node, clade, taxa settings ?????????????????
## Q:  'Trees', root tree, midpoint  ?????????????????????
## Q: 'Find'  ?????????????????
## Q: color, **when** click on a branch, which mode to select, perhaps taxa, highlignts leaf labels ????????
## rice9, orange-tan, green, closest 20 seqs, ...
## annotate paper clip ???????????????

## Q: So with 9 rice9 orange, 20 closest in green, **to compare** the green labels with the blue, red subsets from 820plus9. Perhaps do as previously, grab/grep the colored subsets from the ...tree.txt file, try intersect with the blue, red.
## get vikas comments on 156_3 tree ??????????????
## Q: how select blue, red names on 156_3.fa.aln.hmmaln.phy...tree.txt, so can color ?????????? Perhaps have to color manually, one at a time ???????????

11/09/17:
## ok, to try label 'tree' file for remaining 19 'blue' seqs, 3 removed from '153' tree prepared previously (still like to check which in 10 in orthoMCL and 12 not) ????
## **to try,** take uncolored 'tree' file, copy it. Then set up all the settings did previously for colored tree. Then see if can select one blue seq in 156_3 tree file, color it blue, see if can save, have one seq with figtree assigned color designation. If works, then manually copy this color to remaining 18 'blue' seqs. Finally, display in figtree, visually display the 'blue' seqs in 156_3 figtree display.
## ok, on 'pro', have display of the remaining 19 'blue' seqs. Since the 3 'U' seqs in this group, perhaps try find those in the display ???????????? Note: 3 'U' seqs are in the 10 seqs recognised by both pyML & orthoMCL. 

11/10/17:
## ok, on 'pro', modified tree file from with figtree, (file name 156_3_fa_aln_hmmaln_phy_phyml_tree_copy_bluecolored.txt). Colored remainder of the '12' blue purple, blue '10' blue, & rice9 tan-orange. Can see that the 12-3 = 9 are ***outliers*** here, the two closest branches to grouped rice9 are mixture of blue 10 & pyML red seqs. Note: blue 12 names in file twelve_nocolnam.txt in dir: /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/orthogrp/o_mclonline/r_stuff
## NOTE: WHICH CHROMOSOME WHEAT SEQS ARE ON, ARE ***GROUPED*** ON CIRCULAR TREE !!!!!!!!!!!!!!

11/13/17:
Talkd to vikas:
i) new 'Notes'run. 122 + 10 + 3(nonintersecting in orthoMCL) + 9(rice9) = 144. So removing all from the 12 purple (phyML blue not intersecting with orthoMCL)
ii) if no outlier seqs in image in (i), convey list of 144 seqs to vikas (Q: format ?????????????????)
ii) new notes run, 820 + 9, this time all input run thru all 'Notes' steps
iii) optional: phyML for 1545 + rice9, so thru 'Notes' rather than clustal/omega.
iv) for 156_3, color the 3 seqs from orthoMCL not intersecting with phyML blue or red.


so
i) above
see line 3283

## To run 'Notes' steps on 122plus10plus3plusrice9 (orthoMCL135plusrice9), total 144 set of sequences.

 [1] "TraesCS6A01G014500.1" "TraesCS6A01G014900.1" "TraesCS6B01G114300.1" "AB110443"            
## so the 3 wheat names are the orthoMCL seqs **not** in 'red' or 'blue' sets.
 ## note: longest of these only ~ 400 aa's.

## create new dir, .../phyml/pyMLorthoMCL135price9 from 
cp iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa from .../wheatproj
cp 135xtra3.fa from pyML156_3
cp oGroups144col1_nocolnam_norice9.txt from o_mclonline/r_stuff
cp getseq.awk from .../wheatproj dir
cp 

STOPPED

11/14/17:
## Now, to try 

./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa oGroups144col1_nocolnam_norice9.txt > orthoMCL135.fa
grep -c "^>Tr" orthoMCL135.fa   # 135 as expect

## check that 3 not intersecting orthoMCL seqs are present ??
## use bbedit,  [1] "TraesCS6A01G014500.1" "TraesCS6A01G014900.1" "TraesCS6B01G114300.1" "AB110443"            
## all present

## try python to check if red 122 & blue 10 are also in orthoMCL135.fa
## cp pythonsubset_2.py to .../phyml/pyMLorthoMCL135price9
## move pythonsubset_2.py pythonsubset_3.py

## 1st patfile:
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt
## ten hits in orthoMCL135.fa as expect, the 10 blue intersecting with orthoMCL 135 rows.
## 2nd patfile
pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt
## 122 hits in orthoMCL135.fa as expect, the 122 red intersecting with orthoMCL 135 rows.


## need a cat for the rice9
cat rice9.fa wheat820P.fa > rice9wheat820P.fa
ls -al

cat rice9.fa orthoMCL135.fa > rice9orthoMCL135.fa
ls -al
## ok, 144 rows expect, orthoMCL 135 plus rice9

11/15/17:
## ref lin3 3347

Then Notes steps ...
## need new dir on crane to do next three steps, muscle, fasta2stockholm.pl, & hmmbuild.

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL135price9

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots135price9
cd refinPprots135price9
## scp rice9orthoMCL135.fa to crane, dir = refinPprots135price9
logout
## now for slurm_muscle_wheatproj_refin153.sh
## edit, then scp
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL135price9
scp rice9orthoMCL135.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots135price9
## cp slurm_muscle_wheatproj_refin153.sh to slurm_muscle_wheatproj_refin156_3.sh, edit

scp slurm_muscle_wheatproj_refin135rice9.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots135price9
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin135rice9.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin135rice9.sh 10530356  10:10am => ??:??am, 
squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          10530356     batch TJob_mus   pterry PD       0:00      1 (Priority)
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

cd /work/baenziger/pterry/wheatproj/refinPprots135price9
ls -lh

less job.10530356.err
## many invalid '*' lines.
sacct -j  10530356 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-15T10:20:29 2017-11-15T10:20:59 
2017-11-15T10:20:29 2017-11-15T10:20:59 
10:20:59 - 10:20:29 = 30 sec

less rice9orthoMCL135.fa.aln  ## looks to be *in* MSA fasta format.

## next, fasta2stockholm.pl conversion (line 3395)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots135price9
ls -lh
cd ..
cd refinPprots135price9
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots135price9
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl rice9orthoMCL135.fa.aln > rice9orthoMCL135.fa.aln.slx
ls -al
-rw-r--r-- 1 pterry amundsen 139156 Nov 15 11:50 rice9orthoMCL135.fa.aln.slx

## to check top stockholm file
less rice9orthoMCL135.fa.aln.slx

## now for *hmmbuild*
## see 11/07/17 above.

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots135price9
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots135price9

hmmbuild rice9orthoMCL135.fa.aln.hmm rice9orthoMCL135.fa.aln.slx
# input alignment file:             rice9orthoMCL135.fa.aln.slx
# output HMM file:                  rice9orthoMCL135.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     rice9orthoMCL135.fa.aln   144   945   803     1.61  0.589 

# CPU time: 3.03u 0.00s 00:00:03.03 Elapsed: 00:00:03.36
exit
less rice9orthoMCL135.fa.aln.hmm

#head -n 17 rice9orthoMCL135.fa.aln.hmm
wc -l rice9orthoMCL135.fa.aln.hmm
 2431 rice9orthoMCL135.fa.aln.hmm
tail -n 3 rice9orthoMCL135.fa.aln.hmm

## realign using hmm model, hmmalign 

## slurm file prepared

scp slurm_hmmalign_wheatproj_refinrice9orthoMCL135.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots135price9
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_refinrice9orthoMCL135.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refinrice9orthoMCL135.sh 10538157  10:24pm => ??:??am, 
squeue -u pterry  ## a ST
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          10538157     batch TJob_hmm   pterry  R       0:09      1 c2124

cd /work/baenziger/pterry/wheatproj/refinPprots135price9
ls -lh
-rw-r--r-- 1 pterry amundsen 281K Nov 15 22:24 rice9orthoMCL135.fa.aln.hmmaln

sacct -j  10469154 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-07T08:44:27 2017-11-07T08:44:42 
2017-11-07T08:44:27 2017-11-07T08:44:42 
08:44:42 - 08:44:27 = 15 sec

less rice9orthoMCL135.fa.aln.hmmaln

## next, fasta2stockholm.pl conversion (line 3707)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

cd ..
cd refinPprots135price9
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1398 Oct 28 16:22 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots135price9
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g rice9orthoMCL135.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > rice9orthoMCL135.fa.aln.hmmaln.fa

ls -al
less rice9orthoMCL135.fa.aln.hmmaln.fa

grep -c ">Traes" rice9orthoMCL135.fa.aln.hmmaln.fa  ## 135 as expect, as rice9 not counted
exit
logout

## now fas to phy

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots135price9
cd refinPprots135price9
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots135price9
module load bioperl

./align_convert_fas_to_phy.pl rice9orthoMCL135.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r-- 1 pterry amundsen 175691 Nov 15 23:14 rice9orthoMCL135.fa.aln.hmmaln.phy
exit

## scp back to macbook, 
t
The alignment file "rice9orthoMCL135.fa.aln.hmmaln.phy" was uploaded, it contains 144 taxons of 803 characters.

Your job was submitted.

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20171116-063126_Mh91/cmd.txt

11/16/17:
## see 3573
## have the 'tree' file in dir.
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL135price9/rice9orthomcl135_fa_aln_hmmaln_phy_phyml

-rw-r--r--@  1 bterry  staff  7749 Nov 16 07:43 rice9orthomcl135_fa_aln_hmmaln_phy_phyml_tree.txt
cp to 'pro' laptop

in figtree
tree/midpoint
'Node labels', (display aLRT, sig. digits =2, )
## on taxa 
## basically no more 'long' branches
## now highlighting chr 1, 2, 6 in turn
## set aLRT on %

## talked to vikas, priorities: 
i) prepare another figtree display with 131 sequences from othroMCL 135. The four to be removed from previous display (rice9orthomcl135_fa_aln_hmmaln_phy_phyml_tree.txt)
because they are on long branches in the figtree display. The four are:
--TraesCS1B01G073200.1
--TraesCS1D01G076400.1
--TraesCS1A01G073600.1
--TraesCS1D01G075800.1
## these 'partial' outliers in 156_3 file figtree file display.
## To check: if blue or red source for these four  ??????????????????
ii) finalize figures prevly discussed
iii) doc more in Rmd file
iv) get the four reference papers listed, refer fig 3, then get 1 or 2 more RF proteins that were prevly verified.
  
11/17/17:
## so proceeding with (i), 1st remove the 4 seqs from rice9orthoMCL135.fa file with bbedit. Name the resulting file rice9orthoMCL131.fa. Place in dir. /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131price9

## Now run Notes steps ... (refer 11/15/17, line 3658 above)

Then Notes steps ...
## need new dir on crane to do 1st three steps, muscle, fasta2stockholm.pl, & hmmbuild.

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots131price9
cd refinPprots131price9
## scp rice9orthoMCL131.fa to crane, dir = refinPprots131price9
logout
## now for slurm_muscle_wheatproj_refin153.sh
## edit, then scp
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131price9
scp rice9orthoMCL131.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131price9
## cp slurm_muscle_wheatproj_refin135rice9.sh to slurm_muscle_wheatproj_refin131rice9.sh, edit

scp slurm_muscle_wheatproj_refin131rice9.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin131rice9.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin131rice9.sh 10551043 9:48am =>
[pterry@login.crane scripts]$ 
[pterry@login.crane scripts
squeue -u pterry  ## a PD
[pterry@login.crane scripts]$ squeue -u pterry
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
ls -lh
less job.10551043.err
sacct -j  10551043 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-18T09:47:29 2017-11-18T09:47:56 
2017-11-18T09:47:29 2017-11-18T09:47:56
09:47:56 - 9:47:29 = 27 sec

less rice9orthoMCL131.fa.aln  ## looks to be *in* MSA fasta format.

## next, fasta2stockholm.pl conversion (line 3707)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
ls -lh
cd ..
cd refinPprots131price9
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl rice9orthoMCL131.fa.aln > rice9orthoMCL131.fa.aln.slx
ls -al
-rw-r--r--  1 pterry amundsen 135288 Nov 18 13:15 rice9orthoMCL131.fa.aln.slx

## to check top stockholm file
less rice9orthoMCL131.fa.aln.slx

## now for *hmmbuild*
## see 11/15/17 above (line 3731)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots131price9

hmmbuild rice9orthoMCL131.fa.aln.hmm rice9orthoMCL131.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             rice9orthoMCL131.fa.aln.slx
# output HMM file:                  rice9orthoMCL131.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     rice9orthoMCL131.fa.aln   140   945   803     1.57  0.589 

# CPU time: 3.02u 0.00s 00:00:03.02 Elapsed: 00:00:03.07
exit
less rice9orthoMCL131.fa.aln.hmm

#head -n 17 rice9orthoMCL135.fa.aln.hmm

## realign using hmm model, hmmalign 

## slurm file prepared

scp slurm_hmmalign_wheatproj_refinrice9orthoMCL131.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_refinrice9orthoMCL131.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refinrice9orthoMCL131.sh 10553043  9:00pm => ??:??am, 
squeue -u pterry  ## a R
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          10553043     batch TJob_hmm   pterry  R       0:01      1 c3616

             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
             
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
ls -lh
-rw-r--r-- 1 pterry amundsen 271K Nov 18 21:01 rice9orthoMCL131.fa.aln.hmmaln

sacct -j  10553043 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-18T21:01:33 2017-11-18T21:01:44 
2017-11-18T21:01:33 2017-11-18T21:01:44 
21:01:44 - 21:01:33 = 11 sec

less rice9orthoMCL131.fa.aln.hmmaln

## next, stockholm2fasta.pl conversion (line 3791)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

cd ..
cd refinPprots131price9
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1398 Oct 28 16:22 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g rice9orthoMCL131.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > rice9orthoMCL131.fa.aln.hmmaln.fa

ls -al
less rice9orthoMCL131.fa.aln.hmmaln.fa

grep -c ">Traes" rice9orthoMCL131.fa.aln.hmmaln.fa  ## 131 as expect, as rice9 not counted
exit
logout

## now fas to phy (line 3819)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots131price9
cd refinPprots131price9
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots131price9
module load bioperl

./align_convert_fas_to_phy.pl rice9orthoMCL131.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r--  1 pterry amundsen 170811 Nov 18 21:35 rice9orthoMCL131.fa.aln.hmmaln.phy
exit
logout

## scp back to macbook, (line 3841)

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131price9

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131price9/rice9orthoMCL131.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  170811 Nov 18 21:45 rice9orthoMCL131.fa.aln.hmmaln.phy

less rice9orthoMCL131.fa.aln.hmmaln.phy

head -n 4 rice9orthoMCL131.fa.aln.hmmaln.phy
 144 803
'TraesCS6D01G089500.1'  ------GSSS GTVSSHANQL LNKLKDHVGS GTLQPERAHQ LFDKLLRQAV PISACALNGL 

## so phy header  140 803, expect the 140

Then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131price9/rice9orthoMCL131.fa.aln.hmmaln.phy

Data type: aa's

The alignment file "rice9orthoMCL131.fa.aln.hmmaln.phy" was uploaded, it contains 140 taxons of 803 characters.

Your job was submitted.

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20171119-045204_Ul26/cmd.txt

Submitted 9:52pm, name: rice9orthoMCL131

## path to rice9orthoMCL131 tree file
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131price9/rice9orthomcl131_fa_aln_hmmaln_phy_phyml

## tree file:
rice9orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt

-rw-r--r--@ 1 bterry  staff  7529 Nov 19  2017 rice9orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt

cp to 'pro' laptop

in figtree
tree/midpoint
'Node labels', (display aLRT, sig. digits =2, )
## on taxa 
## basically no more 'long' branches
## now highlighting chr 1, 2, 6 in turn

## set aLRT on %

11/20/17:
## talked to vikas, items:
i) subset 131 for gff3
ii) 'Notes' for 131, no rice9
iii) 131 + RF's from other species
iv) 5 figures, finalize, SVG from figtree
## 820+9, color 9 so stand out more
## venny, think see prev talk items, indicating what subsets to use
v) 4 refs top .Rmd file
vi) where store .Rmd file. Q: github thru rstudio, crane, ?????

*******************ASIDE*******************************************************
## **Aside** task before work on (i)
## for the 131, trying to subset the rows in .../wheatgff3/iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 
## apparently what needed after the subsetting are the rows in the order they are in this wheat gff3 file.
## suggested approach after talk to vikas:
sort oGroups144col1_to_131_nodotnum.txt => oGroups144col1_to_131_nodotnum_sort.txt
subset iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 using oGroups144col1_to_131_nodotnum_sort.txt
## expect will be sorted by chromosome name, BUT, **within** rows of a chromosome name, if in different order in oGroups144col1_to_131_nodotnum_sort.txt than in iwgsc_refseqv1.0_HighConf_2017Mar13.gff3, then would not achieve desired iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 order after the subsetting. If this turns out, could do additional sort sort on 'start' field to fix this ??????? Order of rows in 'type' field still may not be correct ????????

sort oGroups144col1_to_131_nodotnum.txt > oGroups144col1_to_131_nodotnum_sort.txt

## bash Philip_realgff3.sh oGroups144col1_to_131_nodotnum_sort.txt > 131.gff3
bash Philip_realgff3.sh oGroups144col1_to_131_nodotnum_sort.txt > 131_sort.gff3
11:25pm => 11:32pm
ls -al

11/23/17: 

## check 131_sort.gff3 in bbedit  ## chrom colm sorted as expect. Perhaps compare few more entries, see if seq of rows same in 131_sort.gff3 & iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 checked 

TraesCS1A01G031600  ## has 4 rows
TraesCS1A01G054700  ## has 9 rows

## each set of rows matches in the two files, so wheat gene/protein name has info to indicate its place in gff3 file, ***don't*** need start field.

STOPPED

## perhaps check another pair in **another** chrom, perhaps the 'U' rows ?????

11/24/17:

TraesCSU01G090200  ## 12 rows

## 12 rows, sequence of rows match in 131_sort.gff3 & iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
## LOOKS LIKE THE 131_sort.gff3 FILE HAS THE **SAME** ORDER OF ROWS AS THE iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 FILE FOR THE SUBSET 131 ROWS FROM THE orthoMCL OUTPUT MAPPING TO 691 ROWS IN 131_sort.gff3.
**************END ASIDE****************************************


## so for (i) above
## try modify shell script, Philip_realgff3.sh, see line 2302, (also compare python script), also do 'uniq' to check don't have duplicate rows. 
## Work from .../wheatgff3 dir.
## for 'pattern' file, copy in from .../r_stuff/oGroups144col1_nocolnam_norice9.txt
cd .../wheatgff3 dir
cp .../r_stuff/oGroups144col1_nocolnam_norice9.txt .
## need remove '.digit' from RHS of string
## following from line 2273
## cat sort147.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 147 > sort147_nodotnum.txt
cat oGroups144col1_nocolnam_norice9.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 135 > oGroups144col1_to_135_nodotnum.txt


## Now manually reduce from 135 to 131 (using 11/16/17 above) => done
oGroups144col1_to_131_nodotnum.txt

## Target the wheat gff3 file already in .../wheatgff3 dir
## bash Philip_realgff3.sh sort147_nodotnum.txt > realbashtofile.gff3
bash Philip_realgff3.sh oGroups144col1_to_131_nodotnum.txt > 131.gff3
12:41pm => < 1:00pm
## Q: why 'zero bytes' in finder window ??????
## 691 rows, 131 with 'gene' in row. 24 rows of 'chrUn' for the 3 gene names in the 131.
## then 'uniq' check for duplicate rows & python ???????????
## sort gff3_genes_col9names.txt |uniq | wc -l   ## 691 as expect
sort 131.gff3 |uniq | wc -l   ## 110790 as expect
     691  ## thus, all rows unique.
     
## now, for (ii), 'Notes' for 131, **no** rice9, so new directory, pyMLorthoMCL131norice9.
So, refer line 3880 above. New dir: /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9 dir.
## cp rice9orthoMCL131.fa from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131price9
to dir:/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
## now, in bbedit, remove the rice9 rows, rename orthoMCL131.fa, done.

## Now run Notes steps ... (refer 11/17/17, line 3882 above)

## need new dir on crane to do 1st three steps, muscle, fasta2stockholm.pl, & hmmbuild.

11/22/17:
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots131norice9
cd refinPprots131norice9
## scp orthoMCL131.fa to crane, dir = refinPprots131norice9
logout
## now for slurm_muscle_wheatproj_refin153.sh
## edit, then scp

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
scp orthoMCL131.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131norice9
## cp slurm_muscle_wheatproj_refin131rice9.sh to slurm_muscle_wheatproj_refin131norice9.sh, edit

scp slurm_muscle_wheatproj_refin131norice9.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin131norice9.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin131norice9.sh 10587339 12:4pm =>

squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          10587339     batch TJob_mus   pterry PD       0:00      1 (Resources)
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
ls -lh
less job.10587339.err
sacct -j  10587339 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-22T12:44:32 2017-11-22T12:44:57 
2017-11-22T12:44:32 2017-11-22T12:44:57 
12:44:57 - 12:44:32 = 25 sec

less orthoMCL131.fa.aln  ## looks to be *in* MSA fasta format.

## next, fasta2stockholm.pl conversion (line 3929)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
ls -lh
cd ..
cd refinPprots131norice9
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl orthoMCL131.fa.aln > orthoMCL131.fa.aln.slx
ls -al
-rw-r--r--  1 pterry amundsen 126693 Nov 25 10:37 orthoMCL131.fa.aln.slx

## to check top stockholm file
less orthoMCL131.fa.aln.slx

## now for *hmmbuild*
## see 11/17/17 above (line 3954)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9

hmmbuild orthoMCL131.fa.aln.hmm orthoMCL131.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             orthoMCL131.fa.aln.slx
# output HMM file:                  orthoMCL131.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     orthoMCL131.fa.aln     131   945   802     1.56  0.590 

exit
less orthoMCL131.fa.aln.hmm

#head -n 17 orthoMCL135.fa.aln.hmm

STOPPED

## realign using hmm model, hmmalign  (line 3984)

## slurm file prepared
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
scp slurm_hmmalign_wheatproj_refinorthoMCL131.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_refinorthoMCL131.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refinorthoMCL131.sh 10606917  8:45pm => ??:??am, 
squeue -u pterry  ## a R
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
             
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
ls -lh
-rw-r--r-- 1 pterry amundsen 254K Nov 25 20:45 orthoMCL131.fa.aln.hmmaln

sacct -j  10606917 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-25T20:45:17 2017-11-25T20:45:26 
2017-11-25T20:45:17 2017-11-25T20:45:26 
20:45:26  - 20:45:17 = 9 sec

less orthoMCL131.fa.aln.hmmaln

## next, stockholm2fasta.pl conversion (line 4017)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

cd ..
cd refinPprots131norice9
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1398 Oct 28 16:22 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g orthoMCL131.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > orthoMCL131.fa.aln.hmmaln.fa

ls -al
less orthoMCL131.fa.aln.hmmaln.fa

grep -c ">Traes" orthoMCL131.fa.aln.hmmaln.fa  ## 131 as expect
exit
logout


## now fas to phy (line 4045)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots131norice9
cd refinPprots131norice9
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots131norice9
module load bioperl

./align_convert_fas_to_phy.pl orthoMCL131.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r--  1 pterry amundsen 159709 Nov 25 23:18 orthoMCL131.fa.aln.hmmaln.phy
exit
less orthoMCL131.fa.aln.hmmaln.phy
logout

## scp back to macbook, (line 4068)

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131norice9/orthoMCL131.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  159709 Nov 25 23:26 orthoMCL131.fa.aln.hmmaln.phy

less orthoMCL131.fa.aln.hmmaln.phy

head -n 4 orthoMCL131.fa.aln.hmmaln.phy
 131 802
'TraesCS1A01G067800.1'  ---------- ---------- ---------- ---------- ---------- ----------

## so phy header  131 802, expect the 131

Then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9/orthoMCL131.fa.aln.hmmaln.phy

Data type: aa's

The alignment file "orthoMCL131.fa.aln.hmmaln.phy" was uploaded, it contains 131 taxons of 803 characters.

Your job was submitted (131norice9, 11:34pm)
JobID : 1220598
Analysis name : 131norice9
Execution time: 1 hour(s), 12 minute(s)

11/26/17:
## path to orthoMCL131 tree file (line 4101)

/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9/orthomcl131_fa_aln_hmmaln_phy_phyml
orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt

## tree file:
orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt
-rw-r--r--@  1 bterry  staff  7142 Nov 26 07:46 orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt

cp to 'pro' laptop orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt

in figtree
tree/midpoint
'Node labels', (display aLRT, format=%, sig. digits =2, for now left on 2)
## on taxa 
## basically no more 'long' branches
## now highlighting chr 1, 2, 6 in turn

## set aLRT on %

## overall, circular view of orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt
 similar to rice9orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt. The group farthest away from rest of groups, with rice9 closest to it, is sort of the farthest away group in both trees (131plusrice9, & 131norice9)
 ## sort of 2 phylogenetic groups inhorizontal display
 --one, (with CS6B01G114300), nearest to group near rice9
 --two, rest of sequences
 
 ## TO DO, check, how 'blue 10' intersecting with orthoMCL are distributed in these two groups. => seem split between two 'chr6' groups. Chr's 1, 2, 6 grouped similarly as previous ML phylograms.
 
11/28/17:
******************************start venny*************************************
## refer line 4127, venny for orthoMCL135, red 122, blue 22 (total 4 colors, 3 files to venny)
## for orthoMCL135, use file: .../wheatgff3/oGroups144col1_to_135_nodotnum.txt
## for red 122, use file: .../r_stuff/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt
## 1st, need remove '.d' from rhs
cd .../r_stuff/
cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_red_wheatnames.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 122 > red122_nodotnum.txt
## for blue 22, use file:
.../r_stuff/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt 
## 1st, remove '.digit' from rhs sort147.txt, refer line 2266 - 2273.
## cat sort147.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 147 > sort147_nodotnum.txt
cat pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.835_blue_wheatnames.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 22 > blue22_nodotnum.txt

## now, submit these 3 files to venny
http://bioinfogp.cnb.csic.es/tools/venny/index.html
## output: .../r_stuff/orthoMCL135red122blue22venn.png
## Q: how get '4' colors ????????????????????
## can one select the colors ???????????????

## vikas suggestion, cat blue22, red122, do venny with just **2** input files.
cat red122_nodotnum.txt blue22_nodotnum.txt > red122andblue22.txt  ## 144 rows
venny output: .../r_stuff/venny2inp_orthoMCL135andphylogeny.png
## redone, 12/26/17, to change names above circles to orthoMCL & Phylogeny. 
## Q: why not calc % in new venn diagram ????????????????????????

## note: another web site, https://www.stefanjol.nl/venny, say can do **proportional** circles ??????????????????
## tried, all overlaps not correct ??????????????
********************************end venny***************************************

11/29/17:
talked to vikas
## following file to be appended to the '131', run thru 'Notes' steps. Try finish by tomorrow, thursday.
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9/FunctionallyCharacterizedRfs_fasta.txt
## try venny with 2 files, the '135' orthoMCL, & a combined 'blue' plus 'red' file (122+22)
## cp rmd_wkflowdoc dir to 'share' dir on crane. Look into private repo on gethub ??????

*************************Mower*********************************************
talked to J. Mower
## Fuggii paper mentioned
## he familiar with CMS system, does in research
## monitoring transcription: find lines don't restore, look for absent gene transcripts ???? Issue with low transcription level for CMS genes
## says identification of RF's hard, try 'mapping' (me: exactly how ????????????)
## uses figtree, says muscle, phyML ok
*************************Mower****************************************

## ok, next do 'Notes' steps after concatenate '.fa' files '131' & FunctionallyCharacterizedRfs_fasta.txt from vikas.
## 1st need remove blank lines from this file. Done.
## create new dir, 
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131vikas6
##  line 4199, copy following file
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9/orthoMCL131.fa (ref: line 4199)

*************ERROR********************
MISTAKENLY DELETED DIR .../phyml/pyMLorthoMCL131norice9
TO TRY: manually restore (how do time capsule ????) 
--two slurm files, 
--initial .fa file, 
--and the phyml '.zip' file
Q: TERMINAL STILL FINDS THE DIR ?????????????????????????????????
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
LATER, NEXT DAY => NO SUCH DIR. 
***********END ERROR********************************

11/30/17:
## now, for (ii), 'Notes' for 131, **plus** vikas6, 

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131vikas6

cat orthoMCL131.fa FunctionallyCharacterizedRfs_fasta.txt > orthoMCL131vikas6.fa
check in bbedit, number seqs = 131+6=137  ## have 137

## Now run Notes steps ... (refer 11/22/17, line 4201 above)

## need new dir on crane to do 1st three steps, muscle, fasta2stockholm.pl, & hmmbuild.

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir refinPprots131vikas6
cd refinPprots131vikas6
## scp orthoMCL131vikas6.fa to crane, dir = refinPprots131vikas6
logout
## now for slurm_muscle_wheatproj_refin131vikas6.sh
## edit, then scp

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131vikas6
scp orthoMCL131vikas6.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131vikas6
## cp slurm_muscle_wheatproj_refin131rice9.sh to slurm_muscle_wheatproj_refin131vikas6.sh, edit

scp slurm_muscle_wheatproj_refin131vikas6.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm (see line 4223)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin131vikas6.sh
ls -lh
sbatch slurm_muscle_wheatproj_refin131vikas6.sh 10660308 10:15pm =>

squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
ls -lh
less job.10660308.err
sacct -j  10660308 -o start,end
              Start                 End 
------------------- ------------------- 
2017-11-30T22:15:28 2017-11-30T22:15:58 
2017-11-30T22:15:28 2017-11-30T22:15:58 
22:15:58 - 22:15:28 = 30 sec

less orthoMCL131vikas6.fa.aln  ## looks to be *in* MSA fasta format.
## Q: why the vikas6 seqs at top file ???????????????

## next, fasta2stockholm.pl conversion (line 4248)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
ls -lh
cd ..
cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl orthoMCL131vikas6.fa.aln > orthoMCL131vikas6.fa.aln.slx
ls -al
-rw-r--r--  1 pterry amundsen 136568 Nov 30 22:47 orthoMCL131vikas6.fa.aln.slx

## to check top stockholm file
less orthoMCL131vikas6.fa.aln.slx

## now for *hmmbuild*

## see 11/22/17 above (line 4273)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6

hmmbuild orthoMCL131vikas6.fa.aln.hmm orthoMCL131vikas6.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             orthoMCL131vikas6.fa.aln.slx
# output HMM file:                  orthoMCL131vikas6.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     orthoMCL131vikas6.fa.aln   137   974   768     2.38  0.590 

exit
less orthoMCL131vikas6.fa.aln.hmm

#head -n 17 orthoMCL131vikas6.fa.aln.hmm

12/01/17:
## realign using hmm model, hmmalign  (line 4304)

## slurm file prepared
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131vikas6
scp slurm_hmmalign_wheatproj_refinorthoMCL131vikas6.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_refinorthoMCL131vikas6.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_refinorthoMCL131vikas6.sh 10663856  9:28am => ??:??am, 
squeue -u pterry  ## a ST
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
             
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
ls -lh
-rw-r--r-- 1 pterry amundsen 313K Dec  1 09:27 orthoMCL131vikas6.fa.aln.hmmaln

sacct -j  10663856 -o start,end
              Start                 End 
------------------- ------------------- 
2017-12-01T09:27:47 2017-12-01T09:27:59 
2017-12-01T09:27:47 2017-12-01T09:27:59
09:27:59 - 09:27:47 = 12 sec

less orthoMCL131vikas6.fa.aln.hmmaln  ## # STOCKHOLM 1.0 format MSA

## next, stockholm2fasta.pl conversion (line 4334)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al

cd ..
cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x 1 pterry amundsen   1398 Oct 28 16:22 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g orthoMCL131vikas6.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > orthoMCL131vikas6.fa.aln.hmmaln.fa

ls -al
less orthoMCL131vikas6.fa.aln.hmmaln.fa

grep -c ">Traes" orthoMCL131vikas6.fa.aln.hmmaln.fa  ## 131 as expect
grep -c ">" orthoMCL131vikas6.fa.aln.hmmaln.fa  ## 137 as expect
exit
logout

## now fas to phy (line 4363)
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/refinPprots820
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl refinPprots131vikas6
cd refinPprots131vikas6
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/refinPprots131vikas6
module load bioperl

./align_convert_fas_to_phy.pl orthoMCL131vikas6.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r--  1 pterry amundsen 158628 Dec  1 09:55 orthoMCL131vikas6.fa.aln.hmmaln.phy
exit
less orthoMCL131vikas6.fa.aln.hmmaln.phy
 137 768
'TraesCS1D01G057800.1'  ---------- ----TRVRAG TLSPEDAHHL FDELLRQATP VPSRSLDGFI AALARAPASA 
logout

## scp back to macbook, (line 4387)

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131vikas6

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131vikas6/orthoMCL131vikas6.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  158628 Dec  1 10:05 orthoMCL131vikas6.fa.aln.hmmaln.phy

less orthoMCL131vikas6.fa.aln.hmmaln.phy

head -n 4 orthoMCL131vikas6.fa.aln.hmmaln.phy
 137 768
'TraesCS1D01G057800.1'  ---------- ----TRVRAG TLSPEDAHHL FDELLRQATP VPSRSLDGFI AALARAPASA 

## so phy header  137 768, expect the 137

Then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: 
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131vikas6/orthoMCL131vikas6.fa.aln.hmmaln.phy

Data type: aa's
Still, no bootdstrap, rather aLRT

The alignment file "orthoMCL131vikas6.fa.aln.hmmaln.phy" was uploaded, it contains 137 taxons of 768 characters.

Your job was submitted. (10:15am)

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20171201-171442_As33/cmd.txt

## location 1341vikas6 tree file: orthomcl131vikas6_fa_aln_hmmaln_phy_phyml_tree.txt

/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131vikas6/orthomcl131vikas6_fa_aln_hmmaln_phy_phyml/orthomcl131vikas6_fa_aln_hmmaln_phy_phyml_tree.txt

## transfer tree file to 'pro'

in figtree
tree/midpoint
'Node labels', (display aLRT, format=%, sig. digits =2, for now left on 2)
## on taxa 
## basically no more 'long' branches
## now highlighting chr 1, 2, 6 in turn

## set aLRT on %

## Some comments on the figtree display for orthomcl131vikas6_fa_aln_hmmaln_phy_phyml_tree.txt
## Q76C99.1, rice (monocot), looks like similar relationship to all the wheat proteins as the rice9 were previously. The other 5 (dicots) are on long branches not real close to Q76C99.1. So, as the wheat seqs are grouped by chromosome on pyML fightree displays, the dicots are grouped and distinguished from the monocots.
## what to think of the 9.7% on the dicot (the 5) branch ????????

STOPPED
12/02/17:
***********************Aside_p-415_python bk****************
## [:-2], what would this do ????????????????
***********************End aside*****************************
 
# slip a save to ***github*** in here


ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry
mkdir rmd_wkflowdoc
cd /work/baenziger/shared/terry/rmd_wkflowdoc
ls -al
logout
cd /Users/bterry/macbook2017/vikas17/wheatproj/rmd_wkflowdoc
ls -al *_ppo*.Rmd
scp *_ppo*.Rmd pterry@crane.unl.edu:/work/baenziger/shared/terry/rmd_wkflowdoc
ls -al *.png
scp *.png pterry@crane.unl.edu:/work/baenziger/shared/terry/rmd_wkflowdoc
## then log on, see if worked, yes 11 files transferred.

12/04/17:
Talked to vikas
1) 131 gff3 file => s/w to provide the picture of domains, patterns, (for example, see if lot of introns, did I do this before ????) try find ref from prev vikas email from 09/05/17, 'gsds' online site, is this s/w meant? Line 2306 above, from 09/08/17.
2) 131 hmmaln output, '.fa' file, weblogo online pgm, see what looks like
orthoMCL131.fa.aln.hmmaln.fa (line 4353)

## So (1), submit .../wheatgff3/131_sort.gff3 to http://gsds.cbi.pku.edu.cn, request png output
## see line 4143, 11/20/17
## line 4165, 
## LOOKS LIKE THE 131_sort.gff3 FILE HAS THE **SAME** ORDER OF ROWS AS THE iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 FILE FOR THE SUBSET 131 ROWS FROM THE orthoMCL OUTPUT MAPPING TO **691** ROWS IN 131_sort.gff3.
## requested '.png', get browser display of output, can one save to file ??????????
Q: selection of other online page options. Vikas saved using right-click, '.png' provided.

Q: re-submitted .../wheatgff3/131_sort.gff3 to GSDS having selected 'SVG' option. After display appeared, option to save either as svg, png or pdf presented, selected 'svg', then got page http://gsds.cbi.pku.edu.cn/task/ARV2HU/ARV2HU.svg, saved to .../wheatgff3/gsds131.svg. BUT THEN FOR EXAMPLE, COULD NOT OPEN IN 'PREVIEW' ??????????????????????????????

12/05/17:
## (2) 
Q: vikas, get orthoMCL131.fa.aln.hmmaln.fa from crane .../refinPprots131norice9 dir, submit to weblogo, accepts defaults.

cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/
mkdir pyMLorthoMCL131norice9  ## note, this dir previously mistakenly deleted.

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131norice9/orthoMCL131.fa.aln.hmmaln.fa .
ls -al *.fa
## submit to weblogo
## Q: output file, fileVdk3vK.png, x-axis TOO MANY compared to weblogo ???????????????
## perhaps somehow need get the ~35 aa domains of these RF-like seqs to run on weblogo.

12/06/17:
talked to vikas
1) reran .../phyml/pyMLorthoMCL131norice9
/orthoMCL131.fa.aln.hmmaln.fa on weblogo, but 'checked 'multiline logo, kept default of 32 symbols/line. Saved file as .../phyml/pyMLorthoMCL131norice9/131hmmaln.fa.weblogo.pdf
## note: vikas clicked the firefox weblogo to increase size of the display ?????????
## NOTE: basically, at many positions, 1 or few aa's listed, indicating the seqs in the input fasta file seqs similar in aa at many positions.
## Q: could one go in following one of the ref papers, 'mark' the domains by repetition of seq patterns by setting setting multiline logo to appropriate value ????????????????????????????????????
2) MEME ver 4.12.0 (to do)
http://meme-suite.org/tools/meme
fasta format, limit 60,000 char. My file, orthoMCL131.fa.aln.hmmaln.fa has 108,072
## so perhaps split into 132 & 130 size files, run each thru MEME ??????
## Q: says, 'select number motif sites' ????? Q: not knowing what number to give, perhaps run multiple times with say 1, 2, 3 for 1st 3 runs ?????????????????????????????
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
head -n 132 orthoMCL131.fa.aln.hmmaln.fa > orthoMCL131.fa.aln.hmmaln_1st132lines.fa
wc orthoMCL131.fa.aln.hmmaln_1st132lines.fa
     132     132   54450 orthoMCL131.fa.aln.hmmaln_1st132lines.fa
tail -n 130 orthoMCL131.fa.aln.hmmaln.fa > orthoMCL131.fa.aln.hmmaln_last130lines.fa
wc orthoMCL131.fa.aln.hmmaln_last130lines.fa
     130     130   53622 orthoMCL131.fa.aln.hmmaln_last130lines.fa
>>> 54450 + 53622
108072
## 'any number of repetitions'
## number motifs = 1  ???????????????
Sequence contains bad characters

    Total of 18928 bad characters in 66 sequences
    Found 18928 characters (including '-') not in the alphabet on lines 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, ...
## Q: what to do ?????????
## Q: perhaps run perl substitution command, substitute '-' by nothing ???????????
## Q: see line 207 above, looks like perl substitution does not work if the '-' are not in a pattern  ??????????????

12/07/17:
## Q: kochan & wood, p-82, couple approaches, Q: how specify output file ??????
tr -d '-' < orthoMCL131.fa.aln.hmmaln.fa > test_tr
## working ok, but still file > 60,000
-rw-r--r--   1 bterry  staff   72478 Dec  7 08:52 test_tr
## so do 'tr' as follows
tr -d '-' < orthoMCL131.fa.aln.hmmaln_1st66seqs.fa > orthoMCL131.fa.aln.hmmaln_1st66seqs_dash.fa
-rw-r--r--   1 bterry  staff   35522 Dec  7 09:04 orthoMCL131.fa.aln.hmmaln_1st66seqs_dash.fa
## so < 60,000
tr -d '-' < orthoMCL131.fa.aln.hmmaln_last65seqs.fa > orthoMCL131.fa.aln.hmmaln_1ast65seqs_dash.fa
-rw-r--r--   1 bterry  staff   36956 Dec  7 09:12 orthoMCL131.fa.aln.hmmaln_1ast65seqs_dash.fa
## so < 60,000
## now ready submit non dash < 60,000 char to MEME

upload orthoMCL131.fa.aln.hmmaln_1st66seqs_dash.fa
## 'any number of repetitions'
## number motifs = 1  ???????????????
## Advanced options => should any of these be used ???????
## submitted 9:50am => 
## NOTE: REMOVING DASHES WITHIN SEQ OF AA seq, MEME only works on ungapped seqs, so removal all dashes apparently would not hurt MEME ???????
## NOTE: orthoMCL131.fa.aln.hmmaln_1st66seqs_dash.fa has seq length **variance** 179 to 800 ??????????????????

## output, Q: MAST, diff. from MAST ???????
## Q: What to think of this 'logo' ????????????????????????

12/08/17:
## try 2nd run meme, description: orthoMCL131.fa.aln.hmmaln_1st66seqs_dash.fa_2motif
## submit, 10:09am, 
An error occurred running your MEME job. Further details may be available below
http://meme-suite.org/info/status?service=MEME&id=appMEME_4.12.01512749382745409351221
## don't see any error notes ????????????????????????????

## perhaps submit with 3 motifs
http://meme-suite.org/tools/meme
## try 2rd run meme, description: orthoMCL131.fa.aln.hmmaln_1st66seqs_dash.fa_3motif
12/8/2017, 11:30:02 AM
An error occurred running your MEME job. Further details may be available below.
http://meme-suite.org/info/status?service=MEME&id=appMEME_4.12.01512754202263189880938
## don't see any error notes ????????????????????????????

## TALKED TO VIKAS
**PROBLEM:** FOR MEME, WANT ORIGINAL '.fa' FILE PUT THRU 'NOTES' STEPS, NOT THE 'TRIMMED' OUTPUT FROM HMMALIGN !!!!!!!!!!!!!!!!!!??????????????????????????
## line 4199, today, can't find orthoMCL131.fa in /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9  ???????????????????????????????????????????????????/
## so, 
scp it back from pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131norice9/orthoMCL131.fa
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131norice9/orthoMCL131.fa .
ls -al
## Now, submit this file to MEME
## Q: Will MEME have problem with '*' characters ????????????????????? Answer, YES
## so try remove with 'tr'
wc orthoMCL131.fa
    1398    1398   76214 orthoMCL131.fa
## so will need divide file, say in half to be < 60,000

#head -n 701 orthoMCL131.fa.aln.hmmaln.fa > orthoMCL131.fa.aln.hmmaln_1st132lines.fa
head -n 701 orthoMCL131.fa > orthoMCL131_top701.fa
tail -n 697 orthoMCL131.fa > orthoMCL131_last697.fa
## two output files look ok.
## try again submit to MEME
orthoMCL131_top701.fa_1motif
## ran, logo: YNTLIHGYFKVGKMDKACKJFHEMTSQGVEPBVVTYSSVIDALCKNGRMD
Each of the following 63 sequences has an E-value less than 10.
The motif matches shown have a position p-value less than 0.0001

## try again for 2 motifs
orthoMCL131_top701.fa_2motif
Your job ID is: appMEME_4.12.01512792223286-1920140562
running, 10:05pm
## result: motif locations, seeing **different** pattern of the two motifs in the various input sequences.

## github save again.

## perhaps **to try** run wi 3 motifs, then start analyzing 


## get rid '*'s
## apparently not a problem.
## Note: need check size file also. Both small enough.

12/10/17:
vikas
MEME
jhu article (crispr)

12/17/17:
# redo MEME for 131 for 1, 2, & 3 motifs
orthoMCL131_top701.fa
orthoMCL131_top701redo2.fa_1motif
http://meme-suite.org/tools/meme
'any number repetitions'
no. of motifs =1
start: 12:53pm

orthoMCL131_top701.fa
orthoMCL131_top701redo2.fa_2motif
http://meme-suite.org/tools/meme
'any number repetitions'
no. of motifs =2
start: 1:01pm

orthoMCL131_top701.fa
orthoMCL131_top701.fa_3motif
http://meme-suite.org/tools/meme
'any number repetitions'
no. of motifs =3
start: 1:05pm

## Q: pattern of the 3 motifs ***varies*** for location in each sequence ??????????????
## Q: can meme3motif.txt be displayed outside of meme browser result page ????????

## For further information on how to interpret these results, go to http://meme-suite.org
, motif compari
# Q: Tomtom, motif comparison tool ?????????????????????
# I note pattern of 1motif run similar to 1st pattern for 3 motif run.

12/18/17:
talked to vikas
1) get images, etc. in .Rmd file ready for pub
2) vikas available later in day, thurs, fri to work with this info.

3) redo vikas phenogram (/Users/bterry/macbook2017/vikas17/vikas_phenograms
), this time for the 131 seqs rather than 144
## also, try option to display expanded single chrom, fig 8 of phenogram paper.

12/20/17:
## try prepare file for the 131 like gff3_cols13_144nochr_ForPhenoGram.txt of vikas.
## need file wi chr & position for the 131 seqs. Try look at input/output for orthoMCL ???????
gff3_cols13_144nochr.txt, perhaps could go to gff3, select the 131 seqs, similar to prepn of gff3_cols13_144nochr.txt ?????????????????

12/21/17:
## proceeding, 1st get the 131 seq names from /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9/orthoMCL131.fa
grep "^>" orthoMCL131.fa > orthoMCL131names.txt  ## 131 rows as expect, appears sorted, last 3 are chromosome 'U'. Presume need to remove before phenoraph ??????????????
# next, remove '>' left hand side of each line
## cat sort147.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 147 > sort147_nodotnum.txt
cat orthoMCL131names.txt|perl -pe 's/>(Tr.+)$/\1/' | head -n 131 > orthoMCL131names2.txt
# next, remove '.digit'
## cat sort147.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 147 > sort147_nodotnum.txt
cat orthoMCL131names2.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 131 > orthoMCL131namesnodotnum.txt
# now need subset .../wheatgff3/gff3_1345_9names.txt
# 1st copy to /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
# see p-2325
# sort/uniq check of orthoMCL131namesnodotnum.txt
#sort oGroups135plus12blue_norice9.txt |uniq > testsort147.txt
sort orthoMCL131namesnodotnum.txt |uniq > testsortuniq131.txt
## seq of rows seems same
## now, ready for bash subsetting script.
## cp bash Philip_5colmgff3.sh to .../phyml/pyMLorthoMCL131norice9
##bash Philip_5colmgff3.sh sort147_nodotnum.txt > gff3_1345_9names_147.txt  ## ok
bash Philip_5colmgff3.sh orthoMCL131namesnodotnum.txt > gff3_1345_9names_131.txt  ## ok

## now cut colms 1,3  ## Q: will seq names in new colm 3 be a problem ???????????
cut -f 1,3 gff3_1345_9names_131.txt > gff3_cols13_131.txt

## finally, remove 1st 3 char (chr) (each row in gff3_cols13_131.txt with 
cat gff3_cols13_131.txt|perl -pe 's/chr(.+)/\1/' | head -n 131 > gff3_cols13_131nochr.txt

## talked to vikas
1) put 'tree' filenames in file .../rmd_wkflowdoc/listofimages.tst for each of the images. 8 tree files copied to .../wheatproj/rmd_wkflowdoc
2) changes to venny image (orthoMCL & Phylogeny labels). They compare orthoMCL (135 seqs & the phylogeny, blue=22+red=44=144 after 820 blue & red 'p' + rice9 image above. I note, now missing % display ??????????????
3) Q: The Goal of this research? heterosis, in research scale, 'chemical hybridizing agent' to stop polination some plants in field (like detassaling). But not for production scale. Q: vikas comment: active RF proteins only work with subset of sterile cytoplasm (Me: NEED CLARIFY HOW RF-proteins fcn ???????????!!!!!!!!!!!!************)
4) vikas interest to redo rice9, get more rice RF proteins, run say orthoMCL these + the 820 'p' proteins, see if add'l orthogroups contain some of these known active RF proteins, +ve controls ?????
5) vikas new task: snp locations, find location overlaps (also 1000 bases before & after) with RF genes (Me: need add'l explanation of task, data set ?????????????? I note, bioconductor may be able to do ???? Check bioconductor help site. Also, v buffalo, chpt 9, See p-263-4 and following for starters.
6) get the image for the introns in the RF protein seqs, gsds (done, in Rmd file)
7) phenogram with annotation, see what vikas thinks of the single chrom. plots with input files containing seq. names ??????
8) Q: comment on MEME, what to think about varying pattern of motifs between putative RF seqs ?????????????????????????????
9) weblogo ???????????????????

12/22/17:
## read into R, create 3 colm headers, add a vector, 'RF-like_seq'
## need be in dir .../phyml/pyMLorthoMCL131norice9
setwd("/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9")
colm3 <- rep('RF-like_seq', 131)
class(colm3)
length(colm3)
nchar(colm3)
colm1and2 <- read.delim("gff3_cols13_131nochr.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("chr", "pos"))
phen_input <- data.frame(chr = colm1and2$chr, pos = colm1and2$pos, phenotype = colm3)
dim(phen_input)
head(phen_input, n = 3)
write.table(phen_input, file="phen_input131.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=TRUE)
## remove 3 'U' rows => phen_input128.txt
## ready for phenogram plots
## pheno_gram.33904.png, all chromosomes
## pheno_gram.1A.10to60.png, chrom. 1A, 10,000,000 to 60,000,000 part of ~ 594 million length chrom. 1A 
## 
## Q: could I annotate the seqs on this segment of 1A ?????????????
## tried, failed, perhaps email, contact wi Question ???????????????/

12/26/17:
## **also try** like **3rd example** at phenoGram site, put seq names in 'phenotype' colm, select chrom 1A (only 21 seqs for chrom 1A betw. 10 & 60 million), see if annotate by color and display seq names below the ideogram ????????

## now cut colms 1,3,5
cut -f 1,3,5 gff3_1345_9names_131.txt > gff3_cols135_131.txt

## finally, remove 1st 3 char (chr) (each row in gff3_cols135_131.txt with 
cat gff3_cols135_131.txt|perl -pe 's/chr(.+)/\1/' | head -n 131 > gff3_cols135_131nochr.txt
## ck in bbedit, if all tab separations ????
## need colm headers, try add with R

## read into R, create 3 colm headers, add a vector, 'RF-like_seq'
## need be in dir .../phyml/pyMLorthoMCL131norice9
setwd("/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9")
getwd()
colms123 <- read.delim("gff3_cols135_131nochr.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("chr", "pos", "phenotype"))
dim(colms123)
head(colms123, n=3)
phen_input <- data.frame(chr = colms123$chr, pos = colms123$pos, phenotype = colms123$phenotype)
dim(phen_input)
head(phen_input, n = 3)
write.table(phen_input, file="phen_input131protnames.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=TRUE)
## remove 3 'U' rows => phen_input128.txt

## ready for phenogram plots
## ***error***, lost dir.../phyml/pyMLorthoMCL131norice9 by keyboard sensitivity problem ????? Try find the files with 'find' command ??????
## finding the files previously in /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9 in /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pheno_gram.30959 dir.
## but pheno_gram.30959 dir **not** showing up in finder window ???c
?

## ***what to do*** Perhaps mv pheno_gram.30959 to pyMLorthoMCL131norice9
## from 
mv pheno_gram.30959 pyMLorthoMCL131norice9
## check if can see in finder window, looks ok now.

## result: pheno_gram.1A.10.60protnames128.png => gave the 21 seq names, but some colors ***similar*** enough that betw. perhaps 3 or 4, can't identify colored circle matching seq. name ????????? ***But*** seq names in phen_input128protnames.txt **same** as order along chrom. So, **can** see which seqs are ***'grouped'*** on chrom.


## To do, now copy pheno_gram.1A.10.60protnames128.png from Downloads to .../phyml/pyMLorthoMCL131norice9 dir. (done)

## updated venny in 'Rmd' file (Q: why no % calc this time) ????????

12/27/17: 
## To do, put two .png images into rmd_wkflowdoc dir from .../phyml/pyMLorthoMCL131norice9 dir so can invoke in wheatflowdocnotestoc4_from_ppointtmp.Rmd file.
i) pheno_gram.33904.png
ii) pheno_gram.1A.10.60protnames128.png

## now, update, then knit wheatflowdocnotestoc4_from_ppointtmp.Rmd file (done)

12/28/17:
## copy tree files to .../wheatproj/rmd_wkflowdoc (see listoftreefiles.txt)
1) not in pub ???
2) pro, .../100817/PPRhmmsearchsubset_plus9_clustaltree_coloredPandrice9

3) pro, .../vikas17frompro/pyML829/pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors.txt

4).../pyML153/22plus122plus9_fa_aln_hmmaln_phy_phyml/22plus122plus9_fa_aln_hmmaln_phy_phyml_tree.txt
5) .../phyml/pyML156_3/156_3_fa_aln_hmmaln_phy_phyml
/156_3_fa_aln_hmmaln_phy_phyml_tree.txt
6) .../phyml/pyMLorthoMCL135price9/rice9orthomcl135_fa_aln_hmmaln_phy_phyml
/rice9orthomcl135_fa_aln_hmmaln_phy_phyml_tree.txt
7) .../phyml/pyMLorthoMCL131price9/rice9orthomcl131_fa_aln_hmmaln_phy_phyml
/rice9orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt
8) pro, .../macbookpro2017/pyMLorthoMCL131norice9/orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt
9) .../phyml/pyMLorthomcl131vikas6/orthomcl131vikas6_fa_aln_hmmaln_phy_phyml
/orthomcl131vikas6_fa_aln_hmmaln_phy_phyml_tree.txt

## left to do, 3 pro files above (done, copied to .../wheatproj/rmd_wkflowdoc on mbook)

# slip a save to ***github*** in here
cd ~/planets
git status
git add wheatprojdoc060117.txt
git commit -m "update 08/31/17 wheatprojdoc060117.txt"
git status
git push origin master
# git remote -v

12/29/17:

*****************************Start,chpt9,vbuffalo***********************************
p-270
have R 3.4.1, so upgrade to 3.4.2 (3.4.3 avail also), choose 3.4.2 since bioconductor using. (tho reading further, 3.4.3 perhaps better choice.
Now install bioconductor 3.6
Start R, then
source("https://bioconductor.org/biocLite.R")
biocLite()
3.5, not 3.6 ????????????????????????????
source("https://bioconductor.org/biocLite.R")
         biocLite("BiocUpgrade")
## still 3.5, not 3.6 ????????????????????
## but then says:
Upgrade all packages to Bioconductor version 3.6? [y/n]: y
p-270
biocLite("GenomicRanges")
## several **utility** bioconductor packages mentioned.
p-271, new R session
library(BiocInstaller)
biocLite("GenomicRanges")
library(IRanges)
rng <- IRanges(start=4, end=13)  ## how specify sequence ???
rng
IRanges(start=4, width=3)
p-272
p-278
## to run this page, try fig out fig 9.8  ????????????????????
set.seed(0)
alns <- IRanges(start=sample(seq_len(50), 20), width=5)
alns
reduce(alns)
## ok, see how works

12/30/17:

12/31/17:

p-290
## to try code this page, fig 9-16, not needed, can see what happening without coding
p-294
## to try code this page, 'coverage(), 
set.seed(0) 
rngs <- IRanges(start=sample(seq_len(60), 10), width=7)
rngs
names(rngs)[9] <- "A"  # label one range for examples later
rngs_cov <- coverage(rngs)
rngs_cov

01/01/18:
p-299
GenomicRanges
p-306
## perhaps run code, see if 4 chr3 seqs ???????????????????????????
p-307
## perhaps run code, try figure out what happening for (1), see if my interpretation ok for (2), (3), ??????????????????????????
p-308
top of page code output ??????????????????
p-309
## to check bit.ly/anno-data url, => available annotation packages ???????????


p-312
## looks like will need to create a transscriptDb object for data/organism will want to work with ?????????????????????
## Q: will this be a problem ????????????????

p-313
## import.gff() ?????????????????????????
p-314-315
## to run this code ??????????????

p-316
## two ways to grab promoter nucleotide seqs ???????????????????????

01/02/18:
p-317
## Biostrings ????
## large scale alignment/mapping ?????????????????????
## bottom page code ??????????????????????

xxxxxxxxxxxxxxxxxxxxxxxxxxxxx start vikas Q'sxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
## talked to vikas
1) for rice, is there a list of RF-like genes, Os.... one can access ?????
2) start 131, follow vikas 'Notes', create hmm (think previously did ??), then hmmsearch vs all the wheat .fa seqs, => , initially see what get (note: with PRR.hmm, prevly got 1545).
3) venny, check if different web sites, may differ by the '%' representation ??????
4) cp rmd_wkflow_doc to crane
5) get the ios app for pag2018 going (apparently only for ios, not for osx ???) (done)
6) snp input data format

SNP id  | chr  | position
snp1    | 2    | 5 Mb
...
        | 1    |
...

## working with gff3 file, looks like 3 colms from gff3 file, add 2 add'l colms

Traes  | start  | end | start - 1kb | start+1kb

To do: subset snp's within/around RF-like genes. Suggest check google for method to accomplish. Also chpt 9 of v buffalo.
## google finding qqch on ncbi, but searching a seq **prevly** has snps located ?????

7) Evid. RF-like proteins may have variation: Melonek abstr: this implies PPR gene inactivation and loss during polyploidization, for which we found evidence in the form of truncated or frame-shifted gene fragments. Pattern MEME motifs vary between 61 putative RF-like seqs. tested. Are MEME motifs perhaps **more sensitive** way to discriminate betw. putative RF-like seqs. ????????? Perhaps use to subset putative RF-like seqs, look for seqs with similar motif patterns ???????????

8) ask vikas try install figtree on his new mac pro ?????
xxxxxxxxxxxxxxxxxxxxxxxxxx end vikas Qs xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

p-324
finding, working with overlapping ranges **[LOOKS LIKE TASK WANT TO ACCOMPLISH]**
## could one build/structure files as prevly described, then employ IRanges package (TO CHECK)
p-326
findOverlaps()  ???????????

01/03/18:
p-328 Lander-Waterman
## Q: looks like some typos in here ??????????????
p-329
BEDTools
p-330
Q: BED files, GTF, GFF, how compare ????????????????
## note: format vikas suggested & '.bed' files examples bit different, how to proceed ????????

01/04/18:
p-331
annotation/track formats ?????????????????
BAM files ??????????
p-333
## dealing with strand ???????????????????????
## Q: 'echo' line ???????????????????????
p-334
## check chr names compatible ????????
p-335
## Q: strand, stumbling block ?????????????????

## so at the end of chpt9, next to try, p-330 (overlaps) & p-333-35 (slop, flank)
## at same time, check out vikas rec., plink

## 1st, map out what input files will be, steps to get the input files ready.

01/05-06/18:
## after looking at the plink 'Extract a subset of SNPs: file-list options' section, have number of questions for vikas. Some are:
1) looks like 'snp' file will need 2 colms, chr & position (I assume need chr colm as position number not unique in genome, only within a chrom.)  ???????????????????????????????????
2) myrange.txt, would have 4 colms.
For example,

     2 30000000 35000000  R1
## if build from gff3 file, could cut last 3 of these fields directly from gff3 file, for chr field, perhaps extract chr from 'LABEL' field (perhaps what C. Brown presented using R, also in v buffalo for this task).
3) SET file, what is it, perhaps prevly doc'd snps in genes ??????????
4) +- 1bk ranges upstream/downstream of gene (is gene = 5'utr, coding region, 3'utr). Would/can plink do this with its algorithm, or would one need to prepare these ranges oneself  ??????????????????????????
5) are we only doing the 128 genes ?????????????????????????
6) perhaps do for *all* chromosomes ?????????????????
 
## so for (2), prepare myrange.txt file
## 1st, find what did prevly processing wheat ggf3 file for the 128 RF-like gnes/proteins. Check 131 also (perhaps also 135), since only difference is subtracted last 3 lines.
##
 ok, line 5034, looks like can start with file .../phyml/pyMLorthoMCL131norice9
/gff3_1345_9names_131.txt
chr1A	gene	49346779	49349220	TraesCS1A01G067600
chr1A	gene	49355113	49356126	TraesCS1A01G067700
## so in new myrange.txt file, colm 1 will remove chr from chr1A
## new colm 2 will be colm 3 from gff3_1345_9names_131.txt
## new colm 3 will be colm 4 from gff3_1345_9names_131.txt
## new colm 4 will be colm 5 from gff3_1345_9names_131.txt

STOPPED

## to do: implement preceding steps.
cd /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9
cut -f 1,3,4,5 gff3_1345_9names_131.txt > gff3_cols1345_131.txt
cat gff3_cols1345_131.txt|perl -pe 's/chr(.+)/\1/' | head -n 131 > gff3_cols1345_131nochr.txt
## the last file the 'myrange.txt' file in plink section '
Extract a subset of SNPs: file-list options' at url: http://zzz.bwh.harvard.edu/plink/dataman.shtml

## email vikas:
--get 'snp' file
--check if correct in num. colms think need for this file to use in plink  ????????????
--work on pag18 talks to see
check academic courses for 18, stat, agron, the biology (BIOS ???)

## **stopped** plink effort for moment

STOPPED



****************************End,chpt9,vbuffalo**************************************


01/10/18:
from 01/02/18 above, line 5188, 
## 2) start 131 .fa prot. seqs, follow vikas 'Notes' (1st 3 steps only), create hmm (think previously did ??), then hmmsearch vs all the wheat .fa seqs, => , initially see what get (note: with PRR.hmm, prevly got 1545).
## ref. HMMER userguide.pdf, p-20-22

## needed steps to get new hmmsearch output for new hmm based on the 131
## do 1st 3 steps in file: /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/Notes_Alignment_UsingHMMs.txt
## on mbook, work in dir .../vikas2018/131RFlike
mkdir ../macbook2018/vikas18/131RFlike
## i. muscle on .fa for the 131 putative RF-like seqs
## 131 .fa file ???, looks like can use /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyMLorthoMCL131norice9/orthoMCL131.fa
## cp to ../macbook2018/vikas18/131RFlike dir
## refer line 719, 739
## ../FRprotseqs/slurm_muscle_wheatproj_refin820.sh

cp, rename ../FRprotseqs/slurm_muscle_wheatproj_refin820.sh to ../macbook2018/vikas18/131RFlike/slurm_muscle_wheatproj_131RFlike.sh, & edit.
  
## github update (done)

## update crane wi rmd_wkflow_doc

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/shared/terry/rmd_wkflowdoc
ls -al |wc -l ## 15, 14 .png, 1 .Rmd
rm *.png
rm *.Rmd
ls -lh ## dir empty
logout
cd /Users/bterry/macbook2017/vikas17/wheatproj/rmd_wkflowdoc
ls -al *_ppo*.Rmd
scp *_ppo*.Rmd pterry@crane.unl.edu:/work/baenziger/shared/terry/rmd_wkflowdoc
ls -al *.png | wc -l  16
scp *.png pterry@crane.unl.edu:/work/baenziger/shared/terry/rmd_wkflowdoc
## then log on, see if worked, lists 20 files.
ls -lh *.Rmd  # 1
ls -lh *.png  # 16
[pterry@login.crane rmd_wkflowdoc]$ ls -lh |wc -l
18
## later, check what other 1 extra file is ?????????????

01/22/18:

## to prepare crane for this slurm run

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/
ls -lh
## if no dir 131RFlike, create one
mkdir 131RFlike
ls -lh
## /work/baenziger/pterry/wheatproj/131RFlike
logout
## probably need scp orthoMCL131.fa over to crane into .../131RFlike dir.
cd /Users/bterry/macbook2018/vikas18/131RFlike
scp orthoMCL131.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/131RFlike

scp slurm_muscle_wheatproj_131RFlike.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/131RFlike
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_refin820.sh
ls -lh
sbatch slurm_muscle_wheatproj_131RFlike.sh 11302281  12:17pm => ??:??am, 

squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          11302281     batch TJob_mus   pterry PD       0:00      1 (Resources)
## later, 3:36pm,
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

cd /work/baenziger/pterry/wheatproj/131RFlike
ls -lh

-rw-r--r-- 1 pterry amundsen  69K Jan 22 12:25 job.11302281.err
-rw-r--r-- 1 pterry amundsen    0 Jan 22 12:24 job.11302281.out
-rw-r--r-- 1 pterry amundsen  75K Jan 22 11:21 orthoMCL131.fa
-rw-r--r-- 1 pterry amundsen 126K Jan 22 12:25 orthoMCL131.fa.aln

less job.11302281.err

sacct -j  11302281 -o start,end
              Start                 End 
------------------- ------------------- 
2018-01-22T12:24:41 2018-01-22T12:25:08 
2018-01-22T12:24:41 2018-01-22T12:25:08 
12:25:08 - 12:24:41 = 27 sec

less orthoMCL131.fa.aln  ## looks to be *in* MSA fasta format.
 
## next, fasta2stockholm.pl conversion (line 4248)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/131RFlike
ls -lh
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl orthoMCL131.fa.aln > orthoMCL131.fa.aln.slx
ls -al
-rw-r--r--  1 pterry amundsen 126693 Jan 22 16:17 orthoMCL131.fa.aln.slx

## to check top stockholm file
less orthoMCL131.fa.aln.slx

## now for *hmmbuild*

## see 11/30/17 above (line 4595)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/131RFlike
ls -lh
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/131RFlike

hmmbuild orthoMCL131.fa.aln.hmm orthoMCL131.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             orthoMCL131.fa.aln.slx
# output HMM file:                  orthoMCL131.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     orthoMCL131.fa.aln     131   945   802     1.56  0.590 

# CPU time: 2.57u 0.01s 00:00:02.57 Elapsed: 00:00:02.62
exit
less orthoMCL131.fa.aln.hmm
HMMER3/f [3.1b2 | February 2015]
NAME  orthoMCL131.fa.aln
LENG  802
ALPH  amino
RF    no
MM    no
CONS  yes
CS    no
MAP   yes
DATE  Mon Jan 22 16:43:25 2018
NSEQ  131
EFFN  1.555145
CKSUM 2958776102
STATS LOCAL MSV      -12.8115  0.69619
STATS LOCAL VITERBI  -13.7209  0.69619
STATS LOCAL FORWARD   -6.7808  0.69619

## preparing for hmmsearch using orthoMCL131.fa.aln.hmm vs iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa

## log back in, check /work/baenziger/shared/terry/hmm dir.
## has zip file for iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/shared/terry/hmm
ls -al  ## sizes are same.

iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip
/work/baenziger/pterry/wheatproj
## perhaps iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa deleted from crane ??????????????
## not finding iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa.zip in shared dir on crane.
## try from /Users/bterry/macbook2017/vikas17/wheatproj dir the following
cd /Users/bterry/macbook2017/vikas17/wheatproj
find . -name 'iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa' -print
./iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
## so scp iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa to /work/baenziger/pterry/wheatproj/131RFlike

-rw-r--r--  1 bterry  staff  48634703 Jun 14  2017 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa

scp iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/131RFlike

## then check file same size on crane
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj/131RFlike
ls -al
-rw-r--r--  1 pterry amundsen 48634703 Jan 22 19:20 iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
## matches

## then, 
## hmmsearch PPR.hmm iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa > PPR.out
## analyze output of hmmsearch, ... get output like PPRsec2_1562_Seqscolm.txt

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj/131RFlike
ls -al
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
# hmmsearch NB-ARC.hmm Trinity.fasta.transdecoder.pep > hmmsrchshortpep.out
cd /work/baenziger/pterry/wheatproj/131RFlike
hmmsearch orthoMCL131.fa.aln.hmm iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa > orthoMCL131hmmsearch.out
## 7:43pm, ran < 1min.
ls -lh
-rw-r--r-- 1 pterry amundsen 5.2M Jan 22 19:43 orthoMCL131hmmsearch.out

less orthoMCL131hmmsearch.out

# hmmsearch :: search profile(s) against a sequence database
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# query HMM file:                  orthoMCL131.fa.aln.hmm
# target sequence database:        iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Query:       orthoMCL131.fa.aln  [M=802]
Scores for complete sequences (score includes all domains):
   --- full sequence ---   --- best 1 domain ---    -#dom-
    E-value  score  bias    E-value  score  bias    exp  N  Sequence             Description
    ------- ------ -----    ------- ------ -----   ---- --  --------             -----------
          0 1527.6   2.1          0 1527.4   2.1    1.0  1  TraesCS1D01G056200.1  
          0 1513.4   3.1          0 1513.1   3.1    1.0  1  TraesCS1A01G054700.2  
          0 1513.2   0.3          0 1513.0   0.3    1.0  1  TraesCS1D01G068400.1  
          0 1512.9   8.4          0 1512.7   8.4    1.0  1  TraesCS1B01G072900.2  
          0 1510.9   0.6          0 1510.7   0.6    1.0  1  TraesCS1A01G067400.1  
          0 1509.9   0.4          0 1509.7   0.4    1.0  1  TraesCS1B01G085900.1  
          0 1501.2   0.0          0 1500.9   0.0    1.0  1  TraesCS1A01G067600.1  
          0 1497.3   0.3          0 1497.1   0.3    1.0  1  TraesCS1D01G068900.1  
          0 1495.6   1.0          0 1495.3   1.0    1.0  1  TraesCS1D01G068500.1  

wc -l orthoMCL131hmmsearch.out
67619 orthoMCL131hmmsearch.out

## compare PPR.out for size, e-values
wc PPR.out
 118172  689922 6704453 PPR.out

## so only approx half many lines as PPR.out

## to check: how determied how many wheat proteins to call hits with orthoMCL131.fa.aln.hmm vs iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa

## 1st, scp 

## ref, 06/12/17 (line 137)
## Note: p-544, cheng ref., 0.1 for *full*, 100 for *domain* ??????
## Q: few comments:
## PPR.out, line 1540, 'inclusion threshold'
## p-9, sci. reports, RFL genes  >= 10 p-class ppr motifs, (note: sec 2, PPR.out, line 542, # domains < 10) So, should num. domains affect cutoff for hmmsearch hits ?????????????????
## p-533, cheng ref., PPR proteins, 2 to 30 tandem repeats ??????????????
## p-533, cheng ref., PPR.out, line 1562, criteria cutoff, 
(-E 0.1),
(-E 100)
## compare, hmmer doc, p-23, cutoff E-value <= 10.0, catches *all* 1595 lines sec 2, PPR.out 
## hmmer doc, p-24, sec 3, ...

## talked to Vikas, would like to take hits in PPR.out file using cheng, p-544 criterion of 'full' E-value <= 0.1. This line 1562 and above in sec 2.

## 1st, scp orthoMCL131hmmsearch.out back to macbook
cd /Users/bterry/macbook2018/vikas18/131RFlike
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/131RFlike/orthoMCL131hmmsearch.out .

philip-terry-2:131RFlike bterry$ ls -al
-rw-r--r--   1 bterry  staff  5350084 Jan 22 21:16 orthoMCL131hmmsearch.out

## note: all but last row of seqs for LHS E-value < .1


STOPPED

## comments:
i. meme, p-77, 'sparkle', domain viewer (5:40pm tuesday), perhaps could split 'P' from 'PLS', RF-like eqs ??????????
ii. so 1553 - 14 = 1539 rows of seqs < 0.1 LHS E-value
iii. could run thru phyml, see what looks like, including rice9 ???????????
iv. perhaps check couple other hmmsearch criteria for output file ????????
v. Read over melonek material, understand all of it, may help with ideas ??????
vi. ... ????

01/23/18:
## for now, stop with 06/13/17 section steps for hmmsearch output file, /work/baenziger/pterry/wheatproj/131RFlike/orthoMCL131hmmsearch.out file.

## talked to vikas today.
i. given the 1539 seqs < Evalue = 0.1 in orthoMCL131hmmsearch.out, not helping to identify RF-like genes.
ii. to check: compare 1545 from PPR.hmm with 1539 from orthoMCL131.fa.aln.hmm (sort, unique, diff ???). If basically the same set, then
iii. get a list of rice RF-like proteins (see melonek 2016 paper on rice).
iv. unclear vikas here? Considering orthoMCL & ML phylogeny methods. 
--run orthoMCL on expanded rice RF-like list + wheat P proteins selected by another ML phylogeny run (?) (or using all 1539 from orthoMCL131.fa.aln.hmm) output???
-- ???? compare with phylogeny for wheat 'p' proteins rice RF-like seqs with ?? wheat P proteins
v. read over melonek 2016 rice paper (think place where got rice seq from Ensembl) ??? Q: gene/protein names in table S1, fig 3 ???????????????????
vi. understand melonek wheat talk & sorghum poster
vii. barkan & small review, fig 2, could I try differentiate RF-like from 'P' proteins using for example webLogo ????????????????????????????????
viii. autogamous, wheat, apparently ????????

01/28/18:
## talked to vikas, 01/26/18
i. having trouble getting protein seqs from melonek paper, table S5, check out ref. Fuji there for the 'red' seqs, from bradi??? 
ii. Fujii, 2011, *not* 2016

01/29/18:
iii. Sykes paper
Q: is new wheat genome seq 'high quality' ??????????????
# Q: how distinguish RF or PPR-RF from RFL ????? Is idea here, these two co-locate ???? Functional markers for actual RF genes yet to be identified ?????


01/30/18:
## talked to vikas yesterday.
i. from Fujii, 2011 paper, table S1, set up runs of
--orthoMCL & 
--ML phyml 
with following seqs
## 820 'P' proteins prevly used
## table S1 arabidopsis (dicot), brachypodium (monocot as is wheat), & soybean (dicot) RFL seqs. Try dnload these seqs from ensembl in *'bulk'* if can figure how to do?
ii. check sykes paper for additional RFL seqs to use here
iii. run orthoMCL & phyML each twice, once for 3 + wheat (820 P), once for brachy + wheat (820 P).

01/31/18:
## From ftp://ftp.ensemblgenomes.org/pub/plants/release-38/fasta/brachypodium_distachyon/pep/ got Brachypodium_distachyon.v1.0.pep.all.fa (31029 '>' lines). 
# Q: to try, from table S1 of Fujii (2011 paper), subset the 9 brachy seqs from the '.fa' file ???????
# finding 1st two of 9 brachy protein seqs from S1 table in the brachy '.fa' file. 
# did vikas have a script, if provide names, will get that subset protein seqs from the .fa file ???????????????

## looks like ./getseq.awk
## example of use:
philip-terry-2:wheatproj bterry$ pwd
/Users/bterry/macbook2017/vikas17/wheatproj
philip-terry-2:wheatproj bterry$ find . -name 'PPRsec2_1562_Seqscolm.txt' -print
./PPRsec2_1562_Seqscolm.txt
## to do just put 9 brachy names in a file, run as following *example* vs :
## ./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa PPRsec2_1562_Seqscolm.txt > PPRhmmsearchsubset.fa

02/03/18:

# slip a save to ***github*** in here
cd ~/planets
git status
git add wheatprojdoc060117.txt
git commit -m "update 02/03/18 wheatprojdoc060117.txt"
git status
git push origin master
# git remote -v

STOPPED

02/04/18:
## finish reading Sykes paper, checking if additional RFL's can include in (see 0/30/18 above)
## Comments:
i) would any of this Sykes pipeline be helpful for us at this point?
ii) perhaps check fujii, 2011 list, table S1, with sykes sup. table 1, see how compares, if any proteins want to use from Sykes?  

cd /Users/bterry/macbook2018/vikas18/131RFlike
#cat bracky9_3colms.txt|perl -pe 's/.+(Br.+).1/\1/' | head -n 9 > bracky9names.txt
cat bracky9_3colms.txt|perl -pe 's/.+(Br.+)/\1/' | head -n 9 > bracky9names.txt
tr '[a-z]' '[A-Z]' < bracky9names.txt > bracky9namesCAPS.txt

./getseq.awk Brachypodium_distachyon.v1.0.pep.all.fa bracky9namesCAPS.txt > bracky9names.fa
 
02/06/18:
Dnloaded Glycine_max.Glycine_max_v2.0.pep.all.fa.gz from ftp://ftp.ensemblgenomes.org/pub/plants/release-38/fasta/glycine_max/pep/
## expanded yielded
-rw-rw-rw-@ 1 bterry  staff    54M Feb  5 10:09 Glycine_max.Glycine_max_v2.0.pep.all.fa
## gene names closest to Fujii (2011) table S1 soybean names. For example, 

>KRH43692 pep chromosome:Glycine_max_v2.0:8:12977614:12982018:-1 gene:GLYMA_08G164800 transcript:KRH43692 gene_biotype:protein_coding transcript_biotype:protein_coding description:hypothetical protein

## so, appears an *extra* '_' in the gene names compared to Fujii, 2011,table S1.
$## tried 5 names, only 1 of 5 found in soybean .fa file ???????????? Had to make all caps, & put in '_' 1st.
# Q: note place to 'update your ensembl IDs. Fujii paper from 2011, 6-7 years ago ???? Phytozome v4.0 source for G. max ?????????

Try dnload arabidopsis.t
-rw-rw-rw-@ 1 bterry  staff    32M Feb  5 11:45 Arabidopsis_thaliana.TAIR10.pep.all.fa
-rw-rw-rw-@ 1 bterry  staff   9.3M Feb  5 11:44 Arabidopsis_thaliana.TAIR10.pep.all.fa.gz

48322 '>' in .fa file

Differences betw format of name betw Fujii 2011 table S1 & arabidopsis .fa file. BUT, note, .fa file lists for ex., at least *3* tx's for gene name AtPPR_1g06580 (tab S1), AT1G06580 in .fa file.

02/06/18:
## talked to vikas
i. resume search for soybean seqs as follows:
https://soybase.org/dlpages/, try submit list of 41 soybean genes from Fujii, 2011,table S1.
I note, could fail for reasons like the case of the letters in the names, etc. The genome soybean genome I dnloaded above from ensembl had such issues.

cat bracky9_3colms.txt|perl -pe 's/.+(Br.+)/\1/' | head -n 9 > bracky9names.txt
tr '[a-z]' '[A-Z]' < bracky9names.txt > bracky9namesCAPS.txt

cat soybean41Fujii2011.txt|perl -pe 's/.+(Gly.+)\t.+/\1/' | head -n 41 > soybean41Fujii2011names.txt
## At https://soybase.org/dlpages/#genecallcorrespondence site, 1st did 
## Gene Model Correspondence Lookup
## result, 38 of 41 found a name for Wm82.a2.v1 version. Note several names found more than 1 name for this version ?????????
## anyway, **PERHAPS** take these 38 names (instead of submitted ones), submit these names to 'Download longest transcript or predicted protein sequence for gene calls' section of soybean site.
## 1st, need isolate the 4th column from soybase.org_correspondence_methods.csv. Deleted 3 rows wi 'no correspondence'. Tabbed where apparent 'tab' missing ???????? Deleted 1st 3 rows. New name: Glyma4vernames.txt
Now, use perl -pe script
cat Glyma4vernames.txt|perl -pe 's/.+(Glyma\..+)/\1/' | head -n 38 | perl -pe 's/(.+),/\1/' | head -n 38 > Glyma_ver2.0names38.txt

cat Glyma4vernames.txt|perl -pe 's/.+(Glyma\..+,)/\1/' | head -n 38 | perl -pe 's/(.+),/\1/' | head -n 38 > Glyma_ver2.0names38.txt

## unclear what to do, absence '.' several version 2 names, perl -pe can't work ok ???
## need clarify what **want** to do ???????????????????

's/.+\,.+\,\t(Gly.+)\,.+/\1/'
's/.+,.+,.+(Gly.+),.+/\1/'
's/.+(Glyma\..+)/\1/'
's/(.+),/\1/'

02/07/18:
https://soybase.org/dlpages/#dnarna
## https://www.arabidopsis.org/download/index-auto.jsp?dir=/download_files/Proteins
## tair, not used.
## test downloaded 1st soybean v.2 name, appears to have provided two transcripts for that gene

## continue with arabidopsis
## from 02/06/18 above have 
-rw-rw-rw-@ 1 bterry  staff    32M Feb  5 11:45 Arabidopsis_thaliana.TAIR10.pep.all.fa
## from Fujii, 2011, have arab26fujii2011.txt.
## isolate colm 3, 'ID in gene models' (perl -pe)
cat arab26fujii2011.txt|perl -pe 's/.+(AtPPR.+)/\1/' | head -n 3 | perl -pe 's/(.+)\t.d/\1/' | head -n 3
  > Glyma_ver2.0names38.txt
 ## preceding failed ???????????????? 

bbedit: .+(At)PPR_(.+)\t\d to arab26fujii2011.txt
replace was \1\2.1
## new file name: arab26fujii2011names.txt
## check no repeats
sort arab26fujii2011names.txt |uniq  ## 26, originally not sorted, leave that way ????

## left, make names all CAPS
tr '[a-z]' '[A-Z]' < arab26fujii2011names.txt > arab26fujii2011namesCAPS.txt
## now ready for getseq.awk

cp two files to .../arabidopsistuff dir.
Arabidopsis_thaliana.TAIR10.pep.all.fa, Arabidopsis_thaliana.TAIR10.pep.all.fa.gz, & getseq.awk
cd /Users/bterry/macbook2018/vikas18/131RFlike/arabidopsistuff

./getseq.awk Arabidopsis_thaliana.TAIR10.pep.all.fa arab26fujii2011namesCAPS.txt > arab26fujii2011names.fa
## all but >AT1G62915.1 (167 aa's) have lengh ~ 490 range or more

02/08/18:

## back to soybean
## file used to manually select RFlike names originally from Fujii, 2011, table S1, Glyma_Correspondence_Report_20180207232909.csv. Need display in excel due to fact only these, can easily see which names in v2 column. **But wait**, the internet site does this **better** than excel, https://www.soybase.org/correspondence/index.php
## Puts multiple ver2 hits in same colm, **easier** to see.

## so new file with manually selected ver2 name for Fujii, 2011 soybean names will be soybean41to_ver2names38.txt.

02/09/18:

## now, submit this file to https://soybase.org/dlpages/#dnarna, 'Download longest transcript or predicted protein sequence for gene calls' section using soybean41to_ver2names38.txt file.

## resulting soybean41to_ver2names38.txt.prot.fa file has 54 '>' lines (apparently getting muliple isoforms ??????????
## to do, try bbedit reg expn, on soybean41to_ver2names38.txt, add '.1.p' at end to input file. then run this with getseq.awk on soybean41to_ver2names38.txt.prot.fa to get new '.fa' file with just '.1.p' isoform (hopefully dowm from 54 '>' lines to '38 lines ?????

soybean41to_ver2names38.txt => soybean41to_ver2names38dot1dotp.txt (done)

./getseq.awk soybean41to_ver2names38.txt.prot.fa soybean41to_ver2names38dot1dotp.txt > soybean41to_ver2names38dot1dotp.fa

## Finally ready for orthoMCL runs, tho 1st shorten .fa file '>' names, then for 1st orthoMCL run, 
http://orthomcl.org/orthomcl/proteomeUpload.do

## talked to vikas, comments
i. would like copy of Fujii, 2011 names submitted to Glyma 1.1 to Glyma2.0 Correspondence Lookup at https://soybase.org/dlpages
ii. would like both orthoMCL * ML phylogeny on each of the combinations
--820 + bracky9 + rice9
--820 + bracky9 + rice9 + arabidopsis26 + soybean38

iii. ML phylogeny
--820 + bracky9 + rice9
--820 + bracky9 + rice9 + arabidopsis?? + soybean38

## so next, get the .fa files **together**, check for need shorten '>' names
/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl

arab26fujii2011names.fa
bracky9names.fa
soybean41to_ver2names38dot1dotp.fa

## ref line 674
/Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqsPPRhmmsearchsubset_P_prots820.fa
## names *short* enough, just the wheat names

## rice9 ????
## From /Users/bterry/macbook2017/vikas17/wheatproj/hmmpipeline/FRprotseqs/phyml/pyML829
## copy FRknownseqs_shtname_9.fa file. Has short names *already*.
## ref., 'cat', line 1352

02/10/18:

## still need shorten '>'names in .fa files for arabidopsis26, bracky9 & soybean38 ?????
## ref. p-28, haddock, example: (>\w+).+\[(\w+).+

arab26fujii2011names.fa =bbedit=> arab26fujii2011namesshort.fa
(>\w+\.\d).+
\1\r
grep -c "^>" arab26fujii2011namesshort.fa   # 26 as expect
sort arab26fujii2011namesCAPS.txt |uniq | wc -l  ## 26

bracky9names.fa  =bbedit=> bracky9namesshort.fa
(>\w+\.\d).+
\1\r
grep -c "^>" bracky9namesshort.fa   # 9 as expect
sort bracky9namesCAPS.txt |uniq | wc -l  ## 9 

## last, 
soybean41to_ver2names38dot1dotp.fa =bbedit=> soybean41to_ver2names38dot1dotpshort.fa
(>\w+\.\w+\.\d).+
\1\r
grep -c "^>" soybean41to_ver2names38dot1dotpshort.fa   # 38 as expect
sort soybean41to_ver2names38dot1dotp.txt |uniq | wc -l  ## 38

## yet to *cat* input files for orthoMCL ????? see line 1995 for orthomcl ????
--820P + bracky + rice
--820P + bracky + rice + soy + arab

cat PPRhmmsearchsubset_P_prots820.fa bracky9namesshort.fa FRknownseqs_shtname_9.fa > p820br9rice9.fa
grep -c "^>" p820br9rice9.fa  ## 820+9+9=838 as expect

## finally, ready run orthoMCL online (ref. line 1995)
submitted: 02/10/18, 7:36pm.
Job name: p820br9rice9_021018
Sequence file uploaded: p820br9rice9.fa
Email: pterry@huskers.unl.edu

/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/orthomclResult-4HHT9B3DDQF7/orthologGroups
## Q:s
i. what can say about orthoMCL group wi +ve controls in it ????????
ii. 'osat' or 'rcom' ??????
iii. seq ID of best hit (do these hits relate to specific protein ???????)
iv. difference, %ID & %match ????????????????????
v. for orthomcl_group OG5_131220, containing the bracky9 & rice9 'controls', total 153 occurrences. Subtract 153 - 18 = 135 wheat seqs (matching the 135 from last summer).
vi. p-6.12.3, ***where*** access OrthoMCL-DB Web site to learn about 'orthomcl_groups' of interest ???
vii. should one rerun with 1545 seqs following PPR.hmm or even the 110,000 before PPR.hmm ???

cat PPRhmmsearchsubset_P_prots820.fa bracky9namesshort.fa FRknownseqs_shtname_9.fa soybean41to_ver2names38dot1dotpshort.fa arab26fujii2011namesshort.fa > p820br9rice9soy38arab26.fa
grep -c "^>" p820br9rice9soy38arab26.fa  ## 820+9+9+38+26=902 as expect

## finally, ready run orthoMCL online (ref. line 1995)
submitted: 02/10/18, 10:29pm
Job name: p820br9rice9soy38arab26_021018
Sequence file uploaded: p820br9rice9soy38arab26.fa
Email: pterry@huskers.unl.edu

02/11/18:
/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/orthomclResult-2PSJAXREJR6L/orthologGroups
## Q:s
i. several of the +ve controls are in orthogroup **different** from OG5_131220 ??????
ii. tried google search for NP_001052533, but no hits.
iii. google OG5_131220, hitting PPR proteins.
iii. 210 OG5_131220 rows in orthoGroups output file for p820br9rice9soy38arab26.fa input file. Could check how many are wheat proteins. Estimate ~ 130 without actually counting.
iv. tried google another of the soybean orthogroups, OG5_170290, hitting a 'pentatricopeptide (PPR)' protein.

## NOTE: ORTHOMCL only compares input protein seqs to PRE-BUILT orthogroups. Melonek, sci reports paper, p-9, OrthoMCL-DB web site, (www.orthomcl.org/orthomcl/). Q: what all can do there ??? If use ML phylogeny, ALL input seqs processed compared to orthomcl. WHAT does CD-Hit do ?????????

TO TRY: orthomcl run with 1545 wheat seqs ?????
find . -name 'PPRhmmsearchsubset.fa' -print
## copied PPRhmmsearchsubset.fa to /Users/bterry/macbook2018/vikas18/131RFlike/orthomcl

grep -c "^>Tr" PPRhmmsearchsubset.fa  ## 1545

02/12/18:

## to create the two .fa (cat) file with 2 & 4 +ve ctl species for orthomcl & the 1545 .fa file ??
cat PPRhmmsearchsubset.fa bracky9namesshort.fa FRknownseqs_shtname_9.fa > p1545br9rice9.fa
grep -c "^>" p1545br9rice9.fa  ## 1545+9+9=1563 as expect

## finally, ready run orthoMCL online (ref. line 1995)
submitted: 02/12/18, 10:24pm.
Job name: p1545br9rice9_021218
Sequence file uploaded: p1545br9rice9.fa
Email: pterry@huskers.unl.edu

02/13/18:
/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/orthomclResult-UUSGQP3LHON2/orthologGroups
# in bbedit,
##  Tr.+\.[2-9].+
## 86 'Tr' rows != '.1', total 'Tr' rows = 1545
## Tr.+\.[^1].+  ## not working ??????????
## so, in OG5_131220 orthogroup are 
154 - 18 (ctl's) = 136 'Tr' rows in orthogroup OG5_131220, so similar number to all the prev. orthomcl runs.

## vikas Q: on isoforms:
## 86 in [2-9] for 'Tr...\.d', only ~ 2 in OG5_131220 orthogroup, so, if this orthogroup the identifier for RF-like seqs, & '.1' refers to 1st isoform, then ~ only 2 of these higher than '.1' isoforms are RF-like seqs. 1459 ('.1') + 86 (!='.1') = 1545. So accounts for all the seqs input to orthomcl.

## check actual 86, if in OG5_131220
## rename orthologGroups file to orthologGroups86.txt
## (Tr.+\.[2-9]).+  ## finds '86'
## replace: \1
## message says replaced, but 'where are new 86' ???????????
## (Tr\w+\.[2-9]\t\w+).+
## \1
## did replacement, but left all rest in place ????????????

grep -c "Tr\w+\.[2-9]\t\w+.+" orthologGroups86.txt  ## , so *fails*  ????????????
grep -c '\.[2-9]' orthologGroups86.txt  ## 86, ok.
grep '\.[2-9]' orthologGroups86.txt > test86.txt
## bbedit test86.txt for OG5_131220 orthogroup returns only 3 rows
## so, looking like 86 .[2-9] rows except for 3 not RF-like seqs.
## finally, note, *all* 18 +ve ctl's in orthologGroups86.txt associated with orthogroup OG5_131220, the one assoc'd with the +ve ctl's in the previous orthMCL runs.

## still create, submit to orthomcl p1545br9rice9soy38arab26.fa
cd /Users/bterry/macbook2018/vikas18/131RFlike/orthomcl

cat PPRhmmsearchsubset.fa bracky9namesshort.fa FRknownseqs_shtname_9.fa soybean41to_ver2names38dot1dotpshort.fa arab26fujii2011namesshort.fa > p1545br9rice9soy38arab26.fa
grep -c "^>" p1545br9rice9soy38arab26.fa  ## 1545+9+9+38+26=1627 as expect

## finally, ready run orthoMCL online (ref. line 1995)
submitted: 02/13/18, 7:54pm
Job name: p1545br9rice9soy38arab26_021318
Sequence file uploaded: p1545br9rice9soy38arab26.fa

## Note: only 3 '.2' seqs in **orthoMCL131.fa**, rest are '.1' tx.

02/14/18:

/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/orthomclResult-X5O8LRIX5OBA/orthologGroups
## number rows = 1627 as expect
## total 211 OG5_131220 orthogroup rows in file from p1545br9rice9soy38arab26.fa. With 82 'ctl' rows, 211 - 82 = 129 *max* possible rows with OG5_131220 & wheat sequence.

## check 'ctrl' rows for orthogroup: I note a few not with OG5_131220. So, try grep them out for closer look.
grep -v 'Tr' orthologGroups1545_4crtl.txt > test4ctrl82.txt
## 6 of 82 not OG5_131220. 3 in soy, 3 in arab. The 6 are all *different*.

## check wheat rows for not '.1'.
grep -c '\.[2-9]' orthologGroups1545_4ctrl.txt  ## 86, ok.
grep '\.[2-9]' orthologGroups1545_4ctrl.txt > test1545_4ctrl86.txt
## only **3** of the 86 **non** '.1' wheat seqs are in orthogroup OG5_131220 ?????????

## conclude, even starting with 1545 wheat seqs for orthoMCL, only get ~ 129 RF-like seqs, similar to the result starting with 820 'P' proteins.
## Q: diff from melonek 207 number. So far, don't have an explanation. 
## unless a bunch of the non OG5_131220 orthogroups associated with the ~ 75 non '.1' wheat seqs, upon checking, would turn out to be RF-like seqs. A visual check looks like **don't** have many if any in common ??????
## BUT THE 75, ***APPROX*** the DIFFerence betw. 130 & 207 OF MELONEK ?????????????

TO DO: THIS CHECK FOR THE 820P RUNS ????

TO DO: PERHAPS CHECK SOME OF THESE ORTHOGROUPS ARE RF-LIKE REFERENCES ????

## CHECK IF EACH OF THESE [2-9] SEQS SHARE A NAME WITH A WHEAT '.1' SEQ ??????

## talked to vikas
i. check 7 orthogroups found mapping to at least one ctrl (arab or soy), to see if map to any wheat sequence ???????
cd /Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/orthomclResult-X5O8LRIX5OBA

## for orthologGroups1545_4ctrl.txt file, 6 of 7 hit no wheat proteins, one hit 3 (OG5_170290). They are all on chromosome one:

TraesCS1A01G060500.1	OG5_170290	osat|NP_001047166	0	-181	48	100
TraesCS1B01G078800.1	OG5_170290	osat|NP_001047166	0	-181	48	100
TraesCS1D01G061400.1	OG5_170290	osat|NP_001047166	0	-181	48	100


02/15/18:
## to check for 820+4ctrl species ????
cd /Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/orthomclResult-2PSJAXREJR6L

grep -v 'Tr' orthologGroups820_4ctl.txt > test820_4ctrl82.txt
for orthologGroups820_4ctl.txt file, 6 of 7 hit no wheat proteins, one hit 3 (OG5_170290).

## Q: do google search for this orthogroup name. MpPPR_24 	'Pentatricopeptide repeat' proteins. In PFAM, hits PF01535 (and 2 others, all PPR repeat). PF01535 same pfam hit by OG5_131220. So these additional 3 wheat seqs in previous 820 'P's & 1545 group, listed above, all on chromosome one. 
## SO, PRESUME **INCLUDE** IN TENTATIVE RF-like seqs (that is, add to the 131) since tyey map to RF-like control seqs. BUT, HITTING STUFF NOT LABELED RF-like. Perhaps include, later may remove, I note they located on chr 1,

02/16/18:
## saved to github

## TO DO, send email to vikas with this result. (done)

ii. do ML phylogeny (follow steps in vikas 'Notes ...' file for 820P & 1545 with 2 & 4 ctrl species above. See if can isolate additional wheat seqs as RF-like?

## reference (11/30/17)
##  line 4512, now, for (ii), 'Notes' for 131, **plus** vikas6, 

cd /Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/p820br9rice9soy38arab26.fa
## 902 seqs, 
## Q: >Gl... rows not wrapped at 70 as rest of seqs ????

## Now run Notes steps ... 

## need new dir on crane to do 1st three steps, muscle, fasta2stockholm.pl, & hmmbuild.

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir p820br9rice9soy38arab26
cd p820br9rice9soy38arab26
## scp p820br9rice9soy38arab26.fa to crane, dir = p820br9rice9soy38arab26
logout
## now for slurm_muscle_wheatproj_p820br9rice9soy38arab26.sh
## edit, then scp (done)

cd 
/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/phyml/p820br9rice9soy38arab26

scp p820br9rice9soy38arab26.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
## cp slurm_muscle_wheatproj_refin131vikas6.sh to slurm_muscle_wheatproj_p820br9rice9soy38arab26.sh

scp slurm_muscle_wheatproj_p820br9rice9soy38arab26.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm (see line 4541)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_p820br9rice9soy38arab26.sh
ls -lh
sbatch slurm_muscle_wheatproj_p820br9rice9soy38arab26.sh 11716409 2:09pm =>

squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          11716409     batch TJob_mus   pterry PD       0:00      1 (Priority)

             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -lh
less job.11716409.err
sacct -j  11716409 -o start,end
              Start                 End 
------------------- ------------------- 
2018-02-16T14:23:25 2018-02-16T15:19:31 
2018-02-16T14:23:25 2018-02-16T15:19:31 
15:19:31 - 14:23:25 = 65min 06 sec

less p820br9rice9soy38arab26.fa.aln  ## looks to be *in* MSA fasta format.

## next, fasta2stockholm.pl conversion (line 4567)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -lh
#cd ..
#cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl p820br9rice9soy38arab26.fa.aln > p820br9rice9soy38arab26.fa.aln.slx
ls -al
-rw-r--r--  1 pterry amundsen 3400034 Feb 16 19:28 p820br9rice9soy38arab26.fa.aln.slx

## to check top stockholm file
less p820br9rice9soy38arab26.fa.aln.slx

## now for *hmmbuild*

## see 11/30/17 above (line 4593)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -lh

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26

hmmbuild p820br9rice9soy38arab26.fa.aln.hmm p820br9rice9soy38arab26.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             p820br9rice9soy38arab26.fa.aln.slx
# output HMM file:                  p820br9rice9soy38arab26.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     p820br9rice9soy38arab26.fa.aln   902  3748   738    18.65  0.590 

# CPU time: 3.65u 0.02s 00:00:03.67 Elapsed: 00:00:03.72
exit
less p820br9rice9soy38arab26.fa.aln.hmm

#head -n 17 orthoMCL131vikas6.fa.aln.hmm

## refer (12/01/17, p-4623)

## realign using hmm model, hmmalign  (line 4632)
mv  slurm_hmmalign_wheatproj_refinorthoMCL131vikas6.sh slurm_hmmalign_wheatproj_p820br9rice9soy38arab26.sh
## slurm file prepared
cd /Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/phyml/p820br9rice9soy38arab26

scp slurm_hmmalign_wheatproj_p820br9rice9soy38arab26.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

STOPPED

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_refinorthoMCL131vikas6.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_p820br9rice9soy38arab26.sh 11723687  10:19am => ??:??am, 
squeue -u pterry  ## a ST
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          11723687     batch TJob_hmm   pterry PD       0:00      1 (Priority)

             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
             
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -lh
-rw-r--r-- 1 pterry amundsen 7.8M Feb 16 22:22 p820br9rice9soy38arab26.fa.aln.hmmaln

sacct -j  11723687 -o start,end
              Start                 End 
------------------- ------------------- 
2018-02-16T22:20:39 2018-02-16T22:22:01 
2018-02-16T22:20:39 2018-02-16T22:22:01 
22:22:01 - 22:20:39 = 1 min 22 sec 

less p820br9rice9soy38arab26.fa.aln.hmmaln  ## # STOCKHOLM 1.0 format MSA

## next, stockholm2fasta.pl conversion (line 4653)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -al

#cd ..
#cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x  1 pterry amundsen    1398 Feb 16 23:21 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g p820br9rice9soy38arab26.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > p820br9rice9soy38arab26.fa.aln.hmmaln.fa

ls -al
less p820br9rice9soy38arab26.fa.aln.hmmaln.fa

grep -c ">Traes" p820br9rice9soy38arab26.fa.aln.hmmaln.fa  ## 820 as expect
grep -c ">" p820br9rice9soy38arab26.fa.aln.hmmaln.fa  ## 902 as expect
exit
logout

## now fas to phy (line 4682)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl p820br9rice9soy38arab26
cd p820br9rice9soy38arab26
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
module load bioperl

./align_convert_fas_to_phy.pl p820br9rice9soy38arab26.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r--  1 pterry amundsen 1013773 Feb 16 23:43 p820br9rice9soy38arab26.fa.aln.hmmaln.phy
exit
less p820br9rice9soy38arab26.fa.aln.hmmaln.phy
 902 768
'TraesCS5D01G097800.1'  ------PTTH FTPSQAHAAA TSHHPAAA-- AAAATATARL HASASASAPA AAAALCPPFL 
logout

02/17/18:

## scp back to macbook, (line 4707)

cd /Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/phyml/p820br9rice9soy38arab26

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26/p820br9rice9soy38arab26.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  1013773 Feb 17 18:04 p820br9rice9soy38arab26.fa.aln.hmmaln.phy

less p820br9rice9soy38arab26.fa.aln.hmmaln.phy

head -n 4 p820br9rice9soy38arab26.fa.aln.hmmaln.phy
  902 738
'TraesCS5D01G097800.1'  ------PTTH FTPSQAHAAA TSHHPAAA-- AAAATATARL HASASASAPA AAAALCPPFL 
 
## so phy header  902 768, expect the 902

Then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: 
/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/phyml/p820br9rice9soy38arab26/p820br9rice9soy38arab26.fa.aln.hmmaln.phy

Data type: aa's
Still, no bootdstrap, rather aLRT

Name: p820br9rice9soy38arab26_021718

The alignment file "p820br9rice9soy38arab26.fa.aln.hmmaln.phy" was uploaded, it contains 902 taxons of 738 characters.

Your job was submitted. (6:16pm)

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20180218-011554_Ub55/cmd.txt


STOPPED

02/19/18:
Dnloaded from http://www.atgc-montpellier.fr/phyml/results.php?path=20180218-011554_Ub55/sms.csv
## new location:
/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/phyml/p820br9rice9soy38arab26/p820br9rice9soy38arab26_fa_aln_hmmaln_phy_phyml.zip

## Running **time**: 1 day 13 hrs

/Users/bterry/macbook2018/vikas18/131RFlike/orthomcl/phyml/p820br9rice9soy38arab26/p820br9rice9soy38arab26_fa_aln_hmmaln_phy_phyml/p820br9rice9soy38arab26_fa_aln_hmmaln_phy_phyml_tree.txt

## transfer tree file to 'pro'

in figtree
Initially asked select a name for node values, gave aLRT

tree/midpoint
'Node labels', (display aLRT, format=%, sig. digits =2, for now left on 2)
## on taxa 
BR = red, Gly = pink, rice(AB) = green arab(AT) = yellow, these +ve ctls group to the left of circular phylogram. Red & pink sort of group together, yellow near pink. but note, some dispersal of a few mostly yellow & green ?????????????????????
## now highlighting chr 1, 2, 6 in turn
## they pretty much **spread around** the circular phylogram  ???????????????????
## PERHAPS SHOULD NOT HAVE USED **ALL** SEQS IN p820br9rice9soy38arab26.fa FOR hmmbuild ?????????????
## working with p820br9rice9soy38arab26_fa_aln_hmmaln_phy_phyml_tree.txt file, red [=] TraesCS1, chr 1. green [=] TraesCS2, chr 2, purple [=] TraesCS6, chr 6.

## talked to vikas:
i. mentioned wheat seqs in p820br9rice9soy38arab26 phylogram **spread around** the circular phylogram. He suggested could be wheat seqs more closely related to selves than the other species ???????????

02/20/18:
ii. blast 131+3 'genes' of the RF-like genes vs 110,000 genes. Not protein-protein. Det. which blast need. See if can identify any more RF-like seqs. Note: **only** did 131 HERE

## which blast: ??????????

iii. subset ~ 110,000 wheat genome protein seqs using 131+3 RF-like genes (remove '.d' before search). When get, look for '.d' hits where 'd' = [2-9]. See if the number is in ~ 75 count, and what 'orthoGroup' they map to, if to PPR annotation.

## from line 4990 above
#bash Philip_5colmgff3.sh orthoMCL131namesnodotnum.txt > gff3_1345_9names_131.txt  ## ok
## perhaps test if 110,000 wheat genome protein file has names with '.d' following gene name, presumably would not make any difference to this bash script query  ????????

## Note, if gff3 file had '.d' name extensions, should have found duplicate rows. But still without them, if they existed, then why don't have more than 131 rows in output subset file ??????

## vs 110,790 seq '.fa' file (iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa), grep, see if get some rows with '.d' extensions ?????????
## working from dir /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9
grep -c '>' iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa  ## 110790, as expect
grep -c '\.[2-9]' iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa  ## 8970
grep -c '\.1' iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa  ## ## 101820

## 1st, perhaps for the 110,790 '.fa' file, run this query file (orthoMCL131namesnodotnum.txt) against it with bash script. So, modify Philip_5colmgff3.sh to Philip_iwsgc131.sh

bash Philip_iwsgc131.sh orthoMCL131namesnodotnum.txt > iwsgc131names.txt
## finds 3 names with '.2', each unique. So, for these RF-like names, iwsgc '.fa' file does not have dupl names with differing '.d' endings.

## Could run these 131 names vs the non '.1' rows from 1545 run with orthoMCL, check if any of the 131 names match these names ?????  Rule out these [2-9] as having same name as any of the 131 ????

02/21/18:
talked to vikas, library
i. vikas to get new wheat gene seqs file
ii. vikas to get all proteins file (my attempt to find additional seqs of same name as 131 doomed to fail, as REPR iwgsc file only has one seq each protein **by definition**.
iii. gene expression for 131+3 (vikas think start this). He to get info how to do ??
iv. note 'private' blast for URGI (vikas can do), Q: should I sign up to do ???????

02/23/18:
## received vikas email on 2/21/18 with info on preceding questions.
## check /home/baenziger/shared/pterry for
--CDS seqs, both repr & all-variants. Suggest use repr CDS for 1st set blast search (Q: URGI private blast, or crane (blastn?), or what ???????????)
## Q: will I '131 subset' the CDS db 1st, then blast the subset '.fa' file vs the db ?????????
## to make available for viksas, the 131 subset '.fa' file, so he can test the online 'private' URGI blast tool.
## look for the all-protein file. Retry to subset based on the 131 'names'.
## check the README file for more info.
## he has 'shared' dir on 'home'  ???????

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /home/baenziger/shared/pterry  ## so NOT on work dir  ???????????????
## BUT found above: /work/baenziger/shared/terry/hmm
cd /work/baenziger/shared/terry
## so try both ???????
## so I put Rmd on work dir (???????????????????)
## but work dirve subjet to deletion, probably not good place for Rmd file ??????
ls -al

## scp back to macbook

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp pterry@crane.unl.edu:/home/baenziger/shared/pterry/iwgsc_refseqv1.0_README.pdf .
ls -al
-rw-r--r--   1 bterry  staff    318861 Feb 23 11:23 iwgsc_refseqv1.0_README.pdf

scp pterry@crane.unl.edu:/home/baenziger/shared/pterry/iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip .
ls -al
-rw-r--r--   1 bterry  staff  42085055 Feb 23 11:48 iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip


md5 iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip
MD5 (iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip) = 456a8a62bcc7a513e84e92be0aaed78c

less iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa
head -n 10 iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa
>TraesCS1A01G000100.1 gene=TraesCS1A01G000100
ATGCGCGTGATCGCGCTATCTGCCGGGGTTACCCCGTCCCTTAGGATCGGCTTACCCATG
TGCAAGTGCCGTTCACATGGAACCTTTCTCCTCTTCGGCCTTCAAAGTTCTCATTTGAAT
ATTTGCTACTACCACCAAGATCTGCCGCGACGGCCGCTCTGCCCGGGCTCGCGCCCCGGG
TTTTGCAGCGGCCGCCGCGCCCTCCTACTCATCGGGGCATGGCGCTCGTCCAGATGGCCG
GGTGTGGGTCGCGCGCTTTAG
>TraesCS1A01G000200.1 gene=TraesCS1A01G000200

## so looks like could subset with the non '.d' 131 names and get the desired '131.fa' gene CDS.

#bash Philip_iwsgc131.sh orthoMCL131namesnodotnum.txt > iwsgc131names.txt
## rename Philip_iwsgc131.sh to Philip_iwsgc131_CDS.sh, modify inside file to iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa & run

bash Philip_iwsgc131.sh orthoMCL131namesnodotnum.txt > iwsgc131_CDSnames.txt
-rw-r--r--   1 bterry  staff       2879 Feb 23 12:15 iwsgc131_CDSnames.txt
-rw-r--r--   1 bterry  staff       2879 Feb 20 23:15 iwsgc131names.txt
## identical to output when ran vs iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa
## expected.

## next, getseq.awk to get 'fa file for CDS's seqs

#./getseq.awk soybean41to_ver2names38.txt.prot.fa soybean41to_ver2names38dot1dotp.txt > soybean41to_ver2names38dot1dotp.fa

## to do,

remove '>' from iwsgc131_CDSnames.txt (becomes query) => iwsgc131_CDSnames_minus1stchar.txt
## in bbedit, find box: >(\w+\.\d)  replace box: \1

then ready for 
./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa iwsgc131_CDSnames_minus1stchar.txt > iwsgc131_CDS_seqs.fa
ls -al
-rw-r--r--   1 bterry  staff     225890 Feb 23 15:55 iwsgc131_CDS_seqs.fa
## has 3797 lines

## next, get to vikas (do I need to shorten the '>' lines ????) to try with 

02/25/18:
## vikas tested iwsgc131_CDS_seqs.fa as query vs wheat genome db ('private blast'). Result like BLAT, the locations of the hits on the chromosomes, does not tell if underlying gene at the location.
## Suggeted alternative,BLASTN of the query against wheat CDS db. Try do up on crane.

## Searching in /Users/bterry/planets/BdactyloidesthruGSEA081615.txt, around line 498 for about 20 lines, note file slurm_8Trinitymakeblastdbexampdatacrane.sh in dir cd /Users/bterry/macbookpro2015/keenanres15/trintoGSEA/testing/tut
## and slurm_10Trinityblastnexampdatacrane.sh showing how did 'makeblastdb' & 'blastn'.

## See if can adapt for my task ???? Q: how megablast mentioned in slurm_10Trinityblastnexampdatacrane.sh ???????????????

02/26/18:
## at ncbi, blast page, support center, down bottom page, 'dnload' blast+, ver 2.71 latest.
## To check ver at HCC ?????

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/p820br9rice9soy38arab26
ls -al

module avail

blast/2.6   ## closest to current 2.7.1  ?????
## megablast ??????????????
## how useful my current slurm files ???????????
## try check with JJ ????

## talked to JJ:
## see pencil comments on two slurm templates
## suggest practice initially from unix command line
## email addr for JJ if want help on custom made format for output from blastn run
## bcrd-support@unl.edu

02/27/18:
# Initially find a dir. on crane to work in, place query & inpuit file there.
# create dir /work/baenziger/pterry/wheatproj/blast131vsiwsgcCDS
# copy query (iwsgc131_CDS_seqs.fa, check if already on crane, NO), & target db (file from 'home' 'shared' dir, /home/baenziger/shared/pterry, iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip).


ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj
mkdir blast131vsiwgscCDS
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
## on crane, copy CDS...zip to /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS 
cp  /home/baenziger/shared/pterry/iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip .
ls -al
 
unzip iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip
rm iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.zip
logout
cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp iwsgc131_CDS_seqs.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS

# Try make a makeblastdb slurm to produce 'target db'
# sample slurm file on 'pro' **only**. So scp that file up to crane

# from 'pro'
cd /Users/bterry/macbookpro2015/keenanres15/trintoGSEA/testing/tut
# file to transfer: slurm_8Trinitymakeblastdbexampdatacrane.sh
scp slurm_8Trinitymakeblastdbexampdatacrane.sh pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
# could then scp to mbook to edit

# from mbook:
cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS/slurm_8Trinitymakeblastdbexampdatacrane.sh .

02/28/18:
##########################################################################
## NOTE, ABOUT NOON, MBOOK2015 LOCKED UP. PUSHED START BUTTON TO CAUSE IT TO SHUT DOWN.
## SUBSEQUENTLY, DUO ON CELL PHONE CAN'T PERFORM 2ND STEP OF CRANE LOGIN ???????
## NEITHER MBOOK OR 'PRO' WORKS. CAN'T BRING UP THE GREEN CHECK SCREEN ON CELL PHONE ???
## SO PROBLEM BOTH LAPTOPS, THUS PERHAPS CELL PHONE IS PROBLEM ?????? DO APP UPDATE ON CELL PHONE. AFTER APP UPDATE, WORKING AGAIN.
########################################################################
# to do: edit slurm file, slurm_makeblastdb_iwgscCDS.sh

# now, arrange to run this slurm file

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_makeblastdb_iwgscCDS.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/



ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_makeblastdb_iwgscCDS.sh
ls -lh
sbatch slurm_makeblastdb_iwgscCDS.sh 11994615  1:05pm => ??:??am, 
squeue -u pterry  ## a ST
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          11994615     batch TJob_bla   pterry PD       0:00      1 (Priority)

             
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -lh
-rw-r--r--  1 pterry amundsen  12037764 Feb 28 13:10 iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.nhr
-rw-r--r--  1 pterry amundsen   1329596 Feb 28 13:10 iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.nin
-rw-r--r--  1 pterry amundsen  34119809 Feb 28 13:10 iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa.nsq
## so 3 new files as expect from makeblastdb

less job.11994615.out
Building a new DB, current time: 02/28/2018 13:10:03
New DB name:   /lustre/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS/iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa
New DB title:  iwgsc_refseqv1.0_HighConf_REPR_CDS_2017Apr03.fa
Sequence type: Nucleotide
Keep MBits: T
Maximum file size: 1000000000B
Adding sequences from FASTA; added 110790 sequences in 5.57137 seconds.
job.11994615.out (END) 

sacct -j  11994615 -o start,end
              Start                 End 
------------------- ------------------- 
2018-02-28T13:10:01 2018-02-28T13:10:10 
2018-02-28T13:10:01 2018-02-28T13:10:10 
13:10:10 - 13:10:01 = 9 sec

## now ready, prepare slurm file for blastn. Use slurm_makeblastdb_iwgscCDS.sh as starting template, new name: slurm_blastn131_iwgscCDS.sh

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_blastn131_iwgscCDS.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/



ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_blastn131_iwgscCDS.sh
ls -lh
sbatch slurm_blastn131_iwgscCDS.sh 12001430  6:02pm => ??:??am, 
squeue -u pterry  ## 
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          12001430     batch TJob_bla   pterry PD       0:00      1 (Priority)

sacct -j  12001430 -o start,end
              Start                 End 
------------------- ------------------- 
2018-02-28T18:03:01 2018-02-28T18:03:08 
2018-02-28T18:03:01 2018-02-28T18:03:08 
18:03:08 - 18:03:01 = 7 sec

wc -l iwsgc131_CDS.blastn
131 iwsgc131_CDS.blastn

TraesCS1A01G031600.1    TraesCS1A01G031600.1    100.000 1989    0       0       1       1989
    1       1989    0.0     3674
TraesCS1A01G031700.1    TraesCS1A01G031700.1    100.000 2226    0       0       1       2226
iwsgc131_CDS.blastn 
## 131 seqs in blastn output, as expect if set -max_target_seqs parameter to 1. All 131 have -evalue=1e-20.
## email to vikas, to get comment how would like to prioritize further options.

03/01/18:
## new blastn run, to omit -max_target_seqs parameter (JJ, allows blastn to output up to default number output hits).

## create new slurm, remove -max_target_seqs parameter, allow blastn to output up to default number of hit seqs.

## slurm_blastn131_iwgscCDS_defnohits.sh
## scp to crane

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_blastn131_iwgscCDS_defnohits.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## run script

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_blastn131_iwgscCDS.sh
ls -lh
sbatch slurm_blastn131_iwgscCDS_defnohits.sh 12038319  10:30pm => ??:??am, 
squeue -u pterry  ## 
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          12001430     batch TJob_bla   pterry PD       0:00      1 (Priority)

sacct -j  12038319 -o start,end
              Start                 End 
------------------- ------------------- 
2018-03-01T22:30:48 2018-03-01T22:30:55 
2018-03-01T22:30:48 2018-03-01T22:30:55 
22:30:55 - 22:30:48 = 7 sec

cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -al
## **overwrote** prev. iwsgc131_CDS.blastn (should have named iwsgc131_CDS_defnohits.blastn)
wc -l iwsgc131_CDS.blastn
4726 iwsgc131_CDS.blastn  ## only had 131 when '-max_target_seqs parameter to 1'.
less iwsgc131_CDS.blastn
## To do, scp this file back, examine.

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS/iwsgc131_CDS_defnohits.blastn .
## open, examine in bbedit
## for example, 1st 22 hits are vs 1st row of the 131 query. evalue = 0.0 for each. Q: bitscore, size varies thru the 22 rows ?????
## more generally, how try analyze this data ???????

03/02/18:
## some ideas for analyzing the data
i) consider evalue 1e-50 as 'matches of very high quality'
ii) in a series of 22 hits for 1st 131 query sequence, all evalues = 0.0. Bitscores vary from 3674 to 652, and '%ident'l matches' varies from 100 to  73.8%.
iii) looks like one could subset gff3 file with the 22 hits here, map the locations, here on chr 1 since all on that chr. Document pattern of location of hits for the 131 query seqs. Or, just take chr 1 location form the name of the hits. Compare the gff3 location of the query sequence with the location pattern for the 22 hits. Are the hits outside the location of the query sequence. Since the evalues are all 0.0, what might this say about RF-like genes?
iv) I note the 22 hits are listed in bitscore or %identity matches order on blastn output sheet. This not in location order on in this case chromosome 1.
v) In view of the preceding, what analyses should one do? For example, what might preceding say about evolution and RF-like sequences?


grep -c "^TraesCS1A01G031600" iwsgc131_CDS_defnohits.blastn  ## 22

grep -c "TraesCS1A01G031600" iwsgc131_CDS_defnohits.blastn  ## 43

## grep the two preceding (check with bbedit, why 2nd not 44)

grep "^TraesCS1A01G031600" iwsgc131_CDS_defnohits.blastn  > TraesCS1A01G031600_22.txt
cut -f1,2,3,4,5,9,11,12 TraesCS1A01G031600_22.txt > out22_8colm.txt
grep "TraesCS1A01G031600" iwsgc131_CDS_defnohits.blastn  > TraesCS1A01G031600_43.txt
cut -f1,2,3,4,5,9,11,12 TraesCS1A01G031600_43.txt > out43_8colm.txt

## for TraesCS1A01G031600.1, member of 131 seqs, all 22 hits are seqs in the 131. Suggests the 131 may be a subset of related seqs within the 110790 seqs in repr_CDS file. AND, subsets of the 131 are *closely* related to each other, but *not* to the whole 131!
## note: orthoMCL finds the 131, but does not subset within the 131.

03/03/18:

## perhaps can list the related *subsets*, & see how their locations are related ?????

## to find:
## Q: any hits in colm2 not in the 131? These may be additional RF-like seqs ????
## perhaps, cut colm 2 out, do sort|uniq, use bash script to subset it with 131 gene names. If not all seqs selected, unselected would be hits not to the 131?

## 1st, need cut colm 2 from iwsgc131_CDS_defnohits.blastn
cut -f2 iwsgc131_CDS_defnohits.blastn > iwsgc131_CDS_defnohits_colm2.blastn

sort iwsgc131_CDS_defnohits_colm2.blastn |uniq | wc -l  ## 148
wc -l iwsgc131_CDS_defnohits_colm2.blastn  ## 4726
# need check which not in 131? Perhaps, 1st, remove '.\d', see if still get 148
cat iwsgc131_CDS_defnohits_colm2.blastn|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 4726 > iwsgc131_CDS_defnohits_colm2nodotd.blastn
sort iwsgc131_CDS_defnohits_colm2nodotd.blastn |uniq | wc -l  ## *still* 148 > 131
sort iwsgc131_CDS_defnohits_colm2nodotd.blastn |uniq > iwsgc131_CDS_defnohits_colm2nodotd_148uniq.blastn

## so did R have a command to find differences between two vectors (setdiff(x,y), anything in x not in y)

## if vector (char vector), use as is ???????????????????????????????????????????????

## to remove \.\d from iwsgc131_CDSnames_minus1stchar.txt (131 rows), 1 of inputs to setdiff
cat iwsgc131_CDSnames_minus1stchar.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 131 > iwsgc131_CDSnames_minus1stchar_minus_dotd.txt

## the other input to setdiff, the 148 seqs, iwsgc131_CDS_defnohits_colm2nodotd_148uniq.blastn

## start R in rstudio

y131 <- read.delim("iwsgc131_CDSnames_minus1stchar_minus_dotd.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("the131"))
class(y131)

x148 <- read.delim("iwsgc131_CDS_defnohits_colm2nodotd_148uniq.blastn", header=FALSE, stringsAsFactors=FALSE, col.names=c("the148"))

class(x)148
#twelve <- setdiff(bluedf$blue, Ofinder_blue)
seventeen <- setdiff(x148$the148,y131$the131)
class(seventeen)
length(seventeen)  ## 12
write.table(seventeen, file="seventeen_newhits.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=FALSE)

## result: list of **17** gene names, appear to be in colm 2 of iwsgc131_CDS_defnohits.blastn, not in colm 1, the query seq names colm of the 131  (tho have not checked all definitively).

03/04/18:

## comments to this point:
i) from blastn run with '-evalue 1e-20', & 'default number of allowable hits per query sequence, found 17 new gene names in column 2 (hits column) not found in column 1 (query genes) using 'sort|uniq'. Note: intended '-evalue 1e-10' this run, but did not get it changed.
ii) will run blastn again using your -evalue 0. Is the following sequence correct, 10 > 0 > 0.01 > 1e-10 > 1e-50 > 0.0? Found URL (http://www.metagenomics.wiki/tools/blast/evalue) indicating value smaller than 0.01 can still be considered good hits for homology matches. This webpage says -evalue smaller than 1e-50 includes database matches of 'very high quality'.
iii) orthoMCL found approx 131 (or 134) RF-like sequences in one (or two) orthogroups. It appears blastn is able to subset these further. The evalues are quite low (0.0, or less than the 1e-50 of the webpage). Fow example, for the 1st query sequence, TraesCS1A01G031600.1, it 'hits' 21 sequences (in this case they are all part of the 131 query sequences). All these evalues are '0.0'. Perhaps one can subset the 131 by for example, removing these 22 as a subset, rerun blastn on remainder, and in this fashion generate related subsets of the 131. The hits are sorted by bitscore (or percent of identical matches) in the blastn output which does not match their location on the chromosome. Possibly by relating location, bitscore, membership in a subset, and later MEME motif, some understanding of evolutionary relationships among these RF-like sequences may be found?

 
## *next*, rerun blastn with 'evalue 0', followed by sort|uniq, count rows. Perhaps, do with evalue 0.01 since not sure what '0' means ?????????????????

## slurm_blastn131_iwgscCDS_defnohits_evdot01.sh
## scp to crane

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_blastn131_iwgscCDS_defnohits_evdot01.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## run script

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_blastn131_iwgscCDS_defnohits_evdot01.sh
ls -lh
sbatch slurm_blastn131_iwgscCDS_defnohits_evdot01.sh 12086533  6:58pm => ??:??am, 
squeue -u pterry  ## 
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          12086533     batch TJob_bla   pterry PD       0:00      1 (Priority)

             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

sacct -j  12086533 -o start,end
2018-03-04T18:58:30 2018-03-04T18:58:37 
2018-03-04T18:58:30 2018-03-04T18:58:37 
18:58:37 - 18:58:30 = 7 sec

cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -al
## **overwrote** prev. iwsgc131_CDS.blastn (should have named iwsgc131_CDS_defnohits.blastn)
wc -l iwsgc131_CDS_evdot01.blastn
4899 iwsgc131_CDS_evdot01.blastn

less iwsgc131_CDS_evdot01.blastn
## To do, scp this file back, examine.
cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9
scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS/iwsgc131_CDS_evdot01.blastn .

wc -l iwsgc131_CDS_evdot01.blastn
    4899 iwsgc131_CDS_evdot01.blastn
## 4899 - 4726 = 173 additional rows in blastn output
## 1st, need cut colm 2 from iwsgc131_CDS_evdot01.blastn
cut -f2 iwsgc131_CDS_evdot01.blastn > iwsgc131_CDS_evdot01_col2.blastn
wc -l iwsgc131_CDS_evdot01_col2.blastn
    4899 iwsgc131_CDS_evdot01_col2.blastn

sort iwsgc131_CDS_evdot01_col2.blastn |uniq | wc -l  ## 148

## so, **apparently** none of the additional 173 rows are unique compared to the 148 uniq found when using evalue 1e-20. Looking at a family of proteins, increasing the evalue to 0.01 just allows more hits from the 131 to be detected against the 148. So, the subsets thinking to identify may have additional hits, members? What to think? Anyway, the 17 non131 hits may be all the existing CDS's of this sequenced genome outside the 131?

03/05/18:
# updated github

## talked to vikas
i) subset rows from iwsgc131_CDS_evdot01.blastn using the 17 new hits (seventeen_newhits.txt). cut rows 2-12 from iwsgc131_CDS_evdot01.blastn, then run Philip... to do the subsetting on the 'hits' colm of iwsgc131_CDS_evdot01.blastn
ii) for the 17, locate them in iwsgc annotation file, see if names are PPR proteins?
iii) 1602, 1545, try setdiff these two, identify the 62 seqs by which they differ ??
iv) respond to vikas 'unl box' invitation

## ok, for the subset of iwsgc131_CDS_evdot01.blastn which have one of the 17 in colm 2:
## 1st cut colms 2-12 from iwsgc131_CDS_evdot01.blastn.
cut -f2,3,4,5,6,7,8,9,10,11,12 iwsgc131_CDS_evdot01.blastn > iwsgc131_CDS_evdot01_11colms.blastn

## now set up Philip_iwsgc131_CDScolm2_17subset.sh
## put iwsgc131_CDS_evdot01_11colms.blastn 'inside'.

bash Philip_iwsgc131_CDScolm2_17subset.sh seventeen_newhits.txt > iwsgc131_CDS_evdot01_11colms_17subset.blastn
wc -l iwsgc131_CDS_evdot01_11colms_17subset.blastn
     248 iwsgc131_CDS_evdot01_11colms_17subset.blastn

## could cut colm 11, eyeball for range of evalues
cut -f10 iwsgc131_CDS_evdot01_11colms_17subset.blastn > ev_of17.txt
## smallest see 1e-11 (rest 25 to 30 & smaller). How effectively display the distribution ?? histogram ?? Or, grep lines for each of 17 in turn, see if each has a tight distn, thus conclude variation betw the 17 wi regard to evalue ?????
## or, can one relate queries hitting each of the 17, see some patterns there ????
## perhaps, *next* go to annotation file, see name of each of the 17

# line 2151, annotation file in wheatgff3 dir, iwgsc_refseqv1.0_FunctionalAnnotation_v1__HCgenes_v1.0-repr.TEcleaned.TAB

03/06/18:
## copy seventeen_newhits.txt to seventeen_newhits_annotatn.txt. Note: all 17 from chr 1. For the non-PPR, sev'l have **similar** annotation. All non-PPR very close/adjacent to PPR genes. 

## Perhaps see if *relationship* betw. size of evalue & if annotation hit is PPR ??????
## subset each of 17 vs iwsgc131_CDS_evdot01_11colms.blastn, then take mean of evalue colm ??????????
## or, for 1 at time, just try grep ????????
grep "TraesCS1D01G076400" iwsgc131_CDS_evdot01_11colms.blastn  > TraesCS1D01G076400rows.txt

## doc what hit for nonPPR ??  To check: are all these 'response reg' diff. genes ?????

#Subset each of 17 in turn in with Philip_iwsgc131_CDScolm2_17subset.sh in file iwsgc131_CDS_evdot01.blastn. Try correlate query with fcn found in 'annotation' file for 'nonPPR' of the 17?
## now set up Philip_iwsgc131_CDS12colm_17subset.sh
## put iwsgc131_CDS_evdot01.blastn 'inside'.

bash Philip_iwsgc131_CDS12colm_17subset.sh seventeen_newhits.txt > iwsgc131_CDS_evdot01_12colms_17subset.blastn
wc -l iwsgc131_CDS_evdot01_12colms_17subset.blastn
     248 iwsgc131_CDS_evdot01_12colms_17subset.blastn

## now for the 11 of 17 **nonPPR** hits in seventeen_newhits_annotatn.txt in iwsgc131_CDS_evdot01_12colms_17subset.blastn, test what queries hitting them.
--TraesCS1A01G054600, 11 diff. queries hit this, so were the queries PPR seqs, note 'hits' appear to be in cluster of PPR?
--TraesCS1A01G055700, 11 diff. queries hit this, not the same 11 as for TraesCS1A01G054600 above.
--TraesCS1A01G057500, 19 diff. queries hit this
--TraesCS1A01G067100, 8 *diff.* queries hit this
## Next three have same queries in their '23' (Q: but the 'hit' seqs have diff. gene names ??) To check just these in annotation file [**TO DO**]
--TraesCS1B01G074800, 23 *diff* queries hit this
--TraesCS1B01G074900, 23 *diff* queries hit this
--TraesCS1B01G075100, 23 *diff* queries hit this
## Q: if compared genes within the subsets, would there be similar subsets ????? At least the immediate 3 above are the same.
--TraesCS1B01G075400, 6 *diff* queries hit this

--TraesCS1D01G055400, 2 *diff* queries hit this
--TraesCS1D01G056300, 12 *diff* queries hit this
--TraesCS1D01G069200, 20 *diff* queries hit this

## Summary of seventeen_newhits_annotatn.txt: 11 of 17 'nearPPR's'. 8 of these 'response reg' annotation. Similar 'Response reg' distribution thru chroms A, B, D.

03/07/18:
## vikas email response, several misunderstandings need clarification ?????
i) evalues match well, ok
ii) query coverage not checked for the 17 (or subset)?
iii) vicinity, the 11 physically close to annotated PPR genes, but have not checked if close to RF-like genes ?
iv) the 11 have nonPPR annotation ?
v) see seventeen_newhits_annotatn.txt to get overview
vi) show few of the annotation file for the 8 of 11, note, more duplication chrom B, the group of queries hitting 3 are identical!
vi) next ... following preceding 5 parts

## to proceed, 
a) phylogram, with 131 + 6 or more (of 17) + 3 (orthoMCL, 2nd orthogroup). If include (some or all of actually 11 with different annotation) ?????
b) phenogram (whole genome or by chromosome, perhaps both ???)


03/08/18:
## talked to vikas
i) Do check on 0.01 blastn run with 'coverage' calcn, incorporate custom outfmt line from Jean-Jack.
ii) next, run phylogram 131+3+16(?) depending result of (i) ??????
iii) (me), bunch phenograms of various sets of PPRs/RF-like prot. seqs

03/12/18:

## *next*, rerun blastn with 'evalue 0.01', followed by sort|uniq, count rows. This time, change outfmt to '-outfmt "7 qseqid sseqid stitle evalue pident length qlen slen mismatch gapopen qstart qend sstart send bitscore"'.


## slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt7.sh
## scp to crane

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt7.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## run script

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt7.sh
ls -lh
sbatch slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt7.sh 12208753  11:32am => ??:??am, 
squeue -u pterry  ## 
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          12208753     batch TJob_bla   pterry PD       0:00      1 (Priority)


sacct -j  12208753 -o start,end
2018-03-12T12:05:33 2018-03-12T12:05:39 
2018-03-12T12:05:33 2018-03-12T12:05:39 
12:05:39 - 12:05:33 = 6 sec

cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -al
-rw-r--r--  1 pterry amundsen    731966 Mar 12 12:05 iwsgc131_CDS_evdot01_outfmt7.blastn

wc -l iwsgc131_CDS_evdot01_outfmt7.blastn
5555 iwsgc131_CDS_evdot01_outfmt7.blastn  ## ???????????????
#4899 iwsgc131_CDS_evdot01.blastn ## with outfmt6 ????????

less iwsgc131_CDS_evdot01_outfmt7.blastn
## To do, scp this file back, examine.
cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9
scp  pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS/iwsgc131_CDS_evdot01_outfmt7.blastn .

wc -l iwsgc131_CDS_evdot01_outfmt7.blastn
    5555 iwsgc131_CDS_evdot01_outfmt7.blastn
******************************************************************************
## WOULD PREFER TABULAR outfmt 6 FORMAT, SO TO RERUN WITH 8 CUSTOM FIELDS FOR outfmt 6

## *next*, rerun blastn with 'evalue 0.01', followed by sort|uniq, count rows. This time, change outfmt to '-outfmt "6 qseqid sseqid evalue pident length qlen slen bitscore"'.


## slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt6cust.sh
## scp to crane

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt6cust.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## run script

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt6cust.sh
ls -lh
sbatch slurm_blastn131_iwgscCDS_defnohits_evdot01_outfmt6cust.sh 12209624  12:48pm => ??:??am, 
squeue -u pterry  ## 
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

sacct -j  12209624 -o start,end
2018-03-12T12:48:32 2018-03-12T12:48:36 
2018-03-12T12:48:32 2018-03-12T12:48:36 
12:48:36 - 12:48:32 = 4 sec

cd /work/baenziger/pterry/wheatproj/blast131vsiwgscCDS
ls -al
-rw-r--r--  1 pterry amundsen    360860 Mar 12 12:48 iwsgc131_CDS_evdot01_outfmt6cust.blastn

wc -l iwsgc131_CDS_evdot01_outfmt6cust.blastn
4899 iwsgc131_CDS_evdot01_outfmt6cust.blastn

less iwsgc131_CDS_evdot01_outfmt6cust.blastn
## To do, scp this file back, examine.
cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9
scp  pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/blast131vsiwgscCDS/iwsgc131_CDS_evdot01_outfmt6cust.blastn .

###############################dplyr###########################
## R session
## set dir
setwd("~/macbook2018/vikas18/131RFlike/iwgsc.2to9")
getwd()
## read in iwsgc131_CDS_evdot01_outfmt6cust.blastn
library("dplyr")
blastn01cust6df <- read.delim("iwsgc131_CDS_evdot01_outfmt6cust.blastn", header=FALSE, stringsAsFactors=FALSE, col.names=c("qseqid", "sseqid", "evalue", "pident", "length", "qlen", "slen", "bitscore"))

dim(blastn01cust6df)
View(blastn01cust6df)
head(blastn01cust6df, n=2)

## R code to calc 'fracqryaligned=length/qlen'
frac_qry_targ <- blastn01cust6df %>% select(qseqid,sseqid,evalue,length,qlen,slen) %>% 
  mutate(qryfrac=length/qlen, tarfrac=length/slen) 

dim(frac_qry_targ)
head(frac_qry_targ, n=3)

## write.table frac_qry_targ to file
write.table(frac_qry_targ, file="frac_qry_targ.blastn", quote=FALSE, sep="\t", row.names=FALSE, col.names=FALSE)


## perhaps subset rows with qry_frac < 0.50
#filter(starwars, mass > 1000)

frac_qry.50 <- frac_qry_targ %>% filter(qryfrac < 0.50)
dim(frac_qry.50)  ## [1] 2072    8

frac_targ.50 <- frac_qry_targ %>% filter(tarfrac < 0.50)
dim(frac_targ.50)  ## [1] 1887    8

## perhaps check the '16' on these parameters ?????????

## Q: how best to do ??????
## since only 16, perhaps manually in bbedit ????????????

## Q: do I want to look at the data for the hits on the 131 for qryfrac & tarfrac, since many < 0.05  ?????????????????????????

03/15/18:
## talked to vikas yesterday
i) check % coverage for the '17' (over the 131 hits) on blastn with evalue of 0.01, outfmt 6, custom output.
## possible approaches:
a. grep -f seventeen_newhits.txt frac_qry_targ.blastn > targ_17_blastn_hits_248rows.txt
b. 'cat' the 16 files prevly created, they constitute 16 of the 17 rows of 131 qry blastn hits.
c. use like bash script file to subset the 17 new hits from the 3899 frac_qry_targ.blastn file. seventeen_newhits.txt file contains the 'query' file for the task.

03/16/18:

grep -f seventeen_newhits.txt frac_qry_targ.blastn | wc -l  ## 248, same number as Philip_iwsgc131_CDS12colm_17subset.sh when run above.

grep -f seventeen_newhits.txt frac_qry_targ.blastn > targ_17_blastn_hits_248rows.txt

## To do, look at evalue colm, roughly what looks like. Evalues from 09 to 0, only 3 rows at 09. 
Then for the 17 (248 hits), check fraction querys, targets for which length aligned is < 50%? Use dplyr, R.

###############################dplyr###########################
## R session
rm(list=ls())
#
# set dir
setwd("~/macbook2018/vikas18/131RFlike/iwgsc.2to9")
getwd()
## read in targ_17_blastn_hits_248rows.txt
library("dplyr")
blastn01cust6_17_248df <- read.delim("targ_17_blastn_hits_248rows.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("qseqid", "sseqid", "evalue", "length", "qlen", "slen", "qryfrac", "tarfrac"))

dim(blastn01cust6_17_248df)
View(blastn01cust6_17_248df)
head(blastn01cust6_17_248df, n=2)

## perhaps subset rows with qry_frac < 0.50
#filter(starwars, mass > 1000)

frac_qry.50_the17 <- blastn01cust6_17_248df %>% filter(qryfrac < 0.50)
dim(frac_qry.50_the17)  ## [1] 241   8
View(frac_qry.50_the17)
summary(frac_qry.50_the17$qryfrac)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0.02899 0.09053 0.15715 0.17108 0.22591 0.48817 
frac_targ.50_the17 <- blastn01cust6_17_248df %>% filter(tarfrac < 0.50)
dim(frac_targ.50_the17)  ## [1] 55  8
View(frac_targ.50_the17)
summary(frac_targ.50_the17$tarfrac)
Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.1149  0.3354  0.3868  0.3818  0.4648  0.4985 

## so, see, 'summary for qryfrac & for tarfrac, for the 241, & 55 rows with coverage fractions < 50%, mean/medians ~ 16%, 38%. 241 of 248 query fractions < 50%.
## WHAT TO THINK ?????????????

ii) initialize box vikas sent(**TO DO**)

iii) send vikas gene names for 131 + 3 + 17 = 151
## prepare a file with these 151 names
## for the 131, could use iwsgc131_CDSnames_minus1stchar.txt for the 131
## for the 3, 
##ref 02/16/18 email to vikas or 02/14/18 above.
To finish analyzing the two orthomcl runs with 4 ctl species, 4 rows of soybean & 3 rows of arabidopsis mapped to orthogroups other than OG5_131220. 6 of these did not also map to a wheat sequence. One, OG5_170290, mapped to three.

TraesCS1A01G060500.1	OG5_170290	osat|NP_001047166	0	-181	48	100
TraesCS1B01G078800.1	OG5_170290	osat|NP_001047166	0	-181	48	100
TraesCS1D01G061400.1	OG5_170290	osat|NP_001047166	0	-181	48	100
A google search of OG5_170290 produces 'Pentatricopeptide repeat'. In PFAM, it hits PF01535 (and 2 others, all say 'PPR repeat'). PF01535 is same pfam hit by OG5_131220.

Note: these additional 3 wheat seqs are in both the 820 'P's & 1545 group, listed above.
 
## finally, the 17. Try get from precursor to seventeen_newhits.txt (want recover '.d' part of each name).

## To try:
cut -f2 targ_17_blastn_hits_248rows.txt > targ_17_blastn_hits_248rows_col2.txt
sort targ_17_blastn_hits_248rows_col2.txt |uniq | wc -l  ## 17
sort targ_17_blastn_hits_248rows_col2.txt |uniq > seventeen_newhits_with.d.txt

## now cat two files, then manually add the three rows (names) above
cat iwsgc131_CDSnames_minus1stchar.txt seventeen_newhits_with.d.txt > iwsgc_131_17_3_151names.d.txt

## vikas email (done)
a. iwsgc_131_17_3_151names.d.txt file (.d form)
b. results for 50% fraction for the 17, for qry, targ vs length

03/17/18:

iv) TO DO: ML phylogram for these 151 prot. seqs following vikas 'notes' file. See 02/16/18 above. Copy 'notes' in .../FRprotseqs/notes_...


1st, need input for muscle MSA, a prot. fasta file.

./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa iwsgc_131_17_3_151names.d.txt > iwsgc151_REPR_PROT_seqs.fa

## 1506 lines, several **very** short proteins ???????????????????????????

## Now run Notes steps ... 

## need new dir on crane to do 1st three steps, muscle, fasta2stockholm.pl, & hmmbuild.

ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir wheat151
cd wheat151
## scp iwsgc151_REPR_PROT_seqs.fa to crane, dir = wheat151
logout
## now for slurm_muscle_wheatproj_wheat151.sh
## cp slurm_muscle_wheatproj_refin131vikas6.sh to slurm_muscle_wheatproj_wheat151.sh
## edit, then scp (done)

cd 
/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp iwsgc151_REPR_PROT_seqs.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/wheat151

scp slurm_muscle_wheatproj_wheat151.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm (see line 5991)
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/wheat151
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_wheat151.sh
ls -lh
sbatch slurm_muscle_wheatproj_wheat151.sh 12281619 7:07pm => 8:53am, finally done.

squeue -u pterry  ## a PD
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          12281619     batch TJob_mus   pterry PD       0:00      1 (Priority)

cd /work/baenziger/pterry/wheatproj/wheat151
ls -lh

less job.12281619.err
sacct -j  12281619 -o start,end
              Start                 End 
------------------- ------------------- 
2018-03-18T00:30:07 2018-03-18T00:30:41 
2018-03-18T00:30:07 2018-03-18T00:30:41 
00:30:41 - 00:30:07 = 34 sec

less iwsgc151_REPR_PROT_seqs.fa.aln  ## looks to be *in* MSA fasta format.

## next, fasta2stockholm.pl conversion (line 4567)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/wheat151
ls -lh
#cd ..
#cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl iwsgc151_REPR_PROT_seqs.fa.aln > iwsgc151_REPR_PROT_seqs.fa.aln.slx
ls -al
#-rw-r--r--  1 pterry amundsen 143768 Mar 18 09:18 iwsgc151_REPR_PROT_seqs.fa.aln.slx
#-rw-r--r--  1 pterry amundsen 3400034 Feb 16 19:28 p820br9rice9soy38arab26.fa.aln.slx

## to check top of stockholm file
less iwsgc151_REPR_PROT_seqs.fa.aln.slx

## now for *hmmbuild*

## see 02/16/18 above (line 6041)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/wheat151
ls -lh

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/wheat151

hmmbuild iwsgc151_REPR_PROT_seqs.fa.aln.hmm iwsgc151_REPR_PROT_seqs.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             iwsgc151_REPR_PROT_seqs.fa.aln.slx
# output HMM file:                  iwsgc151_REPR_PROT_seqs.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     iwsgc151_REPR_PROT_seqs.fa.aln   151   930   794     2.39  0.590 

# CPU time: 2.99u 0.00s 00:00:02.99 Elapsed: 00:00:03.03

exit
less iwsgc151_REPR_PROT_seqs.fa.aln.hmm

#head -n 17 iwsgc151_REPR_PROT_seqs.fa.aln.hmm

STOPPED

## realign using hmm model, hmmalign  (refer 02/16/18, line 6076)
mv slurm_hmmalign_wheatproj_refinorthoMCL131vikas6.sh slurm_hmmalign_wheatproj_wheat151.sh
# see, from dir .../phyml/pyMLorthoMCL131vikas6

## slurm file prepared
cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_hmmalign_wheatproj_wheat151.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/wheat151
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_wheat151.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_wheat151.sh 12287821  10:26am => ??:??am, 
squeue -u pterry  ## a ST
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
cd /work/baenziger/pterry/wheatproj/wheat151
ls -lh
-rw-r--r-- 1 pterry amundsen 296K Mar 18 10:26 iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln
#-rw-r--r-- 1 pterry amundsen 7.8M Feb 16 22:22 p820br9rice9soy38arab26.fa.aln.hmmaln

sacct -j  12287821 -o start,end
2018-03-18T10:26:07 2018-03-18T10:26:19 
2018-03-18T10:26:07 2018-03-18T10:26:19 
10:26:19 - 10:26:07 = 12 sec

less iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln  ## # STOCKHOLM 1.0 format MSA

## next, stockholm2fasta.pl conversion (line 4653)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/wheat151
ls -al

#cd ..
#cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x  1 pterry amundsen    1398 Feb 16 23:21 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/wheat151
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.fa

ls -al
less iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.fa

grep -c ">Traes" iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.fa  ## 151 as expect
#grep -c ">" p820br9rice9soy38arab26.fa.aln.hmmaln.fa  ## 902 as expect
exit
#logout

## now fas to phy (line 6141)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/wheat151
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl wheat151
cd wheat151
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/wheat151
module load bioperl

./align_convert_fas_to_phy.pl iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.
-rw-r--r--  1 pterry amundsen 182730 Mar 18 13:12 iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy

exit
less iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy
 151 794
'TraesCS1A01G054800.1'  ---------- ---------- ---------- ---------- ---------- ---------- 
logout

## scp back to macbook, (line 6169)

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/wheat151/iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  182730 Mar 18 14:01 iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy

less iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy

head -n 4 iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy
 151 794
'TraesCS1A01G054800.1'  ---------- ---------- ---------- ---------- ---------- ---------- 

## so phy header   151 794, expect the 151

Then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: 
/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9/iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy

Data type: aa's
Still, no bootdstrap, rather aLRT

Name: iwsgc151_REPR_PROT_seqs

The alignment file "iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln.phy" was uploaded, it contains 151 taxons of 794 characters.

Your job was submitted. (2:12pm, sun, 03/18/18)

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20180318-201232_Wu36/cmd.txt

Execution time: 1 hour(s), 9 minute(s)

## Dnloaded from: http://www.atgc-montpellier.fr/phyml/results.php?path=20180318-201232_Wu36/sms.csv

## new location:
/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9
/iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml.zip

/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9/iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml/iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml_tree.txt

## to transfer tree file to 'pro'

in figtree
Initially asked select a name for node values, gave aLRT

tree/root tree/midpoint
'Node labels', (display aLRT, format=%, sig. digits =2, for now left on 2)
## on taxa 
## Q: should I have inluded any of the other species controls ????????????????

## initial comments of figtree display of file: /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9/iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml
/iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml_tree.txt

## couple comments for vikas email
a. 15 to 20 very short proteins in the fasta file of the 151 proteins (approximately 60 to 200 aa's)
b. have the phylogram for the 151 proteins in figtree. Looks similar to previous trees with possible RF-like input sequences. Chromosomes 1, 2, 6 clearly subset in the display. A minority of sequences on long branch lengths.

03/19/18:
## script to separate name, seq lines in a fasta file?
## like do 'summary' for the lengths of sequences in 151 protein fasta file?
## checking lengths of the proteins of the 17 in file iwsgc151_REPR_PROT_seqs.fa
## 10 of 17 not annotated as PPR = 64 aa's
## 1 of 17 not annotated as PPR =264
## 5 of 17 annotated as PPR = 263, 392, 303, 342, 363. So borderline or below criterion of 10x35 = 350 aa's.
## 1 not annotated in annotation file = 266
## uploaded iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml_tree.txt to vikas 'Box'
## see https://unl.app.box.com/folder/0
## vikas can't access, I note a 'share' button, for moment won't push ??????????????

## to do, upload to github again. Done.

03/25/18:

1st, today, recreate iwsgc_131_17_3_151names.d.txt (made a modifn by mistake)

## now cat two files, then manually add the three rows (names) above
cat iwsgc131_CDSnames_minus1stchar.txt seventeen_newhits_with.d.txt > iwsgc_131_17_3_151names.d.txt

## 3 rows added manually => 151 rows again.
## now create five_17minus12_with.d.txt
cp seventeen_newhits_with.d.txt five_17minus12_with.d.txt
## manually delete 12 rows from five_17minus12_with.d.txt previously agreed, leaving 5 of original 17. (done)
## now, cat 131 + 5
cat iwsgc131_CDSnames_minus1stchar.txt five_17minus12_with.d.txt > iwsgc_131_5_3_139names.d.txt

## then manually add the 3 = 139 (done)

## TO DO: ML phylogram for these potential 139 RF-like prot. seqs following vikas 'notes' file. See 03/17/18 above. Copy 'notes' in .../FRprotseqs/notes_...  (line 6970)

1st, need input for muscle MSA, a prot. fasta file.

./getseq.awk iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa iwsgc_131_5_3_139names.d.txt > iwsgc139_REPR_PROT_seqs.fa

## 1467 lines, shortest are 3.
>TraesCS1A01G055500.1 217 aa's
>TraesCS1A01G066500.1 190 aa's
>TraesCS1A01G067500.1 188 aa's

## Now run Notes steps ... 

## need new dir on crane to do 1st three steps, muscle, fasta2stockholm.pl, & hmmbuild.

03/26/18:
ssh -Y pterry@crane.unl.edu
# Rrq096mN
cd /work/baenziger/pterry/wheatproj
mkdir RF139
cd RF139
## scp iwsgc139_REPR_PROT_seqs.fa to crane, dir = RF139
logout
## now for slurm_muscle_wheatproj_RF139.sh
## cp slurm_muscle_wheatproj_wheat151.sh to slurm_muscle_wheatproj_RF139.sh

## edit (done), then scp

cd 
/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp iwsgc139_REPR_PROT_seqs.fa pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/RF139

scp slurm_muscle_wheatproj_RF139.sh pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

## now, ready sbatch this slurm (see line 7001)
ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/RF139
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts

## ck if present slurm_muscle_wheatproj_RF139.sh
ls -lh
sbatch slurm_muscle_wheatproj_RF139.sh 12398498 9:58am => , finally done.

squeue -u pterry  ## a PD

             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          12398498     batch TJob_mus   pterry PD       0:00      1 (Priority)

             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

## To see, **diff.** way review run time, etc. from QIIME2 workshop ??????

cd /work/baenziger/pterry/wheatproj/RF139
ls -lh

less job.12398498.err
sacct -j  12398498 -o start,end
              Start                 End 
------------------- ------------------- 
2018-03-26T09:59:33 2018-03-26T10:00:03 
2018-03-26T09:59:33 2018-03-26T10:00:03 


less iwsgc139_REPR_PROT_seqs.fa.aln  ## looks to be *in* MSA fasta format.

## next, fasta2stockholm.pl conversion (line 7029)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/RF139
ls -lh
#cd ..
#cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/fasta2stockholm.pl .
ls -al

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load perl/5.22
perl fasta2stockholm.pl iwsgc139_REPR_PROT_seqs.fa.aln > iwsgc139_REPR_PROT_seqs.fa.aln.slx
ls -al

ls -al
-rw-r--r--  1 pterry amundsen 135124 Mar 26 11:19 iwsgc139_REPR_PROT_seqs.fa.aln.slx
#-rw-r--r--  1 pterry amundsen 143768 Mar 18 09:18 iwsgc151_REPR_PROT_seqs.fa.aln.slx

## to check top of stockholm file
less iwsgc139_REPR_PROT_seqs.fa.aln.slx

## now for *hmmbuild*

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/RF139
ls -lh

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
module load compiler/gcc/4.8 openmpi/1.8 hmmer
cd /work/baenziger/pterry/wheatproj/RF139

hmmbuild iwsgc139_REPR_PROT_seqs.fa.aln.hmm iwsgc139_REPR_PROT_seqs.fa.aln.slx
# hmmbuild :: profile HMM construction from multiple sequence alignments
# HMMER 3.1b2 (February 2015); http://hmmer.org/
# Copyright (C) 2015 Howard Hughes Medical Institute.
# Freely distributed under the GNU General Public License (GPLv3).
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# input alignment file:             iwsgc139_REPR_PROT_seqs.fa.aln.slx
# output HMM file:                  iwsgc139_REPR_PROT_seqs.fa.aln.hmm
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# idx name                  nseq  alen  mlen eff_nseq re/pos description
#---- -------------------- ----- ----- ----- -------- ------ -----------
1     iwsgc139_REPR_PROT_seqs.fa.aln   139   950   802     1.81  0.591 

# CPU time: 2.56u 0.02s 00:00:02.58 Elapsed: 00:00:02.63
exit
ls -lh
-rw-r--r-- 1 pterry amundsen 366K Mar 26 13:15 iwsgc139_REPR_PROT_seqs.fa.aln.hmm

less iwsgc139_REPR_PROT_seqs.fa.aln.hmm

#head -n 17 iwsgc139_REPR_PROT_seqs.fa.aln.hmm

## realign using hmm model, hmmalign  (refer 03/26/18, line 7086)
## copy slurm_hmmalign_wheatproj_wheat151.sh to slurm_hmmalign_wheatproj_RF139.sh

## slurm file prepared
cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp slurm_hmmalign_wheatproj_RF139.sh  pterry@crane.unl.edu:/home/baenziger/pterry/scripts/

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/RF139
ls -lh  ## ck dir contents?
cd /home/baenziger/pterry/scripts
## ck if present slurm_hmmalign_wheatproj_RF139.sh
ls -lh
sbatch slurm_hmmalign_wheatproj_RF139.sh 12401484  1:58pm => ??:??am, 
squeue -u pterry  ## a ST
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)

cd /work/baenziger/pterry/wheatproj/RF139
ls -lh
-rw-r--r-- 1 pterry amundsen 273K Mar 26 13:58 iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln
##-rw-r--r-- 1 pterry amundsen 296K Mar 18 10:26 iwsgc151_REPR_PROT_seqs.fa.aln.hmmaln

sacct -j  12401484 -o start,end
              Start                 End 
------------------- ------------------- 
2018-03-26T13:58:20 2018-03-26T13:58:30 
2018-03-26T13:58:20 2018-03-26T13:58:30 

less iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln  ## # STOCKHOLM 1.0 format MSA

## next, stockholm2fasta.pl conversion (line 7117)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/RF139
ls -al

#cd ..
#cd refinPprots131vikas6
cp /work/baenziger/pterry/wheatproj/refinPprots820/stockholm2fasta.pl .
ls -al
-rwxr-xr-x  1 pterry amundsen    1398 Feb 16 23:21 stockholm2fasta.pl

# Convert the realigned file from Stockholm to fasta format using Vikas perl script stockholm2fasta.pl.

srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/RF139
module load perl/5.22

perl stockholm2fasta.pl -c 999999 -g iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln|perl -ne 'if (/^(>.+)/) {print $1,"\n"} if (/^[^>]/) {while (m/([A-Z-])/g) { print $1 }; print "\n" }' > iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.fa

ls -al
less iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.fa

grep -c ">Traes" iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.fa  ## 139 as expect
#grep -c ">" p820br9rice9soy38arab26.fa.aln.hmmaln.fa  ## 902 as expect
exit
#logout

## now fas to phy (line 7146)

ssh -Y pterry@crane.unl.edu
# Rrq096mN 
cd /work/baenziger/pterry/wheatproj/RF139
ls -al
cd ..
cp refinPprots820/align_convert_fas_to_phy.pl RF139
cd RF139
ls -al  ## 755 after cp

--try srun, 
srun --pty --ntasks-per-node=4 --mem 4gb --qos=short $SHELL
cd /work/baenziger/pterry/wheatproj/RF139
module load bioperl

./align_convert_fas_to_phy.pl iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.fa
ls -al
## Q: will it create file & name for output, yes.

-rw-r--r--  1 pterry amundsen 169461 Mar 26 19:18 iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy

exit
less iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy
 139 802
'TraesCS1A01G073700.1'  ---------- ---------- ---------- ---------- ---------- ---------- 
logout

## scp back to macbook, (line 7173)

cd /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/RF139/iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy .
ls -al *.phy
-rw-r--r--  1 bterry  staff  169461 Mar 26 19:26 iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy

less iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy

head -n 4 iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy
 139 802
'TraesCS1A01G073700.1'  ---------- ---------- ---------- ---------- ---------- ---------- 

## so phy header    139 802, expect the 139

Then run this thru PhyMl online at http://www.atgc-montpellier.fr/phyml/
--in PhyML, could use 'aLRT', faster than bootstrapping, get similar info.

Selections:
browse: 
/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9/iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy

Data type: aa's
Still, no bootdstrap, rather aLRT

Name: iwsgc139_REPR_PROT_seqs

The alignment file "iwsgc139_REPR_PROT_seqs.fa.aln.hmmaln.phy" was uploaded, it contains 139 taxons of 802 characters.

Your job was submitted. (Mon, 03/26/18, 7:34pm)

You can check your job status here:
http://www.atgc-montpellier.fr/job_status/index.php?path=20180327-023402_Ws89/cmd.txt

Execution time: 1 hour(s), 8 minute(s)

## Dnloaded from: 
http://www.atgc-montpellier.fr/phyml/results.php?path=20180327-023402_Ws89/sms.csv

## location of 139 tree file:
/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9/iwsgc139_repr_prot_seqs_fa_aln_hmmaln_phy_phyml/iwsgc139_repr_prot_seqs_fa_aln_hmmaln_phy_phyml_tree.txt


STOPPED
03/27/18:
## to do: transfer to 'pro'. Instead, rather just dnload it from phyml to 'pro' laptop.

in figtree
Initially asked select a name for node values, gave aLRT

 tree/root tree/midpoint
'Node labels', (display aLRT, format=%, sig. digits =2, for now left on 2)
## on taxa 

## initial comments of figtree display of file: 
chroms 1, 2, 6 'mostly' group. Longest branch is a group of 3, on CS1, A, B, & D.

To do, email 'modified tree file, & 'png' file so don't have to take 'pro' to UNL.

## TO DO: the awk pgm to **find** seq lengths of fasta file ?????
## TO DO: **FIX** FOLLOWING PATHs fot the record

/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9/iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml
/iwsgc151_repr_prot_seqs_fa_aln_hmmaln_phy_phyml_tree.txt

 


## talked to vikas
1. by Wed, need rmd_wkflow_doc up to date
2. will prepare cartoon overview from
3. intron-exon plot for the 139 (subset gff3)
4. me, awk of fasta lengths for 139 .fa file, 'summary' in R
5. www.wheat-expression.com, browser

## working on wheatflowdocnotestoc4_from_ppointtmp.Rmd
grep -c "!" wheatflowdocnotestoc4_from_ppointtmp.Rmd  ## not working ??????
grep -c "\.png" wheatflowdocnotestoc4_from_ppointtmp.Rmd  ## 26



## update Rmd file, outlining this file. STOPPED (line 7535)
## note, when render, the 'html' file displayed 'IN RSTUDIO' ***has*** captions for images ????  AND, NOW THIS NEW html displayed in firefox now **HAS**
 the captions ?????????????????????????????????

## ok, 
16 images in wheatflowdocnotestoc4_from_ppointtmp.Rmd
19 png in dir .../wheatproj/rmd_wkflowdoc
29 'png' found in wheatflowdocnotestoc4_from_ppointtmp.Rmd
16 '!\[" found by bbedit in wheatflowdocnotestoc4_from_ppointtmp.Rmd

## perhaps, just identify the 'png' for the 16 images, keep only these in dir .../wheatproj/rmd_wkflowdoc ?????????
## then get 'tree' files modified from figtree for these 16 images ???????

## line 2302, 
# bash Philip_realgff3.sh sort147_nodotnum.txt > realbashtofile.gff3
## ran in less than 20 min, 789 rows, Q: should I delete last 3 pattern outputs since no chromosome specified before pass to GSDS display  (or IGV) ?????
## TO prepare for GSDS as this example 

03/28/18:
## talked to vikas
1. run intron discovery on the 139 prot. seqs in 

## to remove '\.\d' from iwsgc_131_5_3_139names.d.txt (139 rows)

## 131 +5 +3 (sorted except last 5+3, so leave like that)
wc -l iwsgc_131_5_3_139names.d.txt  ## 139, **BUT** needed last return after line 139
cat iwsgc_131_5_3_139names.d.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | wc -l  ## 139

cat iwsgc_131_5_3_139names.d.txt|perl -pe 's/(Tr.+)\.[0-9]$/\1/' | head -n 139 > iwsgc_131_5_3_139names_minus_dotd.txt
## copy Philip_realgff3.sh from .../wheatgff3 dir to /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9 dir
## check for iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 in .../131RFlike/iwgsc.2to9 dir
## not there, so copy from .../wheatgff3 dir.

03/29/18:
bash Philip_realgff3.sh iwsgc_131_5_3_139names_minus_dotd.txt > 139_131sorted.gff3
## 727 lines, 139 with 'gene'

grep -c "gene" 139_131sorted.gff3  ## 139

grep "gene" 139_131sorted.gff3 > 139_131sorted_gene.gff3

## So (1), submit .../iwgsc.2to9/139_131sorted.gff3 to http://gsds.cbi.pku.edu.cn, request png output (ref line 4788)

## previous file gsds131.png, how got from gsds site ????????????????????????/
## W8BXL5.png
## rename it to gsds139.png
mv W8BXL5.png gsds139.png
## Note: the 4 'indents' are duplicate gene names with '.2' extensions ?????????????
## perhaps they are in the gff3 file, perhaps in one of the 727 lines in 139_131sorted.gff3 file ??????????????????????


## Result: The three long branch seqs in 139 phylogram file are: 
TraesCS1A01G060500
TraesCS1B01G078800
TraesCS1D01G061400
## In gsds139.png, they have **no** introns.

**************************************************************
## ok, trying to get rmd_wkflow_doc dir up to date,
1st, get the 8 'tree' file into the dir with the path to dir. containing the tree file modified by figtree.
## They were:

sec 2.2  2nd => tree file to box, *done*
![Rice9 with 1545 proteins, possible 'P' prots in red](PPRhmmsearchsubset_plus9_clustaltree_coloredPandrice9.png)

sec 2.3.9 3rd => tree file to box, *done*
![829 red and blue](pprhmmsearchsubset_p_prots820plus9_fa_aln_hmmaln_phy_phyml_tree_nexus_2colors_scrnshot.png)


sec 2.7.9  5th, ONLY ON PRO, SO **NEED** COPY TREE FILE OVER TO mbook rmd_wkflow_doc, before to 'box'
![156_3 seqs](156_3_fa_aln_hmmaln_phy_phyml_tree_copy_bluecolored.png)



sec 2.8.7  6th, APPARENTLY, ONLY ON PRO, SO **NEED** COPY TREE FILE OVER TO mbook rmd_wkflow_doc, before to 'box'
![rice9orthomcl135](rice9orthomcl135_fa_aln_hmmaln_phy_phyml_tree.png)


03/31/18:
sec 2.9.8  7th, APPARENTLY, FIGTREE MODIFIED TREE FILE ONLY ON PRO, SO **NEED** COPY TREE FILE OVER TO mbook rmd_wkflow_doc, before to 'box'
![rice9orthomcl131](rice9orthomcl131_fa_aln_hmmaln_phy_phyml_tree.png)


sec 2.10.7  8th, figtree modified, tree file to box, *done*

![orthomcl131](orthomcl131_fa_aln_hmmaln_phy_phyml_tree.png)


sec 2.12.5  10th, APPARENTLY, FIGTREE MODIFIED TREE FILE ONLY ON PRO, SO **NEED** COPY TREE FILE OVER TO mbook rmd_wkflow_doc, before to 'box'
![131plusvikas6](orthomcl131vikas6_fa_aln_hmmaln_phy_phyml_tree.png)


sec 2.29  16th, figtree modified, tree file to box, *done* ![iwsgc139_repr_prot](iwsgc139_repr_prot_seqs_fa_aln_hmmaln_phy_phyml_tree.png)


## **now, go** in figtree_out_treefiles.txt file, find tree files for these 8 including path to post figtree version. 

## now, go to /Users/bterry/macbook2017/vikas17/wheatproj/rmd_wkflowdoc dir, rename the 4 'original' tree files for which plan bring figtree modified tree files over from 'pro' laptop.
mv 156_3_fa_aln_hmmaln_phy_phyml_tree.txt 156_3_fa_aln_hmmaln_phy_phyml_tree.txt.orig
mv rice9orthomcl135_fa_aln_hmmaln_phy_phyml_tree.txt rice9orthomcl135_fa_aln_hmmaln_phy_phyml_tree.txt.orig

mv rice9orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt rice9orthomcl131_fa_aln_hmmaln_phy_phyml_tree.txt.orig
 
mv orthomcl131vikas6_fa_aln_hmmaln_phy_phyml_tree.txt orthomcl131vikas6_fa_aln_hmmaln_phy_phyml_tree.txt.orig
 
ls -al *.orig  ## check if worked (ok, 4 files listed)

04/01/18:
## Then, copy (email) these 4 tree files over from 'pro' to dir rmd_wkflow_doc. (done)

## **yet** also copy (email) over figtree_out_treefiles.txt into rmd_wkflow_doc dir.

## finally, copy these 4 figtree modified tree files up to the 'box'. (done)

## email vikas with 'key', & Q: when, where phenomics symposium ???????

04/03/18:
talked to vikas
1. prepare sample gsds intron display with 35 input rows. To test if gene names are large enough? Example, try 186 of 727 input lines to GSDS (need split so don't split rows of a gene name across subset files, note that a '.2' gene name occurs along wi its '.1' just at row 186)

04/04/18:
head -n 186 139_131sorted.gff3 > 139_131sorted_sub1st186.gff3
## 139_131sorted.gff3 (727 lines). so want subset 1st 186 lines, submit to gsds.

## So (1), submit .../iwgsc.2to9/139_131sorted_sub1st186.gff3 to http://gsds.cbi.pku.edu.cn, request png output (ref line 7603)

## previous file gsds131.png, how got from gsds site ????????????????????????/
## E6Z54L.png
## rename it to gsds139sub1st186.png
mv E6Z54L.png gsds139sub1st186.png
## Note: the 2 'indents' are duplicate gene names with '.2' extensions ?????????????

04/05/18:
## need check '131' for '.d', is '.2' contained ????
## probably redo GDGS, this time with '.1' rather than just gene name (need be clear on what '.d' am using !!!!!!!!!!!! ????????????/

04/06/18:
## talked to vikas
--proceed wih gsds as did for 1st 186 lines, make 4 images total. For now, just take what got in 139_131sorted_sub1st186.gff3 for 1st image.

139_131sorted.gff3, 2nd image
head -n 364 139_131sorted.gff3 | tail -n 178 > 139_131sorted_sub2nd178.gff3
# check in bbedit that correct rows selected for 2nd image, ok
# 73000 -> 68900
## So (1), submit .../iwgsc.2to9/139_131sorted_sub2nd178.gff3 to http://gsds.cbi.pku.edu.cn, request png output (ref line 7603)
# ## rename it to gsds139sub2nd178.png
**************************************************************
## NOTE: iwgsc_refseqv1.0_HighConf_2017Mar13.gff3 may not be 'REPR' type file, i.e., may list more than one transcript per gene ?????????????

139_131sorted.gff3, 3rd image
head -n 544 139_131sorted.gff3 | tail -n 180 > 139_131sorted_sub3rd180.gff3
# check in bbedit that correct rows (180) selected for 3rd image, ok
# 69100 -> 311600
## So (1), submit .../iwgsc.2to9/139_131sorted_sub3rd180.gff3 to http://gsds.cbi.pku.edu.cn, request png output (ref line 7603)
# ## rename it to gsds139sub3rd180.png

04/07/18:
139_131sorted.gff3, 4th image
tail -n 183 139_131sorted.gff3 > 139_131sorted_sub4th183.gff3
# check in bbedit that correct rows (183) selected for 4th image, ok
# 21200 -> 61400
## So (1), submit .../iwgsc.2to9/139_131sorted_sub4th183.gff3 to http://gsds.cbi.pku.edu.cn, request png output (ref line 7603)
# ## rename it to gsds139sub4th183.png
mv FW5KCI.png gsds139sub4th183.png

## To Do: upload 2nd, 3rd, 4th to the 'box'. Done.
## Note: following file used to subset the '139' genes. Looks like *not* the 'REPR' type file if one exists for '.gff3' this wheat genome.
-rw-r--r--  1 bterry  staff  149076203 Mar  9  2017 iwgsc_refseqv1.0_HighConf_2017Mar13.gff3
 
04/08/18:
# slip a save to ***github*** in here

 2. phenograms (note: omit names *not* mapped to a chromosome)
--all chromosomes
--chr 1
--chr 1, concentrated location for RF-like genes

# ref line 5030, .../phyml/FRprotseqs/
1st task, subset gff3 wheat genome file with these, compare with 727 rows got above.  
##See 03/29/18 above.
-rw-r--r--@ 1 bterry  staff  2916 Mar 28 23:08 iwsgc_131_5_3_139names.d.txt
-rw-r--r--  1 bterry  staff  2638 Mar 28 23:11 iwsgc_131_5_3_139names_minus_dotd.txt
#bash Philip_realgff3.sh iwsgc_131_5_3_139names_minus_dotd.txt > 139_131sorted.gff3
## 727 lines, 139 with 'gene'
## or Philip_5colmgff3.sh
bash Philip_realgff3.sh iwsgc_131_5_3_139names.d.txt > 139_131sorted_dotd_vsfullgff3.gff3
## no **gene** rows
bash Philip_realgff3.sh iwsgc_131_5_3_139names_minus_dotd.txt > 139_131sorted_minusdotd_vsfullgff3.gff3
## 727 rows as above.

bash Philip_5colmgff3.sh iwsgc_131_5_3_139names_minus_dotd.txt > gff3_1345_9names_139.txt
## 139 rows as expect.
## next, how get 'phen_input128.txt' (phen_input131.txt)format?

## now cut colms 1,3  ## Q: will seq names in new colm 3 be a problem ???????????
cut -f 1,3 gff3_1345_9names_139.txt > gff3_cols13_139.txt

## finally, remove 1st 3 char (chr) (each row in gff3_cols13_139.txt with 
cat gff3_cols13_139.txt|perl -pe 's/chr(.+)/\1/' | head -n 139 > gff3_cols13_139nochr.txt


## (from 12/22/17)
## read into R, create 3 colm headers, add a vector, 'RF-like_seq'
## need be in dir /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

setwd("/Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9")
colm3 <- rep('RF-like_seq', 139)
class(colm3)
length(colm3)
nchar(colm3)
colm1and2 <- read.delim("gff3_cols13_139nochr.txt", header=FALSE, stringsAsFactors=FALSE, col.names=c("chr", "pos"))
phen_input <- data.frame(chr = colm1and2$chr, pos = colm1and2$pos, phenotype = colm3)
dim(phen_input)
head(phen_input, n = 3)
write.table(phen_input, file="phen_input139.txt", quote=FALSE, sep="\t", row.names=FALSE, col.names=TRUE)
## remove 3 'U' rows => phen_input136.txt
## Q: do I need to sort phen_input136.txt, the last 8 rows = 5 + 3 rows not sorted ??????
## test sort phen_input136.txt

sort phen_input136.txt |uniq | wc -l  ##     137  as expected if each record in unique. Moved header back to top.
sort phen_input136.txt |uniq > phen_input136sorted.txt
## sorting **not** needed for phenogram pgm

## ready for phenogram plots
## plot all 136, all chromosomes, pheno_gram136.png (input from phen_input136.txt)

## plot chr 1A, 24 genes, from phen_input136.txt -> pheno_gram136_chr1A10to60no_anno.png
## Note: does not give names of genes, did not have names in 3rd colm of phen_input136.txt

05/02/18:
# save github

05/25/18:

# working on updating '.Rmd' file
# lines 7609 to 7725, incorporating 5 gsds139 files
# see /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9 dir
-rw-rw-rw-@ 1 bterry  staff  268185 Mar 29 11:54 gsds139.png
-rw-rw-rw-@ 1 bterry  staff   72930 Apr  4 22:21 gsds139sub1st186.png
-rw-rw-rw-@ 1 bterry  staff   67801 Apr  6 21:31 gsds139sub2nd178.png
-rw-rw-rw-@ 1 bterry  staff   70918 Apr  6 23:49 gsds139sub3rd180.png
-rw-rw-rw-@ 1 bterry  staff   70391 Apr  7 09:17 gsds139sub4th183.png
# none of these 5 are in rmd_wkflow_doc, so copy them over (done)
 
# now for two phenograms (line 7786 & 7788), from dir Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9

# plot all 136 (139 minus 3 seqs with no designated chromosome), all chromosomes, pheno_gram136.png (input from phen_input136.txt)
# plot chr 1A, 24 genes, from phen_input136.txt -> pheno_gram136_chr1A10to60no_anno.png
# note: prevly, did single chrom example with all the seq **names**, see 12/26/17.

# working on updating '.Rmd' file
# lines 7786, 7788, incorporating 2 phen136 files in '.Rmd' file. 
# see /Users/bterry/macbook2018/vikas18/131RFlike/iwgsc.2to9 dir
-rw-rw-rw-@ 1 bterry  staff   418K Apr  8 22:08 pheno_gram136.png
-rw-rw-rw-@ 1 bterry  staff   220K Apr  8 22:32 pheno_gram136_chr1A10to60no_anno.png

Neither are in rmd_wkflow_doc dir, so copy them there. (done)


05/26/18:

# To get the 11 figtree-modified tree files to treefiles subdir, match figtree_out_treefiles.txt doc with 'box' doc. Add 3 from pro, get these tree files into treefiles dir.

# see figtree_out_treefiles.txt for paths of these files
# fig 1, probably won't use
# fig 2, 1545+9, apparently *not* phyml ????????
# fig 3, 820+9, 
# fig 4, 22plus122plus9, to get from 'pro'  ????????????????
# fig 5, 156_3,
# fig 6, rice9orthomcl135
# fig 7, rice9orthomcl131
# fig 8, orthomcl131
# fig 10, orthomcl131vikas6
# fig 14, p820br9, to get from 'pro'  ????????????????
# fig 15, iwsgc151, to get from 'pro'  ????????????????
# fig 16, iwsgc139,

05/27/18:

# Now, upload the 8 tree files in /Users/bterry/macbook2017/vikas17/wheatproj/rmd_wkflow_doc/treefiles (done)
# Then, upload the 3 tree files still on 'pro' to treefiles folder on 'box' giving a total of 11 files. (done)
# Dnload these 3 files to treefiles dir on mbook (/Users/bterry/macbook2017/vikas17/wheatproj/rmd_wkflow_doc/treefiles) (done)

05/29/18:

# make dupl of rmd_wkflow_doc dir,
# /Users/bterry/macbook2017/rmd_wkflow_doc_052818backup

# remove any tree files from /Users/bterry/macbook2017/vikas17/wheatproj/rmd_wkflow_doc (removed 7, one ended in '.orig')
# deleted listimages.txt
# for now, retain listoftreefiles.txt, JUST NOT USING RIGHT NOW.
# for now, retain oGroups144col1_to_135_nodotnum.txt, JUST NOT USING RIGHT NOW.
# for now, retain ppointtmp.txt, JUST NOT USING RIGHT NOW.
# Note: lot extra files in /Users/bterry/macbook2017/vikas17/wheatproj/rmd_wkflow_doc, FOR NOW, JUST LEAVE, *DON'T* COPY TO 'box' rmd_wkflow_doc folder.

# now, remove any tree files from rmd_wkflow_doc folder in 'box' if any. (removed 8 tree files)

# find 23 image files called in wheatflowdocnotestoc4_from_ppointtmp.Rmd. Copy to 'box' rmd_wkflow_doc folder. (16 left to copy)

# copy .Rmd, .html files to 'box' (https://unl.app.box.com/folder/48208911836)
# wheatflowdocnotestoc4_from_ppointtmp.Rmd
# wheatflowdocnotestoc4_from_ppointtmp.html
 
# *for moment*, retain other extra files from this dir.

# finish figtree_out_treefiles.txt
# copied 3 paths & sizes from ~/macbookpro2018/treefiles_4_10_11.txt file

05/30/18:

# left, *compare* the sizes in the paths with the sizes in the treefiles dir. (done, all match)

# then leave copy figtree_out_treefiles.txt in 'treefiles' dir, both on mbook & box (done)

# perhaps rerun knit for .Rmd file, check html file, make sure all 23 images are present (done, ok)

05/31/18:

06/06/18:
save to github


STOPPED

# is that all, perhaps cartoon of 'story' in html file
# then on to MEME
# gwas for RF proteins ??



## relationship protein lengths and ML phylogram ???


BR = red, Gly = pink, rice(AB) = green arab(AT) = yellow, these +ve ctls group to the left of circular phylogram. Red & pink sort og group together, yellow near pink. but note, some dispersal of a few mostly yellow & green ?????????????????????
## now highlighting chr 1, 2, 6 in turn
## they pretty much **spread around** the circular phylogram  ???????????????????
## PERHAPS SHOULD NOT HAVE USED **ALL** SEQS IN p820br9rice9soy38arab26.fa FOR hmmbuild ?????????????
## working with p820br9rice9soy38arab26_fa_aln_hmmaln_phy_phyml_tree.txt file, red [=] TraesCS1, chr 1. green [=] TraesCS2, chr 2, purple [=] TraesCS6, chr 6.






STOPPED



## a note: vikas metric of aligned length/query seq length  ???????

## Perhaps, **map** the locations of the 1545, 1602 PPR's, and setDiff to list 62 which differ ??? See if in clusters? Look back on phenogram, see if can do ???????????


STOPPED 
 

## in 131, are all hits within *same* chrom. of query seq. ?????

## find the different ones from the 22, examine


STOPPED 






iii. subset ~ 110,000 wheat .fa protein seq file using wheat protein names from 131 previously identified RF-like seqs. Check how many isoforms find (.1, .2, etc.) for 131 protein seq names.


## Note: only 3 '.2' seqs in orthoMCL131.fa, rest are '.1' tx.






scp pterry@crane.unl.edu:/work/baenziger/pterry/wheatproj/refinPprots131norice9/orthoMCL131.fa.aln.hmmaln .
less orthoMCL131.fa.aln.hmmaln
## so stockholm MSA form does not give info on 'trim' size of the stockholm format ????????????????




## To do, color rice9, blue10. Locate chr 1, 2, 3, 4, 5, 6, 7 on phylogram.
## Check if topology of rice9 vs other groups has changed when removed 135 to 131 ?????
## locate 3 seqs unique to orthoMCL.












## To do: compare with sizes in fig 3, sci.reports ref. There, spanning ~ 500kb base pair region on chromosome 10. RF regions only ~ 100 Kb. 
## To Do: Compare with the 3 regions immedly above
## To Do: compare with the 36 RFproteins from orthofinder ????????????????
## To **check**: if genes in ref regions fig 3, sci reports in my 9 'RF' genes ?????????????




## perhaps plot start & stop ?????????????????????????

## could **check** distribution of 1602 - 144 "Pentatricopeptide" if can get their start positions from gff3 file ?????



## try some code from Adam

 
for line patternfile.txt
  name = line.strip()
  for line2 in gff3file.txt
    if name in line2.split('\t')[8]
      print line2
      




STOPPED





3) ## display location all proteins (genes) all chromosomes same plot. (Q: how do ????
5) ## gene structure (vikas, online s/w) Q: think this more detailed than (3) above ?????
6) ## sequence logos (online)
7) expression data



## Q: any info on OG5_131220 orthomcl_group ?????????????????

## now venn diagram or 'UpSetR', Gehlenborg ??????????








 
 
 
 
 
## stockholm to fasta format, try internet page ????????????????
## DON'T HAVE VIKAS SCRIPT ????????????????????

## BUT, Vikas NOW trims manually ????????????????
## instead, try Gblocks ???????????????????????????????, MIGHT THERE BE A LIMIT IN FILE SIZE TO Gblocks ???????????????????????????????????

## build phylogeny (PhyML eventually ??), now, Mega (ML) ????????, what file format ????????????
## display in figtree or Mega ?????????????? 
 



## check out 'Download Alignment File' from clustal on PPRhmmsearchsubset_plus9.fa.
## clustalo-E20170703-061614-0438-15309988-oy.clustal_num
## Q: perhaps could run this file thru Gblocks to trim, then thru phylogram producing pgm like Mega, then display in Mega or figtree ???????????????


## Q: Exactly how did Vikas get to file: PPRhmmsearchsubset_plus9_clustaltree_colored ??????????????????????
## Q: what downloaded from clustal ??????????????????????, captured in BBedit ????????, then into figtree ?????????????????
## Q: perhaps 'screen captured' web display from 'Phylogenetic Tree' button, paste in BBedit, save, then load into figtree ????????????????

## Q: difference betw. PPRhmmsearchsubset_plus9_clustaltree_colored_nexus & PPRhmmsearchsubset_plus9_clustaltree & PPRhmmsearchsubset_plus9_clustaltree_colored ?????????????????????
                               


## ok, regarding the PPRhmmsearchsubset_plus9_clustaltree_colored (BBedit or grep command line ??????), 1st, separate  
'color' rows out. Take 1st 1558 lines, subtract 1st 4 = 1554 remaining (or 1st 13, don't need to subset PPRhmmsearchsubset.fa. Then, perhaps with bbedit or grep command line (???), 
find box: \]$
## save file as ...color  ## potl 'P' proteins 

find box not \]$
## save as non-color  ## potl 'PLS' proteins

## pare down to 



## Q: should PPRhmmsearchsubset.fa (1545 seqs) seqs be subset to those > some length, then append FRknownseqs_shtname_7.fa (or should include the '13s' also (i.e., > 10) ??????
## test 1-liner code at , https://stackoverflow.com/questions/23992646/sequence-length-of-fasta-file
## on the ...9.fa file.

## so, append to PPRhmmsearchsubset.fa,

Then do clustal/omega (ensembl) MSA, 'command A', save to txt file, they run thru phylogeny, finally display with figtree (Q: WHICH figtree pgm ????????), want see how compares to 'phylotree.txt.png' produced above. Looking for location the new Rf's in 3rd 'area' of that tree ????????

## so, create 11 fasta files, copy each to new file, shorten name line in each file, & reflect in name new file.


## may 1st add 3 from sykes (see below) ????? before ...
## create MSA wi hmmalign (stockholm format output)
## hmmbuild => hmm
## run on PPRhmmsearchsubset.fa, see if can pull out 'RF's' from this file.


## to check 3 on p-353, sykes
## following blasted vs ... ???????
## here, perhaps include in prepn of an hmm the following, but how  ???????????????????

i) brachypodium, gi|357139997 => ... gene prediction ???????????

ii) rice, gi|33859441

iii) maize, gi|662249846


## Q: how best get some 'RF's' from other species ??????????????


STOPPED



--take 1545 wheat PPRs (PPRhmmsearchsubset.fa) *plus* cloned RFLs
--muscle (MSA)
--BBedit, 'clean' data
--phylogeny
--plot phylogeny (figtree)



v) take output from email response (initially not from browser output ???), perhaps subset by colm 7, 'hmm name', but Q: about colm 6, 'hmm acc' ???????
## Q: how get all the email output (vikas did ?????*****?????). Q: can one get this output like email from the website ?????????
## Q: looks like at least one can dnload each of the results **separately** for each of the 500 names in the input to online hmmscan. Looks like **can't** get the form of the email output thru website? Q: currently if try 'print' the email output, it shorter than what vikas got ???????********???????????????

## At least concatenate output of multiple submissions to hnnscan, take the 'email' output.

 




iv) sort | uniq | length, see if still have same number as in PPRsec2_1562.txt (i.e., are there any duplicates)? Name this file PPRseqnames.txt 
TO CHECK that input fasta file, iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa, has these as its 'fasta names' ???????
v) apply Vikas getseq.awk to iwgsc_refseqv1.0_HighConf_REPR_PROTEIN_2017Apr03.fa & PPRseqnames.txt to get subset of fasta file from sec 2 of PPR.out. I note output from getseq.awk is a fasta fie.
## Note: if dataframe format will be needed, check my prev. method convert fasta to dataframe, then use 'merge', ref., p-224, vbuffalo book ????????????

## Q: try figure out what Vikas thinking with his blast & phylogeny analysis to 'identify gene models', that is, check ref articles how to find find RFL genes ??????????????????????

STOPPED

if the full sequence E-value is significant but the single best domain E-value is not, the target sequence is **probably** a multidomain remote homolog; but be wary, and watch out for the case where it’s just a repetitive sequence.
## so Q:, PPR proteins repetitive domains, & two E-Values significantly diff. here, **not** in hmmsrchshortpep.out ****?????????????****
## line 8217, The two columns headed #doms are two different estimates of the number of distinct domains that the target sequence contains. ... These two numbers should be about the **same**.
## note, betw. hmmsrchshortpep.out & PPR.out, **order** magnitude diff. in the two numbers. Though they are about the same.

06/11/17:
## PPR.hmm, 'inclusion threshold' on line 1540. 
## Q: p-9, sci reports ref, PPR.out drops to <10 at line 542 ??? (Q: confusion, does the 10 domains mean RFLs with at least 10 domains in sec 2 should be retained ????????????)
## (Q: p-533, mentions PPR proteins 2 to 30 tandem repeats ??????????)
## inclusion threshold, line 1539 has only 2.2 & 1 for its two estimates of number of domains.
*******************************************
## Q: OK, so how to decide among these criteria ???????????????????
*********************************************

## **sec 3**, line 1598
## Q: how use sec 3 ???????????*************?????????????????????????
*********************************************************************
## Q: perhaps for PPR.out data, for now, don't use sec 3 ??????????????????????
**********************************************************************

## line 8221, The ! or ? symbol indicates whether this domain does or does not satisfy **both** per-sequence and per-domain inclusion thresholds.
## Q: is this good criterion for whatever use sec 3 for ??????????????????
## line 8227, If the independent E-value is significant (<< 1), that means that even this single domain by itself is such a strong hit that it suffices to identify the sequence as a **significant** homolog with respect to the size of the entire original database search. You can be confident that this is a homologous domain.
## Q: (<< 1), what value ?????????????????????
## line 8228, The next **four** columns give the endpoints of the reported local alignment with respect to both the query model (“hmm from” and “hmm to”) and the target sequence (“ali from” and “ali to”).
## think recall I used these endpoints for qqch ????????????????????????????
## Q: **no** vertical '|' in PPR.out, though in hmmsrchshortpep.out ??????????????????????????????????
## Q: where is line 385075, perhaps in Trinity.fasta.transdecoder.pep file ?????, YES
## line 8250, SO WHAT TO DO ?????????
## Should be able to take 'Sequence' colm from sec 2 of hmmsearch, do %in% to find the sec 2 hits from hmmsrchshortpep.out in Trinity.fasta.transdecoder.pep file, the rows want to build Stockholm MSA file with hmmalign.
## Q: or do I want to get just the 'domains' specified in the 3rd sec of hmmsrchshortpep.out for each of the 'hits' ??????????????
## Q: but PPR.out many more domains per hit ????????????***********??????????

08/08-09/17:
the plant journal (2016) 85, 532-47, file name = cheng...journal.pdf
## Q: p-544, ***HMMs*** ??????????????******?????????????????
## also Vikas refs Scientific Reports 6 35152 2016  ## *to see*
## unl classic libr not working ????????????????????????????????????????
## and Vikas BMC paper earlier ?????????  ## *to see*

## get all appropriate (above appropriate cutoff) PPR's from PPR.out. 

## Vikas rec. way using pfam to separate P & PLS subsets of PPR ??????
## then get RFL's, see new refs from Vikas ????????
## Sci Reports, 6:35152, 2016, p-6, fig 3, Q: non-RFL genes mixed in with RFL genes ????????????????????????????????????????????
## same ref, p-2, 4 methods **identify RFL proteins within P-class** ??????????

06/11/17:

STOPPED
## so need a plan to find RF/RFL (???) genes in wheatproj.
## could start with PPR.hmm from pfam since easy.
## so finish surveying hmmsearch criteria for output (i.e., in PPR.out file). ## Note criteria, p-544, cheng paper.


## line 8822, hmmalign the **1st** output from 1st hmmsearch 

## line 8848, (Q: note, looks like maybe there should *not* be 'redirection' command ">" when run hmmbuild command ?????????????, see p-20, output '.hmm' file name will be name given in hmmbuild command ?????????????

## line 8875, 2nd run of hmmsearch with 'refined' '.hmm'

## line 8937, blastp, Q: do I want to do vs uniprotKB ***??????????***
## line 9099, slurm blastp (FAILED)
## ran uniref90, WHAT VALUE ??????????????????, listed in recent trinotate paper ???????,
## line 9214, ran slurm blastp *uniprotKB* 
## line 9231, nearly same number hit as uniref90
## line 9237, names hits different
## line 9257, compare trinity DE'd wi blastp output from NB-ARC proteins.
## line 9356, ran 'comm' command
## to line 10056 (Q: later to review)

STOPPED



